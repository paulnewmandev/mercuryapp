function hr(t,n){return function(){return t.apply(n,arguments)}}const{toString:zr}=Object.prototype,{getPrototypeOf:Vt}=Object,{iterator:$t,toStringTag:br}=Symbol,Mt=(t=>n=>{const d=zr.call(n);return t[d]||(t[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),ft=t=>(t=t.toLowerCase(),n=>Mt(n)===t),jt=t=>n=>typeof n===t,{isArray:St}=Array,wt=jt("undefined");function Lt(t){return t!==null&&!wt(t)&&t.constructor!==null&&!wt(t.constructor)&&st(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const vr=ft("ArrayBuffer");function Br(t){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(t):n=t&&t.buffer&&vr(t.buffer),n}const Wr=jt("string"),st=jt("function"),Er=jt("number"),qt=t=>t!==null&&typeof t=="object",Xr=t=>t===!0||t===!1,It=t=>{if(Mt(t)!=="object")return!1;const n=Vt(t);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(br in t)&&!($t in t)},Vr=t=>{if(!qt(t)||Lt(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},Kr=ft("Date"),Jr=ft("File"),Gr=ft("Blob"),Qr=ft("FileList"),Zr=t=>qt(t)&&st(t.pipe),Yr=t=>{let n;return t&&(typeof FormData=="function"&&t instanceof FormData||st(t.append)&&((n=Mt(t))==="formdata"||n==="object"&&st(t.toString)&&t.toString()==="[object FormData]"))},eo=ft("URLSearchParams"),[to,ro,oo,ao]=["ReadableStream","Request","Response","Headers"].map(ft),so=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ct(t,n,{allOwnKeys:d=!1}={}){if(t===null||typeof t>"u")return;let m,p;if(typeof t!="object"&&(t=[t]),St(t))for(m=0,p=t.length;m<p;m++)n.call(null,t[m],m,t);else{if(Lt(t))return;const u=d?Object.getOwnPropertyNames(t):Object.keys(t),o=u.length;let c;for(m=0;m<o;m++)c=u[m],n.call(null,t[c],c,t)}}function wr(t,n){if(Lt(t))return null;n=n.toLowerCase();const d=Object.keys(t);let m=d.length,p;for(;m-- >0;)if(p=d[m],n===p.toLowerCase())return p;return null}const ht=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Sr=t=>!wt(t)&&t!==ht;function zt(){const{caseless:t,skipUndefined:n}=Sr(this)&&this||{},d={},m=(p,u)=>{const o=t&&wr(d,u)||u;It(d[o])&&It(p)?d[o]=zt(d[o],p):It(p)?d[o]=zt({},p):St(p)?d[o]=p.slice():(!n||!wt(p))&&(d[o]=p)};for(let p=0,u=arguments.length;p<u;p++)arguments[p]&&Ct(arguments[p],m);return d}const no=(t,n,d,{allOwnKeys:m}={})=>(Ct(n,(p,u)=>{d&&st(p)?t[u]=hr(p,d):t[u]=p},{allOwnKeys:m}),t),io=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),co=(t,n,d,m)=>{t.prototype=Object.create(n.prototype,m),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:n.prototype}),d&&Object.assign(t.prototype,d)},lo=(t,n,d,m)=>{let p,u,o;const c={};if(n=n||{},t==null)return n;do{for(p=Object.getOwnPropertyNames(t),u=p.length;u-- >0;)o=p[u],(!m||m(o,t,n))&&!c[o]&&(n[o]=t[o],c[o]=!0);t=d!==!1&&Vt(t)}while(t&&(!d||d(t,n))&&t!==Object.prototype);return n},uo=(t,n,d)=>{t=String(t),(d===void 0||d>t.length)&&(d=t.length),d-=n.length;const m=t.indexOf(n,d);return m!==-1&&m===d},fo=t=>{if(!t)return null;if(St(t))return t;let n=t.length;if(!Er(n))return null;const d=new Array(n);for(;n-- >0;)d[n]=t[n];return d},po=(t=>n=>t&&n instanceof t)(typeof Uint8Array<"u"&&Vt(Uint8Array)),mo=(t,n)=>{const m=(t&&t[$t]).call(t);let p;for(;(p=m.next())&&!p.done;){const u=p.value;n.call(t,u[0],u[1])}},yo=(t,n)=>{let d;const m=[];for(;(d=t.exec(n))!==null;)m.push(d);return m},go=ft("HTMLFormElement"),ho=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,m,p){return m.toUpperCase()+p}),Yt=(({hasOwnProperty:t})=>(n,d)=>t.call(n,d))(Object.prototype),bo=ft("RegExp"),xr=(t,n)=>{const d=Object.getOwnPropertyDescriptors(t),m={};Ct(d,(p,u)=>{let o;(o=n(p,u,t))!==!1&&(m[u]=o||p)}),Object.defineProperties(t,m)},vo=t=>{xr(t,(n,d)=>{if(st(t)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const m=t[d];if(st(m)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},Eo=(t,n)=>{const d={},m=p=>{p.forEach(u=>{d[u]=!0})};return St(t)?m(t):m(String(t).split(n)),d},wo=()=>{},So=(t,n)=>t!=null&&Number.isFinite(t=+t)?t:n;function xo(t){return!!(t&&st(t.append)&&t[br]==="FormData"&&t[$t])}const ko=t=>{const n=new Array(10),d=(m,p)=>{if(qt(m)){if(n.indexOf(m)>=0)return;if(Lt(m))return m;if(!("toJSON"in m)){n[p]=m;const u=St(m)?[]:{};return Ct(m,(o,c)=>{const f=d(o,p+1);!wt(f)&&(u[c]=f)}),n[p]=void 0,u}}return m};return d(t,0)},Lo=ft("AsyncFunction"),qo=t=>t&&(qt(t)||st(t))&&st(t.then)&&st(t.catch),kr=((t,n)=>t?setImmediate:n?((d,m)=>(ht.addEventListener("message",({source:p,data:u})=>{p===ht&&u===d&&m.length&&m.shift()()},!1),p=>{m.push(p),ht.postMessage(d,"*")}))(`axios@${Math.random()}`,[]):d=>setTimeout(d))(typeof setImmediate=="function",st(ht.postMessage)),Co=typeof queueMicrotask<"u"?queueMicrotask.bind(ht):typeof process<"u"&&process.nextTick||kr,To=t=>t!=null&&st(t[$t]),he={isArray:St,isArrayBuffer:vr,isBuffer:Lt,isFormData:Yr,isArrayBufferView:Br,isString:Wr,isNumber:Er,isBoolean:Xr,isObject:qt,isPlainObject:It,isEmptyObject:Vr,isReadableStream:to,isRequest:ro,isResponse:oo,isHeaders:ao,isUndefined:wt,isDate:Kr,isFile:Jr,isBlob:Gr,isRegExp:bo,isFunction:st,isStream:Zr,isURLSearchParams:eo,isTypedArray:po,isFileList:Qr,forEach:Ct,merge:zt,extend:no,trim:so,stripBOM:io,inherits:co,toFlatObject:lo,kindOf:Mt,kindOfTest:ft,endsWith:uo,toArray:fo,forEachEntry:mo,matchAll:yo,isHTMLForm:go,hasOwnProperty:Yt,hasOwnProp:Yt,reduceDescriptors:xr,freezeMethods:vo,toObjectSet:Eo,toCamelCase:ho,noop:wo,toFiniteNumber:So,findKey:wr,global:ht,isContextDefined:Sr,isSpecCompliantForm:xo,toJSONObject:ko,isAsyncFn:Lo,isThenable:qo,setImmediate:kr,asap:Co,isIterable:To};function We(t,n,d,m,p){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",n&&(this.code=n),d&&(this.config=d),m&&(this.request=m),p&&(this.response=p,this.status=p.status?p.status:null)}he.inherits(We,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:he.toJSONObject(this.config),code:this.code,status:this.status}}});const Lr=We.prototype,qr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{qr[t]={value:t}});Object.defineProperties(We,qr);Object.defineProperty(Lr,"isAxiosError",{value:!0});We.from=(t,n,d,m,p,u)=>{const o=Object.create(Lr);he.toFlatObject(t,o,function(S){return S!==Error.prototype},x=>x!=="isAxiosError");const c=t&&t.message?t.message:"Error",f=n==null&&t?t.code:n;return We.call(o,c,f,d,m,p),t&&o.cause==null&&Object.defineProperty(o,"cause",{value:t,configurable:!0}),o.name=t&&t.name||"Error",u&&Object.assign(o,u),o};const Ao=null;function Bt(t){return he.isPlainObject(t)||he.isArray(t)}function Cr(t){return he.endsWith(t,"[]")?t.slice(0,-2):t}function er(t,n,d){return t?t.concat(n).map(function(p,u){return p=Cr(p),!d&&u?"["+p+"]":p}).join(d?".":""):n}function Io(t){return he.isArray(t)&&!t.some(Bt)}const _o=he.toFlatObject(he,{},null,function(n){return/^is[A-Z]/.test(n)});function Pt(t,n,d){if(!he.isObject(t))throw new TypeError("target must be an object");n=n||new FormData,d=he.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(R,A){return!he.isUndefined(A[R])});const m=d.metaTokens,p=d.visitor||S,u=d.dots,o=d.indexes,f=(d.Blob||typeof Blob<"u"&&Blob)&&he.isSpecCompliantForm(n);if(!he.isFunction(p))throw new TypeError("visitor must be a function");function x(E){if(E===null)return"";if(he.isDate(E))return E.toISOString();if(he.isBoolean(E))return E.toString();if(!f&&he.isBlob(E))throw new We("Blob is not supported. Use a Buffer instead.");return he.isArrayBuffer(E)||he.isTypedArray(E)?f&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function S(E,R,A){let B=E;if(E&&!A&&typeof E=="object"){if(he.endsWith(R,"{}"))R=m?R:R.slice(0,-2),E=JSON.stringify(E);else if(he.isArray(E)&&Io(E)||(he.isFileList(E)||he.endsWith(R,"[]"))&&(B=he.toArray(E)))return R=Cr(R),B.forEach(function(se,Y){!(he.isUndefined(se)||se===null)&&n.append(o===!0?er([R],Y,u):o===null?R:R+"[]",x(se))}),!1}return Bt(E)?!0:(n.append(er(A,R,u),x(E)),!1)}const P=[],M=Object.assign(_o,{defaultVisitor:S,convertValue:x,isVisitable:Bt});function L(E,R){if(!he.isUndefined(E)){if(P.indexOf(E)!==-1)throw Error("Circular reference detected in "+R.join("."));P.push(E),he.forEach(E,function(B,ie){(!(he.isUndefined(B)||B===null)&&p.call(n,B,he.isString(ie)?ie.trim():ie,R,M))===!0&&L(B,R?R.concat(ie):[ie])}),P.pop()}}if(!he.isObject(t))throw new TypeError("data must be an object");return L(t),n}function tr(t){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(m){return n[m]})}function Kt(t,n){this._pairs=[],t&&Pt(t,this,n)}const Tr=Kt.prototype;Tr.append=function(n,d){this._pairs.push([n,d])};Tr.toString=function(n){const d=n?function(m){return n.call(this,m,tr)}:tr;return this._pairs.map(function(p){return d(p[0])+"="+d(p[1])},"").join("&")};function Oo(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ar(t,n,d){if(!n)return t;const m=d&&d.encode||Oo;he.isFunction(d)&&(d={serialize:d});const p=d&&d.serialize;let u;if(p?u=p(n,d):u=he.isURLSearchParams(n)?n.toString():new Kt(n,d).toString(m),u){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}class rr{constructor(){this.handlers=[]}use(n,d,m){return this.handlers.push({fulfilled:n,rejected:d,synchronous:m?m.synchronous:!1,runWhen:m?m.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){he.forEach(this.handlers,function(m){m!==null&&n(m)})}}const Ir={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},No=typeof URLSearchParams<"u"?URLSearchParams:Kt,$o=typeof FormData<"u"?FormData:null,Mo=typeof Blob<"u"?Blob:null,jo={isBrowser:!0,classes:{URLSearchParams:No,FormData:$o,Blob:Mo},protocols:["http","https","file","blob","url","data"]},Jt=typeof window<"u"&&typeof document<"u",Wt=typeof navigator=="object"&&navigator||void 0,Po=Jt&&(!Wt||["ReactNative","NativeScript","NS"].indexOf(Wt.product)<0),Ro=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ho=Jt&&window.location.href||"http://localhost",Fo=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Jt,hasStandardBrowserEnv:Po,hasStandardBrowserWebWorkerEnv:Ro,navigator:Wt,origin:Ho},Symbol.toStringTag,{value:"Module"})),ot={...Fo,...jo};function Do(t,n){return Pt(t,new ot.classes.URLSearchParams,{visitor:function(d,m,p,u){return ot.isNode&&he.isBuffer(d)?(this.append(m,d.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)},...n})}function Uo(t){return he.matchAll(/\w+|\[(\w*)]/g,t).map(n=>n[0]==="[]"?"":n[1]||n[0])}function zo(t){const n={},d=Object.keys(t);let m;const p=d.length;let u;for(m=0;m<p;m++)u=d[m],n[u]=t[u];return n}function _r(t){function n(d,m,p,u){let o=d[u++];if(o==="__proto__")return!0;const c=Number.isFinite(+o),f=u>=d.length;return o=!o&&he.isArray(p)?p.length:o,f?(he.hasOwnProp(p,o)?p[o]=[p[o],m]:p[o]=m,!c):((!p[o]||!he.isObject(p[o]))&&(p[o]=[]),n(d,m,p[o],u)&&he.isArray(p[o])&&(p[o]=zo(p[o])),!c)}if(he.isFormData(t)&&he.isFunction(t.entries)){const d={};return he.forEachEntry(t,(m,p)=>{n(Uo(m),p,d,0)}),d}return null}function Bo(t,n,d){if(he.isString(t))try{return(n||JSON.parse)(t),he.trim(t)}catch(m){if(m.name!=="SyntaxError")throw m}return(d||JSON.stringify)(t)}const Tt={transitional:Ir,adapter:["xhr","http","fetch"],transformRequest:[function(n,d){const m=d.getContentType()||"",p=m.indexOf("application/json")>-1,u=he.isObject(n);if(u&&he.isHTMLForm(n)&&(n=new FormData(n)),he.isFormData(n))return p?JSON.stringify(_r(n)):n;if(he.isArrayBuffer(n)||he.isBuffer(n)||he.isStream(n)||he.isFile(n)||he.isBlob(n)||he.isReadableStream(n))return n;if(he.isArrayBufferView(n))return n.buffer;if(he.isURLSearchParams(n))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let c;if(u){if(m.indexOf("application/x-www-form-urlencoded")>-1)return Do(n,this.formSerializer).toString();if((c=he.isFileList(n))||m.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return Pt(c?{"files[]":n}:n,f&&new f,this.formSerializer)}}return u||p?(d.setContentType("application/json",!1),Bo(n)):n}],transformResponse:[function(n){const d=this.transitional||Tt.transitional,m=d&&d.forcedJSONParsing,p=this.responseType==="json";if(he.isResponse(n)||he.isReadableStream(n))return n;if(n&&he.isString(n)&&(m&&!this.responseType||p)){const o=!(d&&d.silentJSONParsing)&&p;try{return JSON.parse(n,this.parseReviver)}catch(c){if(o)throw c.name==="SyntaxError"?We.from(c,We.ERR_BAD_RESPONSE,this,null,this.response):c}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ot.classes.FormData,Blob:ot.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};he.forEach(["delete","get","head","post","put","patch"],t=>{Tt.headers[t]={}});const Wo=he.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xo=t=>{const n={};let d,m,p;return t&&t.split(`
`).forEach(function(o){p=o.indexOf(":"),d=o.substring(0,p).trim().toLowerCase(),m=o.substring(p+1).trim(),!(!d||n[d]&&Wo[d])&&(d==="set-cookie"?n[d]?n[d].push(m):n[d]=[m]:n[d]=n[d]?n[d]+", "+m:m)}),n},or=Symbol("internals");function kt(t){return t&&String(t).trim().toLowerCase()}function _t(t){return t===!1||t==null?t:he.isArray(t)?t.map(_t):String(t)}function Vo(t){const n=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let m;for(;m=d.exec(t);)n[m[1]]=m[2];return n}const Ko=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ft(t,n,d,m,p){if(he.isFunction(m))return m.call(this,n,d);if(p&&(n=d),!!he.isString(n)){if(he.isString(m))return n.indexOf(m)!==-1;if(he.isRegExp(m))return m.test(n)}}function Jo(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,d,m)=>d.toUpperCase()+m)}function Go(t,n){const d=he.toCamelCase(" "+n);["get","set","has"].forEach(m=>{Object.defineProperty(t,m+d,{value:function(p,u,o){return this[m].call(this,n,p,u,o)},configurable:!0})})}let nt=class{constructor(n){n&&this.set(n)}set(n,d,m){const p=this;function u(c,f,x){const S=kt(f);if(!S)throw new Error("header name must be a non-empty string");const P=he.findKey(p,S);(!P||p[P]===void 0||x===!0||x===void 0&&p[P]!==!1)&&(p[P||f]=_t(c))}const o=(c,f)=>he.forEach(c,(x,S)=>u(x,S,f));if(he.isPlainObject(n)||n instanceof this.constructor)o(n,d);else if(he.isString(n)&&(n=n.trim())&&!Ko(n))o(Xo(n),d);else if(he.isObject(n)&&he.isIterable(n)){let c={},f,x;for(const S of n){if(!he.isArray(S))throw TypeError("Object iterator must return a key-value pair");c[x=S[0]]=(f=c[x])?he.isArray(f)?[...f,S[1]]:[f,S[1]]:S[1]}o(c,d)}else n!=null&&u(d,n,m);return this}get(n,d){if(n=kt(n),n){const m=he.findKey(this,n);if(m){const p=this[m];if(!d)return p;if(d===!0)return Vo(p);if(he.isFunction(d))return d.call(this,p,m);if(he.isRegExp(d))return d.exec(p);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,d){if(n=kt(n),n){const m=he.findKey(this,n);return!!(m&&this[m]!==void 0&&(!d||Ft(this,this[m],m,d)))}return!1}delete(n,d){const m=this;let p=!1;function u(o){if(o=kt(o),o){const c=he.findKey(m,o);c&&(!d||Ft(m,m[c],c,d))&&(delete m[c],p=!0)}}return he.isArray(n)?n.forEach(u):u(n),p}clear(n){const d=Object.keys(this);let m=d.length,p=!1;for(;m--;){const u=d[m];(!n||Ft(this,this[u],u,n,!0))&&(delete this[u],p=!0)}return p}normalize(n){const d=this,m={};return he.forEach(this,(p,u)=>{const o=he.findKey(m,u);if(o){d[o]=_t(p),delete d[u];return}const c=n?Jo(u):String(u).trim();c!==u&&delete d[u],d[c]=_t(p),m[c]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const d=Object.create(null);return he.forEach(this,(m,p)=>{m!=null&&m!==!1&&(d[p]=n&&he.isArray(m)?m.join(", "):m)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,d])=>n+": "+d).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...d){const m=new this(n);return d.forEach(p=>m.set(p)),m}static accessor(n){const m=(this[or]=this[or]={accessors:{}}).accessors,p=this.prototype;function u(o){const c=kt(o);m[c]||(Go(p,o),m[c]=!0)}return he.isArray(n)?n.forEach(u):u(n),this}};nt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);he.reduceDescriptors(nt.prototype,({value:t},n)=>{let d=n[0].toUpperCase()+n.slice(1);return{get:()=>t,set(m){this[d]=m}}});he.freezeMethods(nt);function Dt(t,n){const d=this||Tt,m=n||d,p=nt.from(m.headers);let u=m.data;return he.forEach(t,function(c){u=c.call(d,u,p.normalize(),n?n.status:void 0)}),p.normalize(),u}function Or(t){return!!(t&&t.__CANCEL__)}function xt(t,n,d){We.call(this,t??"canceled",We.ERR_CANCELED,n,d),this.name="CanceledError"}he.inherits(xt,We,{__CANCEL__:!0});function Nr(t,n,d){const m=d.config.validateStatus;!d.status||!m||m(d.status)?t(d):n(new We("Request failed with status code "+d.status,[We.ERR_BAD_REQUEST,We.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}function Qo(t){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return n&&n[1]||""}function Zo(t,n){t=t||10;const d=new Array(t),m=new Array(t);let p=0,u=0,o;return n=n!==void 0?n:1e3,function(f){const x=Date.now(),S=m[u];o||(o=x),d[p]=f,m[p]=x;let P=u,M=0;for(;P!==p;)M+=d[P++],P=P%t;if(p=(p+1)%t,p===u&&(u=(u+1)%t),x-o<n)return;const L=S&&x-S;return L?Math.round(M*1e3/L):void 0}}function Yo(t,n){let d=0,m=1e3/n,p,u;const o=(x,S=Date.now())=>{d=S,p=null,u&&(clearTimeout(u),u=null),t(...x)};return[(...x)=>{const S=Date.now(),P=S-d;P>=m?o(x,S):(p=x,u||(u=setTimeout(()=>{u=null,o(p)},m-P)))},()=>p&&o(p)]}const Nt=(t,n,d=3)=>{let m=0;const p=Zo(50,250);return Yo(u=>{const o=u.loaded,c=u.lengthComputable?u.total:void 0,f=o-m,x=p(f),S=o<=c;m=o;const P={loaded:o,total:c,progress:c?o/c:void 0,bytes:f,rate:x||void 0,estimated:x&&c&&S?(c-o)/x:void 0,event:u,lengthComputable:c!=null,[n?"download":"upload"]:!0};t(P)},d)},ar=(t,n)=>{const d=t!=null;return[m=>n[0]({lengthComputable:d,total:t,loaded:m}),n[1]]},sr=t=>(...n)=>he.asap(()=>t(...n)),ea=ot.hasStandardBrowserEnv?((t,n)=>d=>(d=new URL(d,ot.origin),t.protocol===d.protocol&&t.host===d.host&&(n||t.port===d.port)))(new URL(ot.origin),ot.navigator&&/(msie|trident)/i.test(ot.navigator.userAgent)):()=>!0,ta=ot.hasStandardBrowserEnv?{write(t,n,d,m,p,u,o){if(typeof document>"u")return;const c=[`${t}=${encodeURIComponent(n)}`];he.isNumber(d)&&c.push(`expires=${new Date(d).toUTCString()}`),he.isString(m)&&c.push(`path=${m}`),he.isString(p)&&c.push(`domain=${p}`),u===!0&&c.push("secure"),he.isString(o)&&c.push(`SameSite=${o}`),document.cookie=c.join("; ")},read(t){if(typeof document>"u")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ra(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function oa(t,n){return n?t.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):t}function $r(t,n,d){let m=!ra(n);return t&&(m||d==!1)?oa(t,n):n}const nr=t=>t instanceof nt?{...t}:t;function vt(t,n){n=n||{};const d={};function m(x,S,P,M){return he.isPlainObject(x)&&he.isPlainObject(S)?he.merge.call({caseless:M},x,S):he.isPlainObject(S)?he.merge({},S):he.isArray(S)?S.slice():S}function p(x,S,P,M){if(he.isUndefined(S)){if(!he.isUndefined(x))return m(void 0,x,P,M)}else return m(x,S,P,M)}function u(x,S){if(!he.isUndefined(S))return m(void 0,S)}function o(x,S){if(he.isUndefined(S)){if(!he.isUndefined(x))return m(void 0,x)}else return m(void 0,S)}function c(x,S,P){if(P in n)return m(x,S);if(P in t)return m(void 0,x)}const f={url:u,method:u,data:u,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(x,S,P)=>p(nr(x),nr(S),P,!0)};return he.forEach(Object.keys({...t,...n}),function(S){const P=f[S]||p,M=P(t[S],n[S],S);he.isUndefined(M)&&P!==c||(d[S]=M)}),d}const Mr=t=>{const n=vt({},t);let{data:d,withXSRFToken:m,xsrfHeaderName:p,xsrfCookieName:u,headers:o,auth:c}=n;if(n.headers=o=nt.from(o),n.url=Ar($r(n.baseURL,n.url,n.allowAbsoluteUrls),t.params,t.paramsSerializer),c&&o.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),he.isFormData(d)){if(ot.hasStandardBrowserEnv||ot.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(he.isFunction(d.getHeaders)){const f=d.getHeaders(),x=["content-type","content-length"];Object.entries(f).forEach(([S,P])=>{x.includes(S.toLowerCase())&&o.set(S,P)})}}if(ot.hasStandardBrowserEnv&&(m&&he.isFunction(m)&&(m=m(n)),m||m!==!1&&ea(n.url))){const f=p&&u&&ta.read(u);f&&o.set(p,f)}return n},aa=typeof XMLHttpRequest<"u",sa=aa&&function(t){return new Promise(function(d,m){const p=Mr(t);let u=p.data;const o=nt.from(p.headers).normalize();let{responseType:c,onUploadProgress:f,onDownloadProgress:x}=p,S,P,M,L,E;function R(){L&&L(),E&&E(),p.cancelToken&&p.cancelToken.unsubscribe(S),p.signal&&p.signal.removeEventListener("abort",S)}let A=new XMLHttpRequest;A.open(p.method.toUpperCase(),p.url,!0),A.timeout=p.timeout;function B(){if(!A)return;const se=nt.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),J={data:!c||c==="text"||c==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:se,config:t,request:A};Nr(function(me){d(me),R()},function(me){m(me),R()},J),A=null}"onloadend"in A?A.onloadend=B:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(B)},A.onabort=function(){A&&(m(new We("Request aborted",We.ECONNABORTED,t,A)),A=null)},A.onerror=function(Y){const J=Y&&Y.message?Y.message:"Network Error",G=new We(J,We.ERR_NETWORK,t,A);G.event=Y||null,m(G),A=null},A.ontimeout=function(){let Y=p.timeout?"timeout of "+p.timeout+"ms exceeded":"timeout exceeded";const J=p.transitional||Ir;p.timeoutErrorMessage&&(Y=p.timeoutErrorMessage),m(new We(Y,J.clarifyTimeoutError?We.ETIMEDOUT:We.ECONNABORTED,t,A)),A=null},u===void 0&&o.setContentType(null),"setRequestHeader"in A&&he.forEach(o.toJSON(),function(Y,J){A.setRequestHeader(J,Y)}),he.isUndefined(p.withCredentials)||(A.withCredentials=!!p.withCredentials),c&&c!=="json"&&(A.responseType=p.responseType),x&&([M,E]=Nt(x,!0),A.addEventListener("progress",M)),f&&A.upload&&([P,L]=Nt(f),A.upload.addEventListener("progress",P),A.upload.addEventListener("loadend",L)),(p.cancelToken||p.signal)&&(S=se=>{A&&(m(!se||se.type?new xt(null,t,A):se),A.abort(),A=null)},p.cancelToken&&p.cancelToken.subscribe(S),p.signal&&(p.signal.aborted?S():p.signal.addEventListener("abort",S)));const ie=Qo(p.url);if(ie&&ot.protocols.indexOf(ie)===-1){m(new We("Unsupported protocol "+ie+":",We.ERR_BAD_REQUEST,t));return}A.send(u||null)})},na=(t,n)=>{const{length:d}=t=t?t.filter(Boolean):[];if(n||d){let m=new AbortController,p;const u=function(x){if(!p){p=!0,c();const S=x instanceof Error?x:this.reason;m.abort(S instanceof We?S:new xt(S instanceof Error?S.message:S))}};let o=n&&setTimeout(()=>{o=null,u(new We(`timeout ${n} of ms exceeded`,We.ETIMEDOUT))},n);const c=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(x=>{x.unsubscribe?x.unsubscribe(u):x.removeEventListener("abort",u)}),t=null)};t.forEach(x=>x.addEventListener("abort",u));const{signal:f}=m;return f.unsubscribe=()=>he.asap(c),f}},ia=function*(t,n){let d=t.byteLength;if(d<n){yield t;return}let m=0,p;for(;m<d;)p=m+n,yield t.slice(m,p),m=p},ca=async function*(t,n){for await(const d of la(t))yield*ia(d,n)},la=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const n=t.getReader();try{for(;;){const{done:d,value:m}=await n.read();if(d)break;yield m}}finally{await n.cancel()}},ir=(t,n,d,m)=>{const p=ca(t,n);let u=0,o,c=f=>{o||(o=!0,m&&m(f))};return new ReadableStream({async pull(f){try{const{done:x,value:S}=await p.next();if(x){c(),f.close();return}let P=S.byteLength;if(d){let M=u+=P;d(M)}f.enqueue(new Uint8Array(S))}catch(x){throw c(x),x}},cancel(f){return c(f),p.return()}},{highWaterMark:2})},cr=64*1024,{isFunction:At}=he,da=(({Request:t,Response:n})=>({Request:t,Response:n}))(he.global),{ReadableStream:lr,TextEncoder:dr}=he.global,ur=(t,...n)=>{try{return!!t(...n)}catch{return!1}},ua=t=>{t=he.merge.call({skipUndefined:!0},da,t);const{fetch:n,Request:d,Response:m}=t,p=n?At(n):typeof fetch=="function",u=At(d),o=At(m);if(!p)return!1;const c=p&&At(lr),f=p&&(typeof dr=="function"?(E=>R=>E.encode(R))(new dr):async E=>new Uint8Array(await new d(E).arrayBuffer())),x=u&&c&&ur(()=>{let E=!1;const R=new d(ot.origin,{body:new lr,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!R}),S=o&&c&&ur(()=>he.isReadableStream(new m("").body)),P={stream:S&&(E=>E.body)};p&&["text","arrayBuffer","blob","formData","stream"].forEach(E=>{!P[E]&&(P[E]=(R,A)=>{let B=R&&R[E];if(B)return B.call(R);throw new We(`Response type '${E}' is not supported`,We.ERR_NOT_SUPPORT,A)})});const M=async E=>{if(E==null)return 0;if(he.isBlob(E))return E.size;if(he.isSpecCompliantForm(E))return(await new d(ot.origin,{method:"POST",body:E}).arrayBuffer()).byteLength;if(he.isArrayBufferView(E)||he.isArrayBuffer(E))return E.byteLength;if(he.isURLSearchParams(E)&&(E=E+""),he.isString(E))return(await f(E)).byteLength},L=async(E,R)=>{const A=he.toFiniteNumber(E.getContentLength());return A??M(R)};return async E=>{let{url:R,method:A,data:B,signal:ie,cancelToken:se,timeout:Y,onDownloadProgress:J,onUploadProgress:G,responseType:me,headers:le,withCredentials:pe="same-origin",fetchOptions:re}=Mr(E),ne=n||fetch;me=me?(me+"").toLowerCase():"text";let r=na([ie,se&&se.toAbortSignal()],Y),a=null;const i=r&&r.unsubscribe&&(()=>{r.unsubscribe()});let s;try{if(G&&x&&A!=="get"&&A!=="head"&&(s=await L(le,B))!==0){let V=new d(R,{method:"POST",body:B,duplex:"half"}),N;if(he.isFormData(B)&&(N=V.headers.get("content-type"))&&le.setContentType(N),V.body){const[$,_]=ar(s,Nt(sr(G)));B=ir(V.body,cr,$,_)}}he.isString(pe)||(pe=pe?"include":"omit");const l=u&&"credentials"in d.prototype,y={...re,signal:r,method:A.toUpperCase(),headers:le.normalize().toJSON(),body:B,duplex:"half",credentials:l?pe:void 0};a=u&&new d(R,y);let h=await(u?ne(a,re):ne(R,y));const C=S&&(me==="stream"||me==="response");if(S&&(J||C&&i)){const V={};["status","statusText","headers"].forEach(te=>{V[te]=h[te]});const N=he.toFiniteNumber(h.headers.get("content-length")),[$,_]=J&&ar(N,Nt(sr(J),!0))||[];h=new m(ir(h.body,cr,$,()=>{_&&_(),i&&i()}),V)}me=me||"text";let D=await P[he.findKey(P,me)||"text"](h,E);return!C&&i&&i(),await new Promise((V,N)=>{Nr(V,N,{data:D,headers:nt.from(h.headers),status:h.status,statusText:h.statusText,config:E,request:a})})}catch(l){throw i&&i(),l&&l.name==="TypeError"&&/Load failed|fetch/i.test(l.message)?Object.assign(new We("Network Error",We.ERR_NETWORK,E,a),{cause:l.cause||l}):We.from(l,l&&l.code,E,a)}}},fa=new Map,jr=t=>{let n=t&&t.env||{};const{fetch:d,Request:m,Response:p}=n,u=[m,p,d];let o=u.length,c=o,f,x,S=fa;for(;c--;)f=u[c],x=S.get(f),x===void 0&&S.set(f,x=c?new Map:ua(n)),S=x;return x};jr();const Gt={http:Ao,xhr:sa,fetch:{get:jr}};he.forEach(Gt,(t,n)=>{if(t){try{Object.defineProperty(t,"name",{value:n})}catch{}Object.defineProperty(t,"adapterName",{value:n})}});const fr=t=>`- ${t}`,pa=t=>he.isFunction(t)||t===null||t===!1;function ma(t,n){t=he.isArray(t)?t:[t];const{length:d}=t;let m,p;const u={};for(let o=0;o<d;o++){m=t[o];let c;if(p=m,!pa(m)&&(p=Gt[(c=String(m)).toLowerCase()],p===void 0))throw new We(`Unknown adapter '${c}'`);if(p&&(he.isFunction(p)||(p=p.get(n))))break;u[c||"#"+o]=p}if(!p){const o=Object.entries(u).map(([f,x])=>`adapter ${f} `+(x===!1?"is not supported by the environment":"is not available in the build"));let c=d?o.length>1?`since :
`+o.map(fr).join(`
`):" "+fr(o[0]):"as no adapter specified";throw new We("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return p}const Pr={getAdapter:ma,adapters:Gt};function Ut(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new xt(null,t)}function pr(t){return Ut(t),t.headers=nt.from(t.headers),t.data=Dt.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Pr.getAdapter(t.adapter||Tt.adapter,t)(t).then(function(m){return Ut(t),m.data=Dt.call(t,t.transformResponse,m),m.headers=nt.from(m.headers),m},function(m){return Or(m)||(Ut(t),m&&m.response&&(m.response.data=Dt.call(t,t.transformResponse,m.response),m.response.headers=nt.from(m.response.headers))),Promise.reject(m)})}const Rr="1.13.2",Rt={};["object","boolean","number","function","string","symbol"].forEach((t,n)=>{Rt[t]=function(m){return typeof m===t||"a"+(n<1?"n ":" ")+t}});const mr={};Rt.transitional=function(n,d,m){function p(u,o){return"[Axios v"+Rr+"] Transitional option '"+u+"'"+o+(m?". "+m:"")}return(u,o,c)=>{if(n===!1)throw new We(p(o," has been removed"+(d?" in "+d:"")),We.ERR_DEPRECATED);return d&&!mr[o]&&(mr[o]=!0,console.warn(p(o," has been deprecated since v"+d+" and will be removed in the near future"))),n?n(u,o,c):!0}};Rt.spelling=function(n){return(d,m)=>(console.warn(`${m} is likely a misspelling of ${n}`),!0)};function ya(t,n,d){if(typeof t!="object")throw new We("options must be an object",We.ERR_BAD_OPTION_VALUE);const m=Object.keys(t);let p=m.length;for(;p-- >0;){const u=m[p],o=n[u];if(o){const c=t[u],f=c===void 0||o(c,u,t);if(f!==!0)throw new We("option "+u+" must be "+f,We.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new We("Unknown option "+u,We.ERR_BAD_OPTION)}}const Ot={assertOptions:ya,validators:Rt},pt=Ot.validators;let bt=class{constructor(n){this.defaults=n||{},this.interceptors={request:new rr,response:new rr}}async request(n,d){try{return await this._request(n,d)}catch(m){if(m instanceof Error){let p={};Error.captureStackTrace?Error.captureStackTrace(p):p=new Error;const u=p.stack?p.stack.replace(/^.+\n/,""):"";try{m.stack?u&&!String(m.stack).endsWith(u.replace(/^.+\n.+\n/,""))&&(m.stack+=`
`+u):m.stack=u}catch{}}throw m}}_request(n,d){typeof n=="string"?(d=d||{},d.url=n):d=n||{},d=vt(this.defaults,d);const{transitional:m,paramsSerializer:p,headers:u}=d;m!==void 0&&Ot.assertOptions(m,{silentJSONParsing:pt.transitional(pt.boolean),forcedJSONParsing:pt.transitional(pt.boolean),clarifyTimeoutError:pt.transitional(pt.boolean)},!1),p!=null&&(he.isFunction(p)?d.paramsSerializer={serialize:p}:Ot.assertOptions(p,{encode:pt.function,serialize:pt.function},!0)),d.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?d.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:d.allowAbsoluteUrls=!0),Ot.assertOptions(d,{baseUrl:pt.spelling("baseURL"),withXsrfToken:pt.spelling("withXSRFToken")},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();let o=u&&he.merge(u.common,u[d.method]);u&&he.forEach(["delete","get","head","post","put","patch","common"],E=>{delete u[E]}),d.headers=nt.concat(o,u);const c=[];let f=!0;this.interceptors.request.forEach(function(R){typeof R.runWhen=="function"&&R.runWhen(d)===!1||(f=f&&R.synchronous,c.unshift(R.fulfilled,R.rejected))});const x=[];this.interceptors.response.forEach(function(R){x.push(R.fulfilled,R.rejected)});let S,P=0,M;if(!f){const E=[pr.bind(this),void 0];for(E.unshift(...c),E.push(...x),M=E.length,S=Promise.resolve(d);P<M;)S=S.then(E[P++],E[P++]);return S}M=c.length;let L=d;for(;P<M;){const E=c[P++],R=c[P++];try{L=E(L)}catch(A){R.call(this,A);break}}try{S=pr.call(this,L)}catch(E){return Promise.reject(E)}for(P=0,M=x.length;P<M;)S=S.then(x[P++],x[P++]);return S}getUri(n){n=vt(this.defaults,n);const d=$r(n.baseURL,n.url,n.allowAbsoluteUrls);return Ar(d,n.params,n.paramsSerializer)}};he.forEach(["delete","get","head","options"],function(n){bt.prototype[n]=function(d,m){return this.request(vt(m||{},{method:n,url:d,data:(m||{}).data}))}});he.forEach(["post","put","patch"],function(n){function d(m){return function(u,o,c){return this.request(vt(c||{},{method:n,headers:m?{"Content-Type":"multipart/form-data"}:{},url:u,data:o}))}}bt.prototype[n]=d(),bt.prototype[n+"Form"]=d(!0)});let ga=class Hr{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(u){d=u});const m=this;this.promise.then(p=>{if(!m._listeners)return;let u=m._listeners.length;for(;u-- >0;)m._listeners[u](p);m._listeners=null}),this.promise.then=p=>{let u;const o=new Promise(c=>{m.subscribe(c),u=c}).then(p);return o.cancel=function(){m.unsubscribe(u)},o},n(function(u,o,c){m.reason||(m.reason=new xt(u,o,c),d(m.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const d=this._listeners.indexOf(n);d!==-1&&this._listeners.splice(d,1)}toAbortSignal(){const n=new AbortController,d=m=>{n.abort(m)};return this.subscribe(d),n.signal.unsubscribe=()=>this.unsubscribe(d),n.signal}static source(){let n;return{token:new Hr(function(p){n=p}),cancel:n}}};function ha(t){return function(d){return t.apply(null,d)}}function ba(t){return he.isObject(t)&&t.isAxiosError===!0}const Xt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Xt).forEach(([t,n])=>{Xt[n]=t});function Fr(t){const n=new bt(t),d=hr(bt.prototype.request,n);return he.extend(d,bt.prototype,n,{allOwnKeys:!0}),he.extend(d,n,null,{allOwnKeys:!0}),d.create=function(p){return Fr(vt(t,p))},d}const tt=Fr(Tt);tt.Axios=bt;tt.CanceledError=xt;tt.CancelToken=ga;tt.isCancel=Or;tt.VERSION=Rr;tt.toFormData=Pt;tt.AxiosError=We;tt.Cancel=tt.CanceledError;tt.all=function(n){return Promise.all(n)};tt.spread=ha;tt.isAxiosError=ba;tt.mergeConfig=vt;tt.AxiosHeaders=nt;tt.formToJSON=t=>_r(he.isHTMLForm(t)?new FormData(t):t);tt.getAdapter=Pr.getAdapter;tt.HttpStatusCode=Xt;tt.default=tt;const{Axios:Ls,AxiosError:qs,CanceledError:Cs,isCancel:Ts,CancelToken:As,VERSION:Is,all:_s,Cancel:Os,isAxiosError:Ns,spread:$s,toFormData:Ms,AxiosHeaders:js,HttpStatusCode:Ps,formToJSON:Rs,getAdapter:Hs,mergeConfig:Fs}=tt;window.axios=tt;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const va="modulepreload",Ea=function(t){return"/build/"+t},yr={},wa=function(n,d,m){let p=Promise.resolve();if(d&&d.length>0){let x=function(S){return Promise.all(S.map(P=>Promise.resolve(P).then(M=>({status:"fulfilled",value:M}),M=>({status:"rejected",reason:M}))))};var o=x;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),f=c?.nonce||c?.getAttribute("nonce");p=x(d.map(S=>{if(S=Ea(S),S in yr)return;yr[S]=!0;const P=S.endsWith(".css"),M=P?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${M}`))return;const L=document.createElement("link");if(L.rel=P?"stylesheet":va,P||(L.as="script"),L.crossOrigin="",L.href=S,f&&L.setAttribute("nonce",f),document.head.appendChild(L),P)return new Promise((E,R)=>{L.addEventListener("load",E),L.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${S}`)))})}))}function u(c){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=c,window.dispatchEvent(f),!f.defaultPrevented)throw c}return p.then(c=>{for(const f of c||[])f.status==="rejected"&&u(f.reason);return n().catch(u)})};function Sa(t={}){const{immediate:n=!1,onNeedRefresh:d,onOfflineReady:m,onRegistered:p,onRegisteredSW:u,onRegisterError:o}=t;let c,f;const x=async(P=!0)=>{await f};async function S(){if("serviceWorker"in navigator){if(c=await wa(async()=>{const{Workbox:P}=await import("./workbox-window.prod.es5-CwtvwXb3.js");return{Workbox:P}},[]).then(({Workbox:P})=>new P("/build/sw.js",{scope:"/build/",type:"classic"})).catch(P=>{o?.(P)}),!c)return;c.addEventListener("activated",P=>{(P.isUpdate||P.isExternal)&&window.location.reload()}),c.addEventListener("installed",P=>{P.isUpdate||m?.()}),c.register({immediate:n}).then(P=>{u?u("/build/sw.js",P):p?.(P)}).catch(P=>{o?.(P)})}}return f=S(),x}const xa=()=>{Sa({immediate:!0})};xa();const e=(t,n=null)=>{try{if(typeof window<"u"&&typeof window.gettext=="function")return window.gettext(t)}catch(d){console.warn("[App] translate error",d,t)}return n??t};typeof window<"u"&&(window.tx=e,window.__aviTranslate=e);const ka=()=>window.Swal?Promise.resolve(window.Swal):(window.__aviSwalLoaderPromise||(window.__aviSwalLoaderPromise=new Promise((t,n)=>{const d=document.createElement("script");d.src="https://cdn.jsdelivr.net/npm/sweetalert2@11",d.async=!0,d.onload=()=>t(window.Swal),d.onerror=()=>{window.__aviSwalLoaderPromise=null,n(new Error("No se pudo cargar SweetAlert2."))},document.head.appendChild(d)})),window.__aviSwalLoaderPromise),Dr=()=>ka().then(t=>t.mixin({buttonsStyling:!1,customClass:{popup:"rounded-3xl border border-gray-200 bg-white px-6 py-8 shadow-2xl shadow-slate-900/10 dark:border-slate-700 dark:bg-slate-900",title:"text-xl font-semibold text-gray-900 dark:text-white",htmlContainer:"text-sm text-gray-600 dark:text-gray-300",actions:"mt-6 flex items-center justify-center gap-3",confirmButton:"inline-flex items-center justify-center rounded-xl bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-primary-strong focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary",cancelButton:"inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary dark:border-slate-600 dark:bg-slate-800 dark:text-gray-200 dark:hover:bg-slate-700"}})),g=({title:t,text:n,icon:d,confirmText:m})=>{const p={success:{title:"Datos actualizados",text:"La operación se completó correctamente."},error:{title:"Error",text:"Ocurrió un problema durante la operación."},warning:{title:"Atención",text:""},info:{title:"Información",text:""}},u=d&&p[d]?p[d]:p.info;return console.log("[App] showAlert invoked",{title:t,text:n,icon:d}),Dr().then(o=>o.fire({title:t??u.title,html:n??u.text,icon:d??"info",confirmButtonText:m??e("Aceptar")})).catch(o=>(console.error("[App] Error loading SweetAlert, creating fallback modal",o),La(t??u.title,n??u.text,d??"info",m??e("Aceptar"))))},La=(t,n,d,m)=>new Promise(p=>{const u=document.getElementById("fallback-alert-modal");u&&u.remove();const o=document.createElement("div");o.id="fallback-alert-modal",o.className="fixed inset-0 z-[9999] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm",o.style.cssText="animation: fadeIn 0.2s ease-out;";const c={success:{bg:"bg-green-100",text:"text-green-600",icon:"fa-circle-check"},error:{bg:"bg-rose-100",text:"text-rose-600",icon:"fa-circle-xmark"},warning:{bg:"bg-amber-100",text:"text-amber-600",icon:"fa-triangle-exclamation"},info:{bg:"bg-blue-100",text:"text-blue-600",icon:"fa-circle-info"}},f=c[d]||c.info,x=document.createElement("div");x.className="mx-4 w-full max-w-md rounded-2xl border border-gray-200 bg-white p-6 shadow-2xl dark:border-gray-700 dark:bg-slate-900",x.style.cssText="animation: scaleIn 0.2s ease-out;",x.innerHTML=`
            <div class="flex items-start gap-4">
                <div class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full ${f.bg}">
                    <i class="fa-solid ${f.icon} text-xl ${f.text}"></i>
                </div>
                <div class="flex-1">
                    <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">${t}</h3>
                    <p class="mb-4 text-sm text-gray-600 dark:text-gray-300">${n}</p>
                    <div class="flex justify-end">
                        <button
                            type="button"
                            class="inline-flex items-center justify-center rounded-xl bg-primary px-5 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-primary-strong focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary"
                            data-fallback-alert-close
                        >
                            ${m}
                        </button>
                    </div>
                </div>
            </div>
        `,o.appendChild(x),document.body.appendChild(o);const S=x.querySelector("[data-fallback-alert-close]"),P=()=>{o.style.animation="fadeOut 0.2s ease-out",x.style.animation="scaleOut 0.2s ease-out",setTimeout(()=>{o.remove(),p({isConfirmed:!0,isDismissed:!1})},200)};S.addEventListener("click",P),o.addEventListener("click",L=>{L.target===o&&P()});const M=L=>{L.key==="Escape"&&document.getElementById("fallback-alert-modal")&&(P(),document.removeEventListener("keydown",M))};document.addEventListener("keydown",M)});if(!document.getElementById("fallback-alert-styles")){const t=document.createElement("style");t.id="fallback-alert-styles",t.textContent=`
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes scaleOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.95); opacity: 0; }
        }
    `,document.head.appendChild(t)}const qa=()=>{const t=document.querySelector('[data-flash-container="true"]');if(!t)return;const n=t.dataset.flashStatus??"",d=t.dataset.flashMessage??"",m=t.dataset.flashTitle??"";if(!n&&!d)return;const u={success:"success",error:"error",warning:"warning",info:"info"}[n]??"info";g({title:m||void 0,text:d||void 0,icon:u})},Ca=()=>{document.querySelectorAll("[data-toggle-password]").forEach((n,d)=>{const m=n.getAttribute("data-toggle-password"),p=document.getElementById(m);if(!p)return;const u=n.querySelector('[data-icon="show"]'),o=n.querySelector('[data-icon="hide"]'),c=()=>{const f=p.type==="text";n.setAttribute("aria-pressed",String(f)),u&&o&&(u.style.display=f?"none":"",o.style.display=f?"":"none")};c(),n.addEventListener("click",f=>{f.preventDefault(),p.type=p.type==="password"?"text":"password",c()})})},Ta=()=>{const t=document.getElementById("otp-form");if(!t)return;const n=Array.from(t.querySelectorAll("#otp-inputs input")),d=document.getElementById("code"),m=document.getElementById("resend-button"),p=document.getElementById("resend-feedback");if(!d||!m)return;let u=30,o;const c=()=>{d.value=n.map(L=>L.value).join("")};n.forEach((L,E)=>{L.addEventListener("keydown",R=>{R.key==="Backspace"&&!L.value&&E>0&&n[E-1].focus()}),L.addEventListener("input",()=>{L.value=L.value.replace(/\D/g,"").slice(0,1),L.value&&E<n.length-1&&n[E+1].focus(),c()}),L.addEventListener("paste",R=>{R.preventDefault();const B=((R.clipboardData||window.clipboardData).getData("text")??"").replace(/\D/g,"");if(!B)return;let ie=E;for(const Y of B){if(ie>=n.length)break;n[ie].value=Y,ie+=1}const se=Math.min(ie,n.length-1);n[se].focus(),c()})}),t.addEventListener("submit",()=>{c()});const f=L=>{const E=String(Math.floor(L/60)).padStart(2,"0"),R=String(L%60).padStart(2,"0");return`${E}:${R}`},x=()=>{m.innerHTML=`No he recibido el código (<span id="resend-countdown">${f(u)}</span>)`},S=()=>{const L=document.getElementById("resend-countdown");L&&(L.textContent=f(u))},P=()=>{m.textContent="Enviar un nuevo código"},M=()=>{m.disabled=!0,u=30,x(),p&&(p.textContent="",p.classList.remove("text-red-500")),o=setInterval(()=>{u-=1,u<=0?(clearInterval(o),m.disabled=!1,P()):S()},1e3)};M(),m.addEventListener("click",()=>{m.disabled||fetch(m.dataset.resendUrl??"",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m.dataset.csrf??""},body:JSON.stringify({email:m.dataset.email})}).then(L=>{if(!L.ok)throw new Error(`Error HTTP ${L.status}`);u=30,M(),p&&(p.textContent="Acabamos de enviarte un nuevo código.",p.classList.remove("text-red-500"))}).catch(L=>{m.disabled=!1,p&&(p.textContent="No se pudo reenviar el código. Intenta nuevamente.",p.classList.add("text-red-500"))})}),c()},Aa=()=>{const t=document.querySelectorAll("[data-theme-toggle]");if(t.length===0)return;const n=u=>{const o=u==="dark";document.documentElement.classList.toggle("dark",o),document.documentElement.style.colorScheme=o?"dark":"light",localStorage.setItem("theme",u)},d=()=>document.documentElement.classList.contains("dark")?"dark":"light",m=()=>{const u=d()==="dark";t.forEach(o=>{o.setAttribute("aria-pressed",String(u));const c=o.querySelector('[data-theme-icon="light"]'),f=o.querySelector('[data-theme-icon="dark"]');c&&(c.style.display=u?"none":"inline"),f&&(f.style.display=u?"inline":"none")})},p=localStorage.getItem("theme");p?n(p):document.documentElement.style.colorScheme=d()==="dark"?"dark":"light",m(),t.forEach(u=>{u.addEventListener("click",o=>{o.preventDefault();const c=d()==="dark"?"light":"dark";n(c),m()})})},Ia=()=>{const t=Array.from(document.querySelectorAll("[data-dropdown]"));if(t.length===0)return;const n=m=>{const p=m.querySelector("[data-dropdown-panel]"),u=m.querySelector("[data-dropdown-trigger]");p&&!p.hasAttribute("hidden")&&(p.setAttribute("hidden",""),p.classList.add("hidden")),u&&u.setAttribute("aria-expanded","false")},d=(m=null)=>{t.forEach(p=>{p!==m&&n(p)})};t.forEach(m=>{const p=m.querySelector("[data-dropdown-trigger]"),u=m.querySelector("[data-dropdown-panel]");!p||!u||(p.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),!u.hasAttribute("hidden")?n(m):(d(m),u.removeAttribute("hidden"),u.classList.remove("hidden"),p.setAttribute("aria-expanded","true"))}),u.addEventListener("click",o=>{o.stopPropagation()}))}),document.addEventListener("click",m=>{const p=m.target;if(!(p instanceof Element))return;t.some(o=>o.contains(p))||d()}),document.addEventListener("keydown",m=>{m.key==="Escape"&&d()})},_a=()=>{const t=document.querySelector("[data-sidebar]");if(!t)return;const n=document.querySelector("[data-sidebar-overlay]"),d=document.querySelector("[data-sidebar-open]"),m=document.querySelector("[data-sidebar-close]"),p=document.querySelector("[data-content-area]");let u=window.innerWidth>=1024,o=window.innerWidth<1024;const c=288;let f=!o&&!u?"compact":"expanded";const x=()=>{const B=t.getAttribute("data-sidebar-state")??"expanded",ie=t.getAttribute("data-sidebar-hover")??"false";document.body.setAttribute("data-sidebar-state",B),document.body.setAttribute("data-sidebar-hover",ie)},S=()=>window.getComputedStyle(t).position==="fixed",P=()=>{if(!p)return;if(o||!S()){p.style.marginLeft="0px";return}const B=Math.round(t.getBoundingClientRect().width);p.style.marginLeft=`${B}px`},M=()=>{o?(t.setAttribute("data-sidebar-state","expanded"),t.setAttribute("data-sidebar-hover","false")):(f=u?"expanded":"compact",t.setAttribute("data-sidebar-state",f),t.setAttribute("data-sidebar-hover","false")),requestAnimationFrame(()=>{P(),x()})},L=B=>{u=B==="expanded",M()},E=B=>{o||f==="expanded"||(t.setAttribute("data-sidebar-hover",B?"true":"false"),requestAnimationFrame(()=>{P(),x()}))},R=()=>{o?(u?(t.style.transform="translateX(0px)",t.setAttribute("data-sidebar-hover","false"),t.setAttribute("data-sidebar-state","expanded"),n&&n.classList.remove("hidden"),document.body.classList.add("overflow-hidden")):(t.style.transform=`translateX(-${c}px)`,t.setAttribute("data-sidebar-hover","false"),t.setAttribute("data-sidebar-state","expanded"),n&&n.classList.add("hidden"),document.body.classList.remove("overflow-hidden")),requestAnimationFrame(()=>{P(),x()})):(u?(t.style.transform="translateX(0px)",t.setAttribute("data-sidebar-hover","false"),L("expanded")):(t.style.transform="translateX(0px)",t.setAttribute("data-sidebar-hover","false"),L("compact")),n&&n.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};d&&d.addEventListener("click",B=>{B.preventDefault(),u=!u,R()}),m&&m.addEventListener("click",B=>{B.preventDefault(),u=!1,R()}),n&&n.addEventListener("click",B=>{B.preventDefault(),u=!1,R()}),t.addEventListener("mouseenter",()=>{E(!0)}),t.addEventListener("mouseleave",()=>{E(!1)});const A=()=>{const B=o;o=window.innerWidth<1024,o!==B&&(o?u=!1:u=!0),R(),o||M()};R(),o||M(),window.addEventListener("resize",A)},Oa=()=>{const t=document.querySelector("[data-sidebar]");if(!t)return;const n=t.querySelectorAll("[data-sidebar-collapse-trigger]");t.querySelectorAll("[data-sidebar-collapse-panel]");const d=f=>typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(f):f.replace(/[\s#.;?+*~'":!^$\[\]()=>|/@]/g,"\\$&"),m=(f=null)=>{n.forEach(x=>{if(x===f)return;const S=x.getAttribute("data-target");if(!S)return;const P=t.querySelector(`#${d(S)}`),M=x.querySelector("[data-sidebar-collapse-icon]");x.setAttribute("aria-expanded","false"),P&&P.classList.add("hidden"),M&&(M.style.transform="rotate(-90deg)")})},p=(f,x)=>{const S=f.getAttribute("data-target");if(!S)return;const P=t.querySelector(`#${d(S)}`),M=f.querySelector("[data-sidebar-collapse-icon]");f.setAttribute("aria-expanded",String(x)),P&&P.classList.toggle("hidden",!x),M&&(M.style.transform=x?"rotate(0deg)":"rotate(-90deg)")};n.forEach(f=>{p(f,!1)});let u=null;n.forEach(f=>{f.getAttribute("aria-expanded")==="true"&&!u&&(u=f)}),u&&(m(u),p(u,!0)),n.forEach(f=>{f.addEventListener("click",x=>{x.preventDefault(),f.getAttribute("aria-expanded")==="true"?p(f,!1):(m(f),p(f,!0))})}),t.querySelectorAll(".sidebar-nav-item-child").forEach(f=>{f.addEventListener("click",()=>{m()})}),t.querySelectorAll("a.sidebar-nav-item").forEach(f=>{f.tagName==="A"&&!f.hasAttribute("data-sidebar-collapse-trigger")&&f.addEventListener("click",()=>{m()})})},Na=()=>{const t=document.querySelector("[data-company-profile]");if(!t)return;const n=t.querySelector("[data-company-preview]"),d=t.querySelector("[data-company-edit]"),m=d?d.querySelector('input[name="_editing"]'):null,p=()=>{n&&n.classList.add("hidden"),d&&d.classList.remove("hidden"),m&&(m.value="1")},u=()=>{n&&n.classList.remove("hidden"),d&&d.classList.add("hidden"),m&&(m.value="0")};t.querySelectorAll("[data-company-edit-toggle]").forEach(x=>{x.addEventListener("click",S=>{S.preventDefault(),p()})}),t.querySelectorAll("[data-company-edit-cancel]").forEach(x=>{x.addEventListener("click",S=>{S.preventDefault(),u()})}),t.dataset.initialState==="editing"?p():u()},$a=()=>{const t=document.querySelectorAll("[data-dropzone]");if(t.length===0)return;const n=m=>m?m.split(",").map(p=>p.trim()).filter(Boolean):[],d=(m,p)=>{if(p.length===0)return!0;const u=m.type??"",o=m.name?.toLowerCase()??"";return p.some(c=>{if(c==="*/*")return!0;if(c.endsWith("/*")){const f=c.slice(0,-2);return u.startsWith(`${f}/`)}return c.startsWith(".")?o.endsWith(c.toLowerCase()):u===c})};t.forEach(m=>{const p=m.querySelector('input[type="file"]');if(!p)return;const u=n(m.dataset.accept??""),o=Number(m.dataset.maxSize??"10"),c=Number.isFinite(o)?o*1024*1024:10*1024*1024,f=m.querySelector("[data-dropzone-preview]"),x=m.querySelector("[data-dropzone-icon]"),S=m.querySelector("[data-dropzone-filename]"),P=m.querySelector("[data-dropzone-feedback]"),M=S?.dataset.default??S?.textContent??"",L=f?.getAttribute("data-dropzone-initial")??"",E=f?!f.classList.contains("hidden"):!1,R=J=>{f&&f.classList.toggle("hidden",!J),x&&(f?x.classList.toggle("hidden",J):x.classList.remove("hidden"))};R(E);const A=()=>{P&&(P.textContent="",P.classList.add("hidden")),m.classList.remove("has-error")},B=J=>{P&&(P.textContent=J,P.classList.remove("hidden")),S&&(S.textContent=M||"—"),f&&L&&f.setAttribute("src",L),R(E),m.classList.add("has-error"),p.value=""},ie=J=>{if(!f){R(!0);return}if(J.type&&J.type.startsWith("image/")){const G=new FileReader;G.addEventListener("load",()=>{f.setAttribute("src",String(G.result))}),G.readAsDataURL(J)}else L&&f.setAttribute("src",L);R(!0)},se=J=>{if(J.size>c){B(`El archivo supera el máximo permitido (${o} MB).`);return}if(!d(J,u)){const G=u.length>0?`Formato no permitido. Tipos válidos: ${u.join(", ")}.`:"Formato de archivo no permitido.";B(G);return}A(),S&&(S.textContent=J.name),ie(J)},Y=J=>{if(!J||J.length===0)return;const[G]=J;se(G)};m.addEventListener("click",J=>{const G=J.target;G instanceof HTMLButtonElement||G instanceof HTMLAnchorElement||p.click()}),m.addEventListener("keydown",J=>{(J.key==="Enter"||J.key===" ")&&(J.preventDefault(),p.click())}),m.addEventListener("dragover",J=>{J.preventDefault(),m.classList.add("is-dragging")}),m.addEventListener("dragleave",J=>{const G=J.relatedTarget;(!G||!m.contains(G))&&m.classList.remove("is-dragging")}),m.addEventListener("drop",J=>{J.preventDefault(),m.classList.remove("is-dragging");const G=J.dataTransfer?.files;G&&G.length>0&&(p.files=G,Y(G))}),m.querySelectorAll("[data-dropzone-trigger]").forEach(J=>{J.addEventListener("click",G=>{G.preventDefault(),G.stopPropagation(),p.click()})}),p.addEventListener("change",()=>{A(),m.classList.remove("is-dragging"),Y(p.files??void 0)})})},Ma=()=>{const t=document.querySelector('[data-dropdown="notifications"]');if(!t)return;const n=t.querySelector("[data-notification-list]");if(!n)return;const d=t.querySelectorAll("[data-notification-filter]"),m=t.querySelector(".notification-indicator"),p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";let u="all";const o=()=>Array.from(n.querySelectorAll(".notification-item")),c=()=>{const L=o(),E=L.filter(ie=>ie.dataset.isRead==="false").length,R=L.length,A=t.querySelector('[data-notification-count="all"]'),B=t.querySelector('[data-notification-count="unread"]');A&&(A.textContent=String(R)),B&&(B.textContent=String(E)),m&&m.classList.toggle("hidden",E===0)},f=()=>{let L=n.querySelector(".notification-empty");o().filter(R=>!R.classList.contains("hidden")).length===0?(L||(L=document.createElement("li"),L.className="notification-empty px-4 py-6 text-center text-xs text-secondary",n.append(L)),L.textContent=u==="unread"?"No tienes notificaciones sin leer.":"No tienes notificaciones registradas.",L.classList.remove("hidden")):L&&L.remove()},x=()=>{const L=u==="unread";o().forEach(E=>{const R=L&&E.dataset.isRead==="true";E.classList.toggle("hidden",R)}),c(),f()},S=L=>{u!==L&&(u=L,d.forEach(E=>{const R=E.dataset.notificationFilter===L;E.classList.toggle("is-active",R)}),x())};d.forEach(L=>{L.addEventListener("click",E=>{E.preventDefault(),S(L.dataset.notificationFilter??"all")})});const P=L=>{if(!L||L.dataset.isRead==="true")return;const E=L.dataset.readUrl;L.dataset.isRead="true",L.classList.remove("is-unread"),L.classList.add("is-read"),L.classList.add("cursor-default"),L.classList.remove("cursor-pointer");const R=L.querySelector("[data-notification-title]");R&&(R.classList.remove("font-semibold"),R.classList.add("font-medium"));const A=L.querySelector("[data-notification-description]");A&&(A.classList.remove("text-heading","font-medium"),A.classList.add("text-secondary")),c(),f(),E&&fetch(E,{method:"PATCH",headers:{"X-CSRF-TOKEN":p,Accept:"application/json"}}).catch(B=>{console.error("[Notifications] Error marcando como leída:",B)})},M=L=>{if(!L)return;const E=L.dataset.deleteUrl;L.remove(),x(),E&&fetch(E,{method:"DELETE",headers:{"X-CSRF-TOKEN":p,Accept:"application/json"}}).catch(R=>{console.error("[Notifications] Error eliminando notificación:",R)})};n.addEventListener("click",L=>{const E=L.target;if(!(E instanceof Element))return;const R=E.closest(".notification-delete");if(R){L.preventDefault(),L.stopPropagation();const B=R.closest(".notification-item");M(B);return}const A=E.closest(".notification-item");A&&P(A)}),n.addEventListener("keydown",L=>{if(!["Enter"," "].includes(L.key))return;const E=L.target instanceof Element?L.target.closest(".notification-item"):null;E&&(L.preventDefault(),P(E))}),x()},ja=()=>{const t=document.querySelectorAll("[data-notification-list-page]");if(t.length===0)return;const n=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";t.forEach(d=>{const m=()=>Array.from(d.querySelectorAll(".notification-list-item")),p=()=>{if(m().length===0){let c=d.querySelector(".notification-empty");c||(c=document.createElement("li"),c.className="notification-empty rounded-2xl border border-dashed border-surface px-6 py-16 text-center text-sm text-secondary",c.textContent="Aún no tienes notificaciones registradas.",d.append(c))}},u=c=>{if(!c||c.dataset.isRead==="true")return;c.dataset.isRead="true",c.classList.remove("is-unread","opacity-80","cursor-pointer"),c.classList.add("is-read","cursor-default");const f=c.querySelector(".notification-dot");f&&(f.classList.remove("bg-primary"),f.classList.add("bg-surface-muted"));const x=c.querySelector("[data-notification-title]");x&&(x.classList.remove("font-semibold"),x.classList.add("font-medium"));const S=c.querySelector("[data-notification-description]");S&&(S.classList.remove("text-heading","font-medium"),S.classList.add("text-secondary"));const P=c.dataset.readUrl;P&&fetch(P,{method:"PATCH",headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).catch(M=>{console.error("[Notifications] Error marcando como leída (listado):",M)})},o=c=>{if(!c)return;c.remove(),p();const f=c.dataset.deleteUrl;f&&fetch(f,{method:"DELETE",headers:{"X-CSRF-TOKEN":n,Accept:"application/json"}}).catch(x=>{console.error("[Notifications] Error eliminando notificación (listado):",x)})};d.addEventListener("click",c=>{const f=c.target;if(!(f instanceof Element))return;const x=f.closest(".notification-list-delete");if(x){c.preventDefault(),c.stopPropagation();const P=x.closest(".notification-list-item");o(P);return}const S=f.closest(".notification-list-item");S&&u(S)}),d.addEventListener("keydown",c=>{if(!["Enter"," "].includes(c.key))return;const f=c.target instanceof Element?c.target.closest(".notification-list-item"):null;f&&(c.preventDefault(),u(f))})})},Pa=()=>{const t=document.querySelectorAll("[data-select]:not([data-select-manual])");if(t.length===0)return;const n=m=>{const p=m.querySelector("[data-select-trigger]"),u=m.querySelector("[data-select-dropdown]"),o=m.querySelector("[data-select-icon]");!p||!u||(u.hidden=!0,u.dataset.open="false",m.dataset.open="false",p.setAttribute("aria-expanded","false"),o?.classList.remove("rotate-180"))},d=m=>{t.forEach(p=>{p!==m&&n(p)})};t.forEach(m=>{const p=m.querySelector("[data-select-trigger]"),u=m.querySelector("[data-select-dropdown]"),o=m.querySelector('input[type="hidden"]'),c=m.querySelector("[data-select-value]"),f=m.querySelector("[data-select-icon]"),x=Array.from(m.querySelectorAll("[data-select-option]")),S=p?.dataset.selectPlaceholder??"";if(!p||!u||!o||!c)return;u.dataset.open="false",m.dataset.open="false";const P=A=>{x.forEach(B=>{const ie=B.dataset.value===A;B.dataset.selected=ie?"true":"false"})},M=()=>{const A=!!o.value;p.classList.toggle("is-empty",!A)},L=(A,B)=>{o.value=A,c.textContent=B||A||S,P(A),M(),o.dispatchEvent(new Event("change",{bubbles:!0}))},E=x.find(A=>A.dataset.value===o.value);E?L(E.dataset.value??"",E.dataset.label??E.textContent.trim()):o.value||(c.textContent=S,M());const R=()=>{d(m),u.hidden=!1,u.dataset.open="true",m.dataset.open="true",p.setAttribute("aria-expanded","true"),f?.classList.add("rotate-180"),requestAnimationFrame(()=>{u.style.minWidth=`${p.getBoundingClientRect().width}px`})};p.addEventListener("click",A=>{A.preventDefault(),m.dataset.open==="true"?n(m):R()}),x.forEach(A=>{A.addEventListener("click",B=>{B.preventDefault();const ie=A.dataset.value??A.textContent.trim(),se=A.dataset.label??A.textContent.trim();L(ie,se),n(m),p.focus({preventScroll:!0})})}),m.addEventListener("keydown",A=>{A.key==="Escape"&&(n(m),p.focus({preventScroll:!0}))})}),document.addEventListener("click",m=>{const p=m.target;p instanceof Node&&(p.closest("[data-select]")||d())}),document.addEventListener("keydown",m=>{m.key==="Escape"&&d()})},rt=t=>{try{const n=window.atob(t);return JSON.parse(decodeURIComponent(escape(n)))}catch(n){return console.error("[Decode] Error decodificando payload",n),null}},Ra=()=>{const t=document.querySelector("[data-branches-root]");if(!t)return;const n=t.dataset.branchesTableId??"",d=t.dataset.branchesBaseUrl??"",m=t.dataset.branchesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-branch-modal="form"]'),view:t.querySelector('[data-branch-modal="view"]'),delete:t.querySelector('[data-branch-modal="delete"]')},o=u.form?.querySelector("[data-branch-form]")??null,c=u.form?.querySelector("[data-branch-submit]")??null,f=c?.querySelector("[data-branch-submit-label]")??null,x=u.form?.querySelector("[data-branch-modal-title]")??null,S=u.form?.querySelector("[data-branch-modal-subtitle]")??null,P=u.view?.querySelector("[data-branch-view]")??null,M=u.delete?.querySelector("[data-branch-delete-name]")??null,L=u.delete?.querySelector("[data-branch-delete-confirm]")??null,E=u.form?.querySelector("[data-branch-map]")??null,R=u.form?.querySelector("[data-branch-map-search]")??null,A=u.form?.querySelector("[data-branch-map-feedback]")??null,B=u.view?.querySelector("[data-branch-view-map]")??null,ie=t.dataset.branchesMapsKey??"",se={lat:-1.831239,lng:-78.183406};let Y=null,J=null,G=null,me=null;const le=(q,T="info")=>{A&&(A.textContent=q??"",A.classList.remove("text-rose-500","text-emerald-500"),T==="error"?A.classList.add("text-rose-500"):T==="success"&&A.classList.add("text-emerald-500"))},pe=()=>window.google?.maps?Promise.resolve(window.google.maps):ie?(window.__aviMapsLoaderPromise||(window.__aviMapsLoaderPromise=new Promise((q,T)=>{const z=document.createElement("script");z.src=`https://maps.googleapis.com/maps/api/js?key=${ie}&libraries=places`,z.async=!0,z.onload=()=>q(window.google.maps),z.onerror=()=>{window.__aviMapsLoaderPromise=null,T(new Error("No se pudo cargar Google Maps."))},document.head.appendChild(z)})),window.__aviMapsLoaderPromise):Promise.reject(new Error("Google Maps API key is not configured.")),re=q=>{if(!q)return null;if(typeof q.lat=="function")return{lat:q.lat(),lng:q.lng()};const T=Number(q.lat??q.latitude??null),z=Number(q.lng??q.longitude??null);return!Number.isFinite(T)||!Number.isFinite(z)?null:{lat:T,lng:z}},ne=q=>{q&&($("latitude",q.lat.toFixed(6)),$("longitude",q.lng.toFixed(6)))},r=(q,T={})=>{const z=re(q);!z||!Y||!J||(J.setPosition(z),T.pan!==!1&&Y.panTo(z),typeof T.zoom=="number"&&Y.setZoom(T.zoom),ne(z),le(""),T.geocode&&me&&(le("Buscando dirección..."),me.geocode({location:z},(w,k)=>{if(k==="OK"&&Array.isArray(w)&&w.length>0){const Q=w[0].formatted_address??"";$("address",Q),R&&(R.value=Q),le("Ubicación actualizada.","success")}else le("No se pudo obtener la dirección para esta ubicación.","error")})))},a=async()=>{if(!E)return null;if(Y)return Y;try{await pe()}catch(q){return console.error("[Branches] Google Maps load error",q),le("No se pudo cargar el mapa de Google.","error"),null}return Y=new window.google.maps.Map(E,{center:se,zoom:6,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!0,zoomControlOptions:{position:window.google.maps.ControlPosition.RIGHT_BOTTOM}}),J=new window.google.maps.Marker({map:Y,position:se,draggable:!0}),me=new window.google.maps.Geocoder,J.addListener("dragend",q=>{r(q.latLng,{pan:!1,geocode:!0})}),Y.addListener("click",q=>{r(q.latLng,{zoom:Y.getZoom(),geocode:!0})}),R&&(G=new window.google.maps.places.Autocomplete(R,{componentRestrictions:{country:"ec"}}),G.addListener("place_changed",()=>{const q=G.getPlace();if(!q.geometry||!q.geometry.location){le("No se pudo reconocer la ubicación seleccionada.","error");return}r(q.geometry.location,{zoom:15}),q.formatted_address&&$("address",q.formatted_address),le("Ubicación actualizada.","success")})),le(""),Y},i=(q,T,{searchValue:z}={})=>{a().then(()=>{const w=Number.isFinite(q)&&Number.isFinite(T);r(w?{lat:q,lng:T}:se,{zoom:w?15:6,pan:!1}),w||ne(se),R&&(R.value=z??""),le(""),window.setTimeout(()=>{window.google?.maps&&Y&&(window.google.maps.event.trigger(Y,"resize"),Y.panTo(J.getPosition()))},150)}).catch(w=>{console.error("[Branches] Map update error",w),le("No se pudo actualizar el mapa.","error")})},s=(q,T)=>{if(!B)return;const z=Number.isFinite(q)&&Number.isFinite(T);if(!ie){B.removeAttribute("src"),B.alt="Mapa no disponible";return}z?(B.src=`https://maps.googleapis.com/maps/api/staticmap?center=${q},${T}&zoom=15&size=640x360&maptype=roadmap&markers=color:red%7C${q},${T}&key=${ie}`,B.alt="Mapa de la ubicación seleccionada"):(B.src=`https://maps.googleapis.com/maps/api/staticmap?center=${se.lat},${se.lng}&zoom=5&size=640x360&maptype=roadmap&key=${ie}`,B.alt="Mapa general de Ecuador")},l="overflow-hidden",y=q=>q.closest("[data-branch-modal]"),h=q=>{if(q&&(q.classList.remove("hidden"),document.body.classList.add(l),q===u.form)){const T=te(_("latitude"))??se.lat,z=te(_("longitude"))??se.lng;i(T,z,{searchValue:R?.value??""})}},C=q=>{q&&(q.classList.add("hidden"),t.querySelector("[data-branch-modal]:not(.hidden)")||document.body.classList.remove(l))};t.querySelectorAll("[data-branch-modal-close]").forEach(q=>{q.addEventListener("click",()=>{const T=y(q);C(T)})}),Object.values(u).forEach(q=>{q&&(q.addEventListener("click",T=>{T.target===q&&C(q)}),q.addEventListener("keydown",T=>{T.key==="Escape"&&C(q)}))});const D=()=>{o&&(o.querySelectorAll("[data-branch-error]").forEach(q=>{q.textContent=""}),o.querySelectorAll("[data-branch-input]").forEach(q=>{q.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},V=q=>{!o||!q||Object.entries(q).forEach(([T,z])=>{const w=Array.isArray(z)?z[0]:z,k=o.querySelector(`[data-branch-error="${T}"]`),Q=o.querySelector(`[data-branch-input="${T}"]`);k&&(k.textContent=w??""),Q&&Q.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},N=q=>{!c||!f||(q?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=q)},$=(q,T)=>{if(!o)return;const z=o.querySelector(`[data-branch-input="${q}"]`);z&&(z instanceof HTMLInputElement||z instanceof HTMLTextAreaElement||z instanceof HTMLSelectElement)&&(z.value=T??"")},_=q=>{if(!o)return"";const T=o.querySelector(`[data-branch-input="${q}"]`);return T&&(T instanceof HTMLInputElement||T instanceof HTMLTextAreaElement||T instanceof HTMLSelectElement)?T.value.trim():""},te=q=>{if(q===""||q===null||q===void 0)return null;const T=Number(q);return Number.isFinite(T)?T:null},j=(q,T=null)=>{if(!o||!c||!f)return;D(),N(!1),le(""),o.dataset.mode=q,o.dataset.branchId=T?.id??"",q==="create"?(o.reset(),$("status","A"),x&&(x.textContent="Nuevo registro"),S&&(S.textContent="Completa la información para registrar un nuevo elemento."),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar registro"),S&&(S.textContent="Actualiza la información y guarda los cambios."),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),T&&($("code",T.code??""),$("name",T.name??""),$("address",T.address??""),$("website",T.website??""),$("email",T.email??""),$("phone_number",T.phone_number??""),$("latitude",T.latitude??""),$("longitude",T.longitude??""),$("status",T.status??"A"));const z=te(_("latitude")),w=te(_("longitude")),k=q==="edit"?T?.address??"":"";R&&(R.value=k),i(z,w,{searchValue:k})},X=q=>{if(!P||!q)return;P.querySelectorAll("[data-branch-view-field]").forEach(w=>{const k=w.getAttribute("data-branch-view-field");if(!k)return;const Q=q[k];if((k==="latitude"||k==="longitude")&&Q!==null&&Q!==void 0&&Q!==""){const ve=Number(Q);w.textContent=Number.isFinite(ve)?ve.toFixed(6):String(Q);return}w.textContent=Q!=null&&Q!==""?String(Q):"-"});const T=te(q.latitude),z=te(q.longitude);s(T,z)},b=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},v=async()=>{if(!o||!c||!f)return;const q=o.dataset.mode??"create",T=o.dataset.branchId??"",z={code:_("code"),name:_("name"),address:_("address")||null,website:_("website")||null,email:_("email")||null,phone_number:_("phone_number")||null,latitude:te(_("latitude")),longitude:te(_("longitude")),status:_("status")||"A"};D();const w={};(!z.code||z.code.trim()==="")&&(w.code=e("El código es obligatorio.")),(!z.name||z.name.trim()==="")&&(w.name=e("El nombre es obligatorio."));const k=z.phone_number??"",Q=z.email??"",ve=z.website??"";k!==""&&!/^[0-9()+\-\s]{4,}$/.test(k)&&(w.phone_number=e("El teléfono solo puede contener números y símbolos válidos.")),Q!==""&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Q)&&(w.email=e("Ingresa un correo electrónico válido."));try{if(ve!==""){const Ce=new URL(ve.startsWith("http")?ve:`https://${ve}`);z.website=Ce.href}}catch{w.website=e("Ingresa un sitio web válido.")}if(Object.keys(w).length>0){V(w),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}console.log("[Branches] submit payload",z),N(!0);const qe=q==="create"?m:`${d}/${T}`,_e=q==="create"?"POST":"PATCH";try{const Ce=await fetch(qe,{method:_e,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(z)}),Le=await Ce.json().catch(()=>null);if(!Ce.ok){if(Ce.status===422&&Le?.errors)V(Le.errors),g({title:e("Hay errores en el formulario"),text:Le.message??e("Revisa los campos resaltados."),icon:"error"});else if(Ce.status===403)g({title:e("Error de autorización"),text:e("No tienes permisos para realizar esta acción."),icon:"error"});else{const Ve=Le?.message??e("No fue posible guardar la información.");g({title:e("Error"),text:Ve,icon:"error"})}return}g({title:e("Éxito"),text:Le?.message??e("Acción realizada correctamente."),icon:"success"}),C(u.form),b()}catch(Ce){console.error("[Branches] Submit error",Ce),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{N(!1)}},H=async()=>{if(!u.delete||!L)return;const q=u.delete.dataset.branchId||L.dataset.branchId||"";if(!q){C(u.delete);return}L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70");try{const T=await fetch(`${d}/${q}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),z=await T.json().catch(()=>null);if(!T.ok){g({title:e("Error"),text:z?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Éxito"),text:z?.message??e("Registro eliminado correctamente."),icon:"success"}),C(u.delete),b()}catch(T){console.error("[Branches] Delete error",T),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70")}},O=async q=>{const T=q.dataset.id??"";if(!T||q.disabled)return;const z=!q.checked,w=q.checked?"A":"I";q.disabled=!0;try{const k=await fetch(`${d}/${T}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:w})}),Q=await k.json().catch(()=>null);if(!k.ok){q.checked=z,g({title:e("Error"),text:Q?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:Q?.message??e("El estado se modificó correctamente."),icon:"success"}),b()}catch(k){console.error("[Branches] Status toggle error",k),q.checked=z,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{q.disabled=!1}};t.addEventListener("click",async q=>{const T=q.target instanceof Element?q.target.closest("[data-branch-action], [data-action], [data-row-action]"):null;if(!T||!t.contains(T))return;if(T.hasAttribute("data-branch-action")){T.dataset.branchAction==="create"&&(j("create"),h(u.form));return}const z=T.dataset.action||T.dataset.rowAction;if(!z)return;const w=(T.dataset.id||T.dataset.rowId)??"";if(!w){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(z==="view"){try{const k=await fetch(`${d}/${w}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!k.ok)throw new Error("Failed to fetch branch data");const Q=await k.json();Q?.data?.item?(X(Q.data.item),h(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}catch(k){console.error("[Branches] Error loading view data",k),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}return}if(z==="edit"){try{const k=await fetch(`${d}/${w}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!k.ok)throw new Error("Failed to fetch branch data");const Q=await k.json();Q?.data?.item?(j("edit",Q.data.item),h(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}catch(k){console.error("[Branches] Error loading edit data",k),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}return}if(z==="delete"){try{const k=await fetch(`${d}/${w}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!k.ok)throw new Error("Failed to fetch branch data");const Q=await k.json();if(Q?.data?.item){const ve=Q.data.item.name??Q.data.item.code??"";u.delete&&(u.delete.dataset.branchId=w),M&&(M.textContent=ve),L&&(L.dataset.branchId=w),h(u.delete)}else g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}catch(k){console.error("[Branches] Error loading delete data",k),g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}return}}),t.addEventListener("change",q=>{const T=q.target;T instanceof HTMLInputElement&&T.matches("[data-status-toggle]")&&O(T)}),o?.addEventListener("submit",q=>{q.preventDefault(),v()}),L?.addEventListener("click",()=>{H()})},Ha=()=>{const t=document.querySelector("[data-cards-root]");if(!t)return;const n=t.dataset.cardsTableId??"",d=t.dataset.cardsBaseUrl??"",m=t.dataset.cardsStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-card-modal="form"]'),view:t.querySelector('[data-card-modal="view"]'),delete:t.querySelector('[data-card-modal="delete"]')},o=u.form?.querySelector("[data-card-form]")??null,c=u.form?.querySelector("[data-card-submit]")??null,f=c?.querySelector("[data-card-submit-label]")??null,x=u.form?.querySelector("[data-card-modal-title]")??null,S=u.view?.querySelector("[data-card-view]")??null,P=u.delete?.querySelector("[data-card-delete-name]")??null,M=u.delete?.querySelector("[data-card-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-card-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-card-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-card-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-card-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-card-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-card-error="${a}"]`),y=o.querySelector(`[data-card-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-card-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-card-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.cardId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent="Nueva tarjeta"),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar tarjeta"),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),a&&(Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A")))},le=r=>{!S||!r||S.querySelectorAll("[data-card-view-field]").forEach(a=>{const i=a.getAttribute("data-card-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.cardId??"",i=categoryHiddenInput?.value?.trim()??"",s={category_id:i!==""?i:null,name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const l={};if(i||(l.category_id=e("Selecciona una categoría.")),s.name||(l.name=e("El nombre es obligatorio.")),Object.keys(l).length>0){ie(l),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const y=r==="create"?m:`${d}/${a}`,h=r==="create"?"POST":"PATCH";try{const C=await fetch(y,{method:h,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(s)}),D=await C.json().catch(()=>null);if(!C.ok){C.status===422&&D?.errors?(ie(D.errors),g({title:e("Hay errores en el formulario"),text:D.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:D?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:D?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(C){console.error("[Cards] Submit error",C),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.cardId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[Cards] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[Cards] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",r=>{const a=r.target instanceof Element?r.target.closest("[data-card-action], [data-action], [data-row-action]"):null;if(!a)return;if(a.hasAttribute("data-card-action")){a.dataset.cardAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction,s=(a.dataset.id||a.dataset.rowId)??"",l=(a.dataset.name||a.dataset.rowName)??"";if(i==="edit"){const y=a.dataset.rowPayload;let h=y?rt(y):null;if(!h&&s&&(h={id:s,name:l||null}),!h||!h.id){g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"});return}me("edit",h),R(u.form);return}if(i==="view"){const y=a.dataset.rowPayload;let h=y?rt(y):null;if(!h&&s&&(h={id:s,name:l||null}),!h||!h.id){g({title:e("Error"),text:e("No se pudieron obtener los datos para mostrar."),icon:"error"});return}le(h),R(u.view);return}if(i==="delete"){if(!s){g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"});return}u.delete&&(u.delete.dataset.cardId=s),P&&(P.textContent=l||s),R(u.delete)}}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},Fa=()=>{const t=document.querySelector("[data-bank-accounts-root]");if(!t)return;const n=t.dataset.bankAccountsTableId??"",d=t.dataset.bankAccountsBaseUrl??"",m=t.dataset.bankAccountsStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u=(()=>{try{return JSON.parse(t.dataset.bankAccountsTypeLabels??"{}")}catch(s){return console.error("[BankAccounts] Error parsing type labels",s),{}}})(),o={form:t.querySelector('[data-bank-account-modal="form"]'),view:t.querySelector('[data-bank-account-modal="view"]'),delete:t.querySelector('[data-bank-account-modal="delete"]')},c=o.form?.querySelector("[data-bank-account-form]")??null,f=o.form?.querySelector("[data-bank-account-submit]")??null,x=f?.querySelector("[data-bank-account-submit-label]")??null,S=o.form?.querySelector("[data-bank-account-modal-title]")??null,P=o.view?.querySelector("[data-bank-account-view]")??null,M=o.delete?.querySelector("[data-bank-account-delete-name]")??null,L=o.delete?.querySelector("[data-bank-account-delete-confirm]")??null,E="overflow-hidden",R=s=>s.closest("[data-bank-account-modal]"),A=s=>{s&&(s.classList.remove("hidden"),document.body.classList.add(E))},B=s=>{s&&(s.classList.add("hidden"),t.querySelector("[data-bank-account-modal]:not(.hidden)")||document.body.classList.remove(E))};t.querySelectorAll("[data-bank-account-modal-close]").forEach(s=>{s.addEventListener("click",()=>{const l=R(s);B(l)})}),Object.values(o).forEach(s=>{s&&(s.addEventListener("click",l=>{l.target===s&&B(s)}),s.addEventListener("keydown",l=>{l.key==="Escape"&&B(s)}))});const ie=()=>{c&&(c.querySelectorAll("[data-bank-account-error]").forEach(s=>{s.textContent=""}),c.querySelectorAll("[data-bank-account-input]").forEach(s=>{s.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200");const l=s.closest("[data-select]");l&&(l.dataset.selectInvalid="false",l.querySelector("[data-select-trigger]")?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))}))},se=s=>{!c||!s||Object.entries(s).forEach(([l,y])=>{const h=Array.isArray(y)?y[0]:y,C=c.querySelector(`[data-bank-account-error="${l}"]`),D=c.querySelector(`[data-bank-account-input="${l}"]`);if(C&&(C.textContent=h??""),D){D.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");const V=D.closest("[data-select]");V&&(V.dataset.selectInvalid="true",V.querySelector("[data-select-trigger]")?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))}})},Y=s=>{!f||!x||(s?x.textContent="Procesando...":f.dataset.originalLabel&&(x.textContent=f.dataset.originalLabel),f.disabled=s)},J=(s,l)=>{if(!c)return;const y=c.querySelector(`[data-bank-account-input="${s}"]`);y&&((y instanceof HTMLSelectElement||y instanceof HTMLInputElement||y instanceof HTMLTextAreaElement)&&(y.value=l??""),me(y))},G=s=>{if(!c)return"";const l=c.querySelector(`[data-bank-account-input="${s}"]`);return l?l instanceof HTMLSelectElement?l.value:l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?l.value.trim():"":""},me=s=>{if(!(s instanceof HTMLInputElement))return;const l=s.closest("[data-select]");if(!l)return;const y=l.querySelector("[data-select-trigger]"),h=l.querySelector("[data-select-value]"),C=Array.from(l.querySelectorAll("[data-select-option]")),D=y?.dataset.selectPlaceholder??"";let V=D;C.forEach(N=>{const $=N.dataset.value===s.value&&s.value!=="";N.dataset.selected=$?"true":"false",$&&(V=N.dataset.label??N.textContent.trim())}),h&&(h.textContent=s.value?V:D),y?.classList.toggle("is-empty",!s.value)},le=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},pe=s=>u?.[s]??s??"-",re=(s,l=null)=>{if(!(!c||!f||!x)){if(ie(),Y(!1),c.dataset.mode=s,c.dataset.bankAccountId=l?.id??"",s==="create"){c.reset(),J("status","A");const y=c.querySelector('[data-bank-account-input="account_type"]');(y instanceof HTMLInputElement||y instanceof HTMLSelectElement)&&(y.value="",me(y)),S&&(S.textContent="Nueva cuenta de banco"),x.textContent="Guardar",f.dataset.originalLabel="Guardar"}else S&&(S.textContent="Editar cuenta de banco"),x.textContent="Actualizar",f.dataset.originalLabel="Actualizar";l&&(J("bank_name",l.bank_name??""),J("account_number",l.account_number??""),J("account_type",l.account_type??""),J("account_holder_name",l.account_holder_name??""),J("alias",l.alias??""),J("status",l.status??"A"))}},ne=s=>{!P||!s||P.querySelectorAll("[data-bank-account-view-field]").forEach(l=>{const y=l.getAttribute("data-bank-account-view-field");if(!y)return;let h=s[y];y==="account_type_label"&&(h=pe(s.account_type??"")??s.account_type_label??"-"),l.textContent=h!=null&&h!==""?String(h):"-"})},r=async()=>{if(!c||!f||!x)return;const s=c.dataset.mode??"create",l=c.dataset.bankAccountId??"",y={bank_name:G("bank_name"),account_number:G("account_number"),account_type:G("account_type"),account_holder_name:G("account_holder_name"),alias:G("alias")||null,status:G("status")||"A"};ie();const h={};if(y.bank_name||(h.bank_name=e("El nombre del banco es obligatorio.")),y.account_number?/^[A-Za-z0-9\-\s]{4,}$/.test(y.account_number)||(h.account_number=e("El número de cuenta debe tener al menos 4 caracteres válidos.")):h.account_number=e("El número de cuenta es obligatorio."),y.account_type||(h.account_type=e("Selecciona un tipo de cuenta.")),y.account_holder_name||(h.account_holder_name=e("El titular es obligatorio.")),Object.keys(h).length>0){se(h),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}Y(!0);const C=s==="create"?m:`${d}/${l}`,D=s==="create"?"POST":"PATCH";try{const V=await fetch(C,{method:D,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(y)}),N=await V.json().catch(()=>null);if(!V.ok){V.status===422&&N?.errors?(se(N.errors),g({title:e("Hay errores en el formulario"),text:N.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:N?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:N?.message??e("Acción realizada correctamente."),icon:"success"}),B(o.form),le()}catch(V){console.error("[BankAccounts] Submit error",V),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{Y(!1)}},a=async()=>{if(!o.delete||!L)return;const s=o.delete.dataset.bankAccountId;if(!s){B(o.delete);return}L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70");try{const l=await fetch(`${d}/${s}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),y=await l.json().catch(()=>null);if(!l.ok){g({title:e("Error"),text:y?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("Registro eliminado correctamente."),icon:"success"}),B(o.delete),le()}catch(l){console.error("[BankAccounts] Delete error",l),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70")}},i=async s=>{const l=s.dataset.id??"";if(!l||s.disabled)return;const y=!s.checked,h=s.checked?"A":"I";s.disabled=!0;try{const C=await fetch(`${d}/${l}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:h})}),D=await C.json().catch(()=>null);if(!C.ok){s.checked=y,g({title:e("Error"),text:D?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:D?.message??e("El estado se modificó correctamente."),icon:"success"}),le()}catch(C){console.error("[BankAccounts] Status toggle error",C),s.checked=y,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{s.disabled=!1}};c&&c.addEventListener("submit",s=>{s.preventDefault(),r()}),L&&L.addEventListener("click",a),t.addEventListener("click",s=>{const l=s.target instanceof Element?s.target.closest("[data-bank-account-action], [data-action], [data-row-action]"):null;if(!l||!t.contains(l))return;if(l.hasAttribute("data-bank-account-action")){l.dataset.bankAccountAction==="create"&&(re("create"),A(o.form));return}const y=l.dataset.action||l.dataset.rowAction,h=(l.dataset.id||l.dataset.rowId)??"",C=(l.dataset.name||l.dataset.rowName)??"",D=l.dataset.rowPayload;let V=D?rt(D):null;if(!V&&h&&(V={id:h,bank_name:C||null}),!y||!V||!V.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(y==="view"){!V||Object.keys(V).length<=2?fetch(`${d}/${V.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(N=>N.json()).then(N=>{N?.data?.item?(ne(N.data.item),A(o.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(N=>{console.error("[BankAccounts] Fetch error",N),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(ne(V),A(o.view));return}if(y==="edit"){!V||Object.keys(V).length<=2?fetch(`${d}/${V.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(N=>N.json()).then(N=>{N?.data?.item?(re("edit",N.data.item),A(o.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(N=>{console.error("[BankAccounts] Fetch error",N),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(re("edit",V),A(o.form));return}y==="delete"&&(o.delete&&(o.delete.dataset.bankAccountId=V.id),M&&(M.textContent=C||V.bank_name||V.alias||V.account_number||V.id),A(o.delete))}),t.addEventListener("change",s=>{const l=s.target;l instanceof HTMLInputElement&&l.matches("[data-status-toggle]")&&i(l)})},Da=()=>{const t=document.querySelector("[data-income-types-root]");if(!t)return;const n=t.dataset.incomeTypesTableId??"",d=t.dataset.incomeTypesBaseUrl??"",m=t.dataset.incomeTypesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-income-type-modal="form"]'),view:t.querySelector('[data-income-type-modal="view"]'),delete:t.querySelector('[data-income-type-modal="delete"]')},o=u.form?.querySelector("[data-income-type-form]")??null,c=u.form?.querySelector("[data-income-type-submit]")??null,f=c?.querySelector("[data-income-type-submit-label]")??null,x=u.form?.querySelector("[data-income-type-modal-title]")??null,S=u.view?.querySelector("[data-income-type-view]")??null,P=u.delete?.querySelector("[data-income-type-delete-name]")??null,M=u.delete?.querySelector("[data-income-type-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-income-type-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-income-type-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-income-type-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-income-type-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-income-type-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-income-type-error="${a}"]`),y=o.querySelector(`[data-income-type-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-income-type-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-income-type-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.incomeTypeId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent="Nuevo tipo de ingreso"),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar tipo de ingreso"),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),a&&(Y("code",a.code??""),Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A")))},le=r=>{!S||!r||S.querySelectorAll("[data-income-type-view-field]").forEach(a=>{const i=a.getAttribute("data-income-type-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.incomeTypeId??"",i={code:J("code"),name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const s={};if(i.code||(s.code=e("El código es obligatorio.")),i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[IncomeTypes] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.incomeTypeId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[IncomeTypes] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[IncomeTypes] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",async r=>{const a=r.target instanceof Element?r.target.closest("[data-income-type-action], [data-action], [data-row-action]"):null;if(!a||!t.contains(a))return;if(a.hasAttribute("data-income-type-action")){a.dataset.incomeTypeAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction;if(!i)return;const s=(a.dataset.id||a.dataset.rowId)??"";if(!s){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){try{const l=await fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch income type data");const y=await l.json();y?.data?.item?(le(y.data.item),R(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}catch(l){console.error("[IncomeTypes] Error loading view data",l),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}return}if(i==="edit"){try{const l=await fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch income type data");const y=await l.json();y?.data?.item?(me("edit",y.data.item),R(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}catch(l){console.error("[IncomeTypes] Error loading edit data",l),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}return}if(i==="delete"){try{const l=await fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch income type data");const y=await l.json();if(y?.data?.item){const h=y.data.item.name??y.data.item.code??"";u.delete&&(u.delete.dataset.incomeTypeId=s),P&&(P.textContent=h),R(u.delete)}else g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}catch(l){console.error("[IncomeTypes] Error loading delete data",l),g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}return}}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},Ua=()=>{const t=document.querySelector("[data-expense-types-root]");if(!t)return;const n=t.dataset.expenseTypesTableId??"",d=t.dataset.expenseTypesBaseUrl??"",m=t.dataset.expenseTypesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-expense-type-modal="form"]'),view:t.querySelector('[data-expense-type-modal="view"]'),delete:t.querySelector('[data-expense-type-modal="delete"]')},o=u.form?.querySelector("[data-expense-type-form]")??null,c=u.form?.querySelector("[data-expense-type-submit]")??null,f=c?.querySelector("[data-expense-type-submit-label]")??null,x=u.form?.querySelector("[data-expense-type-modal-title]")??null,S=u.view?.querySelector("[data-expense-type-view]")??null,P=u.delete?.querySelector("[data-expense-type-delete-name]")??null,M=u.delete?.querySelector("[data-expense-type-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-expense-type-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-expense-type-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-expense-type-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-expense-type-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-expense-type-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-expense-type-error="${a}"]`),y=o.querySelector(`[data-expense-type-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-expense-type-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-expense-type-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.expenseTypeId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent="Nuevo tipo de egreso"),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar tipo de egreso"),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),a&&(Y("code",a.code??""),Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A")))},le=r=>{!S||!r||S.querySelectorAll("[data-expense-type-view-field]").forEach(a=>{const i=a.getAttribute("data-expense-type-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.expenseTypeId??"",i={code:J("code"),name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const s={};if(i.code||(s.code=e("El código es obligatorio.")),i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[ExpenseTypes] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.expenseTypeId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[ExpenseTypes] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[ExpenseTypes] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",async r=>{const a=r.target instanceof Element?r.target.closest("[data-expense-type-action], [data-action], [data-row-action]"):null;if(!a||!t.contains(a))return;if(a.hasAttribute("data-expense-type-action")){a.dataset.expenseTypeAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction;if(!i)return;const s=(a.dataset.id||a.dataset.rowId)??"";if(!s){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){try{const l=await fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch expense type data");const y=await l.json();y?.data?.item?(le(y.data.item),R(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}catch(l){console.error("[ExpenseTypes] Error loading view data",l),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}return}if(i==="edit"){try{const l=await fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch expense type data");const y=await l.json();y?.data?.item?(me("edit",y.data.item),R(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}catch(l){console.error("[ExpenseTypes] Error loading edit data",l),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}return}if(i==="delete"){try{const l=await fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!l.ok)throw new Error("Failed to fetch expense type data");const y=await l.json();if(y?.data?.item){const h=y.data.item.name??y.data.item.code??"";u.delete&&(u.delete.dataset.expenseTypeId=s),P&&(P.textContent=h),R(u.delete)}else g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}catch(l){console.error("[ExpenseTypes] Error loading delete data",l),g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}return}}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},za=()=>{console.log("🔵 [ReceivableCategories] Module initialization started");const t=document.querySelectorAll("[data-receivable-categories-root]");console.log("🔵 [ReceivableCategories] Found roots",{count:t.length,roots:Array.from(t)}),document.querySelectorAll("[data-receivable-categories-root]").forEach((n,d)=>{console.log(`🔵 [ReceivableCategories] Initializing root ${d+1}`,{root:n,attributes:Array.from(n.attributes).map(i=>({name:i.name,value:i.value}))});const m=n.dataset.receivableCategoriesTableId??"",p=n.dataset.receivableCategoriesBaseUrl??"",u=n.dataset.receivableCategoriesStoreUrl??p,o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";console.log("🔵 [ReceivableCategories] init - Configuration",{tableId:m,baseUrl:p,storeUrl:u,csrfToken:o?"present":"missing",rootElement:n,allDataAttributes:Object.keys(n.dataset)});const c={form:n.querySelector('[data-receivable-category-modal="form"]'),view:n.querySelector('[data-receivable-category-modal="view"]'),delete:n.querySelector('[data-receivable-category-modal="delete"]')},f=c.form?.querySelector("[data-receivable-category-form]")??null,x=c.form?.querySelector("[data-receivable-category-submit]")??null,S=x?.querySelector("[data-receivable-category-submit-label]")??null,P=c.form?.querySelector("[data-receivable-category-modal-title]")??null,M=c.view?.querySelector("[data-receivable-category-view]")??null,L=c.delete?.querySelector("[data-receivable-category-delete-name]")??null,E=c.delete?.querySelector("[data-receivable-category-delete-confirm]")??null,R="overflow-hidden",A=i=>i.closest("[data-receivable-category-modal]"),B=i=>{i&&(i.classList.remove("hidden"),document.body.classList.add(R))},ie=i=>{i&&(i.classList.add("hidden"),n.querySelector("[data-receivable-category-modal]:not(.hidden)")||document.body.classList.remove(R))};n.querySelectorAll("[data-receivable-category-modal-close]").forEach(i=>{i.addEventListener("click",()=>{const s=A(i);ie(s)})}),Object.values(c).forEach(i=>{i&&(i.addEventListener("click",s=>{s.target===i&&ie(i)}),i.addEventListener("keydown",s=>{s.key==="Escape"&&ie(i)}))});const se=()=>{f&&(f.querySelectorAll("[data-receivable-category-error]").forEach(i=>{i.textContent=""}),f.querySelectorAll("[data-receivable-category-input]").forEach(i=>{i.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},Y=i=>{!f||!i||Object.entries(i).forEach(([s,l])=>{const y=Array.isArray(l)?l[0]:l,h=f.querySelector(`[data-receivable-category-error="${s}"]`),C=f.querySelector(`[data-receivable-category-input="${s}"]`);h&&(h.textContent=y??""),C&&C.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},J=i=>{!x||!S||(i?S.textContent="Procesando...":x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=i)},G=(i,s)=>{if(!f)return;const l=f.querySelector(`[data-receivable-category-input="${i}"]`);l&&(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&(l.value=s??"")},me=i=>{if(!f)return"";const s=f.querySelector(`[data-receivable-category-input="${i}"]`);return s&&(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement)?s.value.trim():""},le=()=>{if(!m){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:m}}))},pe=(i,s=null)=>{!f||!x||!S||(se(),J(!1),f.dataset.mode=i,f.dataset.receivableCategoryId=s?.id??"",i==="create"?(f.reset(),G("status","A"),P&&(P.textContent=e("Nueva categoría")),S.textContent=e("Guardar"),x.dataset.originalLabel=e("Guardar")):(P&&(P.textContent=e("Editar categoría")),S.textContent=e("Actualizar"),x.dataset.originalLabel=e("Actualizar")),s&&(G("code",s.code??""),G("name",s.name??""),G("description",s.description??""),G("status",s.status??"A")))},re=i=>{!M||!i||M.querySelectorAll("[data-receivable-category-view-field]").forEach(s=>{const l=s.getAttribute("data-receivable-category-view-field");if(!l)return;const y=i[l];s.textContent=y!=null&&y!==""?String(y):"-"})},ne=async()=>{if(!f||!x||!S)return;const i=f.dataset.mode??"create",s=f.dataset.receivableCategoryId??"",l={code:me("code"),name:me("name"),description:me("description")||null,status:me("status")||"A"};se();const y={};if(l.code||(y.code=e("El código es obligatorio.")),l.name||(y.name=e("El nombre es obligatorio.")),Object.keys(y).length>0){Y(y),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}J(!0);const h=i==="create"?u:`${p}/${s}`,C=i==="create"?"POST":"PATCH";try{const D=await fetch(h,{method:C,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(l)}),V=await D.json().catch(()=>null);if(!D.ok){D.status===422&&V?.errors?(Y(V.errors),g({title:e("Hay errores en el formulario"),text:V.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:V?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:V?.message??e("Acción realizada correctamente."),icon:"success"}),ie(c.form),le()}catch(D){console.error("[ReceivableCategories] Submit error",D),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{J(!1)}},r=async()=>{if(!c.delete||!E)return;const i=c.delete.dataset.receivableCategoryId;if(!i){ie(c.delete);return}E.disabled=!0,E.classList.add("cursor-not-allowed","opacity-70");try{const s=await fetch(`${p}/${i}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":o}}),l=await s.json().catch(()=>null);if(!s.ok){g({title:e("Error"),text:l?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:l?.message??e("Registro eliminado correctamente."),icon:"success"}),ie(c.delete),le()}catch(s){console.error("[ReceivableCategories] Delete error",s),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{E.disabled=!1,E.classList.remove("cursor-not-allowed","opacity-70")}},a=async i=>{const s=i.dataset.id??"";if(!s||i.disabled)return;const l=!i.checked,y=i.checked?"A":"I";i.disabled=!0;try{const h=await fetch(`${p}/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({status:y})}),C=await h.json().catch(()=>null);if(!h.ok){i.checked=l,g({title:e("Error"),text:C?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("El estado se modificó correctamente."),icon:"success"}),le()}catch(h){console.error("[ReceivableCategories] Status toggle error",h),i.checked=l,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{i.disabled=!1}};f&&f.addEventListener("submit",i=>{i.preventDefault(),ne()}),E&&E.addEventListener("click",r),n.addEventListener("click",i=>{console.log("🔵 [ReceivableCategories] Click detected",{target:i.target,targetTagName:i.target?.tagName,targetClasses:i.target?.className,targetId:i.target?.id,targetDataset:i.target?.dataset});let s=null;if(i.target instanceof Element&&(s=i.target.closest("[data-receivable-category-action], [data-action], [data-row-action]"),console.log("🔵 [ReceivableCategories] First closest search",{found:!!s,element:s,tagName:s?.tagName,classes:s?.className}),!s&&(i.target.tagName==="I"||i.target.classList.contains("fa"))&&(s=i.target.closest("button[data-action], button[data-row-action]"),console.log("🔵 [ReceivableCategories] Second closest search (icon)",{found:!!s,element:s,tagName:s?.tagName}))),!s||!n.contains(s)){console.log("🔵 [ReceivableCategories] No actionEl found or not in root, returning");return}if(console.log("🔵 [ReceivableCategories] Final actionEl",{found:!!s,element:s,allAttributes:s?Array.from(s.attributes).map(V=>({name:V.name,value:V.value})):null,dataset:s?.dataset}),s.hasAttribute("data-receivable-category-action")){const V=s.dataset.receivableCategoryAction;console.log("🔵 [ReceivableCategories] Receivable category action",{action:V}),V==="create"&&(pe("create"),B(c.form));return}const l=s.dataset.action||s.dataset.rowAction;if(console.log("🔵 [ReceivableCategories] Row action extracted",{rowAction:l,dataAction:s.dataset.action,dataRowAction:s.dataset.rowAction}),!l){console.log("🔵 [ReceivableCategories] No rowAction found, returning");return}const y=(s.dataset.id||s.dataset.rowId||"").trim(),h=(s.dataset.name||s.dataset.rowName)??"",C=s.dataset.rowPayload;let D=C?rt(C):null;if(console.log("🔵 [ReceivableCategories] Action clicked - FULL DATA",{rowAction:l,rowId:y,rowName:h,hasPayload:!!C,payload:C,data:D,baseUrl:p,csrfToken:o?"present":"missing",allDatasetKeys:Object.keys(s.dataset),datasetId:s.dataset.id,datasetRowId:s.dataset.rowId}),!y){console.error("🔴 [ReceivableCategories] Missing rowId",{actionEl:s,rowAction:l,allDatasetKeys:s?Object.keys(s.dataset):null,dataset:s?.dataset}),g({title:e("Error"),text:e("No se pudo identificar el registro seleccionado."),icon:"error"});return}if(!D&&y){if(console.log("🟡 [ReceivableCategories] No payload, will fetch from server",{rowId:y,rowAction:l,hasData:!!D}),l==="view"||l==="edit"){if(!p){console.error("🔴 [ReceivableCategories] Missing baseUrl"),g({title:e("Error"),text:e("Error de configuración. Por favor, recarga la página."),icon:"error"});return}const V=`${p}/${y}`;console.log("🟢 [ReceivableCategories] Starting fetch",{fetchUrl:V,rowAction:l,rowId:y,baseUrl:p,method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o?"present":"missing"}}),fetch(V,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o}}).then(async N=>{console.log("🟢 [ReceivableCategories] Response received (raw)",{ok:N.ok,status:N.status,statusText:N.statusText,headers:Object.fromEntries(N.headers.entries()),url:N.url});const $=await N.json().catch(_=>(console.error("🔴 [ReceivableCategories] JSON parse error",{parseError:_}),null));if(console.log("🟢 [ReceivableCategories] Response JSON parsed",{json:$}),!N.ok){console.error("🔴 [ReceivableCategories] Fetch failed - Response not OK",{status:N.status,statusText:N.statusText,url:V,json:$,responseHeaders:Object.fromEntries(N.headers.entries())});const _=$?.message??e("No se pudieron obtener los datos del registro.");return g({title:e("Error"),text:_,icon:"error"}),null}return $}).then(N=>{if(console.log("🟢 [ReceivableCategories] Processing response",{hasJson:!!N,json:N,status:N?.status,hasData:!!N?.data,hasItem:!!N?.data?.item,item:N?.data?.item}),!N){console.log("🟡 [ReceivableCategories] No JSON to process");return}if(N?.status==="success"&&N?.data?.item)console.log("✅ [ReceivableCategories] Success! Opening modal",{rowAction:l,data:N.data.item}),D=N.data.item,l==="view"?(re(D),B(c.view)):l==="edit"&&(pe("edit",D),B(c.form));else{const $=N?.message??e("No se pudieron obtener los datos del registro.");console.error("🔴 [ReceivableCategories] Invalid response format",{json:N,expected:"status: success, data.item",actualStatus:N?.status,hasData:!!N?.data,hasItem:!!N?.data?.item}),g({title:e("Error"),text:$,icon:"error"})}}).catch(N=>{console.error("🔴 [ReceivableCategories] Fetch error (catch)",{error:N,errorName:N.name,errorMessage:N.message,errorStack:N.stack,fetchUrl:V});const $=N.message?.includes("Failed to fetch")?e("Error de conexión. Verifica tu conexión a internet."):e("No se pudieron obtener los datos del registro.");g({title:e("Error"),text:$,icon:"error"})});return}else if(l==="delete"){console.log("🟡 [ReceivableCategories] Delete action",{rowId:y,rowName:h}),c.delete&&(c.delete.dataset.receivableCategoryId=y),L&&(L.textContent=h||y),B(c.delete);return}}if(D&&D.id){if(l==="view"){re(D),B(c.view);return}if(l==="edit"){pe("edit",D),B(c.form);return}if(l==="delete"){c.delete&&(c.delete.dataset.receivableCategoryId=D.id),L&&(L.textContent=h||D.name||D.code||D.id),B(c.delete);return}}l!=="delete"&&(console.error("🔴 [ReceivableCategories] No data available",{rowAction:l,rowId:y,hasData:!!D}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"}))}),n.addEventListener("change",i=>{const s=i.target;s instanceof HTMLInputElement&&s.matches("[data-status-toggle]")&&a(s)})})},Ba=()=>{console.log("🟢 [PayableCategories] Module initialization started");const t=document.querySelector("[data-payable-categories-root]");if(!t){console.log("🟢 [PayableCategories] Root element not found");return}const n=t.dataset.payableCategoriesTableId??"",d=t.dataset.payableCategoriesBaseUrl??"",m=t.dataset.payableCategoriesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";console.log("🟢 [PayableCategories] init - Configuration",{tableId:n,baseUrl:d,storeUrl:m,csrfToken:p?"present":"missing",rootElement:t,allDataAttributes:Object.keys(t.dataset)});const u={form:t.querySelector('[data-payable-category-modal="form"]'),view:t.querySelector('[data-payable-category-modal="view"]'),delete:t.querySelector('[data-payable-category-modal="delete"]')},o=u.form?.querySelector("[data-payable-category-form]")??null,c=u.form?.querySelector("[data-payable-category-submit]")??null,f=c?.querySelector("[data-payable-category-submit-label]")??null,x=u.form?.querySelector("[data-payable-category-modal-title]")??null,S=u.view?.querySelector("[data-payable-category-view]")??null,P=u.delete?.querySelector("[data-payable-category-delete-name]")??null,M=u.delete?.querySelector("[data-payable-category-delete-confirm]")??null;console.log("🟢 [PayableCategories] Elements initialized",{hasForm:!!o,hasSubmitButton:!!c,hasSubmitLabel:!!f,hasModalTitle:!!x,hasViewContainer:!!S,hasDeleteName:!!P,hasDeleteConfirmButton:!!M,modals:{form:!!u.form,view:!!u.view,delete:!!u.delete},viewContainerSelector:"[data-payable-category-view]",viewContainerElement:S});const L="overflow-hidden",E=r=>r.closest("[data-payable-category-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-payable-category-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-payable-category-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-payable-category-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-payable-category-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-payable-category-error="${a}"]`),y=o.querySelector(`[data-payable-category-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o){console.error("🟢 [PayableCategories] setFieldValue - No form",{field:r,value:a});return}const i=o.querySelector(`[data-payable-category-input="${r}"]`);if(!i){console.error("🟢 [PayableCategories] setFieldValue - Input not found",{field:r,value:a,selector:`[data-payable-category-input="${r}"]`});return}console.log("🟢 [PayableCategories] setFieldValue",{field:r,value:a,input:i,inputType:i.constructor.name}),(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=a??"",console.log("🟢 [PayableCategories] setFieldValue - Value set",{field:r,value:a,inputValue:i.value}))},J=r=>{if(!o)return"";const a=o.querySelector(`[data-payable-category-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{if(console.log("🟢 [PayableCategories] setFormMode called",{mode:r,data:a,hasForm:!!o,hasSubmitButton:!!c,hasSubmitLabel:!!f}),!o||!c||!f){console.error("🟢 [PayableCategories] setFormMode - Missing required elements",{form:o,submitButton:c,submitLabel:f});return}B(),se(!1),o.dataset.mode=r,o.dataset.payableCategoryId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent=e("Nueva categoría")),f.textContent=e("Guardar"),c.dataset.originalLabel=e("Guardar")):(x&&(x.textContent=e("Editar categoría")),f.textContent=e("Actualizar"),c.dataset.originalLabel=e("Actualizar")),a?(console.log("🟢 [PayableCategories] setFormMode - Populating form with data",{data:a,code:a.code,name:a.name,description:a.description,status:a.status}),Y("code",a.code??""),Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A")):console.log("🟢 [PayableCategories] setFormMode - No data provided")},le=r=>{if(console.log("🟢 [PayableCategories] populateViewModal called",{data:r,viewContainer:S,hasViewContainer:!!S}),!S||!r){console.error("🟢 [PayableCategories] populateViewModal - Missing viewContainer or data",{viewContainer:S,data:r});return}const a=S.querySelectorAll("[data-payable-category-view-field]");console.log("🟢 [PayableCategories] populateViewModal - Found fields",{count:a.length,fields:Array.from(a).map(i=>({field:i.getAttribute("data-payable-category-view-field"),element:i}))}),a.forEach(i=>{const s=i.getAttribute("data-payable-category-view-field");if(!s)return;const l=r[s];console.log("🟢 [PayableCategories] populateViewModal - Setting field",{field:s,value:l,dataField:r[s]}),i.textContent=l!=null&&l!==""?String(l):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.payableCategoryId??"",i={code:J("code"),name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const s={};if(i.code||(s.code=e("El código es obligatorio.")),i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[PayableCategories] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.payableCategoryId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[PayableCategories] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[PayableCategories] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",r=>{console.log("🟢 [PayableCategories] Click detected",{target:r.target,tagName:r.target?.tagName});const a=r.target instanceof Element?r.target.closest("[data-payable-category-action], [data-action], [data-row-action]"):null;if(console.log("🟢 [PayableCategories] Action element found",{actionEl:a,hasAction:!!a,isInRoot:a?t.contains(a):!1,attributes:a?Array.from(a.attributes).map(C=>({name:C.name,value:C.value})):[]}),!a||!t.contains(a))return;if(a.hasAttribute("data-payable-category-action")){const C=a.dataset.payableCategoryAction;console.log("🟢 [PayableCategories] Category action detected",{action:C}),C==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction,s=(a.dataset.id||a.dataset.rowId)??"",l=(a.dataset.name||a.dataset.rowName)??"",y=a.dataset.rowPayload;let h=y?rt(y):null;if(console.log("🟢 [PayableCategories] Row action data",{rowAction:i,rowId:s,rowName:l,hasPayload:!!y,decodedData:h,allDataset:Object.keys(a.dataset).reduce((C,D)=>(C[D]=a.dataset[D],C),{})}),!h&&s&&(h={id:s,name:l||null,code:a.dataset.rowCode??null},console.log("🟢 [PayableCategories] Created data from attributes",{data:h})),!i||!h||!h.id){console.error("🟢 [PayableCategories] Missing required data",{rowAction:i,rowId:s,hasData:!!h,dataId:h?.id}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){console.log("🟢 [PayableCategories] View action",{data:h,dataKeys:Object.keys(h||{}),dataLength:Object.keys(h||{}).length});const C=`${d}/${h.id}`;console.log("🟢 [PayableCategories] Fetching view data",{url:C,dataId:h.id}),fetch(C,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(D=>{if(console.log("🟢 [PayableCategories] View fetch response",{ok:D.ok,status:D.status,statusText:D.statusText}),!D.ok)throw new Error(`HTTP error! status: ${D.status}`);return D.json()}).then(D=>{console.log("🟢 [PayableCategories] View fetch JSON",{json:D,hasItem:!!D?.data?.item,item:D?.data?.item}),D?.status==="success"&&D?.data?.item?(le(D.data.item),R(u.view)):(console.error("🟢 [PayableCategories] Invalid response structure",{json:D}),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"}))}).catch(D=>{console.error("🟢 [PayableCategories] View fetch error",D),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(i==="edit"){console.log("🟢 [PayableCategories] Edit action",{data:h,dataKeys:Object.keys(h||{}),dataLength:Object.keys(h||{}).length});const C=`${d}/${h.id}`;console.log("🟢 [PayableCategories] Fetching edit data",{url:C,dataId:h.id}),fetch(C,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(D=>{if(console.log("🟢 [PayableCategories] Edit fetch response",{ok:D.ok,status:D.status,statusText:D.statusText}),!D.ok)throw new Error(`HTTP error! status: ${D.status}`);return D.json()}).then(D=>{console.log("🟢 [PayableCategories] Edit fetch JSON",{json:D,hasItem:!!D?.data?.item,item:D?.data?.item}),D?.status==="success"&&D?.data?.item?(me("edit",D.data.item),R(u.form)):(console.error("🟢 [PayableCategories] Invalid response structure",{json:D}),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"}))}).catch(D=>{console.error("🟢 [PayableCategories] Edit fetch error",D),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(i==="delete"){console.log("🟢 [PayableCategories] Delete action",{dataId:h.id,rowName:l}),u.delete&&(u.delete.dataset.payableCategoryId=h.id),P&&(P.textContent=l||h.name||h.code||h.id),R(u.delete);return}i!=="delete"&&(console.error("🟢 [PayableCategories] No data available",{rowAction:i,rowId:s,hasData:!!h}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"}))}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},Ht=(t,n={})=>{const d={income:"incomes",expense:"expenses",receivable:"receivables",payable:"payables"},m=n.plural??d[t]??`${t}s`,p=document.querySelector(`[data-${m}-root]`);if(!p)return;const u=p.dataset[`${m}TableId`]??"",o=p.dataset[`${m}BaseUrl`]??"",c=p.dataset[`${m}StoreUrl`]??o,f=p.dataset[`${m}OptionsUrl`]??"",x=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";let S=[];try{S=JSON.parse(p.dataset[`${m}Types`]??"[]")??[]}catch(Z){console.warn(`[${t}] Invalid type options JSON`,Z),S=[]}const M={income:{typeField:"income_type_id",typeNameField:"income_type_name",statusField:"status",settlementField:"status",settlementEndpoint:Z=>`${o}/${Z}/status`,settlementPayload:Z=>({status:Z?"A":"I"}),settlementMessages:{true:e("El ingreso se activó correctamente."),false:e("El ingreso se desactivó correctamente.")},entityTitle:e("ingreso"),createTitle:e("Nuevo ingreso"),editTitle:e("Editar ingreso"),messages:{created:e("El ingreso se registró correctamente."),updated:e("El ingreso se actualizó correctamente."),deleted:e("El ingreso se eliminó correctamente."),toggled:e("El estado se modificó correctamente.")},typeSelectionMessage:e("Selecciona una categoría de ingreso."),defaultStatusValue:"A",currencyCode:"USD"},expense:{typeField:"expense_type_id",typeNameField:"expense_type_name",statusField:"status",settlementField:"status",settlementEndpoint:Z=>`${o}/${Z}/status`,settlementPayload:Z=>({status:Z?"A":"I"}),settlementMessages:{true:e("El egreso se activó correctamente."),false:e("El egreso se desactivó correctamente.")},entityTitle:e("egreso"),createTitle:e("Nuevo egreso"),editTitle:e("Editar egreso"),messages:{created:e("El egreso se registró correctamente."),updated:e("El egreso se actualizó correctamente."),deleted:e("El egreso se eliminó correctamente."),toggled:e("El estado se modificó correctamente.")},typeSelectionMessage:e("Selecciona una categoría de egreso."),defaultStatusValue:"A",currencyCode:"USD"},receivable:{typeField:"receivable_category_id",typeNameField:"receivable_category_name",statusField:null,settlementField:"is_collected",settlementEndpoint:Z=>`${o}/${Z}/settlement`,settlementPayload:Z=>({is_collected:Z}),settlementMessages:{true:e("La cuenta por cobrar fue marcada como cobrada."),false:e("La cuenta por cobrar fue marcada como pendiente.")},entityTitle:e("cuenta por cobrar"),createTitle:e("Nueva cuenta por cobrar"),editTitle:e("Editar cuenta por cobrar"),messages:{created:e("La cuenta por cobrar se registró correctamente."),updated:e("La cuenta por cobrar se actualizó correctamente."),deleted:e("La cuenta por cobrar se eliminó correctamente."),toggled:e("El estado se modificó correctamente.")},typeSelectionMessage:e("Selecciona una categoría de cobro."),defaultStatusValue:null,currencyCode:"USD"},payable:{typeField:"payable_category_id",typeNameField:"payable_category_name",statusField:null,settlementField:"is_paid",settlementEndpoint:Z=>`${o}/${Z}/settlement`,settlementPayload:Z=>({is_paid:Z}),settlementMessages:{true:e("La cuenta por pagar fue marcada como pagada."),false:e("La cuenta por pagar fue marcada como pendiente.")},entityTitle:e("cuenta por pagar"),createTitle:e("Nueva cuenta por pagar"),editTitle:e("Editar cuenta por pagar"),messages:{created:e("La cuenta por pagar se registró correctamente."),updated:e("La cuenta por pagar se actualizó correctamente."),deleted:e("La cuenta por pagar se eliminó correctamente."),toggled:e("El estado se modificó correctamente.")},typeSelectionMessage:e("Selecciona una categoría de pago."),defaultStatusValue:null,currencyCode:"USD"}}[t]??{},L=n.typeField??M.typeField??`${t}_type_id`,E=n.typeNameField??M.typeNameField??`${t}_type_name`,R=n.statusField??M.statusField??null,A=n.settlementField??M.settlementField??R,B=n.defaultStatusValue??M.defaultStatusValue??"A",ie=n.currencyCode??M.currencyCode??"USD";n.entityTitle??M.entityTitle;const se=n.typeSelectionMessage??M.typeSelectionMessage??e("Selecciona una categoría."),Y=n.settlementEndpoint??M.settlementEndpoint??(Z=>`${o}/${Z}/status`),J=n.settlementPayload??M.settlementPayload??(Z=>({status:Z?"A":"I"})),G=M.messages??{},me={created:n.messages?.created??G.created??e("El registro se creó correctamente."),updated:n.messages?.updated??G.updated??e("El registro se actualizó correctamente."),deleted:n.messages?.deleted??G.deleted??e("El registro se eliminó correctamente."),toggled:n.messages?.toggled??G.toggled??e("El estado se modificó correctamente.")},le={true:n.settlementMessages?.true??M.settlementMessages?.true??me.toggled,false:n.settlementMessages?.false??M.settlementMessages?.false??me.toggled},pe={form:p.querySelector(`[data-${t}-modal="form"]`),view:p.querySelector(`[data-${t}-modal="view"]`),delete:p.querySelector(`[data-${t}-modal="delete"]`)},re=pe.form?.querySelector(`[data-${t}-form]`)??null,ne=pe.form?.querySelector(`[data-${t}-submit]`)??null,r=ne?.querySelector(`[data-${t}-submit-label]`)??null,a=pe.form?.querySelector(`[data-${t}-modal-title]`)??null,i=pe.view?.querySelector(`[data-${t}-view]`)??pe.view,s=pe.delete?.querySelector(`[data-${t}-delete-concept]`)??null,l=pe.delete?.querySelector(`[data-${t}-delete-confirm]`)??null,y=re?.querySelector(`[data-${t}-amount-currency]`)??null,h=re?.querySelector(`[data-select-name="${L}"]`)??null;re?.querySelector(`[data-${t}-input="${L}"]`);const C=h?.querySelector(`[data-${t}-type-options]`)??null,D=h?.querySelector("[data-select-trigger]")??null;h?.querySelector("[data-select-value]");const V=h?.querySelector("[data-select-dropdown]")??null,N=h?.querySelector("[data-select-icon]")??null;D?.dataset.selectPlaceholder;const $="overflow-hidden",_={create:n.createTitle??M.createTitle??e(t==="income"?"Nuevo ingreso":t==="expense"?"Nuevo egreso":"Nuevo registro"),edit:n.editTitle??M.editTitle??e(t==="income"?"Editar ingreso":t==="expense"?"Editar egreso":"Editar registro")},te=Z=>Z.closest(`[data-${t}-modal]`),j=Z=>{Z&&(Z.classList.remove("hidden"),document.body.classList.add($))},X=Z=>{Z&&(Z.classList.add("hidden"),p.querySelector(`[data-${t}-modal]:not(.hidden)`)||document.body.classList.remove($))};p.querySelectorAll(`[data-${t}-modal-close]`).forEach(Z=>{Z.addEventListener("click",()=>{const I=te(Z);X(I)})}),Object.values(pe).forEach(Z=>{Z&&(Z.addEventListener("click",I=>{I.target===Z&&X(Z)}),Z.addEventListener("keydown",I=>{I.key==="Escape"&&X(Z)}))});const b=Z=>{const I=re?.querySelector(`[data-${t}-input="${Z}"]`)??null,K=re?.querySelector(`[data-${t}-error="${Z}"]`)??null,ye=I instanceof HTMLInputElement?I.closest("[data-select]"):null,xe=ye?.querySelector("[data-select-trigger]")??null;return{input:I,errorEl:K,selectRoot:ye,trigger:xe}},v=Z=>{!re||!Z||Object.entries(Z).forEach(([I,K])=>{const ye=Array.isArray(K)?K[0]:K,{input:xe,errorEl:Ie,selectRoot:we,trigger:Ne}=b(I);Ie&&(Ie.textContent=ye??""),xe instanceof HTMLInputElement&&xe.type!=="hidden"&&xe.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),(xe instanceof HTMLSelectElement||xe instanceof HTMLTextAreaElement)&&xe.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),we&&(we.dataset.selectInvalid="true",Ne?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))})},H=()=>{re&&(re.querySelectorAll(`[data-${t}-error]`).forEach(Z=>{Z.textContent=""}),re.querySelectorAll(`[data-${t}-input]`).forEach(Z=>{(Z instanceof HTMLInputElement||Z instanceof HTMLTextAreaElement||Z instanceof HTMLSelectElement)&&Z.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),re.querySelectorAll("[data-select]").forEach(Z=>{Z.dataset.selectInvalid="false",Z.querySelector("[data-select-trigger]")?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},O=Z=>{!ne||!r||(Z?r.textContent=e("Procesando..."):ne.dataset.originalLabel&&(r.textContent=ne.dataset.originalLabel),ne.disabled=Z)},q=Z=>{if(!(Z instanceof HTMLInputElement))return;const I=Z.closest("[data-select]");if(!I)return;const K=I.querySelector("[data-select-trigger]"),ye=I.querySelector("[data-select-value]"),xe=Array.from(I.querySelectorAll("[data-select-option]")),Ie=K?.dataset.selectPlaceholder??"";let we=Ie;xe.forEach(Ne=>{const Je=Ne.dataset.value===Z.value&&Z.value!=="";Ne.dataset.selected=Je?"true":"false",Je&&(we=Ne.dataset.label??Ne.textContent.trim())}),ye&&(ye.textContent=Z.value?we:Ie),K?.classList.toggle("is-empty",!Z.value)},T=(Z,I)=>{if(!re)return;const K=re.querySelector(`[data-${t}-input="${Z}"]`);K&&((K instanceof HTMLInputElement||K instanceof HTMLTextAreaElement)&&(K.value=I??""),K instanceof HTMLSelectElement&&(K.value=I??""),K instanceof HTMLInputElement&&K.type==="hidden"&&q(K))},z=(Z,I)=>{if(!re)return;const K=re.querySelector(`[data-${t}-input="${Z}"]`);K&&(K instanceof HTMLInputElement&&K.type==="checkbox"?K.checked=!!I:K instanceof HTMLInputElement?(K.value=I?"1":"0",K.type==="hidden"&&q(K)):K instanceof HTMLSelectElement&&(K.value=I?"1":"0"))},w=Z=>{if(!re)return!1;const I=re.querySelector(`[data-${t}-input="${Z}"]`);return I?I instanceof HTMLInputElement&&I.type==="checkbox"?I.checked:I instanceof HTMLInputElement||I instanceof HTMLSelectElement?I.value==="1"||I.value==="true":!1:!1},k=Z=>{if(!re)return"";const I=re.querySelector(`[data-${t}-input="${Z}"]`);return I&&(I instanceof HTMLInputElement||I instanceof HTMLTextAreaElement||I instanceof HTMLSelectElement)?I.value.trim():""},Q=()=>{if(!u){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:u}}))},ve=()=>{!h||!V||(V.hidden=!0,V.dataset.open="false",h.dataset.open="false",D?.setAttribute("aria-expanded","false"),N?.classList.remove("rotate-180"))},qe=Z=>{if(!C)return;C.innerHTML="",Z.forEach(K=>{const ye=document.createElement("button");ye.type="button",ye.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-gray-800 transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",ye.setAttribute("role","option"),ye.dataset.selectOption="",ye.dataset.value=K.id??"",ye.dataset.label=K.label??"",ye.dataset.selected="false",ye.innerHTML=`<span class="truncate">${K.label??""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,ye.addEventListener("click",xe=>{xe.preventDefault(),I instanceof HTMLInputElement&&(I.value=K.id??"",q(I),I.dispatchEvent(new Event("change",{bubbles:!0}))),h?.setAttribute("data-select-invalid","false"),D?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),ve(),D?.focus({preventScroll:!0})}),C.appendChild(ye)});const I=re?.querySelector(`[data-${t}-input="${L}"]`);I instanceof HTMLInputElement&&q(I)},_e=async()=>{if(!f){qe(S);return}try{const Z=await fetch(f,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),I=await Z.json().catch(()=>null);if(!Z.ok||!I?.data?.items)throw new Error("Invalid response");S=I.data.items,qe(S)}catch(Z){console.error(`[${t}] Error loading type options`,Z),qe(S)}};qe(S);const Ce=Z=>{!i||!Z||i.querySelectorAll(`[data-${t}-view-field]`).forEach(I=>{const K=I.getAttribute(`data-${t}-view-field`);if(!K)return;const ye=Z[K];I.textContent=ye!=null&&ye!==""?String(ye):"-"})},Le=(Z,I=null)=>{if(!(!re||!ne||!r)){if(H(),O(!1),re.dataset.mode=Z,re.dataset.entryId=I?.id??"",Z==="create"){re.reset(),R&&T(R,B??"A"),A&&(!R||A!==R)&&z(A,!1),T(L,""),a&&(a.textContent=_.create),r.textContent=e("Guardar"),ne.dataset.originalLabel=e("Guardar");const K=new Date().toISOString().slice(0,10);if(T("movement_date",K),T("amount",""),y&&(y.textContent=ie),A&&(!R||A!==R)){z(A,!1);const ye=re?.querySelector(`[data-select-name="${A}"]`);if(ye){const xe=ye?.querySelector('input[type="hidden"]');xe&&(xe.value="0",q(xe))}}_e()}else a&&(a.textContent=_.edit),r.textContent=e("Actualizar"),ne.dataset.originalLabel=e("Actualizar");if(I){I[L]&&!S.some(ye=>ye.id===I[L])&&(S=[...S,{id:I[L],label:I[E]??I.type_name??I.concept??I.reference??I[L]}],qe(S)),T(L,I[L]??""),T("movement_date",I.movement_date??""),T("concept",I.concept??""),T("description",I.description??""),T("reference",I.reference??"");const K=typeof I.amount_cents=="number"?(I.amount_cents/100).toFixed(2):"";if(T("amount",K),R&&T(R,I[R]??B??"A"),A&&(!R||A!==R)&&Object.prototype.hasOwnProperty.call(I,A)){z(A,I[A]);const ye=re?.querySelector(`[data-select-name="${A}"]`);if(ye){const xe=ye?.querySelector('input[type="hidden"]');xe&&(xe.value=I[A]?"1":"0",q(xe))}}y&&(y.textContent=I.currency_code??ie),q(re.querySelector(`[data-${t}-input="${L}"]`)),_e()}else q(re.querySelector(`[data-${t}-input="${L}"]`))}},Ve=async()=>{if(!re||!ne||!r)return;const Z=re.dataset.mode??"create",I=re.dataset.entryId??"",K={[L]:k(L),movement_date:k("movement_date"),concept:k("concept"),description:k("description")||null,reference:k("reference")||null,amount:k("amount"),currency_code:ie};if(R){const Ne=k(R);K[R]=Ne==null||Ne===""?B??"A":Ne}A&&(!R||A!==R)&&(K[A]=w(A)),H();const ye={};K[L]||(ye[L]=se),K.movement_date||(ye.movement_date=e("Selecciona la fecha del movimiento.")),K.concept||(ye.concept=e("Ingresa el concepto."));const xe=parseFloat(K.amount??"");if(Number.isNaN(xe)||xe<=0?ye.amount=e("Ingresa un monto válido mayor a cero."):K.amount=xe.toFixed(2),Object.keys(ye).length>0){v(ye),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}O(!0);const Ie=Z==="create"?c:`${o}/${I}`,we=Z==="create"?"POST":"PATCH";try{const Ne=await fetch(Ie,{method:we,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":x},body:JSON.stringify(K)}),Je=await Ne.json().catch(()=>null);if(!Ne.ok){Ne.status===422&&Je?.errors?(v(Je.errors),g({title:e("Hay errores en el formulario"),text:Je.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:Je?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:Je?.message??me[Z==="create"?"created":"updated"],icon:"success"}),X(pe.form),Q()}catch(Ne){console.error(`[${t}] Submit error`,Ne),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{O(!1)}},Ge=async()=>{if(!pe.delete||!l)return;const Z=pe.delete.dataset.entryId;if(!Z){X(pe.delete);return}l.disabled=!0,l.classList.add("cursor-not-allowed","opacity-70");try{const I=await fetch(`${o}/${Z}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":x}}),K=await I.json().catch(()=>null);if(!I.ok){g({title:e("Error"),text:K?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:K?.message??me.deleted,icon:"success"}),X(pe.delete),Q()}catch(I){console.error(`[${t}] Delete error`,I),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{l.disabled=!1,l.classList.remove("cursor-not-allowed","opacity-70")}},Te=async Z=>{const I=Z.dataset.id??"";if(!I||Z.disabled)return;const K=!Z.checked,ye=Z.checked;Z.disabled=!0;try{const xe=await fetch(Y(I),{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":x},body:JSON.stringify(J(ye))}),Ie=await xe.json().catch(()=>null);if(!xe.ok){Z.checked=K,g({title:e("Error"),text:Ie?.message??e("No se pudo actualizar el estado."),icon:"error"});return}const Ne=le[ye?"true":"false"]??me.toggled;g({title:e("Datos actualizados"),text:Ie?.message??Ne,icon:"success"}),Q()}catch(xe){console.error(`[${t}] Status toggle error`,xe),Z.checked=K,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{Z.disabled=!1}};re&&re.addEventListener("submit",Z=>{Z.preventDefault(),Ve()}),l&&l.addEventListener("click",Ge),p.addEventListener("global-table-action:view",Z=>{Z.preventDefault(),Z.detail?.data&&(Ce(Z.detail.data),j(pe.view))}),p.addEventListener("global-table-action:edit",Z=>{Z.preventDefault(),Z.detail?.data&&(Le("edit",Z.detail.data),j(pe.form))}),p.addEventListener("global-table-action:delete",Z=>{if(Z.preventDefault(),Z.detail?.data&&Z.detail?.rowId){const I=Z.detail.data.concept??Z.detail.data.reference??"";pe.delete&&(pe.delete.dataset.entryId=Z.detail.rowId),s&&(s.textContent=I||String(Z.detail.rowId)),j(pe.delete)}}),p.addEventListener("click",async Z=>{const I=Z.target instanceof Element?Z.target.closest(`[data-${t}-action], [data-action], [data-row-action]`):null;if(!I||!p.contains(I))return;if(I.hasAttribute(`data-${t}-action`)){I.dataset[`${t}Action`]==="create"&&(Le("create"),j(pe.form));return}const K=I.dataset.action||I.dataset.rowAction;if(!K)return;const ye=(I.dataset.id||I.dataset.rowId)??"";if(!ye){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(K==="view"){try{const xe=await fetch(`${o}/${ye}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!xe.ok)throw new Error("Failed to fetch entry data");const Ie=await xe.json();Ie?.data?.item?(Ce(Ie.data.item),j(pe.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}catch(xe){console.error(`[${t}] Error loading view data`,xe),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}return}if(K==="edit"){try{const xe=await fetch(`${o}/${ye}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!xe.ok)throw new Error("Failed to fetch entry data");const Ie=await xe.json();Ie?.data?.item?(Le("edit",Ie.data.item),j(pe.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}catch(xe){console.error(`[${t}] Error loading edit data`,xe),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}return}if(K==="delete"){try{const xe=await fetch(`${o}/${ye}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!xe.ok)throw new Error("Failed to fetch entry data");const Ie=await xe.json();if(Ie?.data?.item){const we=Ie.data.item.concept??Ie.data.item.reference??"";pe.delete&&(pe.delete.dataset.entryId=ye),s&&(s.textContent=we||String(ye)),j(pe.delete)}else g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}catch(xe){console.error(`[${t}] Error loading delete data`,xe),g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}return}}),p.addEventListener("change",Z=>{const I=Z.target;I instanceof HTMLInputElement&&I.matches("[data-status-toggle]")&&Te(I)})},Wa=()=>{const t=document.querySelector("[data-users-root]");if(!t)return;const n=t.dataset.usersTableId??"",d=t.dataset.usersBaseUrl??"",m=t.dataset.usersStoreUrl??d,p=t.dataset.usersRoleOptionsUrl??"",u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",o={form:t.querySelector('[data-user-modal="form"]'),view:t.querySelector('[data-user-modal="view"]'),delete:t.querySelector('[data-user-modal="delete"]')},c=o.form?.querySelector("[data-user-form]")??null,f=o.form?.querySelector("[data-user-submit]")??null,x=f?.querySelector("[data-user-submit-label]")??null,S=o.form?.querySelector("[data-user-modal-title]")??null,P=o.view?.querySelector("[data-user-view]")??null,M=o.delete?.querySelector("[data-user-delete-name]")??null,L=o.delete?.querySelector("[data-user-delete-confirm]")??null,E=o.form?.querySelector("[data-user-role-options]")??null,R=o.form?.querySelector('[data-user-input="first_name"]')??null,A="overflow-hidden";let B=[],ie=!1;const se=N=>N.closest("[data-user-modal]"),Y=N=>{N&&(N.classList.remove("hidden"),document.body.classList.add(A),N.focus?.())},J=N=>{N&&(N.classList.add("hidden"),t.querySelector("[data-user-modal]:not(.hidden)")||document.body.classList.remove(A))};t.querySelectorAll("[data-user-modal-close]").forEach(N=>{N.addEventListener("click",()=>{const $=se(N);J($)})}),Object.values(o).forEach(N=>{N&&(N.addEventListener("click",$=>{$.target===N&&J(N)}),N.addEventListener("keydown",$=>{$.key==="Escape"&&J(N)}))});const G=()=>{c&&(c.querySelectorAll("[data-user-error]").forEach(N=>{N.textContent=""}),c.querySelectorAll("[data-user-input]").forEach(N=>{N.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200");const $=N.closest?.("[data-select]");$&&($.dataset.selectInvalid="false",$.querySelector("[data-select-trigger]")?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))}))},me=N=>{!c||!N||Object.entries(N).forEach(([$,_])=>{const te=Array.isArray(_)?_[0]:_,j=c.querySelector(`[data-user-error="${$}"]`),X=c.querySelector(`[data-user-input="${$}"]`);if(j&&(j.textContent=te??""),X){X.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");const b=X.closest("[data-select]");b&&(b.dataset.selectInvalid="true",b.querySelector("[data-select-trigger]")?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))}})},le=N=>{!f||!x||(f.dataset.originalLabel||(f.dataset.originalLabel=x.textContent??""),x.textContent=N?e("Procesando..."):f.dataset.originalLabel??e("Guardar"),f.disabled=N)},pe=(N,$)=>{if(!N)return;const _=N.querySelector("[data-select-trigger]"),te=N.querySelector("[data-select-value]"),j=Array.from(N.querySelectorAll("[data-select-option]")),X=_?.dataset.selectPlaceholder??"";let b=X;j.forEach(v=>{const H=v.dataset.value===$&&$!=="";v.dataset.selected=H?"true":"false",H&&(b=v.dataset.label??v.textContent.trim())}),te&&(te.textContent=$?b:X),_?.classList.toggle("is-empty",!$)},re=(N,$)=>{if(!c)return;const _=c.querySelector(`[data-user-input="${N}"]`);if(_&&((_ instanceof HTMLInputElement||_ instanceof HTMLTextAreaElement)&&(_.value=$??""),_ instanceof HTMLInputElement)){const te=_.closest("[data-select]");te&&pe(te,_.value)}},ne=N=>{if(!c)return"";const $=c.querySelector(`[data-user-input="${N}"]`);return $&&($ instanceof HTMLInputElement||$ instanceof HTMLTextAreaElement)?$.value.trim():""},r=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},a=N=>{E&&(E.innerHTML="",N.forEach($=>{const _=document.createElement("button");_.type="button",_.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",_.dataset.selectOption="",_.dataset.value=$.id,_.dataset.label=$.label,_.innerHTML=`
                <span class="truncate">${$.label}</span>
                <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
            `,_.addEventListener("click",te=>{te.preventDefault(),re("role_id",$.id),s(_.closest("[data-select]"))}),E.appendChild(_)}))},i=async()=>{if(ie||!p)return B;try{const N=await fetch(p,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),$=await N.json().catch(()=>null);if(!N.ok||!$?.data?.items)throw new Error("Invalid response");B=$.data.items,ie=!0,a(B)}catch(N){console.error("[Users] Role options error",N),g({title:e("Error"),text:e("No se pudieron cargar los roles disponibles."),icon:"error"})}return B},s=N=>{if(!N)return;const $=N.querySelector("[data-select-dropdown]"),_=N.querySelector("[data-select-trigger]");$&&!$.hasAttribute("hidden")&&($.setAttribute("hidden",""),$.classList.remove("visible")),_?.setAttribute("aria-expanded","false")},l=async(N,$=null)=>{!c||!f||!x||(G(),le(!1),c.dataset.mode=N,await i(),a(B),N==="create"?(c.reset(),re("id",""),re("status","A"),re("role_id",""),S&&(S.textContent=e("Nuevo usuario")),f.dataset.originalLabel=e("Guardar"),x.textContent=e("Guardar")):(S&&(S.textContent=e("Editar usuario")),f.dataset.originalLabel=e("Actualizar"),x.textContent=e("Actualizar")),$?(re("id",$.id??""),re("first_name",$.first_name??""),re("last_name",$.last_name??""),re("email",$.email??""),re("role_id",$.role_id??""),re("document_number",$.document_number??""),re("phone_number",$.phone_number??""),re("status",$.status??"A")):(re("first_name",""),re("last_name",""),re("email",""),re("document_number",""),re("phone_number","")),re("password",""),re("password_confirmation",""),pe(c?.querySelector('[data-select-name="role_id"]'),ne("role_id")))},y=N=>{!P||!N||P.querySelectorAll("[data-user-view-field]").forEach($=>{const _=$.getAttribute("data-user-view-field");if(!_)return;const te=N[_];$.textContent=te!=null&&te!==""?String(te):"—"})},h={created:e("El usuario se creó correctamente."),updated:e("El usuario se actualizó correctamente."),deleted:e("El usuario se eliminó correctamente."),toggled:e("El estado se actualizó correctamente.")},C=async()=>{if(!c)return;const N=c.dataset.mode==="edit"?"edit":"create",$=ne("id"),_={first_name:ne("first_name"),last_name:ne("last_name"),email:ne("email"),role_id:ne("role_id"),document_number:ne("document_number")||null,phone_number:ne("phone_number")||null,status:ne("status")||"A"},te=ne("password"),j=ne("password_confirmation");(te||j)&&(_.password=te,_.password_confirmation=j);const X=N==="edit"&&$?`${d}/${$}`:m,b=N==="edit"?"PATCH":"POST";G(),le(!0);try{const v=await fetch(X,{method:b,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u},body:JSON.stringify(_)}),H=await v.json().catch(()=>null);if(!v.ok){v.status===422&&me(H?.errors??{}),g({title:e("Error"),text:H?.message??e("No se pudo guardar el usuario."),icon:"error"});return}g({title:e("Datos actualizados"),text:H?.message??(N==="edit"?h.updated:h.created),icon:"success"}),J(o.form),r()}catch(v){console.error("[Users] Submit error",v),g({title:e("Error"),text:e("Ocurrió un problema al guardar el usuario."),icon:"error"})}finally{le(!1)}},D=async()=>{if(!o.delete)return;const N=o.delete.dataset.userId??"";if(!N){g({title:e("Error"),text:e("No se pudo determinar el usuario a eliminar."),icon:"error"});return}L&&(L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70"));try{const $=await fetch(`${d}/${N}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":u}}),_=await $.json().catch(()=>null);if(!$.ok){g({title:e("Error"),text:_?.message??e("No se pudo eliminar el usuario."),icon:"error"});return}g({title:e("Datos actualizados"),text:_?.message??h.deleted,icon:"success"}),J(o.delete),r()}catch($){console.error("[Users] Delete error",$),g({title:e("Error"),text:e("Ocurrió un problema al eliminar el usuario."),icon:"error"})}finally{L&&(L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70"))}},V=async N=>{const $=N.dataset.id??"";if(!$||N.disabled)return;const _=!N.checked,te=N.checked?"A":"I";N.disabled=!0;try{const j=await fetch(`${d}/${$}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u},body:JSON.stringify({status:te})}),X=await j.json().catch(()=>null);if(!j.ok){N.checked=_,g({title:e("Error"),text:X?.message??e("No se pudo actualizar el estado del usuario."),icon:"error"});return}g({title:e("Datos actualizados"),text:X?.message??h.toggled,icon:"success"}),r()}catch(j){console.error("[Users] Status toggle error",j),N.checked=_,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{N.disabled=!1}};c&&c.addEventListener("submit",N=>{N.preventDefault(),C()}),L&&L.addEventListener("click",D),t.addEventListener("click",N=>{const $=N.target instanceof Element?N.target.closest("[data-user-action], [data-action], [data-row-action]"):null;if(!$)return;if($.hasAttribute("data-user-action")){$.dataset.userAction==="create"&&l("create").then(()=>{Y(o.form),window.setTimeout(()=>{R?.focus()},100)});return}const _=$.dataset.action||$.dataset.rowAction;if(!_)return;const te=($.dataset.id||$.dataset.rowId)??"",j=($.dataset.name||$.dataset.rowName)??"",X=$.dataset.rowPayload;let b=X?rt(X):null;if(!b&&te){if(_==="view"||_==="edit"){fetch(`${d}/${te}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(v=>v.json()).then(v=>{v?.data?.item?(b=v.data.item,_==="view"?(y(b),Y(o.view)):_==="edit"&&l("edit",b).then(()=>{Y(o.form),window.setTimeout(()=>{R?.focus()},100)})):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(v=>{console.error("[Users] Fetch error",v),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}else if(_==="delete"){o.delete&&(o.delete.dataset.userId=te),M&&(M.textContent=j||te),Y(o.delete);return}}if(!b||!b.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(_==="view"){y(b),Y(o.view);return}if(_==="edit"){l("edit",b).then(()=>{Y(o.form),window.setTimeout(()=>{R?.focus()},100)});return}_==="delete"&&(o.delete&&(o.delete.dataset.userId=b.id??""),M&&(M.textContent=b.display_name??b.email??b.id??""),Y(o.delete))}),t.addEventListener("change",N=>{const $=N.target;$ instanceof HTMLInputElement&&$.matches("[data-status-toggle]")&&V($)}),t.addEventListener("input",N=>{const $=N.target;if($ instanceof HTMLInputElement&&$.matches('[data-user-input="phone_number"]')){const _=$.value.replace(/\D+/g,"");$.value!==_&&($.value=_)}})},Xa=()=>{const t=document.querySelector("[data-roles-root]");if(!t)return;const n=t.dataset.rolesTableId??"",d=t.dataset.rolesBaseUrl??"",m=t.dataset.rolesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-role-modal="form"]'),view:t.querySelector('[data-role-modal="view"]'),delete:t.querySelector('[data-role-modal="delete"]')},o=u.form?.querySelector("[data-role-form]")??null,c=u.form?.querySelector("[data-role-submit]")??null,f=c?.querySelector("[data-role-submit-label]")??null,x=u.form?.querySelector("[data-role-modal-title]")??null,S=u.view?.querySelector("[data-role-view]")??null,P=u.delete?.querySelector("[data-role-delete-name]")??null,M=u.delete?.querySelector("[data-role-delete-confirm]")??null,L=o?.querySelector('[data-role-input="display_name"]')??null;o?.querySelector('[data-role-input="name"]');const E="overflow-hidden",R=l=>l.closest("[data-role-modal]"),A=l=>{l&&(l.classList.remove("hidden"),document.body.classList.add(E),l.focus?.())},B=l=>{l&&(l.classList.add("hidden"),t.querySelector("[data-role-modal]:not(.hidden)")||document.body.classList.remove(E))};t.querySelectorAll("[data-role-modal-close]").forEach(l=>{l.addEventListener("click",()=>{const y=R(l);B(y)})}),Object.values(u).forEach(l=>{l&&(l.addEventListener("click",y=>{y.target===l&&B(l)}),l.addEventListener("keydown",y=>{y.key==="Escape"&&B(l)}))});const ie=()=>{o&&(o.querySelectorAll("[data-role-error]").forEach(l=>{l.textContent=""}),o.querySelectorAll("[data-role-input]").forEach(l=>{l.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},se=l=>{!o||!l||Object.entries(l).forEach(([y,h])=>{const C=Array.isArray(h)?h[0]:h,D=o.querySelector(`[data-role-error="${y}"]`),V=o.querySelector(`[data-role-input="${y}"]`);D&&(D.textContent=C??""),V&&V.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},Y=l=>{!c||!f||(c.dataset.originalLabel||(c.dataset.originalLabel=f.textContent??""),l?f.textContent=e("Procesando..."):f.textContent=c.dataset.originalLabel??e("Guardar"),c.disabled=l)},J=(l,y)=>{if(!o)return;const h=o.querySelector(`[data-role-input="${l}"]`);h&&(h instanceof HTMLInputElement||h instanceof HTMLTextAreaElement)&&(h.value=y??"")},G=l=>{if(!o)return"";const y=o.querySelector(`[data-role-input="${l}"]`);return y&&(y instanceof HTMLInputElement||y instanceof HTMLTextAreaElement)?y.value.trim():""},me=l=>l?l.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,120):"",le=()=>{if(!o)return;const l=me(G("display_name"));J("name",l)},pe=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},re=(l,y=null)=>{!o||!c||!f||(ie(),Y(!1),o.dataset.mode=l,l==="create"?(o.reset(),J("id",""),J("status","A"),J("name",""),x&&(x.textContent=e("Nuevo rol")),c.dataset.originalLabel=e("Guardar"),f.textContent=e("Guardar"),le()):(x&&(x.textContent=e("Editar rol")),c.dataset.originalLabel=e("Actualizar"),f.textContent=e("Actualizar")),y?(J("id",y.id??""),J("display_name",y.display_name??""),J("description",y.description??""),J("name",y.name??""),J("status",y.status??"A")):(J("display_name",""),J("description","")))},ne=l=>{!S||!l||S.querySelectorAll("[data-role-view-field]").forEach(y=>{const h=y.getAttribute("data-role-view-field");if(!h)return;let C=l[h];if(h==="users_count"&&(C=typeof C=="number"?C:Number(C??0)),h==="description"){y.textContent=C?String(C):"—";return}y.textContent=C!=null&&C!==""?String(C):"—"})},r={created:e("El rol se creó correctamente."),updated:e("El rol se actualizó correctamente."),deleted:e("El rol se eliminó correctamente."),toggled:e("El estado se actualizó correctamente.")},a=async()=>{if(!o)return;const l=o.dataset.mode==="edit"?"edit":"create",y=G("id"),h={display_name:G("display_name"),description:G("description")||null,status:G("status")||"A"},C=l==="edit"&&y?`${d}/${y}`:m,D=l==="edit"?"PATCH":"POST";ie(),Y(!0);try{const V=await fetch(C,{method:D,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(h)}),N=await V.json().catch(()=>null);if(!V.ok){V.status===422&&se(N?.errors??{}),g({title:e("Error"),text:N?.message??e("No se pudo guardar el rol."),icon:"error"});return}g({title:e("Datos actualizados"),text:N?.message??(l==="edit"?r.updated:r.created),icon:"success"}),B(u.form),pe()}catch(V){console.error("[Roles] Submit error",V),g({title:e("Error"),text:e("Ocurrió un problema al guardar el rol."),icon:"error"})}finally{Y(!1)}},i=async()=>{if(!u.delete)return;const l=u.delete.dataset.roleId??"";if(!l){g({title:e("Error"),text:e("No se pudo determinar el rol a eliminar."),icon:"error"});return}M&&(M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70"));try{const y=await fetch(`${d}/${l}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),h=await y.json().catch(()=>null);if(!y.ok){g({title:e("Error"),text:h?.message??e("No se pudo eliminar el rol."),icon:"error"});return}g({title:e("Datos actualizados"),text:h?.message??r.deleted,icon:"success"}),B(u.delete),pe()}catch(y){console.error("[Roles] Delete error",y),g({title:e("Error"),text:e("Ocurrió un problema al eliminar el rol."),icon:"error"})}finally{M&&(M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70"))}},s=async l=>{const y=l.dataset.id??"";if(!y||l.disabled)return;const h=!l.checked,C=l.checked?"A":"I";l.disabled=!0;try{const D=await fetch(`${d}/${y}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:C})}),V=await D.json().catch(()=>null);if(!D.ok){l.checked=h,g({title:e("Error"),text:V?.message??e("No se pudo actualizar el estado del rol."),icon:"error"});return}g({title:e("Datos actualizados"),text:V?.message??r.toggled,icon:"success"}),pe()}catch(D){console.error("[Roles] Status toggle error",D),l.checked=h,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{l.disabled=!1}};o&&o.addEventListener("submit",l=>{l.preventDefault(),a()}),M&&M.addEventListener("click",i),L&&L.addEventListener("input",le),t.addEventListener("click",l=>{const y=l.target instanceof Element?l.target.closest("[data-role-action], [data-action], [data-row-action]"):null;if(!y)return;if(y.hasAttribute("data-role-action")){y.dataset.roleAction==="create"&&(re("create"),A(u.form),window.setTimeout(()=>{L?.focus()},100));return}const h=y.dataset.action||y.dataset.rowAction;if(!h)return;const C=(y.dataset.id||y.dataset.rowId)??"",D=(y.dataset.name||y.dataset.rowName)??"",V=y.dataset.rowPayload;let N=V?rt(V):null;if(!N&&C){if(h==="view"||h==="edit"){fetch(`${d}/${C}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then($=>$.json()).then($=>{$?.data?.item?(N=$.data.item,h==="view"?(ne(N),A(u.view)):h==="edit"&&(re("edit",N),A(u.form),window.setTimeout(()=>{L?.focus()},100))):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch($=>{console.error("[Roles] Fetch error",$),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}else if(h==="delete"){u.delete&&(u.delete.dataset.roleId=C),P&&(P.textContent=D||C),A(u.delete);return}}if(!N||!N.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(h==="view"){ne(N),A(u.view);return}if(h==="edit"){re("edit",N),A(u.form),window.setTimeout(()=>{L?.focus()},100);return}h==="delete"&&(u.delete&&(u.delete.dataset.roleId=N.id??""),P&&(P.textContent=N.display_name??N.name??N.id??""),A(u.delete))}),t.addEventListener("change",l=>{const y=l.target;y instanceof HTMLInputElement&&y.matches("[data-status-toggle]")&&s(y)})},Va=()=>{const t=document.querySelector("[data-permissions-root]");if(!t)return;const n=t.dataset.permissionsTableId??"",d=t.dataset.permissionsBaseUrl??"",m=t.dataset.permissionsStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-permission-modal="form"]'),view:t.querySelector('[data-permission-modal="view"]'),delete:t.querySelector('[data-permission-modal="delete"]')},o=u.form?.querySelector("[data-permission-form]")??null,c=u.form?.querySelector("[data-permission-submit]")??null,f=c?.querySelector("[data-permission-submit-label]")??null,x=u.form?.querySelector("[data-permission-modal-title]")??null,S=u.view?.querySelector("[data-permission-view]")??null,P=u.delete?.querySelector("[data-permission-delete-name]")??null,M=u.delete?.querySelector("[data-permission-delete-confirm]")??null,L=o?.querySelector('[data-permission-input="display_name"]')??null,E="overflow-hidden",R=s=>s.closest("[data-permission-modal]"),A=s=>{s&&(s.classList.remove("hidden"),document.body.classList.add(E),s.focus?.())},B=s=>{s&&(s.classList.add("hidden"),t.querySelector("[data-permission-modal]:not(.hidden)")||document.body.classList.remove(E))};t.querySelectorAll("[data-permission-modal-close]").forEach(s=>{s.addEventListener("click",()=>{const l=R(s);B(l)})}),Object.values(u).forEach(s=>{s&&(s.addEventListener("click",l=>{l.target===s&&B(s)}),s.addEventListener("keydown",l=>{l.key==="Escape"&&B(s)}))});const ie=()=>{o&&(o.querySelectorAll("[data-permission-error]").forEach(s=>{s.textContent=""}),o.querySelectorAll("[data-permission-input]").forEach(s=>{s.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},se=s=>{!o||!s||Object.entries(s).forEach(([l,y])=>{const h=Array.isArray(y)?y[0]:y,C=o.querySelector(`[data-permission-error="${l}"]`),D=o.querySelector(`[data-permission-input="${l}"]`);C&&(C.textContent=h??""),D&&D.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},Y=s=>{!c||!f||(c.dataset.originalLabel||(c.dataset.originalLabel=f.textContent??""),s?f.textContent=e("Procesando..."):f.textContent=c.dataset.originalLabel??e("Guardar"),c.disabled=s)},J=(s,l)=>{if(!o)return;const y=o.querySelector(`[data-permission-input="${s}"]`);y&&(y instanceof HTMLInputElement||y instanceof HTMLTextAreaElement)&&(y.value=l??"")},G=s=>{if(!o)return"";const l=o.querySelector(`[data-permission-input="${s}"]`);return l&&(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)?l.value.trim():""},me=()=>{if(!o)return;const s=G("display_name").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,120);J("name",s)},le=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},pe=(s,l=null)=>{!o||!c||!f||(ie(),Y(!1),o.dataset.mode=s,s==="create"?(o.reset(),J("id",""),J("status","A"),J("name",""),x&&(x.textContent=e("Nuevo permiso")),c.dataset.originalLabel=e("Guardar"),f.textContent=e("Guardar"),me()):(x&&(x.textContent=e("Editar permiso")),c.dataset.originalLabel=e("Actualizar"),f.textContent=e("Actualizar")),l?(J("id",l.id??""),J("display_name",l.display_name??""),J("description",l.description??""),J("name",l.name??""),J("status",l.status??"A")):(J("display_name",""),J("description","")))},re=s=>{!S||!s||S.querySelectorAll("[data-permission-view-field]").forEach(l=>{const y=l.getAttribute("data-permission-view-field");if(!y)return;let h=s[y];if(y==="roles_count"&&(h=typeof h=="number"?h:Number(h??0)),y==="description"){l.textContent=h?String(h):"—";return}l.textContent=h!=null&&h!==""?String(h):"—"})},ne={created:e("El permiso se creó correctamente."),updated:e("El permiso se actualizó correctamente."),deleted:e("El permiso se eliminó correctamente."),toggled:e("El estado se actualizó correctamente.")},r=async()=>{if(!o)return;const s=o.dataset.mode==="edit"?"edit":"create",l=G("id"),y={display_name:G("display_name"),description:G("description")||null,status:G("status")||"A"},h=s==="edit"&&l?`${d}/${l}`:m,C=s==="edit"?"PATCH":"POST";ie(),Y(!0);try{const D=await fetch(h,{method:C,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(y)}),V=await D.json().catch(()=>null);if(!D.ok){D.status===422&&se(V?.errors??{}),g({title:e("Error"),text:V?.message??e("No se pudo guardar el permiso."),icon:"error"});return}g({title:e("Datos actualizados"),text:V?.message??(s==="edit"?ne.updated:ne.created),icon:"success"}),B(u.form),le()}catch(D){console.error("[Permissions] Submit error",D),g({title:e("Error"),text:e("Ocurrió un problema al guardar el permiso."),icon:"error"})}finally{Y(!1)}},a=async()=>{if(!u.delete)return;const s=u.delete.dataset.permissionId??"";if(!s){g({title:e("Error"),text:e("No se pudo determinar el permiso a eliminar."),icon:"error"});return}M&&(M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70"));try{const l=await fetch(`${d}/${s}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),y=await l.json().catch(()=>null);if(!l.ok){g({title:e("Error"),text:y?.message??e("No se pudo eliminar el permiso."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??ne.deleted,icon:"success"}),B(u.delete),le()}catch(l){console.error("[Permissions] Delete error",l),g({title:e("Error"),text:e("Ocurrió un problema al eliminar el permiso."),icon:"error"})}finally{M&&(M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70"))}},i=async s=>{const l=s.dataset.id??"";if(!l||s.disabled)return;const y=!s.checked,h=s.checked?"A":"I";s.disabled=!0;try{const C=await fetch(`${d}/${l}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:h})}),D=await C.json().catch(()=>null);if(!C.ok){s.checked=y,g({title:e("Error"),text:D?.message??e("No se pudo actualizar el estado del permiso."),icon:"error"});return}g({title:e("Datos actualizados"),text:D?.message??ne.toggled,icon:"success"}),le()}catch(C){console.error("[Permissions] Status toggle error",C),s.checked=y,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{s.disabled=!1}};o&&o.addEventListener("submit",s=>{s.preventDefault(),r()}),M&&M.addEventListener("click",a),L&&L.addEventListener("input",me),t.addEventListener("click",s=>{const l=s.target instanceof Element?s.target.closest("[data-permission-action], [data-action], [data-row-action]"):null;if(!l)return;if(l.hasAttribute("data-permission-action")){l.dataset.permissionAction==="create"&&(pe("create"),A(u.form),window.setTimeout(()=>{L?.focus()},100));return}const y=l.dataset.action||l.dataset.rowAction,h=l.dataset.rowPayload,C=h?rt(h):null;if(!y||!C?.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(y==="view"){re(C),A(u.view);return}if(y==="edit"){pe("edit",C),A(u.form),window.setTimeout(()=>{L?.focus()},100);return}y==="delete"&&(u.delete&&(u.delete.dataset.permissionId=C.id??""),P&&(P.textContent=C.display_name??C.name??C.id??""),A(u.delete))}),t.addEventListener("change",s=>{const l=s.target;l instanceof HTMLInputElement&&l.matches("[data-status-toggle]")&&i(l)})},Ka=()=>{Ht("income")},Ja=()=>{Ht("expense")},Ga=()=>{Ht("receivable")},Qa=()=>{Ht("payable")},Za=()=>{const t=document.querySelector("[data-products-index-root]");if(!t)return;const n=t.dataset.productsTableId??"",d=t.dataset.productsBaseUrl??"",m=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",p=t.querySelector('[data-product-modal="delete"]'),u=p?.querySelector("[data-product-delete-name]"),o=p?.querySelector("[data-product-delete-confirm]"),c=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))};t.addEventListener("datatable-refresh-request",c);const f=(P,M)=>{!p||!u||!o||(p.dataset.productId=P,u.textContent=M||"este producto",p.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},x=()=>{p&&(p.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),p.dataset.productId&&delete p.dataset.productId)},S=async()=>{const P=p?.dataset.productId;if(!(!P||!o)){o.disabled=!0,o.classList.add("cursor-not-allowed","opacity-70");try{const M=await fetch(`${d}/${P}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":m}}),L=await M.json().catch(()=>null);if(!M.ok){g({title:e("Error"),text:L?.message??e("No se pudo eliminar el producto."),icon:"error"});return}g({title:e("Éxito"),text:L?.message??e("Producto eliminado correctamente."),icon:"success"}),x(),c()}catch(M){console.error("[ProductsIndex] Delete error",M),g({title:e("Error"),text:e("Ocurrió un problema al eliminar el producto."),icon:"error"})}finally{o.disabled=!1,o.classList.remove("cursor-not-allowed","opacity-70")}}};t.addEventListener("click",P=>{const M=P.target.closest("[data-action], [data-row-action]");if(!M||!t.contains(M))return;const L=M.dataset.action||M.dataset.rowAction,E=M.dataset.id||M.dataset.rowId,R=M.dataset.name||M.dataset.rowName||"";!L||!E||(P.preventDefault(),P.stopPropagation(),L==="view"?window.location.href=`${d}/${E}`:L==="edit"?window.location.href=`${d}/${E}/edit`:L==="delete"&&f(E,R))}),t.querySelectorAll("[data-product-modal-close]").forEach(P=>{P.addEventListener("click",x)}),p&&(p.addEventListener("click",P=>{P.target===p&&x()}),p.addEventListener("keydown",P=>{P.key==="Escape"&&x()})),o&&o.addEventListener("click",S),console.log("[ProductsIndex] module initialized",{tableId:n,baseUrl:d})},Ya=()=>{console.log("🔵 [ProductLines] Module initialization started");const t=document.querySelectorAll("[data-product-lines-root]");console.log("🔵 [ProductLines] Found roots",{count:t.length,roots:Array.from(t)}),document.querySelectorAll("[data-product-lines-root]").forEach((n,d)=>{console.log(`🔵 [ProductLines] Initializing root ${d+1}`,{root:n,attributes:Array.from(n.attributes).map(i=>({name:i.name,value:i.value}))});const m=n.dataset.productLinesTableId??"",p=n.dataset.productLinesBaseUrl??"",u=n.dataset.productLinesStoreUrl??p,o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";console.log("🔵 [ProductLines] init - Configuration",{tableId:m,baseUrl:p,storeUrl:u,csrfToken:o?"present":"missing",rootElement:n,allDataAttributes:Object.keys(n.dataset)});const c={form:n.querySelector('[data-product-line-modal="form"]'),view:n.querySelector('[data-product-line-modal="view"]'),delete:n.querySelector('[data-product-line-modal="delete"]')},f=c.form?.querySelector("[data-product-line-form]")??null,x=c.form?.querySelector("[data-product-line-submit]")??null,S=x?.querySelector("[data-product-line-submit-label]")??null,P=c.form?.querySelector("[data-product-line-modal-title]")??null,M=c.view?.querySelector("[data-product-line-view]")??null,L=c.delete?.querySelector("[data-product-line-delete-name]")??null,E=c.delete?.querySelector("[data-product-line-delete-confirm]")??null,R="overflow-hidden",A=i=>i.closest("[data-product-line-modal]"),B=i=>{i&&(i.classList.remove("hidden"),document.body.classList.add(R))},ie=i=>{i&&(i.classList.add("hidden"),n.querySelector("[data-product-line-modal]:not(.hidden)")||document.body.classList.remove(R))};n.querySelectorAll("[data-product-line-modal-close]").forEach(i=>{i.addEventListener("click",()=>{const s=A(i);ie(s)})}),Object.values(c).forEach(i=>{i&&(i.addEventListener("click",s=>{s.target===i&&ie(i)}),i.addEventListener("keydown",s=>{s.key==="Escape"&&ie(i)}))});const se=()=>{f&&(f.querySelectorAll("[data-product-line-error]").forEach(i=>{i.textContent=""}),f.querySelectorAll("[data-product-line-input]").forEach(i=>{i.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},Y=i=>{!f||!i||Object.entries(i).forEach(([s,l])=>{const y=Array.isArray(l)?l[0]:l,h=f.querySelector(`[data-product-line-error="${s}"]`),C=f.querySelector(`[data-product-line-input="${s}"]`);h&&(h.textContent=y??""),C&&C.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},J=i=>{!x||!S||(i?S.textContent="Procesando...":x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=i)},G=(i,s)=>{if(!f)return;const l=f.querySelector(`[data-product-line-input="${i}"]`);l&&(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&(l.value=s??"")},me=i=>{if(!f)return"";const s=f.querySelector(`[data-product-line-input="${i}"]`);return s&&(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement)?s.value.trim():""},le=()=>{if(!m){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:m}}))},pe=(i,s=null)=>{!f||!x||!S||(se(),J(!1),f.dataset.mode=i,f.dataset.productLineId=s?.id??"",i==="create"?(f.reset(),G("status","A"),P&&(P.textContent="Nueva línea"),S.textContent="Guardar",x.dataset.originalLabel="Guardar"):(P&&(P.textContent="Editar línea"),S.textContent="Actualizar",x.dataset.originalLabel="Actualizar"),s&&(G("name",s.name??""),G("description",s.description??""),G("status",s.status??"A")))},re=i=>{!M||!i||M.querySelectorAll("[data-product-line-view-field]").forEach(s=>{const l=s.getAttribute("data-product-line-view-field");if(!l)return;const y=i[l];s.textContent=y!=null&&y!==""?String(y):"-"})},ne=async()=>{if(!f||!x||!S)return;const i=f.dataset.mode??"create",s=f.dataset.productLineId??"",l={name:me("name"),description:me("description")||null,status:me("status")||"A"};se();const y={};if(l.name||(y.name=e("El nombre es obligatorio.")),Object.keys(y).length>0){Y(y),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}J(!0);const h=i==="create"?u:`${p}/${s}`,C=i==="create"?"POST":"PATCH";try{const D=await fetch(h,{method:C,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(l)}),V=await D.json().catch(()=>null);if(!D.ok){D.status===422&&V?.errors?(Y(V.errors),g({title:e("Hay errores en el formulario"),text:V.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:V?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:V?.message??e("Acción realizada correctamente."),icon:"success"}),ie(c.form),le()}catch(D){console.error("[ProductLines] Submit error",D),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{J(!1)}},r=async()=>{if(!c.delete||!E)return;const i=c.delete.dataset.productLineId;if(!i){ie(c.delete);return}E.disabled=!0,E.classList.add("cursor-not-allowed","opacity-70");try{const s=await fetch(`${p}/${i}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":o}}),l=await s.json().catch(()=>null);if(!s.ok){g({title:e("Error"),text:l?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:l?.message??e("Registro eliminado correctamente."),icon:"success"}),ie(c.delete),le()}catch(s){console.error("[ProductLines] Delete error",s),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{E.disabled=!1,E.classList.remove("cursor-not-allowed","opacity-70")}},a=async i=>{const s=i.dataset.id??"";if(!s||i.disabled)return;const l=!i.checked,y=i.checked?"A":"I";i.disabled=!0;try{const h=await fetch(`${p}/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({status:y})}),C=await h.json().catch(()=>null);if(!h.ok){i.checked=l,g({title:e("Error"),text:C?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("El estado se modificó correctamente."),icon:"success"}),le()}catch(h){console.error("[ProductLines] Status toggle error",h),i.checked=l,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{i.disabled=!1}};f&&f.addEventListener("submit",i=>{i.preventDefault(),ne()}),E&&E.addEventListener("click",r),n.addEventListener("click",i=>{console.log("🔵 [ProductLines] Click detected",{target:i.target,targetTagName:i.target?.tagName,targetClasses:i.target?.className,targetId:i.target?.id,targetDataset:i.target?.dataset});let s=null;if(i.target instanceof Element&&(s=i.target.closest("[data-product-line-action], [data-action], [data-row-action]"),console.log("🔵 [ProductLines] First closest search",{found:!!s,element:s,tagName:s?.tagName,classes:s?.className}),!s&&(i.target.tagName==="I"||i.target.classList.contains("fa"))&&(s=i.target.closest("button[data-action], button[data-row-action]"),console.log("🔵 [ProductLines] Second closest search (icon)",{found:!!s,element:s,tagName:s?.tagName}))),console.log("🔵 [ProductLines] Final actionEl",{found:!!s,element:s,allAttributes:s?Array.from(s.attributes).map(V=>({name:V.name,value:V.value})):null,dataset:s?.dataset}),!s){console.log("🔵 [ProductLines] No actionEl found, returning");return}if(s.hasAttribute("data-product-line-action")){const V=s.dataset.productLineAction;console.log("🔵 [ProductLines] Product line action",{action:V}),V==="create"&&(pe("create"),B(c.form));return}const l=s.dataset.action||s.dataset.rowAction;if(console.log("🔵 [ProductLines] Row action extracted",{rowAction:l,dataAction:s.dataset.action,dataRowAction:s.dataset.rowAction}),!l){console.log("🔵 [ProductLines] No rowAction found, returning");return}const y=(s.dataset.id||s.dataset.rowId||"").trim(),h=(s.dataset.name||s.dataset.rowName)??"",C=s.dataset.rowPayload;let D=C?rt(C):null;if(console.log("🔵 [ProductLines] Action clicked - FULL DATA",{rowAction:l,rowId:y,rowName:h,hasPayload:!!C,payload:C,data:D,baseUrl:p,csrfToken:o?"present":"missing",allDatasetKeys:Object.keys(s.dataset),datasetId:s.dataset.id,datasetRowId:s.dataset.rowId}),!y){console.error("🔴 [ProductLines] Missing rowId",{actionEl:s,rowAction:l,allDatasetKeys:s?Object.keys(s.dataset):null,dataset:s?.dataset}),g({title:e("Error"),text:e("No se pudo identificar el registro seleccionado."),icon:"error"});return}if(!D&&y){if(console.log("🟡 [ProductLines] No payload, will fetch from server",{rowId:y,rowAction:l,hasData:!!D}),l==="view"||l==="edit"){if(!p){console.error("🔴 [ProductLines] Missing baseUrl"),g({title:e("Error"),text:e("Error de configuración. Por favor, recarga la página."),icon:"error"});return}const V=`${p}/${y}`;console.log("🟢 [ProductLines] Starting fetch",{fetchUrl:V,rowAction:l,rowId:y,baseUrl:p,method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o?"present":"missing"}}),fetch(V,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o}}).then(async N=>{console.log("🟢 [ProductLines] Response received (raw)",{ok:N.ok,status:N.status,statusText:N.statusText,headers:Object.fromEntries(N.headers.entries()),url:N.url});const $=await N.json().catch(_=>(console.error("🔴 [ProductLines] JSON parse error",{parseError:_}),null));if(console.log("🟢 [ProductLines] Response JSON parsed",{json:$}),!N.ok){console.error("🔴 [ProductLines] Fetch failed - Response not OK",{status:N.status,statusText:N.statusText,url:V,json:$,responseHeaders:Object.fromEntries(N.headers.entries())});const _=$?.message??e("No se pudieron obtener los datos del registro.");return g({title:e("Error"),text:_,icon:"error"}),null}return $}).then(N=>{if(console.log("🟢 [ProductLines] Processing response",{hasJson:!!N,json:N,status:N?.status,hasData:!!N?.data,hasItem:!!N?.data?.item,item:N?.data?.item}),!N){console.log("🟡 [ProductLines] No JSON to process");return}if(N?.status==="success"&&N?.data?.item)console.log("✅ [ProductLines] Success! Opening modal",{rowAction:l,data:N.data.item}),D=N.data.item,l==="view"?(re(D),B(c.view)):l==="edit"&&(pe("edit",D),B(c.form));else{const $=N?.message??e("No se pudieron obtener los datos del registro.");console.error("🔴 [ProductLines] Invalid response format",{json:N,expected:"status: success, data.item",actualStatus:N?.status,hasData:!!N?.data,hasItem:!!N?.data?.item}),g({title:e("Error"),text:$,icon:"error"})}}).catch(N=>{console.error("🔴 [ProductLines] Fetch error (catch)",{error:N,errorName:N.name,errorMessage:N.message,errorStack:N.stack,fetchUrl:V});const $=N.message?.includes("Failed to fetch")?e("Error de conexión. Verifica tu conexión a internet."):e("No se pudieron obtener los datos del registro.");g({title:e("Error"),text:$,icon:"error"})});return}else if(l==="delete"){console.log("🟡 [ProductLines] Delete action",{rowId:y,rowName:h}),c.delete&&(c.delete.dataset.productLineId=y),L&&(L.textContent=h||y),B(c.delete);return}}if(D){if(l==="view"){re(D),B(c.view);return}if(l==="edit"){pe("edit",D),B(c.form);return}if(l==="delete"){c.delete&&(c.delete.dataset.productLineId=D.id??""),L&&(L.textContent=(D.name||D.id)??""),B(c.delete);return}}l!=="delete"&&(console.error("🔴 [ProductLines] No data available",{rowAction:l,rowId:y,hasData:!!D}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"}))}),n.addEventListener("change",i=>{const s=i.target;s instanceof HTMLInputElement&&s.matches("[data-status-toggle]")&&a(s)})})},es=()=>{console.log("🔵 [ProductCategories] Module initialization started");const t=document.querySelectorAll("[data-product-categories-root]");console.log("🔵 [ProductCategories] Found roots",{count:t.length,roots:Array.from(t)}),document.querySelectorAll("[data-product-categories-root]").forEach((n,d)=>{console.log(`🔵 [ProductCategories] Initializing root ${d+1}`,{root:n,attributes:Array.from(n.attributes).map(b=>({name:b.name,value:b.value}))});const m=n.dataset.productCategoriesTableId??"",p=n.dataset.productCategoriesBaseUrl??"",u=n.dataset.productCategoriesStoreUrl??p,o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",c=n.dataset.productCategoriesOptionsUrl??"";console.log("🔵 [ProductCategories] init - Configuration",{tableId:m,baseUrl:p,storeUrl:u,optionsUrl:c,csrfToken:o?"present":"missing",rootElement:n,allDataAttributes:Object.keys(n.dataset)});const f=(()=>{try{return JSON.parse(n.dataset.productCategoriesLines??"[]")}catch(b){return console.error("[ProductCategories] Error parsing lines",b),[]}})();let x={};try{x=JSON.parse(n.dataset.productCategoriesConfig??"{}")}catch(b){console.error("[ProductCategories] Error parsing config",b)}const S=!!x.requires_parent,P={form:n.querySelector('[data-product-category-modal="form"]'),view:n.querySelector('[data-product-category-modal="view"]'),delete:n.querySelector('[data-product-category-modal="delete"]')},M=P.form?.querySelector("[data-product-category-form]")??null,L=P.form?.querySelector("[data-product-category-submit]")??null,E=L?.querySelector("[data-product-category-submit-label]")??null,R=P.form?.querySelector("[data-product-category-modal-title]")??null,A=M?.querySelector("[data-product-category-parent-wrapper]")??null,B=A?.querySelector('[data-product-category-input="parent_id"]')??null,ie=M?.querySelector('[data-product-category-input="product_line_id"]')??null,se=P.view?.querySelector("[data-product-category-view]")??null,Y=P.delete?.querySelector("[data-product-category-delete-name]")??null,J=P.delete?.querySelector("[data-product-category-delete-confirm]")??null,G="overflow-hidden";let me=new Map;const le=(b,v,{placeholder:H=""}={})=>{if(!(b instanceof HTMLInputElement))return null;const O=b.closest("[data-select]");if(!O)return null;const q=O.querySelector("[data-select-trigger]"),T=O.querySelector("[data-select-dropdown]"),z=O.querySelector("[data-select-value]"),w=O.querySelector("[data-select-icon]"),k=v?O.querySelector(v):T?.querySelector(".max-h-60"),Q=q?.dataset.selectPlaceholder??H??"",ve=()=>{T&&(T.hidden=!0,T.dataset.open="false",O.dataset.open="false",q?.setAttribute("aria-expanded","false"),w?.classList.remove("rotate-180"))},qe=()=>{k&&k.querySelectorAll("[data-select-option]").forEach(Ge=>{Ge.dataset.selected=Ge.dataset.value===b.value?"true":"false"})},_e=(Ge=null)=>{k?.querySelectorAll("[data-select-option]");let Te=Ge;!Te&&k&&(Te=k.querySelector(`[data-select-option][data-value="${b.value??""}"]`)?.dataset.label??null),Te||(Te=b.value?b.value:Q),z&&(z.textContent=Te),q?.classList.toggle("is-empty",!b.value),qe()},Ce=(Ge,Te=null)=>{b.value=Ge??"",_e(Te),b.dispatchEvent(new Event("change",{bubbles:!0}))},Le=(Ge,Te)=>{const Z=document.createElement("button");return Z.type="button",Z.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",Z.dataset.selectOption="",Z.dataset.value=Ge??"",Z.dataset.label=Te??"",Z.dataset.selected=b.value===(Ge??"")?"true":"false",Z.innerHTML=`<span class="truncate">${Te??""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,Z.addEventListener("click",I=>{I.preventDefault(),Ce(Ge??"",Te??""),ve(),q?.focus({preventScroll:!0})}),Z},Ve=(Ge=[])=>{k&&(k.innerHTML="",Ge.forEach(Te=>{const Z=Le(Te.value??"",Te.label??"");k.appendChild(Z)}),_e())};return _e(),{renderOptions:Ve,setValue:Ce,updateDisplay:_e,close:ve,selectRoot:O,placeholder:Q}},pe=le(ie,"[data-product-category-line-options]",{placeholder:e("Selecciona una línea")}),re=le(B,"[data-product-category-parent-options]",{placeholder:e("Selecciona una categoría padre")}),ne=b=>b.closest("[data-product-category-modal]"),r=b=>{b&&(b.classList.remove("hidden"),document.body.classList.add(G))},a=b=>{b&&(b.classList.add("hidden"),n.querySelector("[data-product-category-modal]:not(.hidden)")||document.body.classList.remove(G))};(()=>{A&&(S?A.classList.remove("hidden"):A.classList.add("hidden"))})(),(()=>{if(!pe)return;const b=f.map(v=>({value:v.id,label:v.name}));pe.renderOptions(b),ie?.value||pe.updateDisplay()})();const l=async b=>{if(!S||!re||!c||!b){re&&(re.renderOptions([]),re.setValue(""));return}if(me.has(b)){const v=me.get(b);re.renderOptions(v),re.updateDisplay();return}try{const v=`${c}${c.includes("?")?"&":"?"}per_page=200&product_line_id=${encodeURIComponent(b)}`,H=await fetch(v,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),O=await H.json().catch(()=>null);if(!H.ok||!O?.data?.items)throw new Error("Invalid response");const q=O.data.items.map(T=>({value:T.id,label:T.name}));me.set(b,q),re.renderOptions(q),re.updateDisplay()}catch(v){console.error("[ProductCategories] Error loading parent options",v),g({title:e("Error"),text:e("No se pudieron cargar las categorías padre."),icon:"error"})}};n.querySelectorAll("[data-product-category-modal-close]").forEach(b=>{b.addEventListener("click",()=>{const v=ne(b);a(v)})}),Object.values(P).forEach(b=>{b&&(b.addEventListener("click",v=>{v.target===b&&a(b)}),b.addEventListener("keydown",v=>{v.key==="Escape"&&a(b)}))});const y=()=>{M&&(M.querySelectorAll("[data-product-category-error]").forEach(b=>{b.textContent=""}),M.querySelectorAll("[data-product-category-input]").forEach(b=>{if(b instanceof HTMLInputElement&&b.type==="hidden"){const v=b.closest("[data-select]");v&&(v.dataset.selectInvalid="false",v.querySelector("[data-select-trigger]")?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))}else(b instanceof HTMLInputElement||b instanceof HTMLTextAreaElement||b instanceof HTMLSelectElement)&&b.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},h=b=>{!M||!b||Object.entries(b).forEach(([v,H])=>{const O=Array.isArray(H)?H[0]:H,q=M.querySelector(`[data-product-category-error="${v}"]`),T=M.querySelector(`[data-product-category-input="${v}"]`);if(q&&(q.textContent=O??""),T instanceof HTMLInputElement&&T.type==="hidden"){const z=T.closest("[data-select]");z&&(z.dataset.selectInvalid="true",z.querySelector("[data-select-trigger]")?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))}else(T instanceof HTMLInputElement||T instanceof HTMLTextAreaElement||T instanceof HTMLSelectElement)&&T.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},C=b=>{!L||!E||(b?E.textContent="Procesando...":L.dataset.originalLabel&&(E.textContent=L.dataset.originalLabel),L.disabled=b)},D=(b,v)=>{if(!M)return;if(b==="product_line_id"&&pe){pe.setValue(v??"");return}if(b==="parent_id"&&re){typeof v=="object"&&v!==null&&v.id?re.setValue(v.id,v.name||v.label):re.setValue(v??"");return}const H=M.querySelector(`[data-product-category-input="${b}"]`);H&&(H instanceof HTMLInputElement||H instanceof HTMLTextAreaElement||H instanceof HTMLSelectElement)&&(H.value=v??"")},V=b=>{if(!M)return"";const v=M.querySelector(`[data-product-category-input="${b}"]`);return v&&(v instanceof HTMLInputElement||v instanceof HTMLTextAreaElement||v instanceof HTMLSelectElement)?v.value.trim():""},N=()=>{if(!m){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:m}}))},$=(b,v=null)=>{!M||!L||!E||(y(),C(!1),M.dataset.mode=b,M.dataset.productCategoryId=v?.id??"",b==="create"?(M.reset(),D("status","A"),R&&(R.textContent=S?"Nueva subcategoría":"Nueva categoría"),E.textContent="Guardar",L.dataset.originalLabel="Guardar",pe?.setValue(""),re?.renderOptions([]),re?.setValue("")):(R&&(R.textContent=S?"Editar subcategoría":"Editar categoría"),E.textContent="Actualizar",L.dataset.originalLabel="Actualizar"),v?(D("name",v.name??""),D("status",v.status??"A"),D("product_line_id",v.product_line_id??""),S&&v.product_line_id&&l(v.product_line_id).then(()=>{v.parent_id&&v.parent_name?D("parent_id",{id:v.parent_id,name:v.parent_name}):D("parent_id",v.parent_id??"")}),S||(v.parent_id&&v.parent_name?D("parent_id",{id:v.parent_id,name:v.parent_name}):D("parent_id",v.parent_id??""))):(D("name",""),D("product_line_id",""),D("parent_id","")))},_=b=>{if(!se||!b)return;se.querySelectorAll("[data-product-category-view-field]").forEach(H=>{const O=H.getAttribute("data-product-category-view-field");if(!O)return;const q=b[O];H.textContent=q!=null&&q!==""?String(q):"-"});const v=se.querySelector('[data-product-category-view-field="product_line_name"]');v&&(v.textContent=b.product_line_name??"-")},te=async()=>{if(!M||!L||!E)return;const b=M.dataset.mode??"create",v=M.dataset.productCategoryId??"",H={name:V("name"),product_line_id:V("product_line_id")||null,parent_id:V("parent_id")||null,status:V("status")||"A"};y();const O={};if(H.name||(O.name=e("El nombre es obligatorio.")),!S&&!H.product_line_id&&(O.product_line_id=e("Selecciona una línea de producto.")),S&&(H.product_line_id||(O.product_line_id=e("Selecciona una línea de producto.")),S&&!H.parent_id&&(O.parent_id=e("Selecciona una categoría padre."))),Object.keys(O).length>0){h(O),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}C(!0);const q=b==="create"?u:`${p}/${v}`,T=b==="create"?"POST":"PATCH";try{const z=await fetch(q,{method:T,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(H)}),w=await z.json().catch(()=>null);if(!z.ok){z.status===422&&w?.errors?(h(w.errors),g({title:e("Hay errores en el formulario"),text:w.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:w?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:w?.message??e("Acción realizada correctamente."),icon:"success"}),a(P.form),N()}catch(z){console.error("[ProductCategories] Submit error",z),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{C(!1)}},j=async()=>{if(!P.delete||!J)return;const b=P.delete.dataset.productCategoryId;if(!b){a(P.delete);return}J.disabled=!0,J.classList.add("cursor-not-allowed","opacity-70");try{const v=await fetch(`${p}/${b}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":o}}),H=await v.json().catch(()=>null);if(!v.ok){g({title:e("Error"),text:H?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:H?.message??e("Registro eliminado correctamente."),icon:"success"}),a(P.delete),N()}catch(v){console.error("[ProductCategories] Delete error",v),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{J.disabled=!1,J.classList.remove("cursor-not-allowed","opacity-70")}},X=async b=>{const v=b.dataset.id??"";if(!v||b.disabled)return;const H=!b.checked,O=b.checked?"A":"I";b.disabled=!0;try{const q=await fetch(`${p}/${v}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({status:O})}),T=await q.json().catch(()=>null);if(!q.ok){b.checked=H,g({title:e("Error"),text:T?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:T?.message??e("El estado se modificó correctamente."),icon:"success"}),N()}catch(q){console.error("[ProductCategories] Status toggle error",q),b.checked=H,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{b.disabled=!1}};M&&M.addEventListener("submit",b=>{b.preventDefault(),te()}),J&&J.addEventListener("click",j),n.addEventListener("click",b=>{console.log("🔵 [ProductCategories] Click detected",{target:b.target,targetTagName:b.target?.tagName,targetClasses:b.target?.className,targetId:b.target?.id,targetDataset:b.target?.dataset});let v=null;if(b.target instanceof Element&&(v=b.target.closest("[data-product-category-action], [data-action], [data-row-action]"),console.log("🔵 [ProductCategories] First closest search",{found:!!v,element:v,tagName:v?.tagName,classes:v?.className}),!v&&(b.target.tagName==="I"||b.target.classList.contains("fa"))&&(v=b.target.closest("button[data-action], button[data-row-action]"),console.log("🔵 [ProductCategories] Second closest search (icon)",{found:!!v,element:v,tagName:v?.tagName}))),console.log("🔵 [ProductCategories] Final actionEl",{found:!!v,element:v,allAttributes:v?Array.from(v.attributes).map(w=>({name:w.name,value:w.value})):null,dataset:v?.dataset}),!v){console.log("🔵 [ProductCategories] No actionEl found, returning");return}if(v.hasAttribute("data-product-category-action")){const w=v.dataset.productCategoryAction;console.log("🔵 [ProductCategories] Product category action",{action:w}),w==="create"&&(S&&(me.clear(),re?.renderOptions([]),re?.setValue("")),$("create"),r(P.form));return}const H=v.dataset.action||v.dataset.rowAction;if(console.log("🔵 [ProductCategories] Row action extracted",{rowAction:H,dataAction:v.dataset.action,dataRowAction:v.dataset.rowAction}),!H){console.log("🔵 [ProductCategories] No rowAction found, returning");return}const O=(v.dataset.id||v.dataset.rowId||"").trim(),q=(v.dataset.name||v.dataset.rowName)??"",T=v.dataset.rowPayload;let z=T?rt(T):null;if(console.log("🔵 [ProductCategories] Action clicked - FULL DATA",{rowAction:H,rowId:O,rowName:q,hasPayload:!!T,payload:T,data:z,baseUrl:p,csrfToken:o?"present":"missing",allDatasetKeys:Object.keys(v.dataset),datasetId:v.dataset.id,datasetRowId:v.dataset.rowId}),!O){console.error("🔴 [ProductCategories] Missing rowId",{actionEl:v,rowAction:H,allDatasetKeys:v?Object.keys(v.dataset):null,dataset:v?.dataset}),g({title:e("Error"),text:e("No se pudo identificar el registro seleccionado."),icon:"error"});return}if(!z&&O){if(console.log("🟡 [ProductCategories] No payload, will fetch from server",{rowId:O,rowAction:H,hasData:!!z}),H==="view"||H==="edit"){if(!p){console.error("🔴 [ProductCategories] Missing baseUrl"),g({title:e("Error"),text:e("Error de configuración. Por favor, recarga la página."),icon:"error"});return}const w=`${p}/${O}`;console.log("🟢 [ProductCategories] Starting fetch",{fetchUrl:w,rowAction:H,rowId:O,baseUrl:p,method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o?"present":"missing"}}),fetch(w,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o}}).then(async k=>{console.log("🟢 [ProductCategories] Response received (raw)",{ok:k.ok,status:k.status,statusText:k.statusText,headers:Object.fromEntries(k.headers.entries()),url:k.url});const Q=await k.json().catch(ve=>(console.error("🔴 [ProductCategories] JSON parse error",{parseError:ve}),null));if(console.log("🟢 [ProductCategories] Response JSON parsed",{json:Q}),!k.ok){console.error("🔴 [ProductCategories] Fetch failed - Response not OK",{status:k.status,statusText:k.statusText,url:w,json:Q,responseHeaders:Object.fromEntries(k.headers.entries())});const ve=Q?.message??e("No se pudieron obtener los datos del registro.");return g({title:e("Error"),text:ve,icon:"error"}),null}return Q}).then(k=>{if(console.log("🟢 [ProductCategories] Processing response",{hasJson:!!k,json:k,status:k?.status,hasData:!!k?.data,hasItem:!!k?.data?.item,item:k?.data?.item}),!k){console.log("🟡 [ProductCategories] No JSON to process");return}if(k?.status==="success"&&k?.data?.item)console.log("✅ [ProductCategories] Success! Opening modal",{rowAction:H,data:k.data.item}),z=k.data.item,H==="view"?(_(z),r(P.view)):H==="edit"&&($("edit",z),r(P.form));else{const Q=k?.message??e("No se pudieron obtener los datos del registro.");console.error("🔴 [ProductCategories] Invalid response format",{json:k,expected:"status: success, data.item",actualStatus:k?.status,hasData:!!k?.data,hasItem:!!k?.data?.item}),g({title:e("Error"),text:Q,icon:"error"})}}).catch(k=>{console.error("🔴 [ProductCategories] Fetch error (catch)",{error:k,errorName:k.name,errorMessage:k.message,errorStack:k.stack,fetchUrl:w});const Q=k.message?.includes("Failed to fetch")?e("Error de conexión. Verifica tu conexión a internet."):e("No se pudieron obtener los datos del registro.");g({title:e("Error"),text:Q,icon:"error"})});return}else if(H==="delete"){P.delete&&(P.delete.dataset.productCategoryId=O),Y&&(Y.textContent=q||O),r(P.delete);return}}if(!z||!z.id){if(H==="delete"){const w=O||"",k=q||"";if(!w){g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"});return}P.delete&&(P.delete.dataset.productCategoryId=w),Y&&(Y.textContent=k||w),r(P.delete)}else g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(H==="view"){_(z),r(P.view);return}if(H==="edit"){$("edit",z),r(P.form);return}H==="delete"&&(P.delete&&(P.delete.dataset.productCategoryId=z.id??""),Y&&(Y.textContent=(z.name||z.id)??""),r(P.delete))}),n.addEventListener("change",b=>{const v=b.target;v instanceof HTMLInputElement&&v.matches("[data-status-toggle]")&&X(v),v instanceof HTMLInputElement&&v.matches('[data-product-category-input="product_line_id"]')&&S&&(re?.renderOptions([]),re?.setValue(""),l(v.value))})})},ts=()=>{const t=document.querySelector("[data-workshop-categories-root]");if(!t)return;const n=t.dataset.workshopCategoriesTableId??"",d=t.dataset.workshopCategoriesBaseUrl??"",m=t.dataset.workshopCategoriesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-workshop-category-modal="form"]'),view:t.querySelector('[data-workshop-category-modal="view"]'),delete:t.querySelector('[data-workshop-category-modal="delete"]')},o=u.form?.querySelector("[data-workshop-category-form]")??null,c=u.form?.querySelector("[data-workshop-category-submit]")??null,f=c?.querySelector("[data-workshop-category-submit-label]")??null,x=u.form?.querySelector("[data-workshop-category-modal-title]")??null,S=u.view?.querySelector("[data-workshop-category-view]")??null,P=u.delete?.querySelector("[data-workshop-category-delete-name]")??null,M=u.delete?.querySelector("[data-workshop-category-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-workshop-category-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-workshop-category-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-workshop-category-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-workshop-category-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-workshop-category-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-workshop-category-error="${a}"]`),y=o.querySelector(`[data-workshop-category-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent=e("Procesando..."):c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-workshop-category-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-workshop-category-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.workshopCategoryId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent=e("Nueva categoría")),f.textContent=e("Guardar"),c.dataset.originalLabel=e("Guardar")):(x&&(x.textContent=e("Editar categoría")),f.textContent=e("Actualizar"),c.dataset.originalLabel=e("Actualizar")),a?(Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A")):Y("description",""))},le=r=>{!S||!r||S.querySelectorAll("[data-workshop-category-view-field]").forEach(a=>{const i=a.getAttribute("data-workshop-category-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.workshopCategoryId??"",i={name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const s={};if(i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[WorkshopCategories] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.workshopCategoryId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[WorkshopCategories] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[WorkshopCategories] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",r=>{const a=r.target instanceof Element?r.target.closest("[data-workshop-category-action], [data-action], [data-row-action]"):null;if(!a)return;if(a.hasAttribute("data-workshop-category-action")){a.dataset.workshopCategoryAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction,s=(a.dataset.id||a.dataset.rowId)??"",l=(a.dataset.name||a.dataset.rowName)??"",y=a.dataset.rowPayload;let h=y?rt(y):null;if(!h&&s&&(h={id:s,name:l||null}),!i||!h||!h.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){!h||Object.keys(h).length<=2?fetch(`${d}/${h.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(C=>C.json()).then(C=>{C?.data?.item?(le(C.data.item),R(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(C=>{console.error("[WorkshopCategories] Fetch error",C),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(le(h),R(u.view));return}if(i==="edit"){!h||Object.keys(h).length<=2?fetch(`${d}/${h.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(C=>C.json()).then(C=>{C?.data?.item?(me("edit",C.data.item),R(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(C=>{console.error("[WorkshopCategories] Fetch error",C),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(me("edit",h),R(u.form));return}i==="delete"&&(u.delete&&(u.delete.dataset.workshopCategoryId=h.id),P&&(P.textContent=l||h.name||h.id),R(u.delete))}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},rs=()=>{const t=document.querySelector("[data-workshop-brands-root]");if(!t)return;const n=t.dataset.workshopBrandsTableId??"",d=t.dataset.workshopBrandsBaseUrl??"",m=t.dataset.workshopBrandsStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-workshop-brand-modal="form"]'),view:t.querySelector('[data-workshop-brand-modal="view"]'),delete:t.querySelector('[data-workshop-brand-modal="delete"]')},o=u.form?.querySelector("[data-workshop-brand-form]")??null,c=u.form?.querySelector("[data-workshop-brand-submit]")??null,f=c?.querySelector("[data-workshop-brand-submit-label]")??null,x=u.form?.querySelector("[data-workshop-brand-modal-title]")??null,S=u.view?.querySelector("[data-workshop-brand-view]")??null,P=u.delete?.querySelector("[data-workshop-brand-delete-name]")??null,M=u.delete?.querySelector("[data-workshop-brand-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-workshop-brand-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-workshop-brand-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-workshop-brand-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-workshop-brand-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-workshop-brand-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-workshop-brand-error="${a}"]`),y=o.querySelector(`[data-workshop-brand-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent=e("Procesando..."):c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-workshop-brand-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-workshop-brand-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.workshopBrandId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent=e("Nueva marca")),f.textContent=e("Guardar"),c.dataset.originalLabel=e("Guardar")):(x&&(x.textContent=e("Editar marca")),f.textContent=e("Actualizar"),c.dataset.originalLabel=e("Actualizar")),a?(Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A")):Y("description",""))},le=r=>{!S||!r||S.querySelectorAll("[data-workshop-brand-view-field]").forEach(a=>{const i=a.getAttribute("data-workshop-brand-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.workshopBrandId??"",i={name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const s={};if(i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[WorkshopBrands] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.workshopBrandId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[WorkshopBrands] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[WorkshopBrands] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",r=>{const a=r.target instanceof Element?r.target.closest("[data-workshop-brand-action], [data-action], [data-row-action]"):null;if(!a)return;if(a.hasAttribute("data-workshop-brand-action")){a.dataset.workshopBrandAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction,s=(a.dataset.id||a.dataset.rowId)??"",l=(a.dataset.name||a.dataset.rowName)??"",y=a.dataset.rowPayload;let h=y?rt(y):null;if(!h&&s&&(h={id:s,name:l||null}),!i||!h||!h.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){!h||Object.keys(h).length<=2?fetch(`${d}/${h.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(C=>C.json()).then(C=>{C?.data?.item?(le(C.data.item),R(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(C=>{console.error("[WorkshopBrands] Fetch error",C),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(le(h),R(u.view));return}if(i==="edit"){!h||Object.keys(h).length<=2?fetch(`${d}/${h.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(C=>C.json()).then(C=>{C?.data?.item?(me("edit",C.data.item),R(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(C=>{console.error("[WorkshopBrands] Fetch error",C),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(me("edit",h),R(u.form));return}i==="delete"&&(u.delete&&(u.delete.dataset.workshopBrandId=h.id),P&&(P.textContent=l||h.name||h.id),R(u.delete))}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},os=()=>{const t=document.querySelector("[data-workshop-equipments-root]");if(!t)return;const n=t.dataset.workshopEquipmentsTableId??"",d=t.dataset.workshopEquipmentsBaseUrl??"",m=t.dataset.workshopEquipmentsStoreUrl??d,p=t.dataset.workshopEquipmentsModelOptionsUrl??"",u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",o={form:t.querySelector('[data-workshop-equipment-modal="form"]'),view:t.querySelector('[data-workshop-equipment-modal="view"]'),delete:t.querySelector('[data-workshop-equipment-modal="delete"]')},c=o.form?.querySelector("[data-workshop-equipment-form]")??null,f=o.form?.querySelector("[data-workshop-equipment-submit]")??null,x=f?.querySelector("[data-workshop-equipment-submit-label]")??null,S=o.form?.querySelector("[data-workshop-equipment-modal-title]")??null,P=o.view?.querySelector("[data-workshop-equipment-view]")??null,M=o.delete?.querySelector("[data-workshop-equipment-delete-name]")??null,L=o.delete?.querySelector("[data-workshop-equipment-delete-confirm]")??null,E=c?.querySelector('[data-select-name="brand_id"]')??null,R=E?.querySelector("[data-workshop-equipment-brand-options]")??null,A=E?.querySelector("[data-select-trigger]")??null,B=E?.querySelector("[data-select-dropdown]")??null,ie=E?.querySelector("[data-select-value]")??null,se=c?.querySelector('[data-workshop-equipment-input="brand_id"]')??null,Y=E?.querySelector("[data-select-icon]")??null,J=A?.dataset.selectPlaceholder??"",G=c?.querySelector('[data-select-name="model_id"]')??null,me=G?.querySelector("[data-workshop-equipment-model-options]")??null,le=G?.querySelector("[data-select-trigger]")??null,pe=G?.querySelector("[data-select-dropdown]")??null,re=G?.querySelector("[data-select-value]")??null,ne=c?.querySelector('[data-workshop-equipment-input="model_id"]')??null,r=G?.querySelector("[data-select-icon]")??null,a=G?.querySelector("[data-workshop-equipment-model-search]")??null,i=le?.dataset.selectPlaceholder??"",s="overflow-hidden",l=I=>I.closest("[data-workshop-equipment-modal]"),y=I=>{I&&(I.classList.remove("hidden"),document.body.classList.add(s))},h=I=>{I&&(I.classList.add("hidden"),t.querySelector("[data-workshop-equipment-modal]:not(.hidden)")||document.body.classList.remove(s),q(),w())};t.querySelectorAll("[data-workshop-equipment-modal-close]").forEach(I=>{I.addEventListener("click",()=>{const K=l(I);h(K)})}),Object.values(o).forEach(I=>{I&&(I.addEventListener("click",K=>{K.target===I&&h(I)}),I.addEventListener("keydown",K=>{K.key==="Escape"&&h(I)}))});const C=()=>{c&&(c.querySelectorAll("[data-workshop-equipment-error]").forEach(I=>{I.textContent=""}),c.querySelectorAll("[data-workshop-equipment-input]").forEach(I=>{(I instanceof HTMLInputElement||I instanceof HTMLTextAreaElement)&&I.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),E&&(E.dataset.selectInvalid="false"),G&&(G.dataset.selectInvalid="false"),A?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),le?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))},D=I=>{!c||!I||Object.entries(I).forEach(([K,ye])=>{const xe=Array.isArray(ye)?ye[0]:ye,Ie=c.querySelector(`[data-workshop-equipment-error="${K}"]`);if(Ie&&(Ie.textContent=xe??""),K==="brand_id"){E&&(E.dataset.selectInvalid="true"),A?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");return}if(K==="model_id"){G&&(G.dataset.selectInvalid="true"),le?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");return}const we=c.querySelector(`[data-workshop-equipment-input="${K}"]`);(we instanceof HTMLInputElement||we instanceof HTMLTextAreaElement)&&we.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},V=I=>{!f||!x||(I?x.textContent=e("Procesando..."):f.dataset.originalLabel&&(x.textContent=f.dataset.originalLabel),f.disabled=I)},N=(I,K)=>{if(!c)return;const ye=c.querySelector(`[data-workshop-equipment-input="${I}"]`);ye&&(ye instanceof HTMLInputElement||ye instanceof HTMLTextAreaElement)&&(ye.value=K??"")},$=I=>{if(!c)return"";const K=c.querySelector(`[data-workshop-equipment-input="${I}"]`);return K&&(K instanceof HTMLInputElement||K instanceof HTMLTextAreaElement)?K.value.trim():""},_=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},te=I=>{!P||!I||P.querySelectorAll("[data-workshop-equipment-view-field]").forEach(K=>{const ye=K.getAttribute("data-workshop-equipment-view-field");if(!ye)return;const xe=I[ye];K.textContent=xe!=null&&xe!==""?String(xe):"-"})},j=(I,K=null)=>{!c||!f||!x||(C(),V(!1),c.dataset.mode=I,c.dataset.workshopEquipmentId=K?.id??"",I==="create"?(c.reset(),X(""),b(""),N("status","A"),S&&(S.textContent=e("Nuevo equipo")),x.textContent=e("Guardar"),f.dataset.originalLabel=e("Guardar")):(S&&(S.textContent=e("Editar equipo")),x.textContent=e("Actualizar"),f.dataset.originalLabel=e("Actualizar")),K?(X(K.brand_id??""),b(K.model_id??"",K.model_name??""),N("identifier",K.identifier??""),N("note",K.note??""),N("status",K.status??"A")):(N("identifier",""),N("note","")))},X=I=>{if(!se)return;const K=I?String(I):"";if(se.value=K,ie){const xe=R?.querySelector(`[data-select-option][data-value="${K}"]`)?.dataset.label??J;ie.textContent=K?xe:J}R?.querySelectorAll("[data-select-option]").forEach(ye=>{ye.dataset.selected=ye.dataset.value===K?"true":"false"}),E&&(E.dataset.selectInvalid="false"),A?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),q(),K?(O(),_e(K,a?.value??"")):(b(""),H())},b=(I,K)=>{if(!ne)return;const ye=I?String(I):"";ne.value=ye,re&&(re.textContent=ye?K??v(ye):i),me?.querySelectorAll("[data-select-option]").forEach(xe=>{xe.dataset.selected=xe.dataset.value===ye?"true":"false"}),G&&(G.dataset.selectInvalid="false"),le?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),w()},v=I=>me?.querySelector(`[data-select-option][data-value="${I}"]`)?.dataset.label??i,H=()=>{le?.classList.add("pointer-events-none","opacity-60"),b("")},O=()=>{le?.classList.remove("pointer-events-none","opacity-60")},q=()=>{!E||!B||(B.hidden=!0,B.dataset.open="false",E.dataset.open="false",A?.setAttribute("aria-expanded","false"),Y?.classList.remove("rotate-180"))},T=()=>{!E||!B||(B.hidden=!1,B.dataset.open="true",E.dataset.open="true",A?.setAttribute("aria-expanded","true"),Y?.classList.add("rotate-180"))},z=()=>{if(B){if(B.dataset.open==="true"){q();return}T()}},w=()=>{!G||!pe||(pe.hidden=!0,pe.dataset.open="false",G.dataset.open="false",le?.setAttribute("aria-expanded","false"),r?.classList.remove("rotate-180"))},k=()=>{!G||!pe||(pe.hidden=!1,pe.dataset.open="true",G.dataset.open="true",le?.setAttribute("aria-expanded","true"),r?.classList.add("rotate-180"))},Q=()=>{if(pe){if(pe.dataset.open==="true"){w();return}k(),se?.value&&_e(se.value,a?.value??"")}};let ve;const qe=I=>{if(me){if(me.innerHTML="",!I.length){const K=document.createElement("p");K.className="px-4 py-2 text-sm text-gray-500 dark:text-gray-400",K.textContent=e("No hay modelos disponibles."),me.appendChild(K);return}I.forEach(K=>{const ye=document.createElement("button");ye.type="button",ye.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",ye.dataset.selectOption="",ye.dataset.value=K.id??"",ye.dataset.label=K.name??"",ye.dataset.selected=ne?.value===String(K.id)?"true":"false",ye.innerHTML=`<span class="truncate">${K.name??""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,ye.addEventListener("click",xe=>{xe.preventDefault(),b(K.id??"",K.name??""),le?.focus({preventScroll:!0})}),me.appendChild(ye)})}},_e=async(I,K="")=>{if(!p||!I){qe([]);return}me&&(me.innerHTML=`<p class="px-4 py-2 text-sm text-gray-500 dark:text-gray-400">${e("Cargando...")}</p>`);try{const ye=new URL(p,window.location.origin);ye.searchParams.set("brand_id",I),ye.searchParams.set("per_page","200"),K&&ye.searchParams.set("search",K);const xe=await fetch(ye.toString(),{headers:{Accept:"application/json"}}),Ie=await xe.json().catch(()=>null);xe.ok&&Ie?.data?.items?qe(Ie.data.items):(console.error("[WorkshopEquipments] models fetch error",Ie),qe([]))}catch(ye){console.error("[WorkshopEquipments] models fetch error",ye),qe([])}},Ce=async()=>{if(!c||!f||!x)return;const I=c.dataset.mode??"create",K=c.dataset.workshopEquipmentId??"",ye={brand_id:se?.value??"",model_id:ne?.value??"",identifier:$("identifier"),note:$("note")||null,status:$("status")||"A"};C();const xe={};if(ye.brand_id||(xe.brand_id=e("Debes seleccionar una marca.")),ye.model_id||(xe.model_id=e("Debes seleccionar un modelo.")),ye.identifier||(xe.identifier=e("El identificador es obligatorio.")),Object.keys(xe).length>0){D(xe),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}V(!0);const Ie=I==="create"?m:`${d}/${K}`,we=I==="create"?"POST":"PATCH";try{const Ne=await fetch(Ie,{method:we,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u},body:JSON.stringify(ye)}),Je=await Ne.json().catch(()=>null);if(!Ne.ok){Ne.status===422&&Je?.errors?(D(Je.errors),g({title:e("Hay errores en el formulario"),text:Je.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:Je?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:Je?.message??e("Acción realizada correctamente."),icon:"success"}),h(o.form),_()}catch(Ne){console.error("[WorkshopEquipments] Submit error",Ne),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{V(!1)}},Le=async()=>{if(!o.delete||!L)return;const I=o.delete.dataset.workshopEquipmentId;if(!I){h(o.delete);return}L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70");try{const K=await fetch(`${d}/${I}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":u}}),ye=await K.json().catch(()=>null);if(!K.ok){g({title:e("Error"),text:ye?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:ye?.message??e("Registro eliminado correctamente."),icon:"success"}),h(o.delete),_()}catch(K){console.error("[WorkshopEquipments] Delete error",K),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70")}},Ve=async I=>{const K=I.dataset.id??"";if(!K||I.disabled)return;const ye=!I.checked,xe=I.checked?"A":"I";I.disabled=!0;try{const Ie=await fetch(`${d}/${K}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u},body:JSON.stringify({status:xe})}),we=await Ie.json().catch(()=>null);if(!Ie.ok){I.checked=ye,g({title:e("Error"),text:we?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:we?.message??e("El estado se modificó correctamente."),icon:"success"}),_()}catch(Ie){console.error("[WorkshopEquipments] Status toggle error",Ie),I.checked=ye,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{I.disabled=!1}};c&&c.addEventListener("submit",I=>{I.preventDefault(),Ce()}),L&&L.addEventListener("click",Le);const Ge=async I=>{console.log("[WorkshopEquipments] openBarcodePdf start",{url:I});const K=window.open(I,"_blank","noopener,noreferrer");if(K&&!K.closed){K.focus(),console.log("[WorkshopEquipments] barcode opened via direct popup");return}console.warn("[WorkshopEquipments] popup blocked, attempting fetch fallback",{url:I});try{const ye=await fetch(I,{method:"GET",headers:{Accept:"application/pdf"}});if(!ye.ok)throw new Error(`Unexpected response status ${ye.status}`);const xe=await ye.blob(),Ie=URL.createObjectURL(xe);console.log("[WorkshopEquipments] blob fallback generated",{blobUrl:Ie});const we=window.open(Ie,"_blank","noopener,noreferrer");we&&!we.closed?(we.focus(),console.log("[WorkshopEquipments] barcode opened from blob fallback")):(console.warn("[WorkshopEquipments] blob popup blocked, redirecting current tab",{blobUrl:Ie}),window.location.href=Ie),setTimeout(()=>{URL.revokeObjectURL(Ie),console.log("[WorkshopEquipments] blob URL revoked")},1e4)}catch(ye){console.error("[WorkshopEquipments] barcode fallback error",ye),window.location.href=I}},Te=()=>{t.querySelectorAll("[data-row-url]:not([data-row-action])").forEach(K=>{!(K instanceof HTMLElement)||!K.querySelector("i.fa-barcode, i.fa-solid.fa-barcode")||(K.dataset.rowAction="barcode",console.log("[WorkshopEquipments] enhanced barcode button",{button:K}))})};new MutationObserver(()=>{Te()}).observe(t,{childList:!0,subtree:!0}),Te(),t.addEventListener("click",I=>{if(!(I.target instanceof Element))return;console.log("[WorkshopEquipments] click detected",{target:I.target,tagName:I.target.tagName});let K=I.target.closest("[data-workshop-equipment-action], [data-action], [data-row-action], [data-barcode-url], [data-url], [data-row-url], [data-row-payload]");if(!K){console.log("[WorkshopEquipments] no actionable element detected");return}if(K.tagName!=="BUTTON"){const Ue=K.closest("button[data-action], button[data-url]");Ue&&(console.log("[WorkshopEquipments] using button parent instead of child element",{original:K.tagName,button:Ue,buttonAttributes:Array.from(Ue.attributes).map(ze=>`${ze.name}="${ze.value}"`).join(", ")}),K=Ue)}const ye=K.dataset.rowPayload?K:K.closest("[data-row-payload]");let xe=null;const Ie=ye?.dataset?.rowPayload??K.dataset.rowPayload??null;if(Ie)try{xe=rt(Ie)}catch(Ue){console.error("[WorkshopEquipments] payload decode error",Ue,{payloadValue:Ie})}const we=K.dataset??{};let Ne=we.workshopEquipmentAction??we.action??we.rowAction??null,Je=we.barcodeUrl??(K.getAttribute("data-url")||we.url)??we.rowUrl??"";if(Je||(Je=ye?.dataset?.barcodeUrl??(ye?.getAttribute?.("data-url")||ye?.dataset?.url)??ye?.dataset?.rowUrl??""),console.log("[WorkshopEquipments] URL extraction",{barcodeUrlAttr:Je,datasetUrl:we.url,getAttributeUrl:K.getAttribute("data-url"),actionElTagName:K.tagName,actionElHasDataUrl:K.hasAttribute("data-url")}),!Ne&&Je&&(Ne="barcode"),!Ne&&xe?.barcode_label_url&&(Ne="barcode"),console.log("[WorkshopEquipments] resolved action",{rowAction:Ne,dataset:we,barcodeUrlAttr:Je,data:xe,payloadSource:ye,actionEl:K,actionElTagName:K?.tagName,actionElAttributes:K?Array.from(K.attributes).map(Ue=>`${Ue.name}="${Ue.value}"`).join(", "):null}),Ne==="create"){j("create"),y(o.form);return}if(!Ne){console.log("[WorkshopEquipments] rowAction unresolved, skipping");return}const Xe=(K.dataset.id||K.dataset.rowId)??"",Qe=(K.dataset.name||K.dataset.rowName)??"";if(!xe&&Xe&&(xe={id:Xe,identifier:Qe||null}),Ne==="view"){const Ue=xe?.id??Xe??"";if(!Ue){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}console.log("[WorkshopEquipments] Fetching equipment",{equipmentId:Ue,url:`${d}/${Ue}`,data:xe,rowId:Xe}),fetch(`${d}/${Ue}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(ze=>(console.log("[WorkshopEquipments] Response received",{status:ze.status,ok:ze.ok,url:ze.url}),ze.json().then(Ze=>({response:ze,json:Ze})))).then(({response:ze,json:Ze})=>{ze.ok&&Ze?.data?.item?(te(Ze.data.item),y(o.view)):(console.error("[WorkshopEquipments] Error response",{response:{status:ze.status,ok:ze.ok},json:Ze}),g({title:e("Error"),text:Ze?.message??e("No se pudieron obtener los datos del registro."),icon:"error"}))}).catch(ze=>{console.error("[WorkshopEquipments] Fetch error",ze),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(Ne==="edit"){const Ue=xe?.id??Xe??"";if(!Ue){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}fetch(`${d}/${Ue}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(ze=>ze.json()).then(ze=>{ze?.data?.item?(j("edit",ze.data.item),y(o.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(ze=>{console.error("[WorkshopEquipments] Fetch error",ze),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(Ne==="delete"){const Ue=xe?.id??Xe??"";if(!Ue){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}fetch(`${d}/${Ue}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(ze=>ze.json()).then(ze=>{ze?.data?.item?(xe=ze.data.item,o.delete&&(o.delete.dataset.workshopEquipmentId=Ue),M&&(M.textContent=xe?.identifier??xe?.display_name??Ue),y(o.delete)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(ze=>{console.error("[WorkshopEquipments] Fetch error",ze),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(Ne==="barcode"){const Ue=Je||xe?.barcode_label_url||"",ze=xe?.identifier||K.dataset.identifier||"";if(!Ue){g(ze?{title:e("Error"),text:e("No se pudo generar el código de barras del equipo."),icon:"error"}:{title:e("Error"),text:e("El equipo no tiene identificador configurado. Debes agregar un identificador para generar el código de barras."),icon:"error"});return}console.log("[WorkshopEquipments] barcode action",{url:Ue,data:xe,dataset:we}),Ge(Ue)}}),t.addEventListener("change",I=>{const K=I.target;K instanceof HTMLInputElement&&K.matches("[data-status-toggle]")&&Ve(K)}),R?.querySelectorAll("[data-select-option]").forEach(I=>{I.addEventListener("click",K=>{K.preventDefault(),X(I.dataset.value??""),A?.focus({preventScroll:!0})})}),A?.addEventListener("click",I=>{I.preventDefault(),z()}),A?.addEventListener("keydown",I=>{I.key==="Escape"&&q(),["Enter"," "].includes(I.key)&&(I.preventDefault(),z())}),document.addEventListener("click",I=>{!E||!I.target||E.contains(I.target)||q()}),le?.addEventListener("click",I=>{if(I.preventDefault(),!se?.value){g({title:e("Información"),text:e("Selecciona una marca primero."),icon:"info"});return}Q(),_e(se.value,a?.value??"")}),le?.addEventListener("keydown",I=>{if(I.key==="Escape"&&w(),["Enter"," "].includes(I.key)){if(I.preventDefault(),!se?.value)return;Q(),_e(se.value,a?.value??"")}}),a&&a.addEventListener("input",()=>{se?.value&&(clearTimeout(ve),ve=setTimeout(()=>{_e(se.value,a.value.trim())},250))}),document.addEventListener("click",I=>{!G||!I.target||G.contains(I.target)||w()}),se?.value?O():H()},as=()=>{const t=document.querySelector("[data-workshop-models-root]");if(!t)return;const n=t.dataset.workshopModelsTableId??"",d=t.dataset.workshopModelsBaseUrl??"",m=t.dataset.workshopModelsStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u=t.dataset.workshopModelsBrandOptionsUrl??"",o={form:t.querySelector('[data-workshop-model-modal="form"]'),view:t.querySelector('[data-workshop-model-modal="view"]'),delete:t.querySelector('[data-workshop-model-modal="delete"]')},c=o.form?.querySelector("[data-workshop-model-form]")??null,f=o.form?.querySelector("[data-workshop-model-submit]")??null,x=f?.querySelector("[data-workshop-model-submit-label]")??null,S=o.form?.querySelector("[data-workshop-model-modal-title]")??null,P=o.view?.querySelector("[data-workshop-model-view]")??null,M=o.delete?.querySelector("[data-workshop-model-delete-name]")??null,L=o.delete?.querySelector("[data-workshop-model-delete-confirm]")??null,E=c?.querySelector('[data-select-name="brand_id"]')??null,R=c?.querySelector('[data-workshop-model-input="brand_id"]')??null,A=E?.querySelector("[data-workshop-model-brand-options]")??null,B=E?.querySelector("[data-select-trigger]")??null,ie=E?.querySelector("[data-select-value]")??null,se=E?.querySelector("[data-select-dropdown]")??null,Y=E?.querySelector("[data-select-icon]")??null,J=B?.dataset.selectPlaceholder??"";E&&(E.dataset.selectManual="true");const G="overflow-hidden",me=w=>w.closest("[data-workshop-model-modal]"),le=w=>{w&&(w.classList.remove("hidden"),document.body.classList.add(G))},pe=w=>{w&&(w.classList.add("hidden"),t.querySelector("[data-workshop-model-modal]:not(.hidden)")||document.body.classList.remove(G),D(),s="",R&&(R.value=""),ie&&(ie.textContent=J))};t.querySelectorAll("[data-workshop-model-modal-close]").forEach(w=>{w.addEventListener("click",()=>{const k=me(w);pe(k)})}),Object.values(o).forEach(w=>{w&&(w.addEventListener("click",k=>{k.target===w&&pe(w)}),w.addEventListener("keydown",k=>{k.key==="Escape"&&pe(w)}))});const re=()=>{c&&(c.querySelectorAll("[data-workshop-model-error]").forEach(w=>{w.textContent=""}),c.querySelectorAll("[data-workshop-model-input]").forEach(w=>{w instanceof HTMLInputElement&&w.type==="hidden"||(w instanceof HTMLInputElement||w instanceof HTMLTextAreaElement)&&w.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),E&&(E.dataset.selectInvalid="false"),B?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))},ne=w=>{!c||!w||Object.entries(w).forEach(([k,Q])=>{const ve=Array.isArray(Q)?Q[0]:Q,qe=c.querySelector(`[data-workshop-model-error="${k}"]`);if(qe&&(qe.textContent=ve??""),k==="brand_id"){E&&(E.dataset.selectInvalid="true"),B?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");return}const _e=c.querySelector(`[data-workshop-model-input="${k}"]`);(_e instanceof HTMLInputElement||_e instanceof HTMLTextAreaElement)&&_e.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},r=w=>{!f||!x||(w?x.textContent=e("Procesando..."):f.dataset.originalLabel&&(x.textContent=f.dataset.originalLabel),f.disabled=w)};let a=[],i=!1,s="";const l=w=>{A&&A.querySelectorAll("[data-select-option]").forEach(k=>{k.dataset.selected=k.dataset.value===w?"true":"false"})},y=w=>{if(!R)return;const k=w?String(w):"",Q=a.find(_e=>String(_e.id)===k),ve=A?Array.from(A.querySelectorAll("[data-select-option]")).find(_e=>_e.dataset.value===k):null,qe=Q?.name??ve?.dataset.label??J;s=k,R.value=k,ie&&(ie.textContent=k?qe:J),l(k),E&&(E.dataset.selectInvalid="false"),B?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),B?.classList.toggle("is-empty",!k),R.dispatchEvent(new Event("change",{bubbles:!0})),c?.dispatchEvent(new CustomEvent("workshop-model-brand-change",{bubbles:!0,detail:{brandId:k}}))},h=()=>{s="",R&&(R.value=""),ie&&(ie.textContent=J),l(""),B?.classList.add("is-empty")},C=w=>{A&&(A.innerHTML="",w.forEach(k=>{const Q=document.createElement("button");Q.type="button",Q.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",Q.dataset.selectOption="",Q.dataset.value=k.id??"",Q.dataset.label=k.name??"",Q.dataset.selected=R?.value===String(k.id)?"true":"false",Q.innerHTML=`<span class="truncate">${k.name??""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,Q.addEventListener("click",ve=>{ve.preventDefault(),y(k.id??""),D(),B?.focus({preventScroll:!0})}),A.appendChild(Q)}),l(String(R?.value??"")))},D=()=>{!E||!se||(se.hidden=!0,se.dataset.open="false",E.dataset.open="false",B?.setAttribute("aria-expanded","false"),Y?.classList.remove("rotate-180"))},V=()=>{!E||!se||(se.hidden=!1,se.dataset.open="true",E.dataset.open="true",B?.setAttribute("aria-expanded","true"),Y?.classList.add("rotate-180"))},N=async(w="")=>{C(a);const k=w??s??R?.value??"";if(y(k),!u||i||a.length>0)return a;i=!0;try{const Q=`${u}${u.includes("?")?"&":"?"}per_page=200`,ve=await fetch(Q,{headers:{Accept:"application/json"}}),qe=await ve.json().catch(()=>null);if(ve.ok&&qe?.data?.items){a=qe.data.items,C(a);const _e=w??s??R?.value??"";y(_e)}else console.error("[WorkshopModels] brands fetch error",qe)}catch(Q){console.error("[WorkshopModels] brands fetch error",Q)}finally{i=!1}return a},$=()=>{if(se){if(se.dataset.open==="true"){D();return}V(),N(R?.value??"")}},_=w=>{if(w.key==="Escape"){D();return}["Enter"," "].includes(w.key)&&(w.preventDefault(),$())},te=w=>{!E||!w.target||E.contains(w.target)||D()},j=w=>{w.key==="Escape"&&D()};B&&(B.addEventListener("click",w=>{w.preventDefault(),$()}),B.addEventListener("keydown",_)),se?.addEventListener("keydown",w=>{w.key==="Escape"&&(D(),B?.focus({preventScroll:!0}))}),E&&(document.addEventListener("click",te),document.addEventListener("keydown",j));const X=(w,k)=>{if(!c)return;if(w==="brand_id"){y(k??"");return}const Q=c.querySelector(`[data-workshop-model-input="${w}"]`);Q&&(Q instanceof HTMLInputElement||Q instanceof HTMLTextAreaElement)&&(Q.value=k??"")},b=w=>{if(!c)return"";if(w==="brand_id")return R?.value?.trim()??"";const k=c.querySelector(`[data-workshop-model-input="${w}"]`);return k&&(k instanceof HTMLInputElement||k instanceof HTMLTextAreaElement)?k.value.trim():""},v=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},H=(w,k=null)=>{!c||!f||!x||(re(),r(!1),D(),c.dataset.mode=w,c.dataset.workshopModelId=k?.id??"",N().finally(()=>{w==="create"?(c.reset(),X("status","A"),h(),S&&(S.textContent=e("Nuevo modelo")),x.textContent=e("Guardar"),f.dataset.originalLabel=e("Guardar")):(S&&(S.textContent=e("Editar modelo")),x.textContent=e("Actualizar"),f.dataset.originalLabel=e("Actualizar")),h(),X("name",k?.name??""),X("description",k?.description??""),X("status",k?.status??"A"),k?.brand_id&&y(k.brand_id)}))},O=w=>{!P||!w||P.querySelectorAll("[data-workshop-model-view-field]").forEach(k=>{const Q=k.getAttribute("data-workshop-model-view-field");if(!Q)return;const ve=w[Q];k.textContent=ve!=null&&ve!==""?String(ve):"-"})},q=async()=>{if(!c||!f||!x)return;const w=c.dataset.mode??"create",k=c.dataset.workshopModelId??"",Q=R?.value?.trim()??"",ve={brand_id:Q!==""?Q:null,name:b("name"),description:b("description")||null,status:b("status")||"A"};re();const qe={};if(ve.brand_id||(qe.brand_id=e("Selecciona una marca.")),ve.name||(qe.name=e("El nombre es obligatorio.")),Object.keys(qe).length>0){ne(qe),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}console.log("[WorkshopModels] submit payload",ve),r(!0);const _e=w==="create"?m:`${d}/${k}`,Ce=w==="create"?"POST":"PATCH";try{const Le=await fetch(_e,{method:Ce,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(ve)}),Ve=await Le.json().catch(()=>null);if(!Le.ok){Le.status===422&&Ve?.errors?(ne(Ve.errors),g({title:e("Hay errores en el formulario"),text:Ve.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:Ve?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:Ve?.message??e("Acción realizada correctamente."),icon:"success"}),pe(o.form),v()}catch(Le){console.error("[WorkshopModels] Submit error",Le),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{r(!1)}},T=async()=>{if(!o.delete||!L)return;const w=o.delete.dataset.workshopModelId;if(!w){pe(o.delete);return}L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70");try{const k=await fetch(`${d}/${w}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),Q=await k.json().catch(()=>null);if(!k.ok){g({title:e("Error"),text:Q?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:Q?.message??e("Registro eliminado correctamente."),icon:"success"}),pe(o.delete),v()}catch(k){console.error("[WorkshopModels] Delete error",k),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70")}},z=async w=>{const k=w.dataset.id??"";if(!k||w.disabled)return;const Q=!w.checked,ve=w.checked?"A":"I";w.disabled=!0;try{const qe=await fetch(`${d}/${k}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:ve})}),_e=await qe.json().catch(()=>null);if(!qe.ok){w.checked=Q,g({title:e("Error"),text:_e?.message??e("No se pudo actualizar el modelo."),icon:"error"});return}g({title:e("Datos actualizados"),text:_e?.message??e("El modelo se modificó correctamente."),icon:"success"}),v()}catch(qe){console.error("[WorkshopModels] Status toggle error",qe),w.checked=Q,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el modelo."),icon:"error"})}finally{w.disabled=!1}};c&&c.addEventListener("submit",w=>{w.preventDefault(),q()}),E&&N(s),L&&L.addEventListener("click",T),t.addEventListener("click",w=>{const k=w.target instanceof Element?w.target.closest("[data-workshop-model-action], [data-action], [data-row-action]"):null;if(!k)return;if(k.hasAttribute("data-workshop-model-action")){k.dataset.workshopModelAction==="create"&&(H("create"),le(o.form));return}const Q=k.dataset.action||k.dataset.rowAction,ve=(k.dataset.id||k.dataset.rowId)??"",qe=(k.dataset.name||k.dataset.rowName)??"",_e=k.dataset.rowPayload;let Ce=_e?rt(_e):null;if(console.log("[WorkshopModels] action resolved",{action:Q,data:Ce,actionEl:k}),!Ce&&ve&&(Ce={id:ve,name:qe||null}),!Q||!Ce||!Ce.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(Q==="view"){!Ce||Object.keys(Ce).length<=2?fetch(`${d}/${Ce.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(Le=>Le.json()).then(Le=>{Le?.data?.item?(O(Le.data.item),le(o.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(Le=>{console.error("[WorkshopModels] Fetch error",Le),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(O(Ce),le(o.view));return}if(Q==="edit"){!Ce||Object.keys(Ce).length<=2?fetch(`${d}/${Ce.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(Le=>Le.json()).then(Le=>{Le?.data?.item?(H("edit",Le.data.item),le(o.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(Le=>{console.error("[WorkshopModels] Fetch error",Le),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(H("edit",Ce),le(o.form));return}Q==="delete"&&(o.delete&&(o.delete.dataset.workshopModelId=Ce.id),M&&(M.textContent=qe||Ce.name||Ce.id),le(o.delete))}),t.addEventListener("change",w=>{const k=w.target;k instanceof HTMLInputElement&&k.matches("[data-status-toggle]")&&z(k)})},ss=()=>{const t=document.querySelector("[data-workshop-states-root]");if(!t)return;const n=t.dataset.workshopStatesTableId??"",d=t.dataset.workshopStatesBaseUrl??"",m=t.dataset.workshopStatesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u=t.dataset.workshopStatesCategoryOptionsUrl??"",o={form:t.querySelector('[data-workshop-state-modal="form"]'),view:t.querySelector('[data-workshop-state-modal="view"]'),delete:t.querySelector('[data-workshop-state-modal="delete"]')},c=o.form?.querySelector("[data-workshop-state-form]")??null,f=o.form?.querySelector("[data-workshop-state-submit]")??null,x=f?.querySelector("[data-workshop-state-submit-label]")??null,S=o.form?.querySelector("[data-workshop-state-modal-title]")??null,P=o.view?.querySelector("[data-workshop-state-view]")??null,M=o.delete?.querySelector("[data-workshop-state-delete-name]")??null,L=o.delete?.querySelector("[data-workshop-state-delete-confirm]")??null,E=c?.querySelector('[data-select-name="category_id"]')??null,R=c?.querySelector('[data-workshop-state-input="category_id"]')??null,A=E?.querySelector("[data-workshop-state-category-options]")??null,B=E?.querySelector("[data-select-trigger]")??null,ie=E?.querySelector("[data-select-value]")??null,se=E?.querySelector("[data-select-dropdown]")??null,Y=E?.querySelector("[data-select-icon]")??null,J=B?.dataset.selectPlaceholder??"";E&&(E.dataset.selectManual="true");const G="overflow-hidden",me=w=>w.closest("[data-workshop-state-modal]"),le=w=>{w&&(w.classList.remove("hidden"),document.body.classList.add(G))},pe=w=>{w&&(w.classList.add("hidden"),t.querySelector("[data-workshop-state-modal]:not(.hidden)")||document.body.classList.remove(G),D(),s="",R&&(R.value=""),ie&&(ie.textContent=J))};t.querySelectorAll("[data-workshop-state-modal-close]").forEach(w=>{w.addEventListener("click",()=>{const k=me(w);pe(k)})}),Object.values(o).forEach(w=>{w&&(w.addEventListener("click",k=>{k.target===w&&pe(w)}),w.addEventListener("keydown",k=>{k.key==="Escape"&&pe(w)}))});const re=()=>{c&&(c.querySelectorAll("[data-workshop-state-error]").forEach(w=>{w.textContent=""}),c.querySelectorAll("[data-workshop-state-input]").forEach(w=>{w instanceof HTMLInputElement&&w.type==="hidden"||(w instanceof HTMLInputElement||w instanceof HTMLTextAreaElement)&&w.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),E&&(E.dataset.selectInvalid="false"),B?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))},ne=w=>{!c||!w||Object.entries(w).forEach(([k,Q])=>{const ve=Array.isArray(Q)?Q[0]:Q,qe=c.querySelector(`[data-workshop-state-error="${k}"]`);if(qe&&(qe.textContent=ve??""),k==="category_id"){E&&(E.dataset.selectInvalid="true"),B?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");return}const _e=c.querySelector(`[data-workshop-state-input="${k}"]`);(_e instanceof HTMLInputElement||_e instanceof HTMLTextAreaElement)&&_e.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},r=w=>{!f||!x||(w?x.textContent=e("Procesando..."):f.dataset.originalLabel&&(x.textContent=f.dataset.originalLabel),f.disabled=w)};let a=[],i=!1,s="";const l=w=>{A&&A.querySelectorAll("[data-select-option]").forEach(k=>{k.dataset.selected=k.dataset.value===w?"true":"false"})},y=w=>{if(!R)return;const k=w?String(w):"",Q=a.find(_e=>String(_e.id)===k),ve=A?Array.from(A.querySelectorAll("[data-select-option]")).find(_e=>_e.dataset.value===k):null,qe=Q?.name??ve?.dataset.label??J;s=k,R.value=k,ie&&(ie.textContent=k?qe:J),l(k),E&&(E.dataset.selectInvalid="false"),B?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),B?.classList.toggle("is-empty",!k),R.dispatchEvent(new Event("change",{bubbles:!0})),c?.dispatchEvent(new CustomEvent("workshop-state-category-change",{bubbles:!0,detail:{categoryId:k}})),console.log("[WorkshopStates] category selected",{categoryId:k,label:qe,hiddenValue:R.value})},h=()=>{s="",R&&(R.value=""),ie&&(ie.textContent=J),l(""),B?.classList.add("is-empty")},C=w=>{A&&(A.innerHTML="",w.forEach(k=>{const Q=document.createElement("button");Q.type="button",Q.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",Q.dataset.selectOption="",Q.dataset.value=k.id??"",Q.dataset.label=k.name??"",Q.dataset.selected=R?.value===String(k.id)?"true":"false",Q.innerHTML=`<span class="truncate">${k.name??""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,Q.addEventListener("click",ve=>{ve.preventDefault(),y(k.id??""),D(),B?.focus({preventScroll:!0})}),A.appendChild(Q)}),l(String(R?.value??"")))},D=()=>{!E||!se||(se.hidden=!0,se.dataset.open="false",E.dataset.open="false",B?.setAttribute("aria-expanded","false"),Y?.classList.remove("rotate-180"))},V=()=>{!E||!se||(se.hidden=!1,se.dataset.open="true",E.dataset.open="true",B?.setAttribute("aria-expanded","true"),Y?.classList.add("rotate-180"))},N=async(w="")=>{C(a);const k=w??s??R?.value??"";if(y(k),!u||i||a.length>0)return a;i=!0;try{const Q=`${u}${u.includes("?")?"&":"?"}per_page=200`,ve=await fetch(Q,{headers:{Accept:"application/json"}}),qe=await ve.json().catch(()=>null);if(ve.ok&&qe?.data?.items){a=qe.data.items,C(a);const _e=w??s??R?.value??"";y(_e)}else console.error("[WorkshopStates] categories fetch error",qe)}catch(Q){console.error("[WorkshopStates] categories fetch error",Q)}finally{i=!1}return a},$=()=>{if(se){if(se.dataset.open==="true"){D();return}V(),N(R?.value??"")}},_=w=>{if(w.key==="Escape"){D();return}["Enter"," "].includes(w.key)&&(w.preventDefault(),$())},te=w=>{!E||!w.target||E.contains(w.target)||D()},j=w=>{w.key==="Escape"&&D()};B&&(B.addEventListener("click",w=>{w.preventDefault(),$()}),B.addEventListener("keydown",_)),se?.addEventListener("keydown",w=>{w.key==="Escape"&&(D(),B?.focus({preventScroll:!0}))}),E&&(document.addEventListener("click",te),document.addEventListener("keydown",j));const X=(w,k)=>{if(!c)return;if(w==="category_id"){y(k??"");return}const Q=c.querySelector(`[data-workshop-state-input="${w}"]`);Q&&(Q instanceof HTMLInputElement||Q instanceof HTMLTextAreaElement)&&(Q.value=k??"")},b=w=>{if(!c)return"";if(w==="category_id")return R?.value?.trim()??"";const k=c.querySelector(`[data-workshop-state-input="${w}"]`);return k&&(k instanceof HTMLInputElement||k instanceof HTMLTextAreaElement)?k.value.trim():""},v=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},H=(w,k=null)=>{!c||!f||!x||(re(),r(!1),D(),c.dataset.mode=w,c.dataset.workshopStateId=k?.id??"",N().finally(()=>{w==="create"?(c.reset(),X("status","A"),h(),S&&(S.textContent=e("Nuevo estado")),x.textContent=e("Guardar"),f.dataset.originalLabel=e("Guardar")):(S&&(S.textContent=e("Editar estado")),x.textContent=e("Actualizar"),f.dataset.originalLabel=e("Actualizar")),h(),X("name",k?.name??""),X("description",k?.description??""),X("status",k?.status??"A"),k?.category_id&&y(k.category_id)}))},O=w=>{!P||!w||P.querySelectorAll("[data-workshop-state-view-field]").forEach(k=>{const Q=k.getAttribute("data-workshop-state-view-field");if(!Q)return;const ve=w[Q];k.textContent=ve!=null&&ve!==""?String(ve):"-"})},q=async()=>{if(!c||!f||!x)return;const w=c.dataset.mode??"create",k=c.dataset.workshopStateId??"",Q=R?.value?.trim()??"",ve={category_id:Q!==""?Q:null,name:b("name"),description:b("description")||null,status:b("status")||"A"};re();const qe={};if(ve.category_id||(qe.category_id=e("Selecciona una categoría.")),ve.name||(qe.name=e("El nombre es obligatorio.")),Object.keys(qe).length>0){ne(qe),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}console.log("[WorkshopStates] submit payload",ve),r(!0);const _e=w==="create"?m:`${d}/${k}`,Ce=w==="create"?"POST":"PATCH";try{const Le=await fetch(_e,{method:Ce,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(ve)}),Ve=await Le.json().catch(()=>null);if(!Le.ok){Le.status===422&&Ve?.errors?(ne(Ve.errors),g({title:e("Hay errores en el formulario"),text:Ve.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:Ve?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:Ve?.message??e("Acción realizada correctamente."),icon:"success"}),pe(o.form),v()}catch(Le){console.error("[WorkshopStates] Submit error",Le),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{r(!1)}},T=async()=>{if(!o.delete||!L)return;const w=o.delete.dataset.workshopStateId;if(!w){pe(o.delete);return}L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70");try{const k=await fetch(`${d}/${w}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),Q=await k.json().catch(()=>null);if(!k.ok){g({title:e("Error"),text:Q?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:Q?.message??e("Registro eliminado correctamente."),icon:"success"}),pe(o.delete),v()}catch(k){console.error("[WorkshopStates] Delete error",k),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70")}},z=async w=>{const k=w.dataset.id??"";if(!k||w.disabled)return;const Q=!w.checked,ve=w.checked?"A":"I";w.disabled=!0;try{const qe=await fetch(`${d}/${k}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:ve})}),_e=await qe.json().catch(()=>null);if(!qe.ok){w.checked=Q,g({title:e("Error"),text:_e?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:_e?.message??e("El estado se modificó correctamente."),icon:"success"}),v()}catch(qe){console.error("[WorkshopStates] Status toggle error",qe),w.checked=Q,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{w.disabled=!1}};c&&c.addEventListener("submit",w=>{w.preventDefault(),q()}),E&&N(s),L&&L.addEventListener("click",T),t.addEventListener("click",w=>{const k=w.target instanceof Element?w.target.closest("[data-workshop-state-action], [data-action], [data-row-action]"):null;if(!k)return;if(k.hasAttribute("data-workshop-state-action")){k.dataset.workshopStateAction==="create"&&(H("create"),le(o.form));return}const Q=k.dataset.action||k.dataset.rowAction,ve=(k.dataset.id||k.dataset.rowId)??"",qe=(k.dataset.name||k.dataset.rowName)??"",_e=k.dataset.rowPayload;let Ce=_e?rt(_e):null;if(!Ce&&ve&&(Ce={id:ve,name:qe||null}),!Q||!Ce||!Ce.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(Q==="view"){!Ce||Object.keys(Ce).length<=2?fetch(`${d}/${Ce.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(Le=>Le.json()).then(Le=>{Le?.data?.item?(O(Le.data.item),le(o.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(Le=>{console.error("[WorkshopStates] Fetch error",Le),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(O(Ce),le(o.view));return}if(Q==="edit"){!Ce||Object.keys(Ce).length<=2?fetch(`${d}/${Ce.id}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(Le=>Le.json()).then(Le=>{Le?.data?.item?(H("edit",Le.data.item),le(o.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(Le=>{console.error("[WorkshopStates] Fetch error",Le),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):(H("edit",Ce),le(o.form));return}Q==="delete"&&(o.delete&&(o.delete.dataset.workshopStateId=Ce.id),M&&(M.textContent=qe||Ce.name||Ce.id),le(o.delete))}),t.addEventListener("change",w=>{const k=w.target;k instanceof HTMLInputElement&&k.matches("[data-status-toggle]")&&z(k)})},ns=()=>{const t=document.querySelector("[data-service-categories-root]");if(!t)return;const n=t.dataset.serviceCategoriesTableId??"",d=t.dataset.serviceCategoriesBaseUrl??"",m=t.dataset.serviceCategoriesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-service-category-modal="form"]'),view:t.querySelector('[data-service-category-modal="view"]'),delete:t.querySelector('[data-service-category-modal="delete"]')},o=u.form?.querySelector("[data-service-category-form]")??null,c=u.form?.querySelector("[data-service-category-submit]")??null,f=c?.querySelector("[data-service-category-submit-label]")??null,x=u.form?.querySelector("[data-service-category-modal-title]")??null,S=u.view?.querySelector("[data-service-category-view]")??null,P=u.delete?.querySelector("[data-service-category-delete-name]")??null,M=u.delete?.querySelector("[data-service-category-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-service-category-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-service-category-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-service-category-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-service-category-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-service-category-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-service-category-error="${a}"]`),y=o.querySelector(`[data-service-category-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-service-category-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-service-category-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement||a instanceof HTMLSelectElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.serviceCategoryId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent="Nueva categoría"),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar categoría"),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),a&&(Y("name",a.name??""),Y("status",a.status??"A")))},le=r=>{!S||!r||S.querySelectorAll("[data-service-category-view-field]").forEach(a=>{const i=a.getAttribute("data-service-category-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.serviceCategoryId??"",i={name:J("name"),status:J("status")||"A"};B();const s={};if(i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[ServiceCategories] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.serviceCategoryId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[ServiceCategories] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[ServiceCategories] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",r=>{const a=r.target.closest("[data-service-category-action], [data-action], [data-row-action]");if(!a||!t.contains(a))return;if(a.hasAttribute("data-service-category-action")){a.dataset.serviceCategoryAction==="create"&&(r.preventDefault(),r.stopPropagation(),me("create"),R(u.form));return}r.preventDefault(),r.stopPropagation();const i=a.dataset.action||a.dataset.rowAction;if(!i)return;const s=a.dataset.id||a.dataset.rowId,l=a.dataset.name||a.dataset.rowName||"";if(!s){console.error("[ServiceCategories] No se pudo obtener el ID de la categoría",{action:i,actionEl:a}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(y=>y.json()).then(y=>{y?.status==="success"&&y?.data?.item?(le(y.data.item),R(u.view)):g({title:e("Error"),text:y?.message??e("No se pudieron obtener los datos seleccionados."),icon:"error"})}).catch(y=>{console.error("[ServiceCategories] Error fetching service category",y),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})});return}if(i==="edit"){fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(y=>y.json()).then(y=>{y?.status==="success"&&y?.data?.item?(me("edit",y.data.item),R(u.form)):g({title:e("Error"),text:y?.message??e("No se pudieron obtener los datos seleccionados."),icon:"error"})}).catch(y=>{console.error("[ServiceCategories] Error fetching service category",y),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})});return}if(i==="delete"){const y=s,h=l||y;u.delete&&(u.delete.dataset.serviceCategoryId=y),P&&(P.textContent=h),R(u.delete);return}}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},is=()=>{console.log("🔵 [CustomerCategories] Module initialization started");const t=document.querySelectorAll("[data-customer-categories-root]");console.log("🔵 [CustomerCategories] Found roots",{count:t.length,roots:Array.from(t)}),document.querySelectorAll("[data-customer-categories-root]").forEach((n,d)=>{console.log(`🔵 [CustomerCategories] Initializing root ${d+1}`,{root:n,attributes:Array.from(n.attributes).map(i=>({name:i.name,value:i.value}))});const m=n.dataset.customerCategoriesTableId??"",p=n.dataset.customerCategoriesBaseUrl??"",u=n.dataset.customerCategoriesStoreUrl??p,o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";console.log("🔵 [CustomerCategories] init - Configuration",{tableId:m,baseUrl:p,storeUrl:u,csrfToken:o?"present":"missing",rootElement:n,allDataAttributes:Object.keys(n.dataset)});const c={form:n.querySelector('[data-customer-category-modal="form"]'),view:n.querySelector('[data-customer-category-modal="view"]'),delete:n.querySelector('[data-customer-category-modal="delete"]')},f=c.form?.querySelector("[data-customer-category-form]")??null,x=c.form?.querySelector("[data-customer-category-submit]")??null,S=x?.querySelector("[data-customer-category-submit-label]")??null,P=c.form?.querySelector("[data-customer-category-modal-title]")??null,M=c.view?.querySelector("[data-customer-category-view]")??null,L=c.delete?.querySelector("[data-customer-category-delete-name]")??null,E=c.delete?.querySelector("[data-customer-category-delete-confirm]")??null,R="overflow-hidden",A=i=>i.closest("[data-customer-category-modal]"),B=i=>{i&&(i.classList.remove("hidden"),document.body.classList.add(R))},ie=i=>{i&&(i.classList.add("hidden"),n.querySelector("[data-customer-category-modal]:not(.hidden)")||document.body.classList.remove(R))};n.querySelectorAll("[data-customer-category-modal-close]").forEach(i=>{i.addEventListener("click",()=>{const s=A(i);ie(s)})}),Object.values(c).forEach(i=>{i&&(i.addEventListener("click",s=>{s.target===i&&ie(i)}),i.addEventListener("keydown",s=>{s.key==="Escape"&&ie(i)}))});const se=()=>{f&&(f.querySelectorAll("[data-customer-category-error]").forEach(i=>{i.textContent=""}),f.querySelectorAll("[data-customer-category-input]").forEach(i=>{(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&i.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},Y=i=>{!f||!i||Object.entries(i).forEach(([s,l])=>{const y=Array.isArray(l)?l[0]:l,h=f.querySelector(`[data-customer-category-error="${s}"]`),C=f.querySelector(`[data-customer-category-input="${s}"]`);h&&(h.textContent=y??""),(C instanceof HTMLInputElement||C instanceof HTMLTextAreaElement)&&C.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},J=i=>{!x||!S||(i?S.textContent=e("Procesando..."):x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=i)},G=(i,s)=>{if(!f)return;const l=f.querySelector(`[data-customer-category-input="${i}"]`);l&&(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement||l instanceof HTMLSelectElement)&&(l.value=s??"")},me=i=>{if(!f)return"";const s=f.querySelector(`[data-customer-category-input="${i}"]`);return s&&(s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLSelectElement)?s.value.trim():""},le=()=>{if(!m){console.warn("[CustomerCategories] refresh without tableId"),window.dispatchEvent(new CustomEvent("datatable-refresh"));return}console.info("[CustomerCategories] refresh",{tableId:m}),window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:m}}))},pe=(i,s=null)=>{!f||!x||!S||(se(),J(!1),f.dataset.mode=i,f.dataset.customerCategoryId=s?.id??"",i==="create"?(f.reset(),G("status","A"),P&&(P.textContent=e("Nueva categoría")),S.textContent=e("Guardar"),x.dataset.originalLabel=e("Guardar")):(P&&(P.textContent=e("Editar categoría")),S.textContent=e("Actualizar"),x.dataset.originalLabel=e("Actualizar")),s?(G("name",s.name??""),G("description",s.description??""),G("status",s.status??"A")):(G("name",""),G("description","")))},re=i=>{!M||!i||M.querySelectorAll("[data-customer-category-view-field]").forEach(s=>{const l=s.getAttribute("data-customer-category-view-field");if(!l)return;const y=i[l];s.textContent=y!=null&&y!==""?String(y):"-"})},ne=async()=>{if(!f||!x||!S)return;const i=f.dataset.mode??"create",s=f.dataset.customerCategoryId??"",l={name:me("name"),description:me("description")||null,status:me("status")||"A"};console.info("[CustomerCategories] submit",{mode:i,categoryId:s,payload:l}),se();const y={};if(l.name||(y.name=e("El nombre es obligatorio.")),Object.keys(y).length>0){Y(y),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}J(!0);const h=i==="create"?u:`${p}/${s}`,C=i==="create"?"POST":"PATCH";try{const D=await fetch(h,{method:C,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(l)}),V=await D.json().catch(()=>null);if(!D.ok){console.error("[CustomerCategories] submit failed",{response:D,json:V}),D.status===422&&V?.errors?(Y(V.errors),g({title:e("Hay errores en el formulario"),text:V.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:V?.message??e("No fue posible guardar la información."),icon:"error"});return}console.info("[CustomerCategories] submit success"),g({title:e("Datos actualizados"),text:V?.message??e("Acción realizada correctamente."),icon:"success"}),ie(c.form),le()}catch(D){console.error("[CustomerCategories] Submit error",D),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{J(!1)}},r=async()=>{if(!c.delete||!E)return;const i=c.delete.dataset.customerCategoryId;if(!i){ie(c.delete);return}E.disabled=!0,E.classList.add("cursor-not-allowed","opacity-70");try{console.info("[CustomerCategories] delete",{categoryId:i});const s=await fetch(`${p}/${i}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":o}}),l=await s.json().catch(()=>null);if(!s.ok){console.error("[CustomerCategories] delete failed",{response:s,json:l}),g({title:e("Error"),text:l?.message??e("No se pudo eliminar el registro."),icon:"error"});return}console.info("[CustomerCategories] delete success"),g({title:e("Datos actualizados"),text:l?.message??e("Registro eliminado correctamente."),icon:"success"}),ie(c.delete),le()}catch(s){console.error("[CustomerCategories] Delete error",s),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{E.disabled=!1,E.classList.remove("cursor-not-allowed","opacity-70")}},a=async i=>{const s=i.dataset.id??"";if(!s||i.disabled)return;const l=!i.checked,y=i.checked?"A":"I";i.disabled=!0;try{console.info("[CustomerCategories] toggle status",{categoryId:s,newStatus:y});const h=await fetch(`${p}/${s}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({status:y})}),C=await h.json().catch(()=>null);if(!h.ok){console.error("[CustomerCategories] toggle failed",{response:h,json:C}),i.checked=l,g({title:e("Error"),text:C?.message??e("No se pudo actualizar el estado."),icon:"error"});return}console.info("[CustomerCategories] toggle success"),g({title:e("Datos actualizados"),text:C?.message??e("El estado se modificó correctamente."),icon:"success"}),le()}catch(h){console.error("[CustomerCategories] Status toggle error",h),i.checked=l,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{i.disabled=!1}};f&&f.addEventListener("submit",i=>{i.preventDefault(),ne()}),E&&E.addEventListener("click",r),n.addEventListener("click",i=>{console.log("🔵 [CustomerCategories] Click detected",{target:i.target,targetTagName:i.target?.tagName,targetClasses:i.target?.className,targetId:i.target?.id,targetDataset:i.target?.dataset});let s=null;if(i.target instanceof Element&&(s=i.target.closest("[data-customer-category-action], [data-action], [data-row-action]"),console.log("🔵 [CustomerCategories] First closest search",{found:!!s,element:s,tagName:s?.tagName,classes:s?.className}),!s&&(i.target.tagName==="I"||i.target.classList.contains("fa"))&&(s=i.target.closest("button[data-action], button[data-row-action]"),console.log("🔵 [CustomerCategories] Second closest search (icon)",{found:!!s,element:s,tagName:s?.tagName}))),console.log("🔵 [CustomerCategories] Final actionEl",{found:!!s,element:s,allAttributes:s?Array.from(s.attributes).map(V=>({name:V.name,value:V.value})):null,dataset:s?.dataset}),!s){console.log("🔵 [CustomerCategories] No actionEl found, returning");return}if(s.hasAttribute("data-customer-category-action")){const V=s.dataset.customerCategoryAction;console.log("🔵 [CustomerCategories] Customer category action",{action:V}),V==="create"&&(pe("create"),B(c.form));return}const l=s.dataset.action||s.dataset.rowAction;if(console.log("🔵 [CustomerCategories] Row action extracted",{rowAction:l,dataAction:s.dataset.action,dataRowAction:s.dataset.rowAction}),!l){console.log("🔵 [CustomerCategories] No rowAction found, returning");return}const y=(s.dataset.id||s.dataset.rowId||"").trim(),h=(s.dataset.name||s.dataset.rowName)??"",C=s.dataset.rowPayload;let D=C?rt(C):null;if(console.log("🔵 [CustomerCategories] Action clicked - FULL DATA",{rowAction:l,rowId:y,rowName:h,hasPayload:!!C,payload:C,data:D,baseUrl:p,csrfToken:o?"present":"missing",allDatasetKeys:Object.keys(s.dataset),datasetId:s.dataset.id,datasetRowId:s.dataset.rowId}),!y){console.error("🔴 [CustomerCategories] Missing rowId",{actionEl:s,rowAction:l,allDatasetKeys:s?Object.keys(s.dataset):null,dataset:s?.dataset}),g({title:e("Error"),text:e("No se pudo identificar el registro seleccionado."),icon:"error"});return}if(!D&&y){if(console.log("🟡 [CustomerCategories] No payload, will fetch from server",{rowId:y,rowAction:l,hasData:!!D}),l==="view"||l==="edit"){if(!p){console.error("🔴 [CustomerCategories] Missing baseUrl"),g({title:e("Error"),text:e("Error de configuración. Por favor, recarga la página."),icon:"error"});return}const V=`${p}/${y}`;console.log("🟢 [CustomerCategories] Starting fetch",{fetchUrl:V,rowAction:l,rowId:y,baseUrl:p,method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o?"present":"missing"}}),fetch(V,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":o}}).then(async N=>{console.log("🟢 [CustomerCategories] Response received (raw)",{ok:N.ok,status:N.status,statusText:N.statusText,headers:Object.fromEntries(N.headers.entries()),url:N.url});const $=await N.json().catch(_=>(console.error("🔴 [CustomerCategories] JSON parse error",{parseError:_}),null));if(console.log("🟢 [CustomerCategories] Response JSON parsed",{json:$}),!N.ok){console.error("🔴 [CustomerCategories] Fetch failed - Response not OK",{status:N.status,statusText:N.statusText,url:V,json:$,responseHeaders:Object.fromEntries(N.headers.entries())});const _=$?.message??e("No se pudieron obtener los datos del registro.");return g({title:e("Error"),text:_,icon:"error"}),null}return $}).then(N=>{if(console.log("🟢 [CustomerCategories] Processing response",{hasJson:!!N,json:N,status:N?.status,hasData:!!N?.data,hasItem:!!N?.data?.item,item:N?.data?.item}),!N){console.log("🟡 [CustomerCategories] No JSON to process");return}if(N?.status==="success"&&N?.data?.item)console.log("✅ [CustomerCategories] Success! Opening modal",{rowAction:l,data:N.data.item}),D=N.data.item,l==="view"?(re(D),B(c.view)):l==="edit"&&(pe("edit",D),B(c.form));else{const $=N?.message??e("No se pudieron obtener los datos del registro.");console.error("🔴 [CustomerCategories] Invalid response format",{json:N,expected:"status: success, data.item",actualStatus:N?.status,hasData:!!N?.data,hasItem:!!N?.data?.item}),g({title:e("Error"),text:$,icon:"error"})}}).catch(N=>{console.error("🔴 [CustomerCategories] Fetch error (catch)",{error:N,errorName:N.name,errorMessage:N.message,errorStack:N.stack,fetchUrl:V});const $=N.message?.includes("Failed to fetch")?e("Error de conexión. Verifica tu conexión a internet."):e("No se pudieron obtener los datos del registro.");g({title:e("Error"),text:$,icon:"error"})});return}else if(l==="delete"){c.delete&&(c.delete.dataset.customerCategoryId=y),L&&(L.textContent=h||y),B(c.delete);return}}if(!D||!D.id){l!=="delete"&&g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(l==="view"){re(D),B(c.view);return}if(l==="edit"){pe("edit",D),B(c.form);return}l==="delete"&&(c.delete&&(c.delete.dataset.customerCategoryId=D.id??""),L&&(L.textContent=D.name??""),B(c.delete))}),n.addEventListener("change",i=>{const s=i.target;s instanceof HTMLInputElement&&s.matches("[data-status-toggle]")&&a(s)})})},cs=()=>{const t=document.querySelector("[data-services-root]");if(!t)return;const n=t.dataset.servicesTableId??"",d=t.dataset.servicesBaseUrl??"",m=t.dataset.servicesStoreUrl??d,p=t.dataset.servicesCategoryOptionsUrl??"",u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",o=(()=>{try{return JSON.parse(t.dataset.servicesCategories??"[]")}catch(b){return console.error("[Services] Error parsing categories",b),[]}})(),c={form:t.querySelector('[data-service-modal="form"]'),view:t.querySelector('[data-service-modal="view"]'),delete:t.querySelector('[data-service-modal="delete"]')},f=c.form?.querySelector("[data-service-form]")??null,x=c.form?.querySelector("[data-service-submit]")??null,S=x?.querySelector("[data-service-submit-label]")??null,P=c.form?.querySelector("[data-service-modal-title]")??null,M=c.view?.querySelector("[data-service-view]")??null,L=c.delete?.querySelector("[data-service-delete-name]")??null,E=c.delete?.querySelector("[data-service-delete-confirm]")??null,R=f?.querySelector('[data-select-name="category_id"]')??null,A=f?.querySelector('[data-service-input="category_id"]')??null,B=R?.querySelector("[data-service-category-options]")??null,ie=R?.querySelector("[data-select-trigger]")??null,se=R?.querySelector("[data-select-value]")??null,Y=R?.querySelector("[data-select-dropdown]")??null,J=R?.querySelector("[data-select-icon]")??null,G=ie?.dataset.selectPlaceholder??"",me="overflow-hidden";let le=o;const pe=b=>b.closest("[data-service-modal]"),re=b=>{b&&(b.classList.remove("hidden"),document.body.classList.add(me))},ne=b=>{b&&(b.classList.add("hidden"),t.querySelector("[data-service-modal]:not(.hidden)")||document.body.classList.remove(me))};t.querySelectorAll("[data-service-modal-close]").forEach(b=>{b.addEventListener("click",()=>{const v=pe(b);ne(v)})}),Object.values(c).forEach(b=>{b&&(b.addEventListener("click",v=>{v.target===b&&ne(b)}),b.addEventListener("keydown",v=>{v.key==="Escape"&&ne(b)}))});const r=()=>{f&&(f.querySelectorAll("[data-service-error]").forEach(b=>{b.textContent=""}),f.querySelectorAll("[data-service-input]").forEach(b=>{b.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),R&&(R.dataset.selectInvalid="false",ie?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")))},a=b=>{!f||!b||Object.entries(b).forEach(([v,H])=>{const O=Array.isArray(H)?H[0]:H,q=f.querySelector(`[data-service-error="${v}"]`);if(q&&(q.textContent=O??""),v==="category_id")R&&(R.dataset.selectInvalid="true"),ie?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");else{const T=f.querySelector(`[data-service-input="${v}"]`);T&&T.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}})},i=b=>{!x||!S||(b?S.textContent="Procesando...":x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=b)},s=(b,v)=>{if(!f)return;if(b==="category_id"){C(v??"");return}const H=f.querySelector(`[data-service-input="${b}"]`);H&&(H instanceof HTMLInputElement||H instanceof HTMLTextAreaElement||H instanceof HTMLSelectElement)&&(H.value=v??"")},l=b=>{if(!f)return"";const v=f.querySelector(`[data-service-input="${b}"]`);return v&&(v instanceof HTMLInputElement||v instanceof HTMLTextAreaElement||v instanceof HTMLSelectElement)?v.value.trim():""},y=()=>{!R||!Y||(Y.hidden=!0,Y.dataset.open="false",R.dataset.open="false",ie?.setAttribute("aria-expanded","false"),J?.classList.remove("rotate-180"))},h=b=>{B&&B.querySelectorAll("[data-select-option]").forEach(v=>{v.dataset.selected=v.dataset.value===b?"true":"false"})},C=b=>{if(!A)return;const v=b??"",O=le.find(q=>String(q.id)===String(v))?.name??G;A.value=v,se&&(se.textContent=v?O:G),h(String(v)),ie?.classList.toggle("is-empty",!v),A.dispatchEvent(new Event("change",{bubbles:!0}))},D=b=>{B&&(B.innerHTML="",b.forEach(v=>{const H=document.createElement("button");H.type="button",H.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",H.dataset.selectOption="",H.dataset.value=v.id,H.dataset.label=v.name,H.innerHTML=`<span class="truncate">${v.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,H.addEventListener("click",O=>{O.preventDefault(),C(v.id),y(),ie?.focus({preventScroll:!0})}),B.appendChild(H)}),h(String(A?.value??"")))},V=async(b="")=>{if(D(le),C(b??""),!!p)try{const v=`${p}${p.includes("?")?"&":"?"}per_page=200`,H=await fetch(v,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),O=await H.json().catch(()=>null);if(!H.ok||!O?.data?.items)throw new Error("Invalid response");le=O.data.items,D(le),C(b??"")}catch(v){console.error("[Services] Error loading category options",v),g({title:e("Error"),text:e("No se pudieron cargar las categorías de servicio."),icon:"error"})}},N=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},$=(b,v=null)=>{!f||!x||!S||(r(),i(!1),f.dataset.mode=b,f.dataset.serviceId=v?.id??"",b==="create"?(f.reset(),s("status","A"),s("price","0"),P&&(P.textContent="Nuevo servicio"),S.textContent="Guardar",x.dataset.originalLabel="Guardar"):(P&&(P.textContent="Editar servicio"),S.textContent="Actualizar",x.dataset.originalLabel="Actualizar"),D(le),C(v?.category_id??""),v&&(s("name",v.name??""),s("description",v.description??""),s("price",v.price??"0"),s("status",v.status??"A")),V(v?.category_id??""))},_=b=>{!M||!b||M.querySelectorAll("[data-service-view-field]").forEach(v=>{const H=v.getAttribute("data-service-view-field");if(!H)return;let O=b[H];H==="price"?O=(parseFloat(O)||0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","):O=O!=null&&O!==""?String(O):"-",v.textContent=O})},te=async()=>{if(!f||!x||!S)return;const b=f.dataset.mode??"create",v=f.dataset.serviceId??"",H=l("description");l("duration_minutes");const O=l("price"),q=O?parseFloat(O):0,T={category_id:l("category_id")||null,name:l("name"),description:H||null,price:q,status:l("status")||"A"};r();const z={};if(T.category_id||(z.category_id=e("Selecciona una categoría.")),T.name||(z.name=e("El nombre es obligatorio.")),Object.keys(z).length>0){a(z),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}console.log("[WorkshopStates] submit payload",T),i(!0);const w=b==="create"?m:`${d}/${v}`,k=b==="create"?"POST":"PATCH";try{const Q=await fetch(w,{method:k,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u},body:JSON.stringify(T)}),ve=await Q.json().catch(()=>null);if(!Q.ok){Q.status===422&&ve?.errors?(a(ve.errors),g({title:e("Hay errores en el formulario"),text:ve.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:ve?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:ve?.message??e("Acción realizada correctamente."),icon:"success"}),ne(c.form),N()}catch(Q){console.error("[Services] Submit error",Q),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{i(!1)}},j=async()=>{if(!c.delete||!E)return;const b=c.delete.dataset.serviceId;if(!b){ne(c.delete);return}E.disabled=!0,E.classList.add("cursor-not-allowed","opacity-70");try{const v=await fetch(`${d}/${b}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":u}}),H=await v.json().catch(()=>null);if(!v.ok){g({title:e("Error"),text:H?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:H?.message??e("Registro eliminado correctamente."),icon:"success"}),ne(c.delete),N()}catch(v){console.error("[Services] Delete error",v),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{E.disabled=!1,E.classList.remove("cursor-not-allowed","opacity-70")}},X=async b=>{const v=b.dataset.id??"";if(!v||b.disabled)return;const H=!b.checked,O=b.checked?"A":"I";b.disabled=!0;try{const q=await fetch(`${d}/${v}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u},body:JSON.stringify({status:O})}),T=await q.json().catch(()=>null);if(!q.ok){b.checked=H,g({title:e("Error"),text:T?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:T?.message??e("El estado se modificó correctamente."),icon:"success"}),N()}catch(q){console.error("[Services] Status toggle error",q),b.checked=H,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{b.disabled=!1}};f&&f.addEventListener("submit",b=>{b.preventDefault(),te()}),E&&E.addEventListener("click",j),t.addEventListener("click",b=>{const v=b.target.closest("[data-service-action], [data-action], [data-row-action]");if(!v||!t.contains(v))return;if(v.hasAttribute("data-service-action")){v.dataset.serviceAction==="create"&&(b.preventDefault(),b.stopPropagation(),$("create"),re(c.form));return}b.preventDefault(),b.stopPropagation();const H=v.dataset.action||v.dataset.rowAction,O=v.dataset.id||v.dataset.rowId,q=v.dataset.name||v.dataset.rowName||"",T=v.dataset.rowPayload;if(!H||!O)return;let z=null;if(T)try{z=rt(T)}catch(w){console.error("[Services] Error decoding payload",w)}if(H==="view"){z?(_(z),re(c.view)):fetch(`${d}/${O}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(w=>w.json()).then(w=>{w?.status==="success"&&w?.data?.item?(_(w.data.item),re(c.view)):g({title:e("Error"),text:w?.message??e("No se pudieron obtener los datos seleccionados."),icon:"error"})}).catch(w=>{console.error("[Services] Error fetching service",w),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})});return}if(H==="edit"){z?($("edit",z),re(c.form)):fetch(`${d}/${O}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(w=>w.json()).then(w=>{w?.status==="success"&&w?.data?.item?($("edit",w.data.item),re(c.form)):g({title:e("Error"),text:w?.message??e("No se pudieron obtener los datos seleccionados."),icon:"error"})}).catch(w=>{console.error("[Services] Error fetching service",w),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})});return}if(H==="delete"){const w=z?.id||O,k=z?.name||q||w;c.delete&&(c.delete.dataset.serviceId=w),L&&(L.textContent=k),re(c.delete);return}}),t.addEventListener("change",b=>{const v=b.target;v instanceof HTMLInputElement&&v.matches("[data-status-toggle]")&&X(v)})},ls=()=>{const t=document.querySelector("[data-warehouses-root]");if(!t)return;const n=t.dataset.warehousesTableId??"",d=t.dataset.warehousesBaseUrl??"",m=t.dataset.warehousesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-warehouse-modal="form"]'),view:t.querySelector('[data-warehouse-modal="view"]'),delete:t.querySelector('[data-warehouse-modal="delete"]')},o=u.form?.querySelector("[data-warehouse-form]")??null,c=u.form?.querySelector("[data-warehouse-submit]")??null,f=c?.querySelector("[data-warehouse-submit-label]")??null,x=u.form?.querySelector("[data-warehouse-modal-title]")??null,S=u.view?.querySelector("[data-warehouse-view]")??null,P=u.delete?.querySelector("[data-warehouse-delete-name]")??null,M=u.delete?.querySelector("[data-warehouse-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-warehouse-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-warehouse-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-warehouse-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-warehouse-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-warehouse-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-warehouse-error="${a}"]`),y=o.querySelector(`[data-warehouse-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-warehouse-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-warehouse-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{!o||!c||!f||(B(),se(!1),o.dataset.mode=r,o.dataset.warehouseId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent="Nueva bodega"),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar bodega"),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),a&&(Y("name",a.name??""),Y("address",a.address??""),Y("status",a.status??"A")))},le=r=>{!S||!r||S.querySelectorAll("[data-warehouse-view-field]").forEach(a=>{const i=a.getAttribute("data-warehouse-view-field");if(!i)return;const s=r[i];a.textContent=s!=null&&s!==""?String(s):"-"})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.warehouseId??"",i={name:J("name"),address:J("address")||null,status:J("status")||"A"};B();const s={};if(i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[Warehouses] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.warehouseId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[Warehouses] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[Warehouses] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",r=>{const a=r.target instanceof Element?r.target.closest("[data-warehouse-action], [data-action], [data-row-action]"):null;if(!a)return;if(a.hasAttribute("data-warehouse-action")){a.dataset.warehouseAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction,s=a.dataset.id||a.dataset.rowId,l=a.dataset.name||a.dataset.rowName||"";if(!i||!s){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(y=>y.json()).then(y=>{y?.data?.item?(le(y.data.item),R(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos para ver."),icon:"error"})}).catch(y=>{console.error("[Warehouses] Fetch view error",y),g({title:e("Error"),text:e("No se pudieron obtener los datos para ver."),icon:"error"})});return}if(i==="edit"){fetch(`${d}/${s}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(y=>y.json()).then(y=>{y?.data?.item?(me("edit",y.data.item),R(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}).catch(y=>{console.error("[Warehouses] Fetch edit error",y),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})});return}if(i==="delete"){const y=l||s;u.delete&&(u.delete.dataset.warehouseId=s),P&&(P.textContent=y||s),R(u.delete)}}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},ds=()=>{const t=document.querySelector("[data-document-sequences-root]");if(!t)return;const n=t.dataset.documentSequencesTableId??"",d=t.dataset.documentSequencesBaseUrl??"",m=t.dataset.documentSequencesStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",o=((_,te=[])=>{try{const j=JSON.parse(_??"[]");return Array.isArray(j)?j:te}catch(j){return console.warn("[DocumentSequences] Invalid JSON dataset",j),te}})(t.dataset.documentSequencesTypes,[]),c={form:t.querySelector('[data-document-sequence-modal="form"]'),view:t.querySelector('[data-document-sequence-modal="view"]'),delete:t.querySelector('[data-document-sequence-modal="delete"]')},f=c.form?.querySelector("[data-document-sequence-form]")??null,x=c.form?.querySelector("[data-document-sequence-submit]")??null,S=x?.querySelector("[data-document-sequence-submit-label]")??null,P=c.form?.querySelector("[data-document-sequence-modal-title]")??null,M=c.view?.querySelector("[data-document-sequence-view]")??null,L=c.delete?.querySelector("[data-document-sequence-delete-name]")??null,E=c.delete?.querySelector("[data-document-sequence-delete-confirm]")??null,R=f?.querySelector("[data-document-sequence-preview]")??null,A=f?.querySelector('[data-document-sequence-select="document_type"]')??null,B=A?.querySelector("[data-custom-select-trigger]")??null,ie="overflow-hidden",se=new Set,Y=(_=null)=>{se.forEach(te=>{te!==_&&te.close()})},J=(_,te=[],{placeholder:j=e("Selecciona...")}={})=>{if(!_)return null;const X=_.querySelector("[data-custom-select-trigger]"),b=_.querySelector("[data-custom-select-label]"),v=_.querySelector("[data-custom-select-options]"),H=_.querySelector('input[type="hidden"]');if(!X||!b||!v||!H)return null;let O=Array.isArray(te)?te:[];const q=(ve=[])=>{if(O=Array.isArray(ve)?ve:[],v.innerHTML="",O.length===0){const qe=document.createElement("div");qe.className="px-4 py-2 text-sm text-gray-500 dark:text-gray-300",qe.textContent=e("No hay opciones disponibles"),v.appendChild(qe),T();return}O.forEach(qe=>{const _e=qe.value??qe.id??"",Ce=qe.label??qe.name??_e,Le=document.createElement("button");Le.type="button",Le.className="flex w-full items-center justify-between px-4 py-2 text-left text-sm text-gray-700 transition hover:bg-primary-soft/20 data-[selected=true]:font-semibold data-[selected=true]:text-primary dark:text-gray-200",Le.dataset.selectOption="true",Le.dataset.value=_e,Le.dataset.label=Ce,Le.dataset.selected=H.value===_e?"true":"false",Le.innerHTML=`<span class="truncate">${Ce}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100"></i>`,Le.addEventListener("click",Ve=>{Ve.preventDefault(),k(_e),z(),X.focus({preventScroll:!0})}),v.appendChild(Le)}),T()},T=()=>{const ve=v.querySelector(`[data-select-option][data-value="${H.value??""}"]`);b.textContent=H.value?ve?.dataset.label??j??"":j??e("Selecciona..."),v.querySelectorAll("[data-select-option]").forEach(qe=>{qe.dataset.selected=qe.dataset.value===H.value?"true":"false"}),X.classList.toggle("text-gray-400",!H.value)},z=()=>{v.classList.add("hidden"),_.dataset.open="false",X.setAttribute("aria-expanded","false"),X.querySelector(".fa-chevron-down")?.classList.remove("rotate-180")},w=()=>{Y(Q),v.classList.remove("hidden"),_.dataset.open="true",X.setAttribute("aria-expanded","true"),X.querySelector(".fa-chevron-down")?.classList.add("rotate-180")},k=ve=>{H.value=ve??"",T(),H.dispatchEvent(new Event("change",{bubbles:!0}))};X.addEventListener("click",ve=>{ve.preventDefault(),_.dataset.open==="true"?z():w()}),_.addEventListener("keydown",ve=>{ve.key==="Escape"&&(z(),X.focus({preventScroll:!0}))});const Q={renderOptions:q,setValue:k,close:z,get value(){return H.value}};return se.add(Q),q(O),Q};document.addEventListener("click",_=>{const te=_.target;(te instanceof Element?te.closest("[data-custom-select]"):null)||Y()});const G=J(A,o,{placeholder:e("Selecciona un tipo")}),me=_=>_.closest("[data-document-sequence-modal]"),le=_=>{_&&(_.classList.remove("hidden"),document.body.classList.add(ie))},pe=_=>{_&&(_.classList.add("hidden"),t.querySelector("[data-document-sequence-modal]:not(.hidden)")||document.body.classList.remove(ie))};t.querySelectorAll("[data-document-sequence-modal-close]").forEach(_=>{_.addEventListener("click",()=>{const te=me(_);pe(te)})}),Object.values(c).forEach(_=>{_&&(_.addEventListener("click",te=>{te.target===_&&pe(_)}),_.addEventListener("keydown",te=>{te.key==="Escape"&&pe(_)}))});const re=()=>{f&&(f.querySelectorAll("[data-document-sequence-error]").forEach(_=>{_.textContent=""}),f.querySelectorAll("[data-document-sequence-input]").forEach(_=>{_.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),B?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"))},ne=_=>{!f||!_||Object.entries(_).forEach(([te,j])=>{const X=Array.isArray(j)?j[0]:j,b=f.querySelector(`[data-document-sequence-error="${te}"]`),v=f.querySelector(`[data-document-sequence-input="${te}"]`);b&&(b.textContent=X??""),te==="document_type"?B?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"):v instanceof HTMLInputElement&&v.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},r=_=>{!x||!S||(_?S.textContent=e("Procesando..."):x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=_)},a=(_,te)=>{if(!f)return;if(_==="document_type"){G?.setValue(te??"");return}const j=f?.querySelector(`[data-document-sequence-input="${_}"]`);j&&j instanceof HTMLInputElement&&(j.value=te??"")},i=_=>{if(!f)return"";if(_==="document_type")return G?.value??"";const te=f.querySelector(`[data-document-sequence-input="${_}"]`);return te&&te instanceof HTMLInputElement?te.value.trim():""},s=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},l=()=>{if(!R)return;const _=i("establishment_code").toUpperCase(),te=i("emission_point_code").toUpperCase(),j=i("current_sequence"),X=j?parseInt(j,10):NaN;if(!_||!te||Number.isNaN(X)||X<=0){R.textContent="---";return}const b=`${_}-${te}-${String(X).padStart(3,"0")}`;R.textContent=b},y=_=>{_&&(_.addEventListener("input",()=>{_.value=_.value.replaceAll(/\s+/g,"").toUpperCase().slice(0,5).replace(/[^A-Z0-9]/g,""),l()}),_.addEventListener("blur",()=>{_.value=_.value.replaceAll(/\s+/g,"").toUpperCase().slice(0,5).replace(/[^A-Z0-9]/g,""),l()}))};y(f?.querySelector('[data-document-sequence-input="establishment_code"]')),y(f?.querySelector('[data-document-sequence-input="emission_point_code"]'));const h=f?.querySelector('[data-document-sequence-input="current_sequence"]')??null;h?.addEventListener("input",()=>{if(!h)return;const _=parseInt(h.value,10);(Number.isNaN(_)||_<1)&&(h.value=_<=0?"1":""),l()});const C=(_,te=null)=>{!f||!x||!S||(re(),r(!1),f.dataset.mode=_,f.dataset.documentSequenceId=te?.id??"",_==="create"?(f.reset(),branchSelectController?.setValue(""),G?.setValue(""),a("status","A"),P&&(P.textContent=e("Nuevo secuencial")),S.textContent=e("Guardar"),x.dataset.originalLabel=e("Guardar"),l()):(P&&(P.textContent=e("Editar secuencial")),S.textContent=e("Actualizar"),x.dataset.originalLabel=e("Actualizar")),te&&(a("document_type",te.document_type??""),a("establishment_code",te.establishment_code??""),a("emission_point_code",te.emission_point_code??""),a("current_sequence",te.current_sequence??""),a("status",te.status??"A"),l()))},D=_=>{!M||!_||M.querySelectorAll("[data-document-sequence-view-field]").forEach(te=>{const j=te.getAttribute("data-document-sequence-view-field");if(!j)return;const X=_[j];te.textContent=X!=null&&X!==""?String(X):"—"})},V=async()=>{if(!f||!x||!S)return;const _=f.dataset.mode??"create",te=f.dataset.documentSequenceId??"",j={document_type:i("document_type"),establishment_code:i("establishment_code").toUpperCase(),emission_point_code:i("emission_point_code").toUpperCase(),current_sequence:(()=>{const H=parseInt(i("current_sequence"),10);return Number.isNaN(H)?null:H})(),status:i("status")||"A"};re();const X={};if(j.document_type||(X.document_type=e("El tipo de documento es obligatorio.")),j.establishment_code||(X.establishment_code=e("El código de establecimiento es obligatorio.")),j.emission_point_code||(X.emission_point_code=e("El punto de emisión es obligatorio.")),(!j.current_sequence||j.current_sequence<1)&&(X.current_sequence=e("El secuencial debe ser mayor o igual a 1.")),Object.keys(X).length>0){ne(X),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}r(!0);const b=_==="create"?m:`${d}/${te}`,v=_==="create"?"POST":"PATCH";try{const H=await fetch(b,{method:v,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(j)}),O=await H.json().catch(()=>null);if(!H.ok){H.status===422&&O?.errors?(ne(O.errors),g({title:e("Hay errores en el formulario"),text:O.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:O?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:O?.message??e("Acción realizada correctamente."),icon:"success"}),pe(c.form),s()}catch(H){console.error("[DocumentSequences] Submit error",H),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{r(!1)}},N=async()=>{if(!c.delete||!E)return;const _=c.delete.dataset.documentSequenceId??"";if(!_){pe(c.delete);return}E.disabled=!0,E.classList.add("cursor-not-allowed","opacity-70");try{const te=await fetch(`${d}/${_}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),j=await te.json().catch(()=>null);if(!te.ok){g({title:e("Error"),text:j?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:j?.message??e("Registro eliminado correctamente."),icon:"success"}),pe(c.delete),s()}catch(te){console.error("[DocumentSequences] Delete error",te),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{E.disabled=!1,E.classList.remove("cursor-not-allowed","opacity-70")}},$=async _=>{const te=_.dataset.id??"";if(!te||_.disabled)return;const j=!_.checked,X=_.checked?"A":"I";_.disabled=!0;try{const b=await fetch(`${d}/${te}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:X})}),v=await b.json().catch(()=>null);if(!b.ok){_.checked=j,g({title:e("Error"),text:v?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:v?.message??e("El estado se modificó correctamente."),icon:"success"}),s()}catch(b){console.error("[DocumentSequences] Status toggle error",b),_.checked=j,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{_.disabled=!1}};f&&f.addEventListener("submit",_=>{_.preventDefault(),V()}),E&&E.addEventListener("click",N),t.addEventListener("click",async _=>{const te=_.target instanceof Element?_.target.closest("[data-document-sequence-action], [data-action], [data-row-action]"):null;if(!te||!t.contains(te))return;if(te.hasAttribute("data-document-sequence-action")){te.dataset.documentSequenceAction==="create"&&(C("create"),le(c.form));return}const j=te.dataset.action||te.dataset.rowAction;if(!j)return;const X=(te.dataset.id||te.dataset.rowId)??"";if(!X){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(j==="view"){try{const b=await fetch(`${d}/${X}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!b.ok)throw new Error("Failed to fetch document sequence data");const v=await b.json();v?.data?.item?(D(v.data.item),le(c.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}catch(b){console.error("[DocumentSequences] Error loading view data",b),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"})}return}if(j==="edit"){try{const b=await fetch(`${d}/${X}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!b.ok)throw new Error("Failed to fetch document sequence data");const v=await b.json();v?.data?.item?(C("edit",v.data.item),le(c.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}catch(b){console.error("[DocumentSequences] Error loading edit data",b),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}return}if(j==="delete"){try{const b=await fetch(`${d}/${X}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!b.ok)throw new Error("Failed to fetch document sequence data");const v=await b.json();if(v?.data?.item){const H=v.data.item.display_name??v.data.item.document_type_label??"";c.delete&&(c.delete.dataset.documentSequenceId=X),L&&(L.textContent=H),le(c.delete)}else g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}catch(b){console.error("[DocumentSequences] Error loading delete data",b),g({title:e("Error"),text:e("No se pudieron obtener los datos para eliminar."),icon:"error"})}return}}),t.addEventListener("change",_=>{const te=_.target;te instanceof HTMLInputElement&&te.matches("[data-status-toggle]")&&$(te)})},us=()=>{const t=document.querySelector("[data-price-lists-root]");if(!t)return;const n=t.dataset.priceListsTableId??"",d=t.dataset.priceListsBaseUrl??"",m=t.dataset.priceListsStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-price-list-modal="form"]'),view:t.querySelector('[data-price-list-modal="view"]'),delete:t.querySelector('[data-price-list-modal="delete"]')},o=u.form?.querySelector("[data-price-list-form]")??null,c=u.form?.querySelector("[data-price-list-submit]")??null,f=c?.querySelector("[data-price-list-submit-label]")??null,x=u.form?.querySelector("[data-price-list-modal-title]")??null,S=u.view?.querySelector("[data-price-list-view]")??null,P=u.delete?.querySelector("[data-price-list-delete-name]")??null,M=u.delete?.querySelector("[data-price-list-delete-confirm]")??null,L="overflow-hidden",E=r=>r.closest("[data-price-list-modal]"),R=r=>{r&&(r.classList.remove("hidden"),document.body.classList.add(L))},A=r=>{r&&(r.classList.add("hidden"),t.querySelector("[data-price-list-modal]:not(.hidden)")||document.body.classList.remove(L))};t.querySelectorAll("[data-price-list-modal-close]").forEach(r=>{r.addEventListener("click",()=>{const a=E(r);A(a)})}),Object.values(u).forEach(r=>{r&&(r.addEventListener("click",a=>{a.target===r&&A(r)}),r.addEventListener("keydown",a=>{a.key==="Escape"&&A(r)}))});const B=()=>{o&&(o.querySelectorAll("[data-price-list-error]").forEach(r=>{r.textContent=""}),o.querySelectorAll("[data-price-list-input]").forEach(r=>{r.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},ie=r=>{!o||!r||Object.entries(r).forEach(([a,i])=>{const s=Array.isArray(i)?i[0]:i,l=o.querySelector(`[data-price-list-error="${a}"]`),y=o.querySelector(`[data-price-list-input="${a}"]`);l&&(l.textContent=s??""),y&&y.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},se=r=>{!c||!f||(r?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=r)},Y=(r,a)=>{if(!o)return;const i=o.querySelector(`[data-price-list-input="${r}"]`);i&&(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=a??"")},J=r=>{if(!o)return"";const a=o.querySelector(`[data-price-list-input="${r}"]`);return a&&(a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)?a.value.trim():""},G=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},me=(r,a=null)=>{if(console.log("🟡 [PriceLists] setFormMode called",{mode:r,hasData:!!a,data:a}),!o||!c||!f){console.warn("🟡 [PriceLists] Missing form elements",{form:!!o,submitButton:!!c,submitLabel:!!f});return}B(),se(!1),o.dataset.mode=r,o.dataset.priceListId=a?.id??"",r==="create"?(o.reset(),Y("status","A"),x&&(x.textContent="Nueva lista de precios"),f.textContent="Guardar",c.dataset.originalLabel="Guardar"):(x&&(x.textContent="Editar lista de precios"),f.textContent="Actualizar",c.dataset.originalLabel="Actualizar"),a&&(console.log("🟡 [PriceLists] Setting form values",{name:a.name,description:a.description,status:a.status}),Y("name",a.name??""),Y("description",a.description??""),Y("status",a.status??"A"))},le=r=>{if(console.log("🟡 [PriceLists] populateViewModal called",{hasViewContainer:!!S,hasData:!!r,data:r}),!S||!r){console.warn("🟡 [PriceLists] Missing viewContainer or data",{viewContainer:S,data:r});return}S.querySelectorAll("[data-price-list-view-field]").forEach(a=>{const i=a.getAttribute("data-price-list-view-field");if(!i)return;const s=r[i],l=s!=null&&s!==""?String(s):"-";a.textContent=l,console.log("🟡 [PriceLists] Set view field",{field:i,value:s,displayValue:l})})},pe=async()=>{if(!o||!c||!f)return;const r=o.dataset.mode??"create",a=o.dataset.priceListId??"",i={name:J("name"),description:J("description")||null,status:J("status")||"A"};B();const s={};if(i.name||(s.name=e("El nombre es obligatorio.")),Object.keys(s).length>0){ie(s),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}se(!0);const l=r==="create"?m:`${d}/${a}`,y=r==="create"?"POST":"PATCH";try{const h=await fetch(l,{method:y,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(i)}),C=await h.json().catch(()=>null);if(!h.ok){h.status===422&&C?.errors?(ie(C.errors),g({title:e("Hay errores en el formulario"),text:C.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:C?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:C?.message??e("Acción realizada correctamente."),icon:"success"}),A(u.form),G()}catch(h){console.error("[PriceLists] Submit error",h),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{se(!1)}},re=async()=>{if(!u.delete||!M)return;const r=u.delete.dataset.priceListId;if(!r){A(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const a=await fetch(`${d}/${r}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),i=await a.json().catch(()=>null);if(!a.ok){g({title:e("Error"),text:i?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:i?.message??e("Registro eliminado correctamente."),icon:"success"}),A(u.delete),G()}catch(a){console.error("[PriceLists] Delete error",a),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},ne=async r=>{const a=r.dataset.id??"";if(!a||r.disabled)return;const i=!r.checked,s=r.checked?"A":"I";r.disabled=!0;try{const l=await fetch(`${d}/${a}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:s})}),y=await l.json().catch(()=>null);if(!l.ok){r.checked=i,g({title:e("Error"),text:y?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:y?.message??e("El estado se modificó correctamente."),icon:"success"}),G()}catch(l){console.error("[PriceLists] Status toggle error",l),r.checked=i,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{r.disabled=!1}};o&&o.addEventListener("submit",r=>{r.preventDefault(),pe()}),M&&M.addEventListener("click",re),t.addEventListener("click",async r=>{const a=r.target instanceof Element?r.target.closest("[data-price-list-action], [data-action], [data-row-action]"):null;if(!a)return;if(console.log("🟡 [PriceLists] Click detected",{target:r.target,actionEl:a,hasPriceListAction:a.hasAttribute("data-price-list-action"),action:a.dataset.priceListAction,dataAction:a.dataset.action,rowAction:a.dataset.rowAction}),a.hasAttribute("data-price-list-action")){a.dataset.priceListAction==="create"&&(me("create"),R(u.form));return}const i=a.dataset.action||a.dataset.rowAction,s=a.dataset.rowPayload;let l=s?rt(s):null;const y=(a.dataset.id||a.dataset.rowId)??null;if(console.log("🟡 [PriceLists] Action clicked",{rowAction:i,hasPayload:!!s,hasData:!!l,rowId:y,actionEl:a}),!i||!y){console.error("🟡 [PriceLists] Missing rowAction or rowId",{rowAction:i,rowId:y}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if((i==="view"||i==="edit")&&!l){console.log("🟡 [PriceLists] Fetching data for",{rowAction:i,rowId:y});try{const h=await fetch(`${d}/${y}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("🟡 [PriceLists] Fetch response",{status:h.status,ok:h.ok}),!h.ok){const D=await h.text();console.error("🟡 [PriceLists] Fetch failed",{status:h.status,text:D.substring(0,200)}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}const C=await h.json().catch(()=>null);if(console.log("🟡 [PriceLists] Fetch JSON",{status:C?.status,hasData:!!C?.data,hasItem:!!C?.data?.item}),C?.status==="success"&&C?.data?.item)l=C.data.item,console.log("🟡 [PriceLists] Data fetched successfully",{data:l});else{console.error("🟡 [PriceLists] Invalid response format",{json:C}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}}catch(h){console.error("🟡 [PriceLists] Fetch error",h),g({title:e("Error"),text:e("Ocurrió un problema al obtener los datos."),icon:"error"});return}}if(!l&&i==="delete"&&(l={id:y,name:(a.dataset.name||a.dataset.rowName)??null}),(i==="view"||i==="edit")&&!l?.id){console.error("🟡 [PriceLists] Missing data.id after fetch",{data:l,rowAction:i}),g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(i==="view"){console.log("🟡 [PriceLists] Populating view modal",{data:l}),le(l),R(u.view);return}if(i==="edit"){console.log("🟡 [PriceLists] Setting form mode to edit",{data:l}),me("edit",l),R(u.form);return}i==="delete"&&(u.delete&&(u.delete.dataset.priceListId=l.id??""),P&&(P.textContent=l.name??""),R(u.delete))}),t.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.matches("[data-status-toggle]")&&ne(a)})},fs=()=>{const t=document.querySelector("[data-product-form-root]");if(!t)return;console.log("[ProductsForm] Inicializando módulo de productos",{mode:t.dataset.productFormMode});const n=t.querySelector("[data-product-form]"),d=n?.querySelector("[data-product-description-input]"),m=n?.querySelector("[data-product-description-editor]"),p=n?.querySelector("[data-product-featured-input]"),u=n?.querySelector("[data-product-featured-preview]"),o=n?.querySelector("[data-product-featured-wrapper]"),c=n?.querySelector("[data-product-featured-remove]"),f=n?.querySelector("[data-product-featured-remove-input]"),x=n?.querySelector("[data-product-gallery-input]"),S=n?.querySelector("[data-product-gallery-upload]"),P=n?.querySelector("[data-product-gallery-container]");let M=n?.querySelector("[data-product-gallery-removed]");const L=n?.querySelector("[data-product-line-select]"),E=n?.querySelector("[data-product-category-select]"),R=n?.querySelector("[data-product-subcategory-select]"),A=L?.querySelector('input[type="hidden"]')??null,B=E?.querySelector('input[type="hidden"]')??null,ie=R?.querySelector('input[type="hidden"]')??null,se=Array.from(E?.querySelectorAll("[data-product-category-option]")??[]),Y=Array.from(R?.querySelectorAll("[data-product-subcategory-option]")??[]),J=o?.dataset.productFeaturedInitial==="true",G='<i class="fa-solid fa-image text-2xl text-gray-400"></i>';(()=>{try{return JSON.parse(t.dataset.productFormCatalog??"{}")}catch(b){return console.warn("[ProductsForm] Invalid catalog data",b),{}}})();const me=(()=>{try{return JSON.parse(t.dataset.productFormInitial??"null")}catch(b){return console.warn("[ProductsForm] Invalid initial payload",b),null}})();let le=[];const pe=(b,v,{silent:H=!1}={})=>{if(!b)return;console.log("[ProductsForm] setCustomSelectValue",{name:b.dataset.selectName,value:v});const O=b.querySelector('input[type="hidden"]'),q=b.querySelector("[data-select-trigger]"),T=b.querySelector("[data-select-value]"),z=Array.from(b.querySelectorAll("[data-select-option]")),w=q?.dataset.selectPlaceholder??"";if(!O||!T)return;const k=v??"";if(O.value=k,z.forEach(Q=>{Q.dataset.selected=Q.dataset.value===k?"true":"false"}),k){const Q=z.find(ve=>ve.dataset.value===k);T.textContent=Q?.dataset.label??Q?.textContent.trim()??w}else T.textContent=w;q?.classList.toggle("is-empty",!k),H||O.dispatchEvent(new Event("change",{bubbles:!0}))},re=b=>{c&&(c.dataset.visible=b?"true":"false",console.log("[ProductsForm] featured remove visibility",{visible:b}))},ne=()=>{u&&(u.innerHTML=G)},r=b=>{if(!u||!b){ne();return}console.log("[ProductsForm] renderFeaturedFromFile",{name:b.name,size:b.size,type:b.type});const v=new FileReader;v.onload=H=>{u.innerHTML=`<img src="${H.target?.result??""}" alt="${b.name}" class="h-full w-full object-cover">`},v.readAsDataURL(b)},a=()=>{const b=A?.value??"",v=B?.value??"";console.log("[ProductsForm] filterCategories",{selectedLine:b,selectedCategory:v}),se.forEach(q=>{const T=q.dataset.line??"",z=!!(b&&T&&T!==b);q.hidden=z}),v&&(se.some(T=>!T.hidden&&T.dataset.value===v)||pe(E,"",{silent:!0}));const H=B?.value??"",O=ie?.value??"";Y.forEach(q=>{const T=q.dataset.line??"",z=q.dataset.category??"",w=!!(b&&T&&T!==b),k=!!(H&&z&&z!==H);q.hidden=w||k}),O&&(Y.some(T=>!T.hidden&&T.dataset.value===O)||pe(R,"",{silent:!0}))},i=()=>{!E||!R||(a(),A?.addEventListener("change",a),B?.addEventListener("change",a))},s=()=>{if(!m||!d)return;(window.Quill?Promise.resolve(window.Quill):new Promise(v=>{const H=setInterval(()=>{window.Quill&&(clearInterval(H),v(window.Quill))},100);setTimeout(()=>{clearInterval(H),v(null)},3e3)})).then(v=>{if(!v){console.warn("[ProductsForm] Quill no disponible");return}console.log("[ProductsForm] Quill cargado correctamente");const H=new v(m,{theme:"snow",placeholder:e("Describe tu producto con especificaciones, características y beneficios."),modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["link","blockquote","code-block"],["clean"]]}});d.value&&H.clipboard.dangerouslyPasteHTML(d.value);const O=m.previousElementSibling,q=m;O?.classList.add("rounded-t-3xl","border","border-gray-200","border-b-0","bg-white","px-4","py-2","dark:border-gray-700","dark:bg-slate-900"),q?.classList.add("rounded-b-3xl","border","border-gray-200","border-t","bg-white","dark:border-gray-700","dark:bg-slate-900"),q?.classList.add("rounded-tl-none","rounded-tr-none"),H.on("text-change",()=>{const T=H.root.innerHTML;d.value=T==="<p><br></p>"?"":T,console.log("[ProductsForm] description text-change",{length:H.getLength()})})})},l=()=>{p&&p.addEventListener("change",()=>{const b=p.files?.[0]??null;if(console.log("[ProductsForm] featured_input change",{hasFile:!!b}),b){r(b),f&&(f.value="0"),re(!0);return}if(J&&f?.value!=="1"&&u?.querySelector("img")){re(!0);return}ne(),re(!1)})};re(!!J),c?.addEventListener("click",b=>{b.preventDefault(),p&&(p.value=""),ne(),f&&(f.value=J?"1":"0"),re(!1),console.log("[ProductsForm] featured image cleared by user",{initialHadImage:J})});const y=()=>Array.from(P?.querySelectorAll('[data-product-gallery-card][data-gallery-type="existing"]')??[]),h=()=>{if(!x)return;const b=new DataTransfer;le.forEach(v=>{b.items.add(v)}),x.files=b.files},C=()=>{!P||!S||(P.querySelectorAll("[data-product-gallery-new]").forEach(b=>b.remove()),le.forEach((b,v)=>{console.log("[ProductsForm] renderGalleryPreviews",{index:v,name:b.name,size:b.size});const H=new FileReader,O=document.createElement("div");O.className="group relative flex flex-col gap-2 rounded-2xl border border-dashed border-gray-300 bg-white/95 p-3 shadow-sm dark:border-gray-700 dark:bg-slate-900",O.dataset.productGalleryNew="",O.dataset.productGalleryCard="",O.dataset.galleryType="new",O.dataset.galleryIndex=String(v),O.innerHTML=`
                    <button type="button" class="absolute right-2 top-2 inline-flex h-8 w-8 items-center justify-center rounded-full bg-slate-900/80 text-white transition hover:bg-slate-900 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary focus-visible:outline-white cursor-pointer z-10" data-product-gallery-remove aria-label="${e("Eliminar imagen temporal")}">
                    <span class="sr-only">${e("Eliminar imagen temporal")}</span>
                    <svg class="h-3.5 w-3.5" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                        <path d="M3.5 3.5L10.5 10.5M10.5 3.5L3.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                </button>
                <figure class="aspect-square overflow-hidden rounded-xl bg-gray-100 shadow-inner ring-1 ring-gray-200/70 dark:bg-slate-800 dark:ring-gray-700/60">
                    <img src="" alt="${b.name}" class="h-full w-full object-cover opacity-0 transition-opacity duration-200">
                    </figure>
                <p class="text-xs text-gray-500 dark:text-gray-400 truncate">${b.name}</p>
                `;const q=O.querySelector("img");P.insertBefore(O,S),H.onload=T=>{q&&(q.src=T.target?.result??"",q.classList.remove("opacity-0"))},H.readAsDataURL(b)}))},D=()=>{if(!x||!P||!S)return;x.addEventListener("change",()=>{const H=Array.from(x.files??[]);if(console.log("[ProductsForm] gallery_input change",{selectedFiles:H.map(T=>({name:T.name,size:T.size}))}),H.length===0)return;const O=y().length,q=Math.max(0,5-O-le.length);if(q<=0){g({title:e("Galería llena"),text:e("Debes eliminar imágenes existentes antes de agregar nuevas."),icon:"warning"}),x.value="";return}if(H.length>q){const T=e("Solo puedes agregar :count imágenes adicionales.").replace(":count",q);g({title:e("Límite excedido"),text:T,icon:"warning"}),x.value="";return}le=le.concat(H),x.value="",h(),C()});const b=()=>M&&M.isConnected?M:n?(M=n.querySelector("[data-product-gallery-removed]"),M||(M=document.createElement("div"),M.dataset.productGalleryRemoved="",M.hidden=!0,n.appendChild(M)),M):null,v=H=>{const O=H.target instanceof Element?H.target.closest("[data-product-gallery-remove]"):null;if(!O)return;H.preventDefault();const q=O.closest("[data-product-gallery-card]");if(!q)return;const T=q.dataset.galleryType??"";if(T==="existing"){const z=q.dataset.galleryPath??"",w=q.querySelector('input[name="retain_gallery[]"]');w&&w.remove();const k=b();if(z&&k){console.log("[ProductsForm] removing existing gallery image",{galleryPath:z});const Q=document.createElement("input");Q.type="hidden",Q.name="removed_gallery[]",Q.value=z,k.appendChild(Q)}q.remove()}else if(T==="new"){const z=Number(q.dataset.galleryIndex??"-1");!Number.isNaN(z)&&z>=0&&(console.log("[ProductsForm] removing new gallery image",{index:z}),le.splice(z,1),h(),C())}};P.addEventListener("click",v),n?.addEventListener("click",v)},V=b=>{if(!(b instanceof HTMLInputElement)||b.type!=="checkbox")return;const H=b.parentElement?.querySelector("[data-visibility-track]"),O=H?.querySelector("[data-visibility-thumb]");if(!H||!O)return;const q=b.checked;H.classList.toggle("bg-primary",q),H.classList.toggle("bg-gray-300",!q),O.classList.toggle("translate-x-5",q)},N=()=>{if(!n)return;n.querySelectorAll('input[type="checkbox"][name="show_in_pos"], input[type="checkbox"][name="show_in_b2b"], input[type="checkbox"][name="show_in_b2c"]').forEach(v=>{V(v),v.addEventListener("change",()=>V(v))})},$=b=>{if(!(b instanceof HTMLInputElement))return;const v=b.value?.trim()??"";if(v===""){b.value="0";return}const H=v.replace(/,/g,"."),O=Number.parseFloat(H);if(Number.isNaN(O)||O<0){b.value="0";return}b.value=(Math.round(O*100)/100).toString()},_=()=>{if(!n)return;const b=n.querySelectorAll("[data-product-price-input]");b.length!==0&&(b.forEach(v=>{v instanceof HTMLInputElement&&($(v),v.addEventListener("blur",()=>{$(v)}))}),n.addEventListener("submit",()=>{b.forEach(v=>{v instanceof HTMLInputElement&&$(v)})}))},te=()=>{setTimeout(()=>{if(console.log("[ProductsForm] initialising selects",{hasInitialData:!!me}),L){const O=me?.product_line_id??A?.value??"";O&&pe(L,O,{silent:!0})}if(E){const O=me?.category_id??B?.value??"";O&&pe(E,O,{silent:!0})}if(R){const O=me?.subcategory_id??ie?.value??"";O&&pe(R,O,{silent:!0})}const b=n?.querySelector('[data-select-name="price_list_pos_id"]');if(b){const O=b.querySelector('input[type="hidden"]'),q=me?.price_list_pos_id??O?.value??"";q&&pe(b,q,{silent:!0})}const v=n?.querySelector('[data-select-name="price_list_b2c_id"]');if(v){const O=v.querySelector('input[type="hidden"]'),q=me?.price_list_b2c_id??O?.value??"";q&&pe(v,q,{silent:!0})}const H=n?.querySelector('[data-select-name="price_list_b2b_id"]');if(H){const O=H.querySelector('input[type="hidden"]'),q=me?.price_list_b2b_id??O?.value??"";q&&pe(H,q,{silent:!0})}a()},100)},j=()=>{if(console.log("🟡 [ProductsForm] initialiseProductSelects called",{hasForm:!!n,form:n}),!n){console.warn("🟡 [ProductsForm] Form not found for initialiseProductSelects");return}const b=n.querySelectorAll("[data-select-manual]");console.log("🟡 [ProductsForm] Initializing product selects",{count:b.length,formFound:!!n,selects:Array.from(b).map(v=>({name:v.dataset.selectName,hasManual:v.hasAttribute("data-select-manual"),initialized:v.dataset.productsFormInitialized==="true"}))}),b.forEach((v,H)=>{if(console.log(`🟡 [ProductsForm] Processing select ${H+1}`,{name:v.dataset.selectName,alreadyInitialized:v.dataset.productsFormInitialized==="true"}),v.dataset.productsFormInitialized==="true"){console.log(`🟡 [ProductsForm] Select ${H+1} already initialized, skipping`);return}v.dataset.productsFormInitialized="true";const O=v.querySelector("[data-select-trigger]"),q=v.querySelector("[data-select-dropdown]"),T=v.querySelector('input[type="hidden"]'),z=v.querySelector("[data-select-value]"),w=v.querySelector("[data-select-icon]"),k=Array.from(q?q.querySelectorAll("[data-select-option]"):v.querySelectorAll("[data-select-option]")),Q=q?q.innerHTML:"no dropdown",ve=q?q.innerHTML.substring(0,500):"no dropdown";if(console.log(`🟡 [ProductsForm] Select ${H+1} elements`,{name:v.dataset.selectName,hasTrigger:!!O,hasDropdown:!!q,hasHiddenInput:!!T,hasValueLabel:!!z,hasIcon:!!w,optionsCount:k.length,dropdownHidden:q?.hidden,dropdownDatasetOpen:q?.dataset.open,dropdownHTMLPreview:ve,dropdownHTMLFull:Q,optionsFound:k.map(Z=>({value:Z.dataset.value,label:Z.dataset.label,textContent:Z.textContent.trim().substring(0,50)}))}),!O||!q||!T||!z){console.error(`🟡 [ProductsForm] Select ${H+1} missing required elements`,{hasTrigger:!!O,hasDropdown:!!q,hasHiddenInput:!!T,hasValueLabel:!!z,selectName:v.dataset.selectName});return}console.log(`🟡 [ProductsForm] Initializing select ${H+1}`,{name:v.dataset.selectName,optionsCount:k.length,initialValue:T.value}),q.setAttribute("hidden",""),q.classList.add("hidden","invisible"),q.hidden=!0,q.dataset.open="false",v.dataset.open="false",console.log(`🟡 [ProductsForm] Select ${H+1} initial state set`,{name:v.dataset.selectName,dropdownHidden:q.hidden,hasHiddenClass:q.classList.contains("hidden"),hasInvisibleClass:q.classList.contains("invisible"),datasetOpen:q.dataset.open});const qe=Z=>{k.forEach(I=>{const K=I.dataset.value===Z;I.dataset.selected=K?"true":"false"})},_e=()=>{const Z=!!T.value;O.classList.toggle("is-empty",!Z)},Ce=(Z,I)=>{T.value=Z,z.textContent=I||Z||(O.dataset.selectPlaceholder??""),qe(Z),_e(),T.dispatchEvent(new Event("change",{bubbles:!0}))},Le=k.find(Z=>Z.dataset.value===T.value);Le?Ce(Le.dataset.value??"",Le.dataset.label??Le.textContent.trim()):T.value||(z.textContent=O.dataset.selectPlaceholder??"",_e());const Ve=()=>{console.log("🟡 [ProductsForm] Closing select",{name:v.dataset.selectName}),q.setAttribute("hidden",""),q.classList.add("hidden"),q.hidden=!0,q.dataset.open="false",v.dataset.open="false",O.setAttribute("aria-expanded","false"),w&&(w.style.transform=""),console.log("🟡 [ProductsForm] Select closed",{name:v.dataset.selectName,dropdownHidden:q.hidden,hasHiddenClass:q.classList.contains("hidden"),datasetOpen:q.dataset.open})},Ge=()=>{const Z=Array.from(q?q.querySelectorAll("[data-select-option]"):v.querySelectorAll("[data-select-option]"));console.log("🟡 [ProductsForm] Opening select",{name:v.dataset.selectName,optionsCount:k.length,currentOptionsCount:Z.length,visibleOptions:Z.filter(I=>!I.hidden&&!I.closest("[hidden]")).length,dropdownHTML:q?q.innerHTML.substring(0,300):"no dropdown",optionsDetails:Z.map((I,K)=>({index:K,value:I.dataset.value,label:I.dataset.label,textContent:I.textContent.trim().substring(0,50),isHidden:I.hidden,parentHidden:I.closest("[hidden]")!==null,display:window.getComputedStyle(I).display,visibility:window.getComputedStyle(I).visibility}))}),b.forEach(I=>{if(I!==v&&I.dataset.open==="true"){const K=I.querySelector("[data-select-dropdown]"),ye=I.querySelector("[data-select-trigger]"),xe=I.querySelector("[data-select-icon]");K&&ye&&(K.hidden=!0,K.dataset.open="false",I.dataset.open="false",ye.setAttribute("aria-expanded","false"),xe&&(xe.style.transform=""))}}),q.dataset.open="true",v.dataset.open="true",q.removeAttribute("hidden"),q.classList.remove("hidden","invisible"),q.hidden=!1,O.setAttribute("aria-expanded","true"),w&&(w.style.transform="rotate(180deg)"),console.log("🟡 [ProductsForm] Select opened (before RAF)",{name:v.dataset.selectName,dropdownHidden:q.hidden,hasHiddenClass:q.classList.contains("hidden"),hasInvisibleClass:q.classList.contains("invisible"),datasetOpen:q.dataset.open,ariaExpanded:O.getAttribute("aria-expanded"),iconTransform:w?.style.transform}),requestAnimationFrame(()=>{q.style.display="",q.style.visibility="",q.style.opacity="",q.style.minWidth=`${O.getBoundingClientRect().width}px`,console.log("🟡 [ProductsForm] Select opened (after RAF)",{name:v.dataset.selectName,dropdownHidden:q.hidden,hasHiddenClass:q.classList.contains("hidden"),hasInvisibleClass:q.classList.contains("invisible"),datasetOpen:q.dataset.open,dropdownDisplay:window.getComputedStyle(q).display,dropdownVisibility:window.getComputedStyle(q).visibility,dropdownOpacity:window.getComputedStyle(q).opacity,minWidth:q.style.minWidth,triggerWidth:O.getBoundingClientRect().width,computedStyles:{display:window.getComputedStyle(q).display,visibility:window.getComputedStyle(q).visibility,opacity:window.getComputedStyle(q).opacity,transform:window.getComputedStyle(q).transform}})})};O.addEventListener("click",Z=>{console.log("🟡 [ProductsForm] Trigger clicked",{name:v.dataset.selectName,target:Z.target,currentTarget:Z.currentTarget}),Z.preventDefault(),Z.stopPropagation();const I=v.dataset.open==="true";console.log("🟡 [ProductsForm] Select state before toggle",{name:v.dataset.selectName,isOpen:I,dropdownHidden:q.hidden,datasetOpen:q.dataset.open}),I?Ve():Ge()});const Te=Z=>{const I=Z.target.closest("[data-select-option]");if(!I||!q.contains(I))return;console.log("🟡 [ProductsForm] Option clicked",{selectName:v.dataset.selectName,value:I.dataset.value,label:I.dataset.label,textContent:I.textContent.trim(),isHidden:I.hidden,parentHidden:I.closest("[hidden]")!==null}),Z.preventDefault(),Z.stopPropagation();const K=I.dataset.value??"",ye=I.dataset.label??I.textContent.trim();console.log("🟡 [ProductsForm] Setting value",{selectName:v.dataset.selectName,value:K,label:ye}),Ce(K,ye),Ve(),O.focus({preventScroll:!0})};q.addEventListener("click",Te),k.forEach((Z,I)=>{Z.addEventListener("click",Te)}),v.addEventListener("keydown",Z=>{Z.key==="Escape"&&(Ve(),O.focus({preventScroll:!0}))})}),document.addEventListener("click",v=>{const H=v.target;H instanceof Node&&(H.closest("[data-select]")||b.forEach(O=>{if(O.dataset.open==="true"){const q=O.querySelector("[data-select-dropdown]"),T=O.querySelector("[data-select-trigger]"),z=O.querySelector("[data-select-icon]");q&&T&&(q.hidden=!0,q.dataset.open="false",O.dataset.open="false",T.setAttribute("aria-expanded","false"),z?.classList.remove("rotate-180"))}}))})};(()=>{setTimeout(()=>{console.log("[ProductsForm] Starting form initialization"),j(),setTimeout(()=>{i(),te(),s(),l(),D(),_(),N()},50)},300),n?.addEventListener("change",b=>{const v=b.target;v instanceof HTMLInputElement&&v.matches('[name="show_in_pos"], [name="show_in_b2b"], [name="show_in_b2c"]')&&(console.log("[ProductsForm] visibility change",{field:v.name,checked:v.checked}),V(v))})})()},ps=()=>{const t=document.querySelector("[data-product-transfers-root]");if(!t)return;const n=t.dataset.productTransfersTableId??"",d=t.dataset.productTransfersBaseUrl??"",m=t.dataset.productTransfersStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";let u=[],o=[];try{const T=t.dataset.productTransfersWarehouses??"[]";u=JSON.parse(T)??[]}catch(T){console.error("[ProductTransfers] Invalid warehouses JSON",{error:T,data:t.dataset.productTransfersWarehouses?.substring(0,100),length:t.dataset.productTransfersWarehouses?.length}),u=[]}try{const T=t.dataset.productTransfersProducts??"[]";o=JSON.parse(T)??[],console.log("[ProductTransfers] Products loaded",{count:o.length})}catch(T){console.error("[ProductTransfers] Invalid products JSON",{error:T,data:t.dataset.productTransfersProducts?.substring(0,200),length:t.dataset.productTransfersProducts?.length}),o=[]}const c={form:t.querySelector('[data-product-transfer-modal="form"]'),view:t.querySelector('[data-product-transfer-modal="view"]'),delete:t.querySelector('[data-product-transfer-modal="delete"]')},f=c.form?.querySelector("[data-product-transfer-form]")??t.querySelector("[data-product-transfer-form]")??null,x=f?.querySelector("[data-product-transfer-submit]")??null,S=x?.querySelector("[data-product-transfer-submit-label]")??null,P=c.form?.querySelector("[data-product-transfer-modal-title]")??null,M=f?.querySelector('[data-product-transfer-input="movement_date"]')??null,L=f?.querySelector('[data-product-transfer-input="reference"]')??null,E=f?.querySelector('[data-product-transfer-input="notes"]')??null,R=f?.querySelector('[data-product-transfer-select="origin"]')??null,A=f?.querySelector('[data-product-transfer-select="destination"]')??null,B=f?.querySelector("[data-product-transfer-items]")??null,ie=f?.querySelector("[data-product-transfer-add-item]")??null;f?.querySelector('[data-product-transfer-error="movement_date"]'),f?.querySelector('[data-product-transfer-error="origin_warehouse_id"]'),f?.querySelector('[data-product-transfer-error="destination_warehouse_id"]');const se=f?.querySelector('[data-product-transfer-error="items"]')??null;c.view?.querySelector("[data-product-transfer-view]"),c.view?.querySelector("[data-product-transfer-view-items]");const Y=c.delete?.querySelector("[data-product-transfer-delete-reference]")??null,J=c.delete?.querySelector("[data-product-transfer-delete-confirm]")??null,G="overflow-hidden",me=new Set,le=(T=null)=>{me.forEach(z=>{z!==T&&z.close()})},pe=(T,z=[],{placeholder:w=""}={})=>{if(!T)return null;const k=T.querySelector('input[type="hidden"]'),Q=T.querySelector("[data-select-trigger]"),ve=T.querySelector("[data-select-dropdown]"),qe=T.querySelector("[data-select-value]"),_e=T.querySelector("[data-select-icon]"),Ce=T.querySelector("[data-product-transfer-origin-options], [data-product-transfer-destination-options], [data-product-transfer-item-options]");if(!k||!Q||!ve||!qe||!Ce)return null;let Le=z;const Ve=()=>{Ce.querySelectorAll("[data-select-option]").forEach(we=>{we.dataset.selected=we.dataset.value===k.value?"true":"false"})},Ge=()=>{const Ne=Ce.querySelector(`[data-select-option][data-value="${k.value??""}"]`)?.dataset.label??w??"";qe.textContent=k.value?Ne:w??"",Q.classList.toggle("is-empty",!k.value),Ve()},Te=()=>{ve.setAttribute("hidden",""),ve.hidden=!0,ve.dataset.open="false",T.dataset.open="false",Q.setAttribute("aria-expanded","false"),_e?.classList.remove("rotate-180"),ve.classList.remove("visible","opacity-100"),ve.classList.add("invisible","opacity-0")};let Z=null;const I=()=>{Z&&le(Z),console.log("[ProductTransfers] Opening dropdown",{dropdown:ve,optionsContainer:Ce,currentOptionsCount:Le.length,hidden:ve.hidden,hasOptions:Ce.children.length}),ve.removeAttribute("hidden"),ve.hidden=!1,ve.dataset.open="true",T.dataset.open="true",Q.setAttribute("aria-expanded","true"),_e?.classList.add("rotate-180");const we=T.querySelector("[data-product-transfer-item-search]");we&&(we.value=""),requestAnimationFrame(()=>{ve.style.minWidth=`${Q.getBoundingClientRect().width}px`,ve.classList.remove("invisible","opacity-0"),ve.classList.add("visible","opacity-100"),we&&we.focus(),console.log("[ProductTransfers] Dropdown opened",{hidden:ve.hidden,hasAttributeHidden:ve.hasAttribute("hidden"),datasetOpen:ve.dataset.open,optionsCount:Ce.children.length,classes:ve.className})})},K=we=>{k.value=we??"",Ge(),k.dispatchEvent(new Event("change",{bubbles:!0}))};let ye="";const xe=T.querySelector("[data-product-transfer-item-search]"),Ie=(we=[],Ne="")=>{Le=we,Ce.innerHTML="";const Je=Ne.trim()?Le.filter(Xe=>{const Qe=(Xe.label??Xe.name??"").toLowerCase(),Ue=Ne.toLowerCase();return Qe.includes(Ue)}):Le;if(Je.length===0&&Ne.trim()){const Xe=document.createElement("div");Xe.className="px-4 py-3 text-center text-sm text-gray-500 dark:text-gray-400",Xe.textContent=e("No se encontraron productos"),Ce.appendChild(Xe)}else Je.forEach(Xe=>{const Qe=document.createElement("button");Qe.type="button",Qe.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",Qe.dataset.selectOption="",Qe.dataset.value=Xe.id??Xe.value??"",Qe.dataset.label=Xe.label??Xe.name??"",Qe.dataset.selected=k.value===(Xe.id??Xe.value??"")?"true":"false",Qe.innerHTML=`<span class="truncate">${Xe.label??Xe.name??""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,Qe.addEventListener("click",Ue=>{Ue.preventDefault(),K(Xe.id??Xe.value??""),Te(),xe&&(xe.value="",ye=""),Q.focus({preventScroll:!0})}),Ce.appendChild(Qe)});Ge()};return xe&&(xe.addEventListener("input",we=>{ye=we.target.value,Ie(Le,ye)}),xe.addEventListener("keydown",we=>{if(we.key==="Escape")we.preventDefault(),xe.value="",ye="",Ie(Le,""),Q.focus({preventScroll:!0});else if(we.key==="ArrowDown"){we.preventDefault();const Ne=Ce.querySelector("[data-select-option]");Ne&&Ne.focus()}})),Q.addEventListener("click",we=>{we.preventDefault(),we.stopPropagation(),we.stopImmediatePropagation();const Ne=T.dataset.open==="true";console.log("[ProductTransfers] Select trigger clicked",{isOpen:Ne,selectRoot:T,trigger:Q}),Ne?Te():(console.log("[ProductTransfers] Opening select",{dropdown:ve,optionsContainer:Ce,currentOptionsCount:Le.length}),I())}),T.addEventListener("keydown",we=>{we.key==="Escape"&&(Te(),Q.focus({preventScroll:!0}))}),Z={setValue:K,renderOptions:Ie,close:Te,get value(){return k.value},destroy(){me.delete(Z)}},me.add(Z),Ie(Le),Z};document.addEventListener("click",T=>{const z=T.target;(z instanceof Element?z.closest("[data-select]"):null)||z instanceof Element&&z.closest("[data-product-transfers-root] [data-select]")||le()},!0);const re=T=>{!x||!S||(T?S.textContent=e("Procesando..."):x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=T)},ne=()=>{f&&(f.querySelectorAll("[data-product-transfer-error]").forEach(T=>{T.textContent=""}),f.querySelectorAll("[data-product-transfer-input]").forEach(T=>{T.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}),R?.querySelector("[data-select-trigger]")?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),A?.querySelector("[data-select-trigger]")?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),se&&(se.textContent=""))},r=T=>{!f||!T||Object.entries(T).forEach(([z,w])=>{const k=Array.isArray(w)?w[0]:w;if(z.startsWith("items")){se&&(se.textContent=k??"");return}z==="origin_warehouse_id"&&R?.querySelector("[data-select-trigger]")?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),z==="destination_warehouse_id"&&A?.querySelector("[data-select-trigger]")?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200");const Q=f.querySelector(`[data-product-transfer-error="${z}"]`),ve=f.querySelector(`[data-product-transfer-input="${z}"]`);Q&&(Q.textContent=k??""),ve&&ve.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},a=pe(R,u,{placeholder:e("Selecciona una bodega")}),i=pe(A,u,{placeholder:e("Selecciona una bodega")}),s=()=>{if(!a||!i)return;const T=a.value,z=T?u.filter(w=>w.id!==T):u;i.renderOptions(z)};a&&R?.querySelector('input[type="hidden"]')?.addEventListener("change",()=>{s()});const l=new Map,y=()=>{l.forEach(T=>{T?.destroy?.()}),l.clear()},h=T=>{const z=T.dataset.productTransferItemRow??null;z&&l.has(z)&&(l.get(z)?.destroy?.(),l.delete(z)),T.remove()};let C=0;const D=(T=null)=>{if(!B)return;const z=`item-${C+=1}`,w=document.createElement("div");w.className="rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-slate-900",w.dataset.productTransferItemRow=z,w.innerHTML=`
            <div class="grid gap-3 md:grid-cols-[minmax(0,2fr)_120px_1fr_40px] md:items-end">
                <div>
                    <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">${e("Producto")}</label>
                    <div class="relative" data-select data-select-name="product_id" data-select-manual="true">
                        <input type="hidden" data-product-transfer-item-input="product_id" value="">
                        <button
                            type="button"
                            class="flex w-full items-center justify-between rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-800 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                            data-select-trigger
                            data-select-placeholder="${e("Selecciona un producto")}"
                            aria-haspopup="listbox"
                            aria-expanded="false"
                        >
                            <span data-select-value class="truncate">${e("Selecciona un producto")}</span>
                            <i class="fa-solid fa-chevron-down text-xs text-secondary transition" data-select-icon></i>
                        </button>
                        <div
                            class="invisible absolute left-0 right-0 z-50 mt-2 w-full origin-top scale-95 transform rounded-xl border border-gray-200 bg-white shadow-xl opacity-0 transition will-change-transform data-[open='true']:visible data-[open='true']:scale-100 data-[open='true']:opacity-100 dark:border-gray-700 dark:bg-slate-900"
                            data-select-dropdown
                            role="listbox"
                            hidden
                        >
                            <div class="border-b border-gray-200 p-3 dark:border-gray-700">
                                <input
                                    type="text"
                                    class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder-gray-400 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-800 dark:text-white"
                                    placeholder="${e("Buscar producto...")}"
                                    data-product-transfer-item-search
                                    autocomplete="off"
                                >
                            </div>
                            <div class="max-h-56 overflow-y-auto py-2" data-product-transfer-item-options></div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">${e("Cantidad")}</label>
                    <input
                        type="number"
                        min="1"
                        step="1"
                        data-product-transfer-item-input="quantity"
                        class="w-full rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm text-gray-800 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                        value="1"
                        required
                    >
                </div>
                <div>
                    <label class="mb-1 block text-xs font-semibold uppercase tracking-wide text-gray-600 dark:text-gray-300">${e("Notas")}</label>
                    <input
                        type="text"
                        data-product-transfer-item-input="notes"
                        class="w-full rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm text-gray-800 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                        maxlength="500"
                    >
                </div>
                <div class="flex justify-end md:justify-center">
                    <button
                        type="button"
                        class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-gray-300 text-gray-500 transition hover:border-rose-500 hover:text-rose-600 dark:border-gray-700 dark:text-gray-300"
                        data-product-transfer-item-remove
                        aria-label="${e("Eliminar producto")}"
                    >
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
        `,B.appendChild(w);const k=w.querySelector('[data-product-transfer-item-input="quantity"]'),Q=w.querySelector('[data-product-transfer-item-input="notes"]');T&&(k&&T.quantity&&(k.value=T.quantity),Q&&T.notes&&(Q.value=T.notes)),requestAnimationFrame(()=>{const qe=w.querySelector("[data-select]");if(!qe){console.error("[ProductTransfers] Product select root not found for row:",z);return}if(!o||o.length===0){console.warn("[ProductTransfers] No products available for select",{products:o,count:o?.length});return}const _e=pe(qe,o,{placeholder:e("Selecciona un producto")});_e?(l.set(z,_e),_e.renderOptions(o),T&&T.product_id&&_e.setValue(T.product_id),console.log("[ProductTransfers] Product select controller created successfully for row:",z,{productsCount:o.length,productId:T?.product_id})):console.error("[ProductTransfers] Failed to create product select controller for row:",z,{productSelectRoot:!!qe,productsCount:o?.length,optionsContainer:qe?.querySelector("[data-product-transfer-item-options]")})}),w.querySelector("[data-product-transfer-item-remove]")?.addEventListener("click",()=>{h(w),N()})},V=()=>{B&&(y(),B.innerHTML="")},N=()=>{B&&B.querySelectorAll("[data-product-transfer-item-row]").length===0&&D()};ie?.addEventListener("click",T=>{T.preventDefault(),D()});const $=()=>f?.dataset.mode??"create",_=()=>B?Array.from(B.querySelectorAll("[data-product-transfer-item-row]")).map(z=>{const k=l.get(z.dataset.productTransferItemRow??"")?.value??"",Q=z.querySelector('[data-product-transfer-item-input="quantity"]'),ve=z.querySelector('[data-product-transfer-item-input="notes"]');return{product_id:k,quantity:Q?Number.parseInt(Q.value||"0",10):0,notes:ve?.value?.trim()??null}}):[],te=T=>{T&&(T.classList.remove("hidden"),document.body.classList.add(G))},j=T=>{T&&(T.classList.add("hidden"),t.querySelector("[data-product-transfer-modal]:not(.hidden)")||document.body.classList.remove(G))};t.querySelectorAll("[data-product-transfer-modal-close]").forEach(T=>{T.addEventListener("click",()=>{const z=T.closest("[data-product-transfer-modal]");j(z)})}),[c.form,c.view,c.delete].forEach(T=>{T&&(T.addEventListener("click",z=>{z.target===T&&j(T)}),T.addEventListener("keydown",z=>{z.key==="Escape"&&j(T)}))});const X=(T,z=null)=>{if(!(!f||!x||!S)){if(ne(),se&&(se.textContent=""),f.dataset.mode=T,f.dataset.entryId=z?.id??"",x.dataset.originalLabel=e(T==="create"?"Guardar":"Actualizar"),S.textContent=x.dataset.originalLabel,P&&(P.textContent=e(T==="create"?"Nuevo movimiento":"Editar movimiento")),M&&(M.value=z?.movement_date??new Date().toISOString().slice(0,10)),L&&(L.value=z?.reference??""),E&&(E.value=z?.notes??""),a){const w=z?.origin_warehouse_id??"";a.renderOptions(u),a.setValue(w)}if(i){const w=z?.origin_warehouse_id??"",k=z?.destination_warehouse_id??"",Q=w?u.filter(ve=>ve.id!==w):u;i.renderOptions(Q),i.setValue(k)}V(),z?.items?.length?z.items.forEach(w=>D(w)):D()}},b=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},v=async()=>{if(!f||!x||!S)return;const T=_().filter(_e=>_e.product_id),z={movement_date:M?.value??"",reference:L?.value?.trim()||null,origin_warehouse_id:a?.value??"",destination_warehouse_id:i?.value??"",notes:E?.value?.trim()||null,items:T};if(!T.length&&se){se.textContent=e("Agrega al menos un producto al movimiento.");return}if(T.some(_e=>!_e.product_id||!Number.isInteger(_e.quantity)||_e.quantity<=0)){se&&(se.textContent=e("Cada producto debe tener una cantidad válida mayor que cero."));return}ne(),re(!0);const k=$(),Q=f.dataset.entryId??"",ve=k==="create"?m:`${d}/${Q}`,qe=k==="create"?"POST":"PATCH";try{const _e=await fetch(ve,{method:qe,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(z)}),Ce=await _e.json().catch(()=>null);if(!_e.ok){_e.status===422&&Ce?.errors?(r(Ce.errors),g({title:e("Hay errores en el formulario"),text:Ce?.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:Ce?.message??e("No fue posible guardar la información."),icon:"error"});return}if(!c.form){g({title:e("Datos actualizados"),text:Ce?.message??e(k==="create"?"El movimiento se registró correctamente.":"El movimiento se actualizó correctamente."),icon:"success"}).then(()=>{window.location.href=`${d}/${Ce?.data?.item?.id??Q}`}).catch(()=>{window.location.href=`${d}/${Ce?.data?.item?.id??Q}`});return}g({title:e("Datos actualizados"),text:Ce?.message??e(k==="create"?"El movimiento se registró correctamente.":"El movimiento se actualizó correctamente."),icon:"success"}).then(()=>{j(c.form),b()}).catch(()=>{j(c.form),b()})}catch(_e){console.error("[ProductTransfers] Submit error",_e),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{re(!1)}},H=async()=>{if(!c.delete||!J)return;const T=c.delete.dataset.productTransferId??"";if(!T){g({title:e("Error"),text:e("No se pudo determinar el movimiento a eliminar."),icon:"error"});return}J.disabled=!0,J.classList.add("cursor-not-allowed","opacity-70");try{const z=await fetch(`${d}/${T}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),w=await z.json().catch(()=>null);if(!z.ok){g({title:e("Error"),text:w?.message??e("No se pudo eliminar el movimiento."),icon:"error"});return}g({title:e("Datos actualizados"),text:w?.message??e("El movimiento se eliminó correctamente."),icon:"success"}),j(c.delete),b()}catch(z){console.error("[ProductTransfers] Delete error",z),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{J.disabled=!1,J.classList.remove("cursor-not-allowed","opacity-70")}};f&&f.addEventListener("submit",T=>{T.preventDefault(),v()}),J&&J.addEventListener("click",H),t.querySelector('form[action*="/store"][data-product-transfer-form]')&&X("create");const q=t.querySelector('form[method="POST"][data-product-transfer-form][data-entry-id]');if(q&&q.dataset.entryId){const T=q.dataset.entryId;fetch(`${d}/${T}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(z=>z.json()).then(z=>{z?.data?.item&&X("edit",z.data.item)}).catch(z=>{console.error("[ProductTransfers] Error loading edit data",z)})}t.addEventListener("click",T=>{const z=T.target instanceof Element?T.target.closest("[data-product-transfer-action], [data-action], [data-row-action]"):null;if(!z)return;if(z.hasAttribute("data-product-transfer-action")){z.dataset.productTransferAction==="create"&&(window.location.href=`${d}/create`);return}const w=z.dataset.action||z.dataset.rowAction,k=z.dataset.id||z.dataset.rowId,Q=z.dataset.name||z.dataset.rowName||"";if(!w||!k){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(w==="view"){window.location.href=`${d}/${k}`;return}if(w==="edit"){window.location.href=`${d}/${k}/edit`;return}if(w==="delete"){const ve=Q||k;c.delete&&(c.delete.dataset.productTransferId=k),Y&&(Y.textContent=ve||k),te(c.delete)}})},ms=()=>{const t=document.querySelector("[data-providers-root]");if(!t)return;const n=t.dataset.providersTableId??"",d=t.dataset.providersBaseUrl??"",m=t.dataset.providersStoreUrl??d,p=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",u={form:t.querySelector('[data-provider-modal="form"]'),view:t.querySelector('[data-provider-modal="view"]'),delete:t.querySelector('[data-provider-modal="delete"]')},o=u.form?.querySelector("[data-provider-form]")??null,c=u.form?.querySelector("[data-provider-submit]")??null,f=c?.querySelector("[data-provider-submit-label]")??null,x=u.form?.querySelector("[data-provider-modal-title]")??null,S=u.view?.querySelector("[data-provider-view]")??null,P=u.delete?.querySelector("[data-provider-delete-name]")??null,M=u.delete?.querySelector("[data-provider-delete-confirm]")??null,L=o?.querySelector('[data-provider-input="provider_type"]')??null,E=o?.querySelector('[data-provider-input="identification_type"]')??null,R=o?Array.from(o.querySelectorAll('[data-provider-section="individual"]')):[],A=o?Array.from(o.querySelectorAll('[data-provider-section="business"]')):[],B="overflow-hidden",ie=$=>$.closest("[data-provider-modal]"),se=$=>{$&&($.classList.remove("hidden"),document.body.classList.add(B))},Y=$=>{$&&($.classList.add("hidden"),t.querySelector("[data-provider-modal]:not(.hidden)")||document.body.classList.remove(B))};t.querySelectorAll("[data-provider-modal-close]").forEach($=>{$.addEventListener("click",()=>{const _=ie($);Y(_)})}),Object.values(u).forEach($=>{$&&($.addEventListener("click",_=>{_.target===$&&Y($)}),$.addEventListener("keydown",_=>{_.key==="Escape"&&Y($)}))});const J=$=>{const _=o?.querySelector(`[data-provider-input="${$}"]`)??null,te=o?.querySelector(`[data-provider-error="${$}"]`)??null,j=_ instanceof HTMLInputElement?_.closest("[data-select]"):null,X=j?.querySelector("[data-select-trigger]")??null;return{input:_,errorEl:te,selectRoot:j,trigger:X}},G=$=>{const{input:_,errorEl:te,selectRoot:j,trigger:X}=J($);te&&(te.textContent=""),_&&_.type!=="hidden"&&_.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),j&&(j.dataset.selectInvalid="false"),X?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")},me=($,_)=>{const{input:te,errorEl:j,selectRoot:X,trigger:b}=J($);j&&(j.textContent=_??""),te&&te.type!=="hidden"&&te.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),X&&(X.dataset.selectInvalid="true"),b?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")},le=()=>{o&&o.querySelectorAll("[data-provider-input]").forEach($=>{const _=$.getAttribute("data-provider-input");_&&G(_)})},pe=$=>{$&&Object.entries($).forEach(([_,te])=>{const j=Array.isArray(te)?te[0]:te;me(_,j??"")})},re=$=>{!c||!f||($?f.textContent="Procesando...":c.dataset.originalLabel&&(f.textContent=c.dataset.originalLabel),c.disabled=$)},ne=$=>{if(!($ instanceof HTMLInputElement))return;const _=$.closest("[data-select]");if(!_)return;const te=_.querySelector("[data-select-trigger]"),j=_.querySelector("[data-select-value]"),X=Array.from(_.querySelectorAll("[data-select-option]")),b=te?.dataset.selectPlaceholder??"";let v=b;X.forEach(H=>{const O=H.dataset.value===$.value&&$.value!=="";H.dataset.selected=O?"true":"false",O&&(v=H.dataset.label??H.textContent.trim())}),j&&(j.textContent=$.value?v:b),te?.classList.toggle("is-empty",!$.value)},r=($,_)=>{if(!o)return;const te=o.querySelector(`[data-provider-input="${$}"]`);te&&(te instanceof HTMLInputElement||te instanceof HTMLTextAreaElement)&&(te.value=_??"",ne(te))},a=$=>{if(!o)return"";const _=o.querySelector(`[data-provider-input="${$}"]`);return _&&(_ instanceof HTMLInputElement||_ instanceof HTMLTextAreaElement)?_.value.trim():""},i=($,_)=>{const te=(_??"").toUpperCase().replace(/\s+/g,"");return $==="CEDULA"?te.replace(/\D+/g,"").slice(0,10):$==="RUC"?te.replace(/\D+/g,"").slice(0,13):te.replace(/[^A-Z0-9]/g,"").slice(0,20)},s=$=>($??"").replace(/[^0-9+\-()\s]/g,""),l=()=>{if(!o)return;const _=(a("provider_type")||"individual")==="business";R.forEach(te=>{te.classList.toggle("hidden",_),te.querySelectorAll("[data-provider-input]").forEach(j=>{if((j instanceof HTMLInputElement||j instanceof HTMLTextAreaElement)&&(j.disabled=_,j.required=!_,_)){j.value="";const X=j.getAttribute("data-provider-input");X&&G(X)}})}),A.forEach(te=>{te.classList.toggle("hidden",!_),te.querySelectorAll("[data-provider-input]").forEach(j=>{if((j instanceof HTMLInputElement||j instanceof HTMLTextAreaElement)&&(j.disabled=!_,j.required=_,!_)){j.value="";const X=j.getAttribute("data-provider-input");X&&G(X)}})}),E instanceof HTMLInputElement&&(_&&E.value==="CEDULA"?r("identification_type","RUC"):!_&&E.value==="RUC"?r("identification_type","CEDULA"):ne(E))},y=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},h=($,_=null)=>{!o||!c||!f||(le(),re(!1),o.dataset.mode=$,o.dataset.providerId=_?.id??"",$==="create"?(o.reset(),r("status","A"),r("provider_type","individual"),r("identification_type","CEDULA"),r("identification_number",""),r("first_name",""),r("last_name",""),r("business_name",""),r("email",""),r("phone_number",""),x&&(x.textContent=e("Nuevo proveedor")),f.textContent=e("Guardar"),c.dataset.originalLabel=e("Guardar")):(x&&(x.textContent=e("Editar proveedor")),f.textContent=e("Actualizar"),c.dataset.originalLabel=e("Actualizar")),_&&(r("provider_type",_.provider_type??"individual"),r("identification_type",_.identification_type??"CEDULA"),r("identification_number",_.identification_number??""),r("first_name",_.first_name??""),r("last_name",_.last_name??""),r("business_name",_.business_name??""),r("email",_.email??""),r("phone_number",_.phone_number??""),r("status",_.status??"A")),l())},C=$=>{!S||!$||S.querySelectorAll("[data-provider-view-field]").forEach(_=>{const te=_.getAttribute("data-provider-view-field");if(!te)return;const j=$[te];_.textContent=j!=null&&j!==""?String(j):"-"})},D=async()=>{if(!o||!c||!f)return;const $=o.dataset.mode??"create",_=o.dataset.providerId??"",te=a("provider_type")||"individual",j=a("identification_type")||"CEDULA",X=i(j,a("identification_number")),b=a("email").toLowerCase(),v=s(a("phone_number")),H={provider_type:te,identification_type:j,identification_number:X,first_name:a("first_name"),last_name:a("last_name"),business_name:a("business_name"),email:b||null,phone_number:v||null,status:a("status")||"A"};H.provider_type==="business"?(H.first_name=null,H.last_name=null,H.business_name=H.business_name?H.business_name.toUpperCase():null):(H.first_name=H.first_name?H.first_name.toUpperCase():null,H.last_name=H.last_name?H.last_name.toUpperCase():null,H.business_name=null),le();const O={};if(H.identification_number?(H.identification_type==="CEDULA"&&!/^\d{10}$/.test(H.identification_number)&&(O.identification_number=e("Ingresa un número de cédula válido (10 dígitos).")),H.identification_type==="RUC"&&!/^\d{13}$/.test(H.identification_number)&&(O.identification_number=e("Ingresa un número de RUC válido (13 dígitos).")),H.identification_type==="PASAPORTE"&&!/^[A-Z0-9]{5,20}$/.test(H.identification_number)&&(O.identification_number=e("Ingresa un número de pasaporte válido (5-20 caracteres alfanuméricos)."))):O.identification_number=e("El número de identificación es obligatorio."),H.provider_type==="business"?H.business_name||(O.business_name=e("La razón social es obligatoria.")):(H.first_name||(O.first_name=e("El nombre es obligatorio.")),H.last_name||(O.last_name=e("El apellido es obligatorio."))),H.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(H.email)&&(O.email=e("Ingresa un correo electrónico válido.")),H.phone_number&&!/^[0-9+\-()\s]{6,}$/.test(H.phone_number)&&(O.phone_number=e("Ingresa un teléfono válido.")),Object.keys(O).length>0){pe(O),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}re(!0);const q=$==="create"?m:`${d}/${_}`,T=$==="create"?"POST":"PATCH";try{const z=await fetch(q,{method:T,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify(H)}),w=await z.json().catch(()=>null);if(!z.ok){z.status===422&&w?.errors?(pe(w.errors),g({title:e("Hay errores en el formulario"),text:w.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:w?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:w?.message??e("Acción realizada correctamente."),icon:"success"}),Y(u.form),y()}catch(z){console.error("[Providers] Submit error",z),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{re(!1)}},V=async()=>{if(!u.delete||!M)return;const $=u.delete.dataset.providerId;if(!$){Y(u.delete);return}M.disabled=!0,M.classList.add("cursor-not-allowed","opacity-70");try{const _=await fetch(`${d}/${$}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":p}}),te=await _.json().catch(()=>null);if(!_.ok){g({title:e("Error"),text:te?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:te?.message??e("Registro eliminado correctamente."),icon:"success"}),Y(u.delete),y()}catch(_){console.error("[Providers] Delete error",_),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{M.disabled=!1,M.classList.remove("cursor-not-allowed","opacity-70")}},N=async $=>{const _=$.dataset.id??"";if(!_||$.disabled)return;const te=!$.checked,j=$.checked?"A":"I";$.disabled=!0;try{const X=await fetch(`${d}/${_}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":p},body:JSON.stringify({status:j})}),b=await X.json().catch(()=>null);if(!X.ok){$.checked=te,g({title:e("Error"),text:b?.message??e("No se pudo actualizar el estado."),icon:"error"});return}g({title:e("Datos actualizados"),text:b?.message??e("El estado se modificó correctamente."),icon:"success"}),y()}catch(X){console.error("[Providers] Status toggle error",X),$.checked=te,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{$.disabled=!1}};o&&o.addEventListener("submit",$=>{$.preventDefault(),D()}),L instanceof HTMLInputElement&&L.addEventListener("change",()=>{l()}),E instanceof HTMLInputElement&&E.addEventListener("change",()=>{E.value=E.value.toUpperCase(),ne(E)}),M&&M.addEventListener("click",V),t.addEventListener("click",async $=>{const _=$.target instanceof Element?$.target.closest("[data-provider-action], [data-action], [data-row-action]"):null;if(!_)return;if(_.hasAttribute("data-provider-action")){_.dataset.providerAction==="create"&&(h("create"),se(u.form));return}const te=_.dataset.action||_.dataset.rowAction,j=_.dataset.id||_.dataset.rowId,X=_.dataset.name||_.dataset.rowName||"";if(!te||!j){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(te==="edit"){fetch(`${d}/${j}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(b=>b.json()).then(b=>{b?.data?.item?(h("edit",b.data.item),se(u.form)):g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})}).catch(b=>{console.error("[Providers] Fetch edit error",b),g({title:e("Error"),text:e("No se pudieron obtener los datos para editar."),icon:"error"})});return}if(te==="view"){fetch(`${d}/${j}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(b=>b.json()).then(b=>{b?.data?.item?(C(b.data.item),se(u.view)):g({title:e("Error"),text:e("No se pudieron obtener los datos para ver."),icon:"error"})}).catch(b=>{console.error("[Providers] Fetch view error",b),g({title:e("Error"),text:e("No se pudieron obtener los datos para ver."),icon:"error"})});return}if(te==="delete"){const b=X||j;u.delete&&(u.delete.dataset.providerId=j),P&&(P.textContent=b||j),se(u.delete)}}),t.addEventListener("change",$=>{const _=$.target;_ instanceof HTMLInputElement&&_.matches("[data-status-toggle]")&&N(_)}),l()},ys=()=>{const t=document.querySelector("[data-customers-root]");if(!t)return;const n=t.dataset.customersTableId??"",d=t.dataset.customersBaseUrl??"",m=t.dataset.customersStoreUrl??d,p=t.dataset.customersApiUrl??"",u=(t.dataset.customersType??"").toLowerCase(),o=u==="business",c=t.dataset.customersValidateDocumentUrl??"",f=t.dataset.customersValidateEmailUrl??"",x=t.dataset.customersCategoriesOptionsUrl??"";let S=[];try{S=JSON.parse(t.dataset.customersCategoriesOptions??"[]")??[]}catch(ee){console.warn("[Customers] Invalid categories options payload",ee)}Array.isArray(S)||(S=[]);const P=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"";console.info("[Customers] init",{tableId:n,baseUrl:d,apiUrl:p,presetCustomerType:u});const M=ee=>t.querySelector(ee)||document.querySelector(ee),L={form:M('[data-customer-modal="form"]'),view:M('[data-customer-modal="view"]'),delete:M('[data-customer-modal="delete"]')},E=L.form?.querySelector("[data-customer-form]")??null,R=L.form?.querySelector("[data-customer-submit]")??null,A=R?.querySelector("[data-customer-submit-label]")??null,B=L.form?.querySelector("[data-customer-modal-title]")??null,ie=L.view?.querySelector("[data-customer-view]")??null,se=L.delete?.querySelector("[data-customer-delete-name]")??null,Y=L.delete?.querySelector("[data-customer-delete-confirm]")??null,J=L.delete?.querySelector("[data-customer-delete-id]")??null;console.log("[Customers] delete references",{deleteModal:L.delete,deleteConfirmButton:Y,deleteIdInput:J});const G=E?.querySelector('[data-customer-input="customer_type"]')??null,me=E?.querySelector('[data-customer-input="document_type"]')??null,le=E?.querySelector('[data-customer-input="document_number"]')??null,pe=E?.querySelector('[data-customer-input="email"]')??null,re=E?.querySelector('[data-customer-input="first_name"]')??null,ne=E?.querySelector('[data-customer-input="last_name"]')??null,r=E?.querySelector('[data-customer-input="business_name"]')??null,a=E?.querySelector('[data-customer-input="phone_number"]')??null,i=E?.querySelector('[data-customer-input="category_id"]')??null,s=E?.querySelector('[data-customer-input="sex"]')??null,l=E?.querySelector('[data-customer-input="birth_date"]')??null,y=E?.querySelector('[data-customer-input="portal_password"]')??null,h=E?.querySelector("[data-customer-password-toggle]")??null,C=E?.querySelector('[data-customer-input="b2b_access"]')??null,D=E?.querySelector('[data-customer-input="b2c_access"]')??null,V=E?.querySelector('[data-customer-toggle="b2b_access"]')??null,N=E?.querySelector('[data-customer-toggle="b2c_access"]')??null,$=E?.querySelector('[data-customer-toggle-label="b2b_access"]')??null,_=E?.querySelector('[data-customer-toggle-label="b2c_access"]')??null,te=E?.querySelector("[data-customer-category-options]")??null,j=i?.closest("[data-select]")??null,X=j?.querySelector("[data-select-trigger]")??null,b=j?.querySelector("[data-select-dropdown]")??null,v=j?.querySelector("[data-select-icon]")??null,H=E?.querySelector("[data-customer-type-wrapper]")??null,O="overflow-hidden",q={document_number:null,email:null};let T={value:null,available:null,message:""},z={value:null,available:null,message:""};e("Masculino"),e("Femenino"),e("Otro");const w={b2b_access:{input:C,button:V,label:$},b2c_access:{input:D,button:N,label:_}},k=ee=>{if(!(y instanceof HTMLInputElement))return;const ae=!!ee;y.type=ae?"text":"password",h instanceof HTMLElement&&(h.dataset.state=ae?"visible":"hidden",h.setAttribute("aria-pressed",ae?"true":"false"),h.innerHTML=ae?'<i class="fa-solid fa-eye-slash"></i>':'<i class="fa-solid fa-eye"></i>',h.setAttribute("aria-label",e(ae?"Ocultar clave":"Mostrar clave")))},Q=(ee,ae)=>{const ue=w[ee];if(!ue?.input)return;const Oe=!!ae;if(ue.input.value=Oe?"1":"0",ue.button){ue.button.dataset.active=Oe?"true":"false",ue.button.setAttribute("aria-pressed",Oe?"true":"false"),ue.button.classList.toggle("bg-primary",Oe),ue.button.classList.toggle("border-primary",Oe),ue.button.classList.toggle("shadow-lg",Oe),ue.button.classList.toggle("bg-gray-200",!Oe),ue.button.classList.toggle("border-gray-300",!Oe),ue.button.classList.toggle("dark:bg-primary",Oe),ue.button.classList.toggle("dark:border-primary",Oe),ue.button.classList.toggle("dark:bg-slate-700",!Oe),ue.button.classList.toggle("dark:border-gray-600",!Oe);const He=ue.button.querySelector("[data-customer-toggle-handle]");He&&(He.dataset.active=Oe?"true":"false")}ue.label&&(ue.label.textContent=e(Oe?"Activo":"Inactivo"))},ve=ee=>{const ae=w[ee];if(!ae?.input)return!1;const ue=ae.input.value;return ue==="1"||ue===1||ue===!0||ue==="true"},qe=ee=>{Q(ee,!ve(ee))},_e=ee=>ee.closest("[data-customer-modal]"),Ce=ee=>{ee&&(ee.classList.remove("hidden"),document.body.classList.add(O))},Le=ee=>{ee&&(ee.classList.add("hidden"),ee===L.delete&&(ee.dataset.customerId="",J&&(J.value=""),Y&&(Y.dataset.customerId="")),t.querySelector("[data-customer-modal]:not(.hidden)")||document.body.classList.remove(O))};t.querySelectorAll("[data-customer-modal-close]").forEach(ee=>{ee.addEventListener("click",()=>{const ae=_e(ee);Le(ae)})}),Object.values(L).forEach(ee=>{ee&&(ee.addEventListener("click",ae=>{ae.target===ee&&Le(ee)}),ee.addEventListener("keydown",ae=>{ae.key==="Escape"&&Le(ee)}))});const Ve=()=>{E&&E.querySelectorAll("[data-customer-input]").forEach(ee=>{const ae=ee.getAttribute("data-customer-input");ae&&I(ae)})},Ge=ee=>{!E||!ee||Object.entries(ee).forEach(([ae,ue])=>{const Oe=Array.isArray(ue)?ue[0]:ue;K(ae,Oe??"")})},Te=ee=>{const ae=E?.querySelector(`[data-customer-input="${ee}"]`)??null,ue=E?.querySelector(`[data-customer-error="${ee}"]`)??null,Oe=ae instanceof HTMLInputElement?ae.closest("[data-select]"):null,He=Oe?.querySelector("[data-select-trigger]")??null,De=E?.querySelector(`[data-customer-valid-icon="${ee}"]`)??null;return{input:ae,errorEl:ue,selectRoot:Oe,trigger:He,icon:De}},Z=(ee,ae)=>{const{icon:ue}=Te(ee);ue&&ue.classList.toggle("opacity-0",!ae)},I=ee=>{const{input:ae,errorEl:ue,selectRoot:Oe,trigger:He}=Te(ee);ue&&(ue.textContent=""),ae&&ae.type!=="hidden"&&ae.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),Oe&&(Oe.dataset.selectInvalid="false",He?.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")),Z(ee,!1)},K=(ee,ae)=>{const{input:ue,errorEl:Oe,selectRoot:He,trigger:De}=Te(ee);Oe&&(Oe.textContent=ae??""),ue&&ue.type!=="hidden"&&ue.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200"),He&&(He.dataset.selectInvalid="true",De?.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")),Z(ee,!1)},ye=ee=>{I(ee),Z(ee,!0)},xe=ee=>{!R||!A||(ee?A.textContent="Procesando...":R.dataset.originalLabel&&(A.textContent=R.dataset.originalLabel),R.disabled=ee)},Ie=(ee,ae)=>{if(!E)return;const ue=E.querySelector(`[data-customer-input="${ee}"]`);ue&&((ue instanceof HTMLInputElement||ue instanceof HTMLTextAreaElement||ue instanceof HTMLSelectElement)&&(ue.value=ae??""),Ne(ue))},we=ee=>{if(!E)return"";const ae=E.querySelector(`[data-customer-input="${ee}"]`);return ae&&(ae instanceof HTMLInputElement||ae instanceof HTMLTextAreaElement||ae instanceof HTMLSelectElement)?ae.value.trim():""},Ne=ee=>{if(!(ee instanceof HTMLInputElement))return;const ae=ee.closest("[data-select]");if(!ae)return;const ue=ae.querySelector("[data-select-trigger]"),Oe=ae.querySelector("[data-select-value]"),He=Array.from(ae.querySelectorAll("[data-select-option]")),De=ue?.dataset.selectPlaceholder??"";let Fe=De;He.forEach(Ke=>{const dt=Ke.dataset.value===ee.value&&ee.value!=="";Ke.dataset.selected=dt?"true":"false",dt&&(Fe=Ke.dataset.label??Ke.textContent.trim())}),Oe&&(Oe.textContent=ee.value?Fe:De),ue?.classList.toggle("is-empty",!ee.value)},Je=()=>{!j||!X||!b||(b.hidden=!0,b.dataset.open="false",j.dataset.open="false",X.setAttribute("aria-expanded","false"),v?.classList.remove("rotate-180"))},Xe=ee=>{te&&te.querySelectorAll("[data-select-option]").forEach(ae=>{ae.dataset.selected=ae.dataset.value===ee?"true":"false"})},Qe=(ee=[])=>{if(!(te instanceof HTMLElement)||!(i instanceof HTMLInputElement))return;const ae=Array.isArray(ee)?ee:[];if(te.innerHTML="",ae.length===0){const ue=document.createElement("p");ue.className="px-4 py-2 text-sm text-secondary",ue.textContent=e("No hay categorías disponibles."),te.appendChild(ue),i.value="",Ne(i);return}ae.forEach(ue=>{const Oe=String(ue?.id??""),He=ue?.name??"",De=document.createElement("button");De.type="button",De.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",De.dataset.selectOption="",De.dataset.value=Oe,De.dataset.label=He,De.dataset.selected=i.value===Oe?"true":"false",De.innerHTML=`<span class="truncate">${He}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,De.addEventListener("click",Fe=>{Fe.preventDefault(),Ie("category_id",Oe),Je(),X?.focus({preventScroll:!0})}),te.appendChild(De)}),Xe(i.value),Ne(i)},Ue=async()=>{if(!x)return Qe(S),S;try{const ee=`${x}${x.includes("?")?"&":"?"}per_page=200`,ae=await fetch(ee,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}),ue=await ae.json().catch(()=>null);if(!ae.ok||!ue?.data?.items)throw new Error("Invalid response");S=Array.isArray(ue.data.items)?ue.data.items:[]}catch(ee){console.error("[Customers] Error loading categories options",ee),g({title:e("Error"),text:e("No fue posible cargar las categorías."),icon:"error"})}finally{Qe(S)}return S},ze=()=>{if(!n){console.warn("[Customers] refresh without tableId"),window.dispatchEvent(new CustomEvent("datatable-refresh"));return}console.info("[Customers] refresh",{tableId:n}),window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},Ze=(ee,ae=null)=>{if(!E||!R||!A)return;Ve(),xe(!1),E.dataset.mode=ee,E.dataset.customerId=ae?.id??"",E.dataset.hasPortalPassword=ae?.has_portal_password?"true":"false",Q("b2b_access",!!ae?.b2b_access),Q("b2c_access",!!ae?.b2c_access),y instanceof HTMLInputElement&&(y.value=""),k(!1);const ue=De=>{i instanceof HTMLInputElement&&(i.value=De??"",Ne(i))},Oe=()=>{ee==="create"?S.length>0?ue(S[0]?.id??""):ue(""):ue(ae?.category_id??"")},He=()=>{Ue().then(()=>{Oe()}).catch(()=>{Oe()})};if(ee==="create"){E.reset();const De=u&&["individual","business"].includes(u)?u:"individual";Ie("customer_type",De),Ie("document_type",De==="business"?"RUC":"CEDULA"),Ie("document_number",""),Ie("first_name",""),Ie("last_name",""),Ie("business_name",""),Ie("email",""),Ie("phone_number",""),Ie("address",""),Ie("status","A"),Ie("category_id",""),Ie("sex",""),Ie("birth_date",""),B&&(B.textContent=e(o?"Nueva empresa":"Nuevo cliente")),A.textContent=e("Guardar"),R.dataset.originalLabel=e("Guardar")}else Ie("customer_type",ae?.customer_type??"individual"),Ie("document_type",ae?.document_type??"RUC"),Ie("document_number",ae?.document_number??""),Ie("first_name",ae?.first_name??""),Ie("last_name",ae?.last_name??""),Ie("business_name",ae?.business_name??""),Ie("email",ae?.email??""),Ie("phone_number",ae?.phone_number??""),Ie("address",ae?.address??""),Ie("status",ae?.status??"A"),Ie("category_id",ae?.category_id??""),Ie("sex",ae?.sex??""),Ie("birth_date",ae?.birth_date??""),B&&(B.textContent=e(o?"Editar empresa":"Editar cliente")),A.textContent=e("Actualizar"),R.dataset.originalLabel=e("Actualizar");He(),de(),["customer_type","document_type"].forEach(De=>{const Fe=E.querySelector(`[data-customer-input="${De}"]`);Fe instanceof HTMLInputElement&&Ne(Fe)}),s instanceof HTMLInputElement&&Ne(s),at()},mt=ee=>{!ie||!ee||ie.querySelectorAll("[data-customer-view-field]").forEach(ae=>{const ue=ae.getAttribute("data-customer-view-field");if(!ue)return;const Oe=ee[ue];let He=Oe!=null&&Oe!==""?String(Oe):"-";ue==="category_name"&&(He=Oe?String(Oe):"-"),ae.textContent=He})},it=()=>(we("document_type")||"").toUpperCase(),ct=()=>it()==="RUC"?"business":"individual",at=()=>{if(!E)return;const ee=ct(),ae=it(),ue=ee==="individual",Oe=ee==="business";E.querySelectorAll('[data-customer-section="individual"]').forEach(He=>{const De=ue;He.classList.toggle("hidden",!De),He.querySelectorAll("[data-customer-input]").forEach(Fe=>{if(!(Fe instanceof HTMLInputElement||Fe instanceof HTMLTextAreaElement||Fe instanceof HTMLSelectElement))return;const Ke=Fe.getAttribute("data-customer-input")??"";Fe.disabled=!De,Fe.required=De&&["first_name","last_name"].includes(Ke),De||(Fe.value="",Fe instanceof HTMLInputElement&&Ne(Fe),Ke&&I(Ke))})}),E.querySelectorAll('[data-customer-section="business"]').forEach(He=>{const De=Oe;He.classList.toggle("hidden",!De),He.querySelectorAll("[data-customer-input]").forEach(Fe=>{if(!(Fe instanceof HTMLInputElement||Fe instanceof HTMLTextAreaElement||Fe instanceof HTMLSelectElement))return;const Ke=Fe.getAttribute("data-customer-input")??"";Fe.disabled=!De,Fe.required=De&&Ke==="business_name",De||(Fe.value="",Ke&&I(Ke))})}),s instanceof HTMLInputElement&&ae==="RUC"&&(s.value="",Ne(s),I("sex")),l instanceof HTMLInputElement&&ae==="RUC"&&(l.value="",I("birth_date"))},de=()=>{if(G instanceof HTMLInputElement){if(!u||!["individual","business"].includes(u)){G.disabled=!1,H?.classList.remove("hidden");return}G.value=u,Ne(G),G.disabled=!0,H&&H.classList.add("hidden"),at()}};de(),Qe(S);const oe=ee=>typeof ee=="string"?ee:(ee??"").toString(),fe=(ee="")=>oe(ee).replace(/[^A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s]/g,"").replace(/\s+/g," ").trim(),ge=(ee="")=>oe(ee).replace(/\s+/g," ").trim(),Ae=(ee="")=>oe(ee).trim().toLowerCase(),$e=(ee="")=>oe(ee).replace(/\D+/g,""),Re=(ee="",ae="RUC")=>{const ue=oe(ee).toUpperCase();return ae==="CEDULA"?ue.replace(/\D+/g,"").slice(0,10):ae==="RUC"?ue.replace(/\D+/g,"").slice(0,13):ue.replace(/[^A-Z0-9]/g,"").slice(0,20)},U=ee=>{const ae=fe(ee);return ae.length?ae.toUpperCase():null},F=ee=>{const ae=ge(ee);return ae.length?ae.toUpperCase():null},W=ee=>{const ae=Ae(ee??"");return ae.length?ae:null},ce=ee=>{const ae=$e(ee??"");return ae.length?ae:null},be=(ee,ae=we("document_type")||"RUC")=>{const ue=Re(ee??"",ae);return ue.length?ue:""},Ee=ee=>{const ae=fe(ee.target.value).toUpperCase();ee.target.value!==ae&&(ee.target.value=ae)},Se=ee=>{const ae=ge(ee.target.value).toUpperCase();ee.target.value!==ae&&(ee.target.value=ae)},Me=ee=>{const ae=$e(ee.target.value);ee.target.value!==ae&&(ee.target.value=ae)},ke=ee=>{const ae=Ae(ee.target.value);ee.target.value!==ae&&(ee.target.value=ae)},Pe=()=>{if(!le)return;const ee=we("document_type")||"RUC",ae=Re(le.value??"",ee);le.value!==ae&&(le.value=ae),I("document_number"),Z("document_number",!1),T={value:null,available:null,message:""}},Be=(ee,ae)=>ae?ee==="CEDULA"?/^\d{10}$/.test(ae):ee==="RUC"?/^\d{13}$/.test(ae):ee==="PASAPORTE"?/^[A-Z0-9]{5,20}$/.test(ae):ae.length>0:!1,je=ee=>{ct();const ae=it(),ue=ae!=="RUC";switch(ee){case"customer_type":return we("customer_type")?(I("customer_type"),!0):(K("customer_type",e("Selecciona un tipo de cliente.")),!1);case"category_id":return we("category_id")?(I("category_id"),!0):(K("category_id",e("Selecciona una categoría.")),!1);case"first_name":{if(!ue)return I("first_name"),!0;const Oe=we("first_name");return Oe?/^[A-ZÁÉÍÓÚÜÑ\s]+$/.test(Oe)?(I("first_name"),!0):(K("first_name",e("Solo se permiten letras y espacios.")),!1):(K("first_name",e("Ingresa los nombres del cliente.")),!1)}case"last_name":{if(!ue)return I("last_name"),!0;const Oe=we("last_name");return Oe?/^[A-ZÁÉÍÓÚÜÑ\s]+$/.test(Oe)?(I("last_name"),!0):(K("last_name",e("Solo se permiten letras y espacios.")),!1):(K("last_name",e("Ingresa los apellidos del cliente.")),!1)}case"business_name":return ae!=="RUC"||we("business_name")?(I("business_name"),!0):(K("business_name",e("Ingresa la razón social.")),!1);case"email":{const Oe=we("email");return Oe?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Oe)?(I("email"),Z("email",!1),!0):(K("email",e("Ingresa un correo electrónico válido.")),!1):(I("email"),Z("email",!1),!0)}case"phone_number":{const Oe=we("phone_number");return Oe?/^\d+$/.test(Oe)?(I("phone_number"),!0):(K("phone_number",e("Ingresa un número telefónico válido.")),!1):(I("phone_number"),!0)}case"sex":{if(!ue)return I("sex"),!0;const Oe=we("sex");return Oe?["MASCULINO","FEMENINO","OTRO"].includes(Oe)?(I("sex"),!0):(K("sex",e("Selecciona un sexo válido.")),!1):(I("sex"),!0)}case"birth_date":{if(!ue)return I("birth_date"),!0;const Oe=we("birth_date");if(!Oe)return I("birth_date"),!0;const He=new Date(Oe);return Number.isNaN(He.getTime())||He>new Date?(K("birth_date",e("Ingresa una fecha de nacimiento válida.")),!1):(I("birth_date"),!0)}default:return!0}},Ye=async()=>{if(!le||!c)return;const ee=we("document_type")||"RUC",ae=be(le.value,ee);if(le.value!==ae&&(le.value=ae),!ae){I("document_number");return}if(T.value===ae&&T.available!==null){T.available?ye("document_number"):K("document_number",T.message||e("El número de documento ya está registrado."));return}q.document_number&&q.document_number.abort();const ue=new AbortController;q.document_number=ue;try{console.info("[Customers] validate document",{docType:ee,documentNumber:ae});const Oe=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":P},body:JSON.stringify({document_type:ee,document_number:ae,customer_id:E?.dataset.customerId??null}),signal:ue.signal}),He=await Oe.json().catch(()=>null);if(ue.signal.aborted)return;if(!Oe.ok||!He?.data)throw console.error("[Customers] validate document failed",{response:Oe,json:He}),new Error(He?.message??"");const De=!!He.data.available;T={value:ae,available:De,message:He.message??""},De?ye("document_number"):K("document_number",He.message??e("El número de documento ya está registrado."))}catch(Oe){if(Oe.name==="AbortError")return;T={value:ae,available:null,message:""},K("document_number",e("No fue posible validar el número de documento."))}finally{ue.signal.aborted||(q.document_number=null)}},yt=async()=>{if(!pe||!f)return;const ee=W(pe.value);if(pe.value!==(ee??"")&&(pe.value=ee??""),!ee){I("email"),Z("email",!1);return}if(z.value===ee&&z.available!==null){z.available?ye("email"):K("email",z.message||e("El correo electrónico ya está registrado."));return}q.email&&q.email.abort();const ae=new AbortController;q.email=ae;try{console.info("[Customers] validate email",{emailValue:ee});const ue=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":P},body:JSON.stringify({email:ee,customer_id:E?.dataset.customerId??null}),signal:ae.signal}),Oe=await ue.json().catch(()=>null);if(ae.signal.aborted)return;if(!ue.ok||!Oe?.data)throw console.error("[Customers] validate email failed",{response:ue,json:Oe}),new Error(Oe?.message??"");const He=!!Oe.data.available;z={value:ee,available:He,message:Oe.message??""},He?ye("email"):K("email",Oe.message??e("El correo electrónico ya está registrado."))}catch(ue){if(ue.name==="AbortError")return;z={value:ee,available:null,message:""},K("email",e("No fue posible validar el correo electrónico."))}finally{ae.signal.aborted||(q.email=null)}},ut=async()=>{if(!E||!R||!A)return;const ee=E.dataset.mode??"create",ae=E.dataset.customerId??"",ue={category_id:we("category_id")||null,customer_type:we("customer_type")||"individual",document_type:we("document_type")||"RUC",document_number:we("document_number"),first_name:we("first_name")||null,last_name:we("last_name")||null,business_name:we("business_name")||null,sex:we("sex")||null,birth_date:we("birth_date")||null,email:we("email")||null,phone_number:we("phone_number")||null,address:we("address")||null,status:we("status")||"A",portal_password:we("portal_password")||null,b2b_access:ve("b2b_access")?1:0,b2c_access:ve("b2c_access")?1:0},Oe=(ue.document_type||"RUC").toUpperCase();ue.document_type=Oe;const He=Oe==="RUC"?"business":"individual";ue.customer_type=He,ue.document_number=be(ue.document_number,ue.document_type),le&&(le.value=ue.document_number??""),ue.email=W(ue.email),pe&&(pe.value=ue.email??""),ue.phone_number=ce(ue.phone_number),a&&(a.value=ue.phone_number??""),ue.sex=He==="individual"&&ue.sex?ue.sex.toString().toUpperCase():null,s instanceof HTMLInputElement&&(s.value=ue.sex??"",Ne(s)),ue.birth_date=He==="individual"&&ue.birth_date?ue.birth_date:null,l instanceof HTMLInputElement&&(l.value=ue.birth_date??"");const De={...ue};Object.prototype.hasOwnProperty.call(De,"portal_password")&&(De.portal_password=De.portal_password?"***":De.portal_password),console.info("[Customers] submit",{mode:ee,customerId:ae,payload:De}),Ve();const Fe={},Ke=He;ue.customer_type||(Fe.customer_type=e("Selecciona un tipo de cliente.")),ue.category_id||(Fe.category_id=e("Selecciona una categoría.")),ue.sex&&!["MASCULINO","FEMENINO","OTRO"].includes(ue.sex)&&(Fe.sex=e("Selecciona un sexo válido."));const dt=!!ue.b2b_access||!!ue.b2c_access,Ur=E?.dataset.hasPortalPassword==="true";if(dt&&!ue.email&&(Fe.email=e("Registra un correo electrónico para habilitar el acceso al portal.")),dt&&(ee==="create"&&!ue.portal_password&&(Fe.portal_password=e("Define una clave para el portal.")),ee==="update"&&!ue.portal_password&&!Ur&&(Fe.portal_password=e("Define una clave para el portal."))),Ke==="individual"?(ue.first_name=U(ue.first_name),ue.last_name=U(ue.last_name),re&&(re.value=ue.first_name??""),ne&&(ne.value=ue.last_name??""),ue.first_name||(Fe.first_name=e("Ingresa los nombres del cliente.")),ue.last_name||(Fe.last_name=e("Ingresa los apellidos del cliente.")),ue.business_name=null):Ke==="business"&&(ue.business_name=F(ue.business_name),r&&(r.value=ue.business_name??""),ue.business_name||(Fe.business_name=e("Ingresa la razón social.")),ue.first_name=null,ue.last_name=null),ue.document_number&&Be(ue.document_type,ue.document_number)||(Fe.document_number=e("Ingresa un número de documento válido.")),ue.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(ue.email)&&(Fe.email=e("Ingresa un correo electrónico válido.")),ue.phone_number&&!/^\d+$/.test(ue.phone_number)&&(Fe.phone_number=e("Ingresa un número telefónico válido.")),ue.birth_date){const gt=new Date(ue.birth_date);(Number.isNaN(gt.getTime())||gt>new Date)&&(Fe.birth_date=e("Ingresa una fecha de nacimiento válida."))}if(Object.keys(Fe).length>0){Ge(Fe),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}ue.portal_password||delete ue.portal_password,xe(!0);const Qt=ee==="create"?m:`${d}/${ae}`,Zt=ee==="create"?"POST":"PATCH";try{console.info("[Customers] submit request",{url:Qt,method:Zt});const gt=await fetch(Qt,{method:Zt,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":P},body:JSON.stringify(ue)}),Et=await gt.json().catch(()=>null);if(!gt.ok){console.error("[Customers] submit failed",{response:gt,json:Et}),gt.status===422&&Et?.errors?(Ge(Et.errors),g({title:e("Hay errores en el formulario"),text:Et.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:Et?.message??e("No fue posible guardar la información."),icon:"error"});return}console.info("[Customers] submit success"),g({title:e("Datos actualizados"),text:Et?.message??e("Acción realizada correctamente."),icon:"success"}),Le(L.form),ze()}catch(gt){console.error("[Customers] Submit error",gt),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{xe(!1)}},lt=async()=>{if(!L.delete||!Y)return;const ee=(Y?.dataset.customerId??"").trim()||(J?.value??"").trim()||L.delete.dataset.customerId||"";if(console.log("[Customers] handleDelete invoked",{customerId:ee,datasetId:L.delete?.dataset.customerId,inputValue:J?.value,buttonDataset:Y?.dataset.customerId}),!ee){console.warn("[Customers] handleDelete without customerId, aborting"),Le(L.delete);return}Y.disabled=!0,console.log("[Customers] handleDelete request start"),Y.classList.add("cursor-not-allowed","opacity-70");try{console.info("[Customers] delete",{customerId:ee}),console.log("[Customers] delete request",`${d}/${ee}`);const ae=await fetch(`${d}/${ee}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":P}}),ue=await ae.json().catch(()=>null);if(!ae.ok){console.error("[Customers] delete failed",{response:ae,json:ue}),g({title:e("Error"),text:ue?.message??e("No se pudo eliminar el registro."),icon:"error"});return}console.info("[Customers] delete success",{customerId:ee}),console.log("[Customers] delete response",ue),g({title:e("Datos actualizados"),text:ue?.message??e("Registro eliminado correctamente."),icon:"success"}),Le(L.delete),ze()}catch(ae){console.error("[Customers] Delete error",ae),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{Y.disabled=!1,Y.classList.remove("cursor-not-allowed","opacity-70")}},et=async ee=>{const ae=ee.dataset.id??"";if(!ae||ee.disabled)return;const ue=!ee.checked,Oe=ee.checked?"A":"I";ee.disabled=!0;try{console.info("[Customers] toggle status",{customerId:ae,newStatus:Oe});const He=await fetch(`${d}/${ae}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":P},body:JSON.stringify({status:Oe})}),De=await He.json().catch(()=>null);if(!He.ok){console.error("[Customers] toggle failed",{response:He,json:De}),ee.checked=ue,g({title:e("Error"),text:De?.message??e("No se pudo actualizar el estado."),icon:"error"});return}console.info("[Customers] toggle success",{customerId:ae,newStatus:Oe}),g({title:e("Datos actualizados"),text:De?.message??e("El estado se modificó correctamente."),icon:"success"}),ze()}catch(He){console.error("[Customers] Status toggle error",He),ee.checked=ue,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}finally{ee.disabled=!1}};E&&(E.addEventListener("submit",ee=>{ee.preventDefault(),ut()}),["b2b_access","b2c_access"].forEach(ee=>{w[ee].button?.addEventListener("click",ue=>{ue.preventDefault(),qe(ee),I(ee)})}),h instanceof HTMLElement&&h.addEventListener("click",ee=>{ee.preventDefault();const ae=h.dataset.state==="visible";k(!ae)}),G instanceof HTMLInputElement&&G.addEventListener("change",()=>{I("customer_type");const ee=(G.value||"").toLowerCase();if(me instanceof HTMLInputElement){const ae=it();ee==="business"&&ae!=="RUC"?(Ie("document_type","RUC"),Ne(me),me.dispatchEvent(new Event("change",{bubbles:!0}))):ee!=="business"&&ae==="RUC"&&(Ie("document_type","CEDULA"),Ne(me),me.dispatchEvent(new Event("change",{bubbles:!0})))}at(),Ne(G),je("customer_type"),je("first_name"),je("last_name"),je("business_name")}),me instanceof HTMLInputElement&&me.addEventListener("change",()=>{Pe(),Ne(me);const ee=it();if(G instanceof HTMLInputElement&&!G.disabled){const ae=ee==="RUC"?"business":"individual";(G.value||"").toLowerCase()!==ae&&(Ie("customer_type",ae),Ne(G))}at(),I("customer_type"),Ye(),["first_name","last_name","business_name","sex","birth_date"].forEach(ae=>{I(ae),je(ae)})}),le instanceof HTMLInputElement&&(le.addEventListener("input",()=>{Pe()}),le.addEventListener("blur",()=>{const ee=be(le.value),ae=we("document_type");if(!ee){I("document_number"),Z("document_number",!1);return}if(le.value=ee,!Be(ae,ee)){K("document_number",e("Ingresa un número de documento válido."));return}Ye()})),i instanceof HTMLInputElement&&i.addEventListener("change",()=>{I("category_id"),Ne(i),je("category_id")}),s instanceof HTMLInputElement&&s.addEventListener("change",()=>{const ee=we("sex");Ie("sex",ee?ee.toUpperCase():""),I("sex"),je("sex")}),l instanceof HTMLInputElement&&l.addEventListener("change",()=>{je("birth_date")}),y instanceof HTMLInputElement&&y.addEventListener("input",()=>{I("portal_password")}),pe instanceof HTMLInputElement&&(pe.addEventListener("input",ee=>{ke(ee),I("email"),z={value:null,available:null,message:""}}),pe.addEventListener("blur",()=>{je("email")&&yt()})),re instanceof HTMLInputElement&&(re.addEventListener("input",ee=>{Ee(ee),I("first_name")}),re.addEventListener("blur",()=>{je("first_name")})),ne instanceof HTMLInputElement&&(ne.addEventListener("input",ee=>{Ee(ee),I("last_name")}),ne.addEventListener("blur",()=>{je("last_name")})),r instanceof HTMLInputElement&&(r.addEventListener("input",ee=>{Se(ee),I("business_name")}),r.addEventListener("blur",()=>{je("business_name")})),a instanceof HTMLInputElement&&(a.addEventListener("input",ee=>{Me(ee),I("phone_number")}),a.addEventListener("blur",()=>{je("phone_number")})),at()),Y&&Y.addEventListener("click",lt),t.addEventListener("click",ee=>{const ae=ee.target instanceof Element?ee.target.closest("[data-customer-action], [data-row-action], [data-action]"):null;if(!ae)return;if(ae.hasAttribute("data-customer-action")){ae.dataset.customerAction==="create"&&(Ze("create"),Ce(L.form));return}const ue=ae.dataset.action||ae.dataset.action||ae.dataset.rowAction,Oe=ae.dataset.rowPayload,He=ae.dataset.id||ae.dataset.id||ae.dataset.rowId,De=ae.dataset.name||ae.dataset.name||ae.dataset.rowName;let Fe=Oe?rt(Oe):null;if(!Fe&&He&&(Fe={id:He,display_name:De??null,name:De??null}),!ue||!Fe?.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}if(ue==="view"){fetch(`${d}/${Fe.id}`,{headers:{Accept:"application/json"}}).then(Ke=>Ke.json()).then(Ke=>{const dt=Ke?.data?.item??Ke?.data??Ke;mt(dt),Ce(L.view)}).catch(Ke=>{console.error("[Customers] Error fetching customer data",Ke),g({title:e("Error"),text:e("No se pudo cargar la información del cliente."),icon:"error"})});return}if(ue==="edit"){fetch(`${d}/${Fe.id}`,{headers:{Accept:"application/json"}}).then(Ke=>Ke.json()).then(Ke=>{const dt=Ke?.data?.item??Ke?.data??Ke;Ze("edit",dt),Ce(L.form)}).catch(Ke=>{console.error("[Customers] Error fetching customer data",Ke),g({title:e("Error"),text:e("No se pudo cargar la información del cliente."),icon:"error"})});return}if(ue==="delete"){const Ke=Fe.id??"",dt=Fe.display_name??Fe.name??De??"";console.log("[Customers] open delete modal",{idValue:Ke,nameValue:dt,data:Fe}),L.delete&&(L.delete.dataset.customerId=Ke),J&&(J.value=Ke),Y&&(Y.dataset.customerId=Ke),se&&(se.textContent=dt),Ce(L.delete)}}),t.addEventListener("change",ee=>{const ae=ee.target;ae instanceof HTMLInputElement&&ae.matches("[data-status-toggle]")&&et(ae)})},gs=()=>{const t=document.querySelector("[data-workshop-orders-root]");if(!t)return;const n=t.dataset.workshopOrdersTableId??"",d=t.dataset.workshopOrdersBaseUrl??"",m=t.dataset.workshopOrdersStoreUrl??d;t.dataset.workshopOrdersOptionsUrl;const p=t.dataset.workshopOrdersCustomersUrl??"",u=t.dataset.workshopOrdersEquipmentsUrl??"",o=t.dataset.workshopOrdersResponsiblesUrl??"",c=t.dataset.workshopOrdersAccessoriesUrl??"",f=t.dataset.workshopOrdersAccessoriesCreateUrl??"";t.dataset.workshopOrdersCategoriesUrl,t.dataset.workshopOrdersStatesUrl;const x=t.dataset.workshopOrdersCustomerCreateUrl??"",S=t.dataset.workshopOrdersEquipmentCreateUrl??"",P=t.dataset.workshopOrdersResponsibleCreateUrl??"",M=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",L={form:t.querySelector('[data-workshop-order-modal="form"]'),view:t.querySelector('[data-workshop-order-modal="view"]'),delete:t.querySelector('[data-workshop-order-modal="delete"]'),accessoryCreate:t.querySelector('[data-workshop-order-modal="accessory-create"]')},E=L.form?.querySelector("[data-workshop-order-form]")??null,R=L.form?.querySelector("[data-workshop-order-submit]")??null,A=R?.querySelector("[data-workshop-order-submit-label]")??null;L.form?.querySelector("[data-workshop-order-modal-title]");const B=L.delete?.querySelector("[data-workshop-order-delete-summary]")??null,ie=L.delete?.querySelector("[data-workshop-order-delete-confirm]")??null,se="overflow-hidden",Y=U=>U.closest("[data-workshop-order-modal]"),J=U=>{U&&(U.classList.remove("hidden"),document.body.classList.add(se))},G=U=>{U&&(U.classList.add("hidden"),t.querySelector("[data-workshop-order-modal]:not(.hidden)")||document.body.classList.remove(se))};t.querySelectorAll("[data-workshop-order-modal-close]").forEach(U=>{U.addEventListener("click",()=>{const F=Y(U);G(F)})}),Object.values(L).forEach(U=>{U&&(U.addEventListener("click",F=>{F.target===U&&G(U)}),U.addEventListener("keydown",F=>{F.key==="Escape"&&G(U)}))});const me=()=>{E&&(E.querySelectorAll("[data-workshop-order-error]").forEach(U=>{U.textContent=""}),E.querySelectorAll("[data-workshop-order-input]").forEach(U=>{(U instanceof HTMLInputElement||U instanceof HTMLTextAreaElement||U instanceof HTMLSelectElement)&&U.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},le=U=>{!E||!U||Object.entries(U).forEach(([F,W])=>{const ce=Array.isArray(W)?W[0]:W,be=E.querySelector(`[data-workshop-order-error="${F}"]`);be&&(be.textContent=ce??"");const Ee=E.querySelector(`[data-workshop-order-input="${F}"]`);(Ee instanceof HTMLInputElement||Ee instanceof HTMLTextAreaElement||Ee instanceof HTMLSelectElement)&&Ee.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},pe=U=>{!R||!A||(U?A.textContent=e("Procesando..."):R.dataset.originalLabel&&(A.textContent=R.dataset.originalLabel),R.disabled=U)},re=U=>{if(!E)return"";const F=E.querySelector(`[data-workshop-order-input="${U}"]`);return F&&(F instanceof HTMLInputElement||F instanceof HTMLTextAreaElement||F instanceof HTMLSelectElement)?F.value.trim():""},ne=(U,F)=>{if(!E)return;const W=E.querySelector(`[data-workshop-order-input="${U}"]`);W&&(W instanceof HTMLInputElement||W instanceof HTMLTextAreaElement||W instanceof HTMLSelectElement)&&(W.value=F??"")};let r={};const a=(U=null)=>{if(U!==null&&typeof U=="object"&&(r={...U}),U===null&&(r={}),!n){window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{filters:r}}));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n,filters:r}}))},i=new Set,s=async(U,F,W)=>{if(!W||!F||F.length<2)return[];try{const ce=new URL(W,window.location.origin);ce.searchParams.set("search",F),ce.searchParams.set("per_page","10");const be=await fetch(ce.toString(),{headers:{Accept:"application/json"}}),Ee=await be.json().catch(()=>null);return be.ok&&Ee?.data?.items?Ee.data.items:[]}catch(ce){return console.error(`[WorkshopOrders] ${U} search error`,ce),[]}},l=(U,F,W,ce)=>{if(!U)return;if(U.innerHTML="",!F||F.length===0){const Ee=document.createElement("p");Ee.className="px-4 py-3 text-sm text-gray-500 dark:text-gray-400",Ee.textContent=e("No se encontraron resultados"),U.appendChild(Ee),U.hidden=!1,U.dataset.open="true";return}const be=document.createElement("div");be.className="max-h-60 overflow-y-auto py-2",F.forEach(Ee=>{const Se=document.createElement("button");Se.type="button",Se.className="flex w-full items-center justify-between px-4 py-2.5 text-left text-sm text-gray-700 transition hover:bg-primary-soft/20 dark:text-white dark:hover:bg-primary/20";const Me=Ee.name||Ee.label||Ee.display_name||"",ke=Ee.document_number||Ee.identifier||Ee.email||"";Se.innerHTML=`
                <div class="flex-1">
                    <div class="font-medium">${Me}</div>
                    ${ke?`<div class="text-xs text-gray-500 dark:text-gray-400">${ke}</div>`:""}
                </div>
            `,Se.addEventListener("click",()=>{ce&&ce(Ee),U.hidden=!0,U.dataset.open="false"}),be.appendChild(Se)}),U.appendChild(be),U.hidden=!1,U.dataset.open="true"};let y;const h=E?.querySelector("[data-workshop-order-customer-search]"),C=E?.querySelector("[data-workshop-order-customer-results]"),D=E?.querySelector("[data-workshop-order-customer-create]");h instanceof HTMLInputElement&&(h.addEventListener("input",()=>{clearTimeout(y);const U=h.value.trim();if(U.length<2){C&&(C.hidden=!0,C.dataset.open="false");return}y=setTimeout(async()=>{const F=await s("customer",U,p);l(C,F,"customer",W=>{ne("customer_id",W.id);const ce=E?.querySelector("[data-workshop-order-customer-search]");ce instanceof HTMLInputElement&&(ce.value=W.name||W.display_name||"",ce.readOnly=!0)})},300)}),h.addEventListener("focus",()=>{h.value.trim().length>=2&&!h.readOnly&&h.dispatchEvent(new Event("input"))})),D&&D.addEventListener("click",()=>{x&&window.open(x,"_blank")});let V;const N=E?.querySelector("[data-workshop-order-equipment-search]"),$=E?.querySelector("[data-workshop-order-equipment-results]"),_=E?.querySelector("[data-workshop-order-equipment-create]");N instanceof HTMLInputElement&&(N.addEventListener("input",()=>{clearTimeout(V);const U=N.value.trim();if(U.length<2){$&&($.hidden=!0,$.dataset.open="false");return}V=setTimeout(async()=>{const F=await s("equipment",U,u);l($,F,"equipment",W=>{ne("equipment_id",W.id);const ce=E?.querySelector("[data-workshop-order-equipment-search]");ce instanceof HTMLInputElement&&(ce.value=W.label||W.identifier||"",ce.readOnly=!0)})},300)}),N.addEventListener("focus",()=>{N.value.trim().length>=2&&!N.readOnly&&N.dispatchEvent(new Event("input"))})),_&&_.addEventListener("click",()=>{S&&window.open(S,"_blank")});let te;const j=E?.querySelector("[data-workshop-order-responsible-search]"),X=E?.querySelector("[data-workshop-order-responsible-results]"),b=E?.querySelector("[data-workshop-order-responsible-create]");j instanceof HTMLInputElement&&(j.addEventListener("input",()=>{clearTimeout(te);const U=j.value.trim();if(U.length<2){X&&(X.hidden=!0,X.dataset.open="false");return}te=setTimeout(async()=>{const F=await s("responsible",U,o);l(X,F,"responsible",W=>{ne("responsible_user_id",W.id);const ce=E?.querySelector("[data-workshop-order-responsible-search]");ce instanceof HTMLInputElement&&(ce.value=W.name||W.display_name||"",ce.readOnly=!0)})},300)}),j.addEventListener("focus",()=>{j.value.trim().length>=2&&!j.readOnly&&j.dispatchEvent(new Event("input"))})),b&&b.addEventListener("click",()=>{P&&window.open(P,"_blank")});let v;const H=E?.querySelector("[data-workshop-order-accessories-search]"),O=E?.querySelector("[data-workshop-order-accessories-results]"),q=E?.querySelector("[data-workshop-order-accessories-selected]"),T=U=>{if(!U?.id||i.has(U.id)||(i.add(U.id),!q))return;const F=document.createElement("span");F.className="inline-flex items-center gap-2 rounded-full bg-primary-soft/30 px-3 py-1.5 text-xs font-semibold text-primary dark:bg-primary/15 dark:text-primary-100",F.dataset.accessoryId=U.id,F.innerHTML=`
            <span>${U.name||""}</span>
            <button type="button" class="hover:text-primary-strong" data-accessory-remove="${U.id}" aria-label="${e("Remover accesorio")}">
                <i class="fa-solid fa-xmark text-[10px]"></i>
            </button>
        `;const W=F.querySelector(`[data-accessory-remove="${U.id}"]`);W&&W.addEventListener("click",()=>{i.delete(U.id),F.remove()}),q.appendChild(F)};H instanceof HTMLInputElement&&(H.addEventListener("input",()=>{clearTimeout(v);const U=H.value.trim();if(U.length<2){O&&(O.hidden=!0,O.dataset.open="false");return}v=setTimeout(async()=>{const F=await s("accessories",U,c);l(O,F,"accessories",W=>{T(W),H.value="",O&&(O.hidden=!0,O.dataset.open="false")})},300)}),H.addEventListener("focus",()=>{H.value.trim().length>=2&&H.dispatchEvent(new Event("input"))}));const z=L.accessoryCreate?.querySelector("[data-workshop-order-accessory-form]"),w=z?.querySelector('[data-workshop-order-accessory-input="name"]'),k=z?.querySelector("[data-workshop-order-accessory-submit]"),Q=k?.querySelector("[data-workshop-order-accessory-submit-label]"),ve=()=>{z&&z.reset(),w&&(w.value=""),z?.querySelectorAll("[data-workshop-order-accessory-error]").forEach(U=>{U.textContent=""})},qe=U=>{!k||!Q||(k.disabled=U,U?Q.textContent=e("Procesando..."):Q.textContent=e("Guardar"))};z&&z.addEventListener("submit",async U=>{if(U.preventDefault(),!(!w||!w.value.trim())){qe(!0);try{const F=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":M},body:JSON.stringify({name:w.value.trim()})}),W=await F.json().catch(()=>null);F.ok&&W?.data?.item?(T(W.data.item),g({title:e("Éxito"),text:W?.message??e("Accesorio creado correctamente."),icon:"success"}),G(L.accessoryCreate),ve()):F.status===422&&W?.errors?z.querySelectorAll("[data-workshop-order-accessory-error]").forEach(ce=>{const be=ce.getAttribute("data-workshop-order-accessory-error"),Ee=W.errors[be]?Array.isArray(W.errors[be])?W.errors[be][0]:W.errors[be]:"";ce.textContent=Ee}):g({title:e("Error"),text:W?.message??e("No fue posible crear el accesorio."),icon:"error"})}catch(F){console.error("[WorkshopOrders] accessory create error",F),g({title:e("Error"),text:e("Ocurrió un problema al crear el accesorio."),icon:"error"})}finally{qe(!1)}}});const _e=E?.querySelector("[data-workshop-order-accessories-create-button]");_e&&_e.addEventListener("click",()=>{ve(),J(L.accessoryCreate),w&&setTimeout(()=>w.focus(),100)});const Ce=async()=>{if(!E||!R||!A)return;const U=E.dataset.mode??"create",F=E.dataset.workshopOrderId??"",W=Array.from(i),ce={category_id:re("category_id"),state_id:re("state_id")||null,customer_id:re("customer_id"),equipment_id:re("equipment_id"),responsible_user_id:re("responsible_user_id"),priority:re("priority"),work_summary:re("work_summary"),work_description:re("work_description")||null,general_condition:re("general_condition")||null,diagnosis:re("diagnosis")==="1",warranty:re("warranty")==="1",equipment_password:re("equipment_password")||null,promised_at:re("promised_at")||null,budget_currency:re("budget_currency")||null,budget_amount:re("budget_amount")||null,advance_currency:re("advance_currency")||null,advance_amount:re("advance_amount")||null,status:re("status")||"A",accessories:W};me();const be={};if(ce.customer_id||(be.customer_id=e("Debes seleccionar un cliente.")),ce.equipment_id||(be.equipment_id=e("Debes seleccionar un equipo.")),ce.responsible_user_id||(be.responsible_user_id=e("Debes seleccionar un responsable.")),ce.category_id||(be.category_id=e("Debes seleccionar una categoría.")),ce.work_summary||(be.work_summary=e("Debes indicar el trabajo a realizar.")),Object.keys(be).length>0){le(be),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}pe(!0);const Ee=U==="create"?m:`${d}/${F}`,Se=U==="create"?"POST":"PATCH";try{const Me=await fetch(Ee,{method:Se,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":M},body:JSON.stringify(ce)}),ke=await Me.json().catch(()=>null);if(!Me.ok){Me.status===422&&ke?.errors?(le(ke.errors),g({title:e("Hay errores en el formulario"),text:ke.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:ke?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:ke?.message??e("Acción realizada correctamente."),icon:"success"}),G(L.form),a()}catch(Me){console.error("[WorkshopOrders] Submit error",Me),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{pe(!1)}};document.addEventListener("click",U=>{U.target&&!E?.contains(U.target)&&!C?.contains(U.target)&&!$?.contains(U.target)&&!X?.contains(U.target)&&!O?.contains(U.target)&&(C&&(C.hidden=!0,C.dataset.open="false"),$&&($.hidden=!0,$.dataset.open="false"),X&&(X.hidden=!0,X.dataset.open="false"),O&&(O.hidden=!0,O.dataset.open="false"))}),E&&E.addEventListener("submit",U=>{U.preventDefault(),Ce()}),t.addEventListener("click",U=>{if(!(U.target instanceof Element))return;const F=U.target.closest("[data-workshop-order-action], [data-action], [data-row-action]");if(!F)return;const W=F.dataset.rowPayload?F:F.closest("[data-row-payload]");let ce=null;const be=W?.dataset?.rowPayload??F.dataset.rowPayload??null;if(be)try{ce=rt(be)}catch(ke){console.error("[WorkshopOrders] payload decode error",ke,{payloadValue:be})}const Ee=F.dataset??{};let Se=Ee.workshopOrderAction??Ee.action??Ee.rowAction??null;if(Se==="create"){window.location.href=`${d}/create`;return}if(!Se)return;const Me=(F.dataset.id||F.dataset.rowId)??"";if(!ce&&Me&&(ce={id:Me}),Se==="view"){if(!ce?.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}window.location.href=`${d}/${ce.id}`;return}if(Se==="edit"){if(!ce?.id){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}window.location.href=`${d}/${ce.id}/edit`;return}if(Se==="delete"){const ke=ce?.id??Me??"";if(!ke){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}!ce||Object.keys(ce).length<=1?fetch(`${d}/${ke}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(Pe=>Pe.json()).then(Pe=>{Pe?.data?.item?(ce=Pe.data.item,Le(ce,ke)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(Pe=>{console.error("[WorkshopOrders] Fetch error",Pe),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):Le(ce,ke);return}});const Le=(U,F)=>{if(!(!L.delete||!F)){if(L.delete.dataset.workshopOrderId=F,B){const W=U.order_number?`${U.order_number}${U.customer_name?" - "+U.customer_name:""}`:U.customer_name?U.customer_name:F;B.textContent=W}J(L.delete)}},Ve=async()=>{if(!L.delete||!ie)return;const U=L.delete.dataset.workshopOrderId;if(!U){G(L.delete);return}ie.disabled=!0,ie.classList.add("cursor-not-allowed","opacity-70");try{const F=await fetch(`${d}/${U}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":M}}),W=await F.json().catch(()=>null);if(!F.ok){g({title:e("Error"),text:W?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:W?.message??e("Registro eliminado correctamente."),icon:"success"}),G(L.delete),a()}catch(F){console.error("[WorkshopOrders] Delete error",F),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{ie.disabled=!1,ie.classList.remove("cursor-not-allowed","opacity-70")}};ie&&ie.addEventListener("click",Ve);let Ge="table",Te=null,Z=null;const I=t.querySelector('[data-orders-view="table"]'),K=t.querySelector('[data-orders-view="kanban"]'),ye=K?.querySelector("[data-orders-kanban-container]"),xe=t.querySelectorAll("[data-view-toggle]"),Ie=t.querySelector("[data-orders-cards-container]"),we=t.querySelector("[data-orders-filters]"),Ne=t.querySelector("[data-filter-state-container]"),Je=we?.dataset?.categoriesData;let Xe=[];if(Je)try{Xe=JSON.parse(Je)}catch(U){console.error("[WorkshopOrders] Error parsing categories data",U)}const Qe=()=>{const U=new Map;return Xe.forEach(F=>{F.states&&Array.isArray(F.states)&&F.states.forEach(W=>{U.has(W.id)||U.set(W.id,{...W,category_id:F.id})})}),Array.from(U.values())},Ue=U=>{if(!U)return Qe();const F=Xe.find(W=>W.id===U);return!F||!F.states?[]:F.states.map(W=>({...W,category_id:U}))},ze=U=>{Ge=U,xe.forEach(F=>{const W=F.dataset.viewToggle===U;F.dataset.active=W?"true":"false"}),I&&I.classList.toggle("hidden",U!=="table"),K&&K.classList.toggle("hidden",U!=="kanban"),Ie&&Ie.classList.toggle("hidden",U!=="table"),Ne&&Ne.classList.toggle("hidden",U!=="table"),U==="kanban"?(Z=null,$e(),Ze()):Re()},Ze=async()=>{if(!ye)return;let U=[];Te?U=Ue(Te):U=Qe();const F=ye.querySelector("[data-orders-kanban-columns]");F&&(F.innerHTML=`
                <div class="flex items-center justify-center min-h-[400px] w-full">
                    <div class="text-center">
                        <i class="fa-solid fa-spinner fa-spin text-3xl text-gray-400 mb-4"></i>
                        <p class="text-sm text-gray-500 dark:text-gray-400">${e("Cargando tablero...")}</p>
                    </div>
                </div>
            `);try{const W={};Te&&(W.category_id=Te);const ce=new URLSearchParams({per_page:"1000"});W.category_id&&ce.append("category_id",W.category_id),W.state_id&&ce.append("state_id",W.state_id);const be=t.dataset.workshopOrdersBaseUrl?`${t.dataset.workshopOrdersBaseUrl}/data?${ce.toString()}`:`${d||t.dataset.workshopOrdersBaseUrl||""}/data?${ce.toString()}`;if(!be||be==="/data")throw console.error("[WorkshopOrders] No se pudo determinar la URL base para cargar las órdenes"),new Error("URL base no disponible");const Se=await(await fetch(be,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();if(Se?.status!=="success"||!Se?.data?.items)throw new Error("Failed to load orders");const Me=Se.data.items||[],ke=ye.querySelector("[data-orders-kanban-columns]");if(!ke)return;if(ke.innerHTML="",U.length===0){ke.innerHTML=`
                    <div class="flex items-center justify-center min-h-[400px] w-full">
                        <div class="text-center">
                            <i class="fa-solid fa-inbox text-4xl text-gray-400 mb-4"></i>
                            <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">${e("No hay estados disponibles")}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${e("Agrega estados a las categorías para ver el tablero kanban")}</p>
                        </div>
                    </div>
                `;return}U.forEach(Pe=>{const Be=Me.filter(lt=>lt.state_id===Pe.id),je=document.createElement("div");je.className="flex-shrink-0 w-80",je.dataset.kanbanColumn=Pe.id,je.dataset.stateId=Pe.id,je.dataset.dropZone="true";const Ye={Urgente:"border-rose-500 bg-rose-50 text-rose-700 dark:bg-rose-900/20 dark:text-rose-300 dark:border-rose-400",Alta:"border-amber-500 bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-300 dark:border-amber-400",Normal:"border-blue-500 bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-400",Baja:"border-gray-500 bg-gray-50 text-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600"},yt=Ye[Be.find(lt=>lt.priority)?.priority]||Ye.Normal;je.innerHTML=`
                    <div class="rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-slate-800/50">
                        <div class="sticky top-0 z-10 rounded-t-xl border-b border-gray-200 bg-white px-4 py-3 dark:border-gray-700 dark:bg-slate-900">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <h3 class="text-sm font-bold text-gray-900 dark:text-white">${Pe.name||"Sin estado"}</h3>
                                    <span class="inline-flex h-5 min-w-[20px] items-center justify-center rounded-full bg-primary px-2 text-xs font-semibold text-white" data-state-count>
                                        ${Be.length}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="max-h-[calc(100vh-300px)] space-y-3 overflow-y-auto p-4 rounded-b-xl" data-kanban-column-orders="${Pe.id}" style="min-height: 100px;">
                            ${Be.length===0?`
                                <div class="rounded-lg border-2 border-dashed border-gray-300 p-8 text-center dark:border-gray-600">
                                    <i class="fa-solid fa-inbox text-2xl text-gray-400 mb-2"></i>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${e("Sin órdenes")}</p>
                                </div>
                            `:""}
                        </div>
                    </div>
                `;const ut=je.querySelector(`[data-kanban-column-orders="${Pe.id}"]`);Be.length>0&&ut&&Be.forEach(lt=>{const et=mt(lt,Ye,Pe.id);ut.appendChild(et)}),it(je,Pe.id),ke.appendChild(je)}),ct()}catch(W){console.error("[WorkshopOrders] Error loading kanban view",W);const ce=ye.querySelector("[data-orders-kanban-columns]");ce&&(ce.innerHTML=`
                <div class="flex items-center justify-center min-h-[400px] w-full">
                    <div class="text-center">
                        <i class="fa-solid fa-triangle-exclamation text-4xl text-rose-400 mb-4"></i>
                        <p class="text-sm font-medium text-gray-900 dark:text-white mb-1">${e("Error al cargar el tablero")}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${e("Intenta recargar la página")}</p>
                    </div>
                </div>
                `)}},mt=(U,F,W)=>{const ce=document.createElement("div");ce.className="group cursor-move rounded-xl border border-gray-200 bg-white p-4 shadow-sm transition-all hover:shadow-md hover:border-primary dark:border-gray-700 dark:bg-slate-900",ce.dataset.orderId=U.id,ce.dataset.currentStateId=W,ce.draggable=!0;const be=F[U.priority]||F.Normal,Ee=U.priority?`<span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold ${be}">${U.priority}</span>`:"",Se=U.order_number||"-",Me=U.customer_name||e("Sin cliente"),ke=U.equipment_label||e("Sin equipo"),Pe=U.promised_at_formatted||"",Be=`${d}/${U.id}`,je=`${d}/${U.id}/edit`;return ce.innerHTML=`
            <div class="space-y-3">
                <div class="flex items-start justify-between gap-2">
                    <div class="flex-1">
                        <h4 class="text-sm font-bold text-gray-900 dark:text-white">${Se}</h4>
                        <p class="mt-1 text-xs text-gray-600 dark:text-gray-400">${Me}</p>
                    </div>
                    ${Ee}
                </div>
                <div class="space-y-1.5">
                    <div class="flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400">
                        <i class="fa-solid fa-desktop text-[10px]"></i>
                        <span class="truncate">${ke}</span>
                    </div>
                    ${Pe?`
                        <div class="flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400">
                            <i class="fa-solid fa-calendar-days text-[10px]"></i>
                            <span>${Pe}</span>
                        </div>
                    `:""}
                </div>
                <div class="flex items-center justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-800">
                    <a
                        href="${Be}"
                        class="inline-flex h-7 w-7 items-center justify-center rounded-lg border border-gray-300 text-gray-600 transition hover:border-primary hover:text-primary focus:outline-none focus:ring-2 focus:ring-primary/30 dark:border-gray-700 dark:text-gray-300 dark:hover:border-primary"
                        title="${e("Ver")}"
                        onclick="event.stopPropagation();"
                    >
                        <i class="fa-regular fa-eye text-xs"></i>
                    </a>
                    <a
                        href="${je}"
                        class="inline-flex h-7 w-7 items-center justify-center rounded-lg border border-gray-300 text-gray-600 transition hover:border-primary hover:text-primary focus:outline-none focus:ring-2 focus:ring-primary/30 dark:border-gray-700 dark:text-gray-300 dark:hover:border-primary"
                        title="${e("Editar")}"
                        onclick="event.stopPropagation();"
                    >
                        <i class="fa-regular fa-pen-to-square text-xs"></i>
                    </a>
                </div>
            </div>
        `,ce},it=(U,F)=>{const W=U.querySelector(`[data-kanban-column-orders="${F}"]`);if(!W)return;let ce=0;W.addEventListener("dragenter",be=>{be.preventDefault(),ce++,W.classList.add("bg-primary-soft/10","border-primary","border-2","border-dashed")}),W.addEventListener("dragover",be=>{be.preventDefault(),be.dataTransfer.dropEffect="move"}),W.addEventListener("dragleave",be=>{be.preventDefault(),ce--,ce===0&&W.classList.remove("bg-primary-soft/10","border-primary","border-2","border-dashed")}),W.addEventListener("drop",async be=>{be.preventDefault(),ce=0,W.classList.remove("bg-primary-soft/10","border-primary","border-2","border-dashed");const Ee=be.dataTransfer.getData("text/plain");if(!Ee)return;const Se=document.querySelector(`[data-order-id="${Ee}"]`);if(!Se)return;const Me=Se.dataset.currentStateId,ke=F;Me!==ke&&await at(Ee,ke,Se,Me,ke)})},ct=()=>{const U=ye?.querySelectorAll("[data-order-id]");U&&U.forEach(F=>{F.addEventListener("dragstart",W=>{const ce=F.dataset.orderId;W.dataTransfer.setData("text/plain",ce),W.dataTransfer.effectAllowed="move",F.classList.add("opacity-50","cursor-grabbing")}),F.addEventListener("dragend",W=>{F.classList.remove("opacity-50","cursor-grabbing")})})},at=async(U,F,W,ce,be)=>{if(!(!U||!be))try{const Ee=W.innerHTML;W.innerHTML=`
                <div class="flex items-center justify-center py-4">
                    <i class="fa-solid fa-spinner fa-spin text-primary"></i>
                </div>
            `;const Me=await(await fetch(`${d}/${U}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":M},body:JSON.stringify({state_id:be})})).json();if(Me?.status==="success"){const ke=ye?.querySelector(`[data-state-id="${be}"]`),Pe=ke?.querySelector(`[data-kanban-column-orders="${be}"]`);if(Pe){W.remove();const Be=Me?.data?.item;if(Be){const Ye=mt(Be,{Urgente:"border-rose-500 bg-rose-50 text-rose-700 dark:bg-rose-900/20 dark:text-rose-300 dark:border-rose-400",Alta:"border-amber-500 bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-300 dark:border-amber-400",Normal:"border-blue-500 bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-400",Baja:"border-gray-500 bg-gray-50 text-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600"},be);Pe.appendChild(Ye);const yt=ye?.querySelector(`[data-state-id="${ce}"]`),ut=yt?.querySelector("[data-state-count]");if(ut){const et=yt?.querySelectorAll("[data-order-id]");ut.textContent=et?.length||0}const lt=ke?.querySelector("[data-state-count]");if(lt){const et=ke?.querySelectorAll("[data-order-id]");lt.textContent=et?.length||0}ct()}}g({title:e("Estado actualizado"),text:Me?.message||e("El estado de la orden se actualizó correctamente."),icon:"success"})}else W.innerHTML=Ee,g({title:e("Error"),text:Me?.message||e("No se pudo actualizar el estado de la orden."),icon:"error"})}catch(Ee){console.error("[WorkshopOrders] Error updating order state",Ee),g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}},de=U=>{const F=U.querySelector("[data-select-trigger]"),W=U.querySelector("[data-select-dropdown]"),ce=U.querySelector("[data-select-icon]");if(!F||!W)return;const be=()=>{W.hidden=!0,W.dataset.open="false",U.dataset.open="false",F.setAttribute("aria-expanded","false"),ce?.classList.remove("rotate-180")},Ee=()=>{W.hidden=!1,W.dataset.open="true",U.dataset.open="true",F.setAttribute("aria-expanded","true"),ce?.classList.add("rotate-180"),requestAnimationFrame(()=>{W.style.minWidth=`${F.getBoundingClientRect().width}px`})};F.addEventListener("click",Se=>{Se.preventDefault(),Se.stopPropagation(),!F.disabled&&(W.hidden?Ee():be())}),document.addEventListener("click",Se=>{U.contains(Se.target)||be()}),document.addEventListener("keydown",Se=>{Se.key==="Escape"&&!W.hidden&&be()})},oe=()=>{if(!we)return;const U=we.querySelector('[data-select-name="filter_category"]'),F=we.querySelector("[data-filter-category-options]");if(!U||!F)return;const W=document.createElement("button");W.type="button",W.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",W.dataset.selectOption="",W.dataset.value="",W.dataset.label=e("Todas"),W.dataset.selected="true",W.innerHTML=`
            <span>${e("Todas")}</span>
            <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
        `,W.addEventListener("click",()=>{fe("")}),F.appendChild(W),Xe.forEach(ce=>{const be=document.createElement("button");be.type="button",be.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",be.dataset.selectOption="",be.dataset.value=ce.id,be.dataset.label=ce.name,be.dataset.selected="false",be.innerHTML=`
                <span>${ce.name}</span>
                <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
            `,be.addEventListener("click",()=>{fe(ce.id)}),F.appendChild(be)})},fe=U=>{const F=we?.querySelector('[data-select-name="filter_category"]'),W=F?.querySelector("[data-filter-category-input]"),ce=F?.querySelector("[data-select-value]"),be=F?.querySelector("[data-select-dropdown]"),Ee=F?.querySelector("[data-select-trigger]");if(Te=U||null,W&&(W.value=U||""),ce){const Me=U&&Xe.find(ke=>ke.id===U)?.name||e("Todas");ce.textContent=Me}be&&(be.hidden=!0,be.dataset.open="false"),Ee&&Ee.setAttribute("aria-expanded","false");const Se=F?.querySelector("[data-filter-category-options]");Se&&Se.querySelectorAll("[data-select-option]").forEach(Me=>{Me.dataset.selected=Me.dataset.value===U?"true":"false"}),ge(),Re()},ge=()=>{if(!we)return;const U=we.querySelector('[data-select-name="filter_state"]'),F=we.querySelector("[data-filter-state-options]"),W=U?.querySelector("[data-select-trigger]");if(!U||!F)return;F.innerHTML="";let ce=[];if(Te?ce=Ue(Te):ce=Qe(),W&&(W.disabled=ce.length===0),ce.length===0){const Ee=document.createElement("div");Ee.className="px-4 py-3 text-sm text-gray-500 dark:text-gray-400",Ee.textContent=e("No hay estados disponibles"),F.appendChild(Ee);return}const be=document.createElement("button");be.type="button",be.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",be.dataset.selectOption="",be.dataset.value="",be.dataset.label=e("Todos"),be.dataset.selected="true",be.innerHTML=`
            <span>${e("Todos")}</span>
            <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
        `,be.addEventListener("click",()=>{Ae("")}),F.appendChild(be),ce.forEach(Ee=>{const Se=document.createElement("button");Se.type="button",Se.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",Se.dataset.selectOption="",Se.dataset.value=Ee.id,Se.dataset.label=Ee.name,Se.dataset.selected="false",Se.innerHTML=`
                <span>${Ee.name}</span>
                <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
            `,Se.addEventListener("click",()=>{Ae(Ee.id)}),F.appendChild(Se)})},Ae=U=>{const F=we?.querySelector('[data-select-name="filter_state"]'),W=F?.querySelector("[data-filter-state-input]"),ce=F?.querySelector("[data-select-value]"),be=F?.querySelector("[data-select-dropdown]"),Ee=F?.querySelector("[data-select-trigger]");if(Z=U||null,W&&(W.value=U||""),ce)if(!U)ce.textContent=e("Todos");else{const ke=Qe().find(Pe=>Pe.id===U);ce.textContent=ke?.name||e("Todos")}be&&(be.hidden=!0,be.dataset.open="false"),Ee&&Ee.setAttribute("aria-expanded","false");const Se=F?.querySelector("[data-filter-state-options]");Se&&Se.querySelectorAll("[data-select-option]").forEach(Me=>{Me.dataset.selected=Me.dataset.value===U?"true":"false"}),Re()},$e=()=>{const U=we?.querySelector('[data-select-name="filter_state"]'),F=U?.querySelector("[data-filter-state-input]"),W=U?.querySelector("[data-select-value]");F&&(F.value=""),W&&(W.textContent=e("Todos"));const ce=U?.querySelector("[data-filter-state-options]");ce&&ce.querySelectorAll("[data-select-option]").forEach(be=>{be.dataset.selected=be.dataset.value===""?"true":"false"})},Re=()=>{const U={};Te&&(U.category_id=Te),Z&&Ge==="table"&&(U.state_id=Z),r=U,Ge==="table"?a(U):Ge==="kanban"&&Ze()};if(xe.forEach(U=>{U.addEventListener("click",()=>{const F=U.dataset.viewToggle;F&&ze(F)})}),we&&Xe.length>0){const U=we.querySelector('[data-select-name="filter_category"]'),F=we.querySelector('[data-select-name="filter_state"]');U&&de(U),F&&de(F),oe(),ge()}t.addEventListener("change",U=>{const F=U.target;if(F instanceof HTMLInputElement&&F.matches("[data-status-toggle]")){const W=F.dataset.id??"";if(!W||F.disabled)return;const ce=!F.checked,be=F.checked?"A":"I";F.disabled=!0,fetch(`${d}/${W}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":M},body:JSON.stringify({status:be})}).then(Ee=>Ee.json().catch(()=>null)).then(Ee=>{Ee?.status==="success"?(g({title:e("Datos actualizados"),text:Ee?.message??e("El estado se modificó correctamente."),icon:"success"}),a()):(F.checked=ce,g({title:e("Error"),text:Ee?.message??e("No se pudo actualizar el estado."),icon:"error"}))}).catch(Ee=>{console.error("[WorkshopOrders] Status toggle error",Ee),F.checked=ce,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}).finally(()=>{F.disabled=!1})}})},hs=()=>{const t=document.querySelector("[data-workshop-advances-root]");if(!t)return;const n=t.dataset.workshopAdvancesTableId??"",d=t.dataset.workshopAdvancesBaseUrl??"",m=t.dataset.workshopAdvancesStoreUrl??d,p=t.dataset.workshopAdvancesOptionsUrl??"",u=t.dataset.workshopAdvancesOrdersUrl??"",o=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",c={form:t.querySelector('[data-workshop-advance-modal="form"]'),view:t.querySelector('[data-workshop-advance-modal="view"]'),delete:t.querySelector('[data-workshop-advance-modal="delete"]')},f=c.form?.querySelector("[data-workshop-advance-form]")??null,x=c.form?.querySelector("[data-workshop-advance-submit]")??null,S=x?.querySelector("[data-workshop-advance-submit-label]")??null,P=c.form?.querySelector("[data-workshop-advance-modal-title]")??null,M=c.delete?.querySelector("[data-workshop-advance-delete-amount]")??null,L=c.delete?.querySelector("[data-workshop-advance-delete-confirm]")??null,E="overflow-hidden",R=j=>j.closest("[data-workshop-advance-modal]"),A=j=>{j&&(j.classList.remove("hidden"),document.body.classList.add(E))},B=j=>{j&&(j.classList.add("hidden"),t.querySelector("[data-workshop-advance-modal]:not(.hidden)")||document.body.classList.remove(E))};t.querySelectorAll("[data-workshop-advance-modal-close]").forEach(j=>{j.addEventListener("click",()=>{const X=R(j);B(X)})}),Object.values(c).forEach(j=>{j&&(j.addEventListener("click",X=>{X.target===j&&B(j)}),j.addEventListener("keydown",X=>{X.key==="Escape"&&B(j)}))});const ie=()=>{f&&(f.querySelectorAll("[data-workshop-advance-error]").forEach(j=>{j.textContent=""}),f.querySelectorAll("[data-workshop-advance-input]").forEach(j=>{(j instanceof HTMLInputElement||j instanceof HTMLTextAreaElement||j instanceof HTMLSelectElement)&&j.classList.remove("border-rose-500","focus:border-rose-500","focus:ring-rose-200")}))},se=j=>{!f||!j||Object.entries(j).forEach(([X,b])=>{const v=Array.isArray(b)?b[0]:b,H=f.querySelector(`[data-workshop-advance-error="${X}"]`);H&&(H.textContent=v??"");const O=f.querySelector(`[data-workshop-advance-input="${X}"]`);(O instanceof HTMLInputElement||O instanceof HTMLTextAreaElement||O instanceof HTMLSelectElement)&&O.classList.add("border-rose-500","focus:border-rose-500","focus:ring-rose-200")})},Y=j=>{!x||!S||(j?S.textContent=e("Procesando..."):x.dataset.originalLabel&&(S.textContent=x.dataset.originalLabel),x.disabled=j)},J=j=>{if(!f)return"";if(j==="payment_method_id"){const b=f.querySelector('[data-select-name="payment_method_id"]');if(b){const v=b.querySelector('[data-workshop-advance-input="payment_method_id"]');if(v&&v.value)return v.value.trim()}}const X=f.querySelector(`[data-workshop-advance-input="${j}"]`);return X&&(X instanceof HTMLInputElement||X instanceof HTMLTextAreaElement||X instanceof HTMLSelectElement)?X.value.trim():""},G=(j,X)=>{if(!f)return;if(j==="payment_method_id"){const v=f.querySelector('[data-select-name="payment_method_id"]');if(v){const H=v.querySelector('[data-workshop-advance-input="payment_method_id"]');if(H)if(H.value=X??"",X){const O=v.querySelector("[data-workshop-advance-payment-method-options]"),q=v.querySelector("[data-select-value]");if(O&&q){const T=O.querySelector(`[data-value="${X}"]`);T&&T.textContent&&(q.textContent=T.textContent.trim())}}else{const O=v.querySelector("[data-select-value]"),q=v.querySelector("[data-select-trigger]");O&&q&&(O.textContent=q.getAttribute("data-select-placeholder")||e("Selecciona un método de pago"))}}return}const b=f.querySelector(`[data-workshop-advance-input="${j}"]`);b&&(b instanceof HTMLInputElement||b instanceof HTMLTextAreaElement||b instanceof HTMLSelectElement)&&(b.value=X??"")},me=()=>{if(!n){window.dispatchEvent(new CustomEvent("datatable-refresh"));return}window.dispatchEvent(new CustomEvent("datatable-refresh",{detail:{tableId:n}}))},le=j=>{!c.view||!j||c.view.querySelectorAll("[data-workshop-advance-view-field]").forEach(X=>{const b=X.getAttribute("data-workshop-advance-view-field");if(!b)return;const v=j[b];X.textContent=v!=null&&v!==""?String(v):"-"})},pe=(j,X=null)=>{if(!(!f||!x||!S))if(ie(),Y(!1),f.dataset.mode=j,f.dataset.workshopAdvanceId=X?.id??"",j==="create"){f.reset(),G("status","A");const b=new Date,v=new Date(b.getTime()-b.getTimezoneOffset()*6e4).toISOString().slice(0,16);G("payment_date",v),P&&(P.textContent=e("Nuevo abono")),S.textContent=e("Guardar"),x.dataset.originalLabel=e("Guardar"),ne(),re(),a()}else P&&(P.textContent=e("Editar abono")),S.textContent=e("Actualizar"),x.dataset.originalLabel=e("Actualizar"),X&&r(X)},re=()=>{const j=f?.querySelector('[data-select-name="payment_method_id"]');if(j){const X=j.querySelector('[data-workshop-advance-input="payment_method_id"]'),b=j.querySelector("[data-select-trigger]"),v=j.querySelector("[data-select-value]");X&&(X.value=""),b&&(b.setAttribute("aria-expanded","false"),b.dataset.initialized="false"),v&&(v.textContent=b?.getAttribute("data-select-placeholder")||e("Selecciona un método de pago"));const H=j.querySelector("[data-select-dropdown]");H&&(H.hidden=!0,H.dataset.open="false");const O=j.querySelector("[data-select-icon]");O&&(O.style.transform="")}},ne=()=>{const j=f?.querySelector("[data-workshop-advance-order-search]");j instanceof HTMLInputElement&&(j.value="",j.readOnly=!1),G("order_id",""),$()},r=async j=>{if(!j||!f)return;if(G("order_id",j.order_id??""),G("amount",j.amount??""),j.payment_date){const b=new Date(j.payment_date),v=new Date(b.getTime()-b.getTimezoneOffset()*6e4).toISOString().slice(0,16);G("payment_date",v)}else{const b=new Date,v=new Date(b.getTime()-b.getTimezoneOffset()*6e4).toISOString().slice(0,16);G("payment_date",v)}G("reference",j.reference??""),G("notes",j.notes??""),G("status",j.status??"A");const X=f?.querySelector("[data-workshop-advance-order-search]");X instanceof HTMLInputElement&&j.order_number&&(X.value=j.order_number+(j.customer_name?" - "+j.customer_name:""),X.readOnly=!0),await a(),j.payment_method_id&&setTimeout(()=>{const b=f?.querySelector('[data-select-name="payment_method_id"]');if(b){const v=b.querySelector('[data-workshop-advance-input="payment_method_id"]'),H=b.querySelector("[data-select-value]"),O=b.querySelector("[data-workshop-advance-payment-method-options]");if(v&&(v.value=j.payment_method_id),O&&H){const q=O.querySelector(`[data-value="${j.payment_method_id}"]`);q&&q.textContent&&(H.textContent=q.textContent.trim())}}},200)},a=async()=>{if(p)try{const j=await fetch(p,{headers:{Accept:"application/json"}}),X=await j.json().catch(()=>null);j.ok&&X?.data&&l(X.data)}catch(j){console.error("[WorkshopAdvances] options load error",j)}};let i=!1;const s=j=>{if(!j)return;const X=j.querySelector("[data-select-trigger]");if(!X||X.dataset.initialized==="true")return;X.dataset.initialized="true";const b=j.querySelector("[data-select-dropdown]"),v=j.querySelector("[data-select-icon]");X.addEventListener("click",H=>{H.stopPropagation();const O=b?.dataset.open==="true";b&&(b.hidden=O,b.dataset.open=O?"false":"true",X.setAttribute("aria-expanded",!O),v&&(v.style.transform=O?"":"rotate(180deg)"))}),i||(i=!0,document.addEventListener("click",H=>{f?.querySelectorAll('[data-select-manual="true"]')?.forEach(q=>{if(!q.contains(H.target)){const T=q.querySelector("[data-select-dropdown]"),z=q.querySelector("[data-select-trigger]"),w=q.querySelector("[data-select-icon]");T&&T.dataset.open==="true"&&(T.hidden=!0,T.dataset.open="false",z&&z.setAttribute("aria-expanded","false"),w&&(w.style.transform=""))}})}))},l=j=>{if(!j||!f)return;const X=f.querySelector("[data-workshop-advance-payment-method-options]");if(X&&j.payment_methods)if(X.innerHTML="",j.payment_methods.length===0){const b=document.createElement("p");b.className="px-4 py-3 text-sm text-gray-500 dark:text-gray-400",b.textContent=e("No hay métodos de pago disponibles"),X.appendChild(b)}else j.payment_methods.forEach(b=>{const v=document.createElement("button");v.type="button",v.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-gray-700 transition hover:bg-primary-soft/20 dark:text-white dark:hover:bg-primary/20",v.dataset.value=b.id,v.setAttribute("role","option"),v.textContent=b.name||"",v.addEventListener("click",H=>{H.stopPropagation();const O=f.querySelector('[data-select-name="payment_method_id"]'),q=O?.querySelector('[data-workshop-advance-input="payment_method_id"]'),T=O?.querySelector("[data-select-value]"),z=O?.querySelector("[data-select-trigger]"),w=O?.querySelector("[data-select-dropdown]");q&&(q.value=b.id),T&&(T.textContent=b.name||""),z&&z.setAttribute("aria-expanded","false"),w&&(w.hidden=!0,w.dataset.open="false");const k=O?.querySelector("[data-select-icon]");k&&(k.style.transform="")}),X.appendChild(v)});setTimeout(()=>{f?.querySelectorAll('[data-select-manual="true"]')?.forEach(v=>{s(v)})},100)},y=async(j,X,b)=>{if(!b||!X||X.length<2)return[];try{const v=new URL(b,window.location.origin);v.searchParams.set("search",X),v.searchParams.set("per_page","10");const H=await fetch(v.toString(),{headers:{Accept:"application/json"}}),O=await H.json().catch(()=>null);return H.ok&&O?.data?.items?O.data.items:[]}catch(v){return console.error(`[WorkshopAdvances] ${j} search error`,v),[]}},h=(j,X,b,v)=>{if(!j)return;if(j.innerHTML="",!X||X.length===0){const O=document.createElement("p");O.className="px-4 py-3 text-sm text-gray-500 dark:text-gray-400",O.textContent=e("No se encontraron resultados"),j.appendChild(O),j.hidden=!1,j.dataset.open="true";return}const H=document.createElement("div");H.className="max-h-60 overflow-y-auto py-2",X.forEach(O=>{const q=document.createElement("button");q.type="button",q.className="flex w-full items-center justify-between px-4 py-2.5 text-left text-sm text-gray-700 transition hover:bg-primary-soft/20 dark:text-white dark:hover:bg-primary/20";const T=O.order_number||O.label||"",z=O.customer_name||"";q.innerHTML=`
                <div class="flex-1">
                    <div class="font-medium">${T}</div>
                    ${z?`<div class="text-xs text-gray-500 dark:text-gray-400">${z}</div>`:""}
                </div>
            `,q.addEventListener("click",()=>{v&&v(O),j.hidden=!0,j.dataset.open="false"}),H.appendChild(q)}),j.appendChild(H),j.hidden=!1,j.dataset.open="true"};let C;const D=f?.querySelector("[data-workshop-advance-order-search]"),V=f?.querySelector("[data-workshop-advance-order-results]");D instanceof HTMLInputElement&&(D.addEventListener("input",()=>{clearTimeout(C);const j=D.value.trim();if(j.length<2){V&&(V.hidden=!0,V.dataset.open="false");return}C=setTimeout(async()=>{const X=await y("order",j,u);h(V,X,"order",b=>{G("order_id",b.id);const v=f?.querySelector("[data-workshop-advance-order-search]");v instanceof HTMLInputElement&&(v.value=b.order_number||b.label||"",v.readOnly=!0)})},300)}),D.addEventListener("focus",()=>{D.value.trim().length>=2&&!D.readOnly&&D.dispatchEvent(new Event("input"))}));const N=async()=>{if(!f||!x||!S)return;const j=f.dataset.mode??"create",X=f.dataset.workshopAdvanceId??"",b={order_id:J("order_id"),currency:"USD",amount:J("amount"),payment_date:J("payment_date"),payment_method_id:J("payment_method_id")||null,reference:J("reference")||null,notes:J("notes")||null,status:J("status")||"A"};ie();const v={};if(b.order_id||(v.order_id=e("Debes seleccionar una orden de trabajo.")),b.amount||(v.amount=e("Debes ingresar el monto del abono.")),b.payment_date||(v.payment_date=e("Debes ingresar la fecha de pago.")),Object.keys(v).length>0){se(v),g({title:e("Hay errores en el formulario"),text:e("Revisa los campos resaltados."),icon:"error"});return}Y(!0);const H=j==="create"?m:`${d}/${X}`,O=j==="create"?"POST":"PATCH";try{const q=await fetch(H,{method:O,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify(b)}),T=await q.json().catch(()=>null);if(!q.ok){q.status===422&&T?.errors?(se(T.errors),g({title:e("Hay errores en el formulario"),text:T.message??e("Revisa los campos resaltados."),icon:"error"})):g({title:e("Error"),text:T?.message??e("No fue posible guardar la información."),icon:"error"});return}g({title:e("Datos actualizados"),text:T?.message??e("Acción realizada correctamente."),icon:"success"}),B(c.form),me()}catch(q){console.error("[WorkshopAdvances] Submit error",q),g({title:e("Error"),text:e("Ocurrió un problema al guardar. Inténtalo nuevamente."),icon:"error"})}finally{Y(!1)}},$=()=>{V&&(V.hidden=!0,V.dataset.open="false")};document.addEventListener("click",j=>{j.target&&!f?.contains(j.target)&&!V?.contains(j.target)&&$()}),f&&f.addEventListener("submit",j=>{j.preventDefault(),N()}),t.addEventListener("click",j=>{if(!(j.target instanceof Element))return;let X=j.target.closest("[data-workshop-advance-action], [data-action], [data-row-action]");if(!X)return;if(X.tagName!=="BUTTON"&&X.hasAttribute("data-action")){const w=X.closest("button[data-action], button[data-row-action]");w&&(X=w)}const b=X.dataset.rowPayload?X:X.closest("[data-row-payload]");let v=null;const H=b?.dataset?.rowPayload??X.dataset.rowPayload??null;if(H)try{v=rt(H)}catch(w){console.error("[WorkshopAdvances] payload decode error",w,{payloadValue:H})}const O=X.dataset??{};let q=O.workshopAdvanceAction??O.action??O.rowAction??null;if(q==="create"){pe("create"),A(c.form),a();return}if(!q)return;const T=(X.dataset.id||X.dataset.rowId)??"",z=(X.dataset.name||X.dataset.rowName)??"";if(!v&&T&&(v={id:T,amount_formatted:z||null}),q==="view"){const w=v?.id??T??"";if(!w){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}console.log("[WorkshopAdvances] Fetching advance",{advanceId:w,url:`${d}/${w}`,data:v,rowId:T}),fetch(`${d}/${w}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(k=>(console.log("[WorkshopAdvances] Response received",{status:k.status,ok:k.ok,url:k.url}),k.json().then(Q=>({response:k,json:Q})))).then(({response:k,json:Q})=>{k.ok&&Q?.data?.item?(le(Q.data.item),A(c.view)):(console.error("[WorkshopAdvances] Error response",{response:{status:k.status,ok:k.ok},json:Q}),g({title:e("Error"),text:Q?.message??e("No se pudieron obtener los datos del registro."),icon:"error"}))}).catch(k=>{console.error("[WorkshopAdvances] Fetch error",k),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(q==="edit"){const w=v?.id??T??"";if(!w){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}fetch(`${d}/${w}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(k=>k.json()).then(k=>{k?.data?.item?(pe("edit",k.data.item),A(c.form),a()):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(k=>{console.error("[WorkshopAdvances] Fetch error",k),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})});return}if(q==="delete"){const w=v?.id??T??"";if(!w){g({title:e("Error"),text:e("No se pudieron obtener los datos seleccionados."),icon:"error"});return}!v||Object.keys(v).length<=2?fetch(`${d}/${w}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(k=>k.json()).then(k=>{k?.data?.item?(v=k.data.item,_(v,w)):g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}).catch(k=>{console.error("[WorkshopAdvances] Fetch error",k),g({title:e("Error"),text:e("No se pudieron obtener los datos del registro."),icon:"error"})}):_(v,w);return}});const _=(j,X)=>{if(!(!c.delete||!X)){if(c.delete.dataset.workshopAdvanceId=X,M){const b=j.amount_formatted?`${j.amount_formatted}${j.order_number?" - Orden: "+j.order_number:""}${j.customer_name?" - "+j.customer_name:""}`:j.order_number?`Orden: ${j.order_number}${j.customer_name?" - "+j.customer_name:""}`:X;M.textContent=b}A(c.delete)}},te=async()=>{if(!c.delete||!L)return;const j=c.delete.dataset.workshopAdvanceId;if(!j){B(c.delete);return}L.disabled=!0,L.classList.add("cursor-not-allowed","opacity-70");try{const X=await fetch(`${d}/${j}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":o}}),b=await X.json().catch(()=>null);if(!X.ok){g({title:e("Error"),text:b?.message??e("No se pudo eliminar el registro."),icon:"error"});return}g({title:e("Datos actualizados"),text:b?.message??e("Registro eliminado correctamente."),icon:"success"}),B(c.delete),me()}catch(X){console.error("[WorkshopAdvances] Delete error",X),g({title:e("Error"),text:e("Ocurrió un problema al eliminar. Inténtalo nuevamente."),icon:"error"})}finally{L.disabled=!1,L.classList.remove("cursor-not-allowed","opacity-70")}};L&&L.addEventListener("click",te),t.addEventListener("change",j=>{const X=j.target;if(X instanceof HTMLInputElement&&X.matches("[data-status-toggle]")){const b=X.dataset.id??"";if(!b||X.disabled)return;const v=!X.checked,H=X.checked?"A":"I";X.disabled=!0,fetch(`${d}/${b}/status`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":o},body:JSON.stringify({status:H})}).then(O=>O.json().catch(()=>null)).then(O=>{O?.status==="success"?(g({title:e("Datos actualizados"),text:O?.message??e("El estado se modificó correctamente."),icon:"success"}),me()):(X.checked=v,g({title:e("Error"),text:O?.message??e("No se pudo actualizar el estado."),icon:"error"}))}).catch(O=>{console.error("[WorkshopAdvances] Status toggle error",O),X.checked=v,g({title:e("Error"),text:e("Ocurrió un problema al actualizar el estado."),icon:"error"})}).finally(()=>{X.disabled=!1})}})},bs=()=>{document.addEventListener("click",t=>{const n=t.target;if(!(n instanceof Element))return;const d=n.closest('button[data-action="barcode"], button[data-row-action="barcode"]');if(!d)return;const m=d.dataset.url||d.dataset.barcodeUrl||"";if(!m)return;t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();const p=window.open(m,"_blank","noopener,noreferrer");return p&&!p.closed?p.focus():console.warn("[GlobalBarcodeHandler] Popup blocked for barcode URL:",m),!1},!0)},gr=()=>{qa(),Ca(),Ta(),Aa(),Ia(),_a(),Oa(),$a(),Pa(),bs(),Wa(),Xa(),Va(),Ra(),ds(),Ha(),Fa(),Da(),Ua(),Ka(),Ja(),Ga(),Qa(),za(),Ba(),Ya(),es(),Na(),Ma(),ja(),ns(),ts(),rs(),as(),os(),cs(),ls(),us(),Za(),fs(),ps(),ms(),is(),ys(),ss(),gs(),hs(),vs(),Es(),ws(),Ss()},vs=()=>{const t=document.querySelector("[data-workshop-order-form-root]");if(!t||!t.querySelector('form[method="POST"]'))return;const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",m=window.location.origin,p=`${m}/workshop/work-orders/search/customers`,u=`${m}/workshop/work-orders/search/equipments`,o=`${m}/workshop/work-orders/search/responsibles`,c=`${m}/workshop/categories/options`,f=`${m}/workshop/states/options`,x=`${m}/workshop/accessories/options`,S=new Set,P=a=>{try{if(typeof window<"u"&&typeof window.gettext=="function")return window.gettext(a)}catch(i){console.warn("[WorkshopOrderCreate] translate error",i,a)}return a};let M=null,L=null,E=null,R=null;const A=async(a="")=>{const i=t.querySelector("[data-order-customer-options]");i&&(clearTimeout(M),M=setTimeout(async()=>{try{const s=a&&a.length>0?`&search=${encodeURIComponent(a)}`:"",y=await(await fetch(`${p}?limit=50${s}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();y?.status==="success"&&y?.data?.items&&(i.innerHTML="",y.data.items.length===0?i.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+P("No se encontraron clientes")+"</div>":y.data.items.forEach(h=>{let C=h.name||h.display_name||"";!C&&h.first_name&&(C=`${h.first_name||""} ${h.last_name||""}`.trim()),!C&&h.business_name&&(C=h.business_name),C||(C=gettext("Sin nombre"));const D=h.document_number||"",V=D?`${C} - ${D}`:C,N=D?`${C} - ${D}`:C,$=document.createElement("button");$.type="button",$.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",$.dataset.selectOption="",$.dataset.value=h.id,$.dataset.label=V,$.dataset.selected="false",$.innerHTML=`
                                <div class="flex-1">
                                    <p class="font-medium">${C}</p>
                                    ${D?`<p class="text-xs text-gray-500 dark:text-gray-400">${D}</p>`:""}
                                </div>
                                <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
                            `,$.addEventListener("click",_=>{_.preventDefault(),_.stopPropagation();const te=t.querySelector('[data-select-name="customer_id"]');if(te){const j=te.querySelector("[data-select-input]"),X=te.querySelector("[data-select-value]");j&&(j.value=h.id),X&&(X.textContent=N);const b=te.querySelector("[data-select-dropdown]");b&&(b.hidden=!0,b.dataset.open="false");const v=te.querySelector("[data-select-trigger]");v&&v.setAttribute("aria-expanded","false");const H=te.querySelector("[data-select-icon]");H&&H.classList.remove("rotate-180"),i.querySelectorAll("[data-select-option]").forEach(O=>{O.dataset.selected="false"}),$.dataset.selected="true"}}),i.appendChild($)}))}catch(s){console.error("[WorkshopOrderCreate] Error loading customers",s)}},300))},B=async(a="")=>{const i=t.querySelector("[data-order-equipment-options]");i&&(clearTimeout(L),L=setTimeout(async()=>{try{const s=a&&a.length>0?`&search=${encodeURIComponent(a)}`:"",y=await(await fetch(`${u}?limit=50${s}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();y?.status==="success"&&y?.data?.items&&(i.innerHTML="",y.data.items.length===0?i.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+P("No se encontraron equipos")+"</div>":y.data.items.forEach(h=>{const C=document.createElement("button");C.type="button",C.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",C.dataset.selectOption="",C.dataset.value=h.id,C.dataset.label=h.label||"",C.dataset.selected="false",C.innerHTML=`<span class="truncate">${h.label||""}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,C.addEventListener("click",D=>{D.preventDefault(),D.stopPropagation();const V=t.querySelector('[data-select-name="equipment_id"]');if(V){const N=V.querySelector("[data-select-input]"),$=V.querySelector("[data-select-value]");N&&(N.value=h.id),$&&($.textContent=h.label||"");const _=V.querySelector("[data-select-dropdown]");_&&(_.hidden=!0,_.dataset.open="false");const te=V.querySelector("[data-select-trigger]");te&&te.setAttribute("aria-expanded","false");const j=V.querySelector("[data-select-icon]");j&&j.classList.remove("rotate-180"),i.querySelectorAll("[data-select-option]").forEach(X=>{X.dataset.selected="false"}),C.dataset.selected="true"}}),i.appendChild(C)}))}catch(s){console.error("[WorkshopOrderCreate] Error loading equipments",s)}},300))},ie=async(a="")=>{const i=t.querySelector("[data-order-responsible-options]");i&&(clearTimeout(E),E=setTimeout(async()=>{try{const s=a&&a.length>0?`&search=${encodeURIComponent(a)}`:"",y=await(await fetch(`${o}?limit=50${s}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();y?.status==="success"&&y?.data?.items&&(i.innerHTML="",y.data.items.length===0?i.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+P("No se encontraron usuarios")+"</div>":y.data.items.forEach(h=>{const C=h.name||h.full_name||`${h.first_name||""} ${h.last_name||""}`.trim()||h.email||"",D=h.document_number||"",V=D?`${C} - ${D}`:C,N=D?`${C} - ${D}`:C,$=document.createElement("button");$.type="button",$.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",$.dataset.selectOption="",$.dataset.value=h.id,$.dataset.label=V,$.dataset.selected="false",$.innerHTML=`
                                <div class="flex-1">
                                    <p class="font-medium">${C}</p>
                                    ${D?`<p class="text-xs text-gray-500 dark:text-gray-400">${D}</p>`:""}
                                </div>
                                <i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>
                            `,$.addEventListener("click",_=>{_.preventDefault(),_.stopPropagation();const te=t.querySelector('[data-select-name="responsible_user_id"]');if(te){const j=te.querySelector("[data-select-input]"),X=te.querySelector("[data-select-value]");j&&(j.value=h.id),X&&(X.textContent=N);const b=te.querySelector("[data-select-dropdown]");b&&(b.hidden=!0,b.dataset.open="false");const v=te.querySelector("[data-select-trigger]");v&&v.setAttribute("aria-expanded","false");const H=te.querySelector("[data-select-icon]");H&&H.classList.remove("rotate-180"),i.querySelectorAll("[data-select-option]").forEach(O=>{O.dataset.selected="false"}),$.dataset.selected="true"}}),i.appendChild($)}))}catch(s){console.error("[WorkshopOrderCreate] Error loading responsibles",s)}},300))},se=async a=>{if(!a||a.length<2){const i=t.querySelector("[data-order-accessories-results]");i&&(i.innerHTML="",i.hidden=!0,i.dataset.open="false");return}clearTimeout(R),R=setTimeout(async()=>{try{const s=await(await fetch(`${x}?search=${encodeURIComponent(a)}&limit=20`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json(),l=t.querySelector("[data-order-accessories-results]"),y=t.querySelector("[data-order-accessories-search]");s?.status==="success"&&s?.data?.items&&l&&(l.innerHTML="",s.data.items.length===0?l.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+P("No se encontraron accesorios")+"</div>":s.data.items.forEach(h=>{if(S.has(h.id))return;const C=document.createElement("button");C.type="button",C.className="flex w-full items-center justify-between px-4 py-3 text-left text-sm text-gray-900 transition hover:bg-gray-50 dark:text-white dark:hover:bg-slate-800",C.innerHTML=`<p class="font-medium">${h.name||""}</p>`,C.addEventListener("click",()=>{S.add(h.id);const D=t.querySelector("[data-order-accessories-selected]");if(D){const V=document.createElement("span");V.className="inline-flex items-center gap-2 rounded-lg bg-primary/10 px-3 py-1.5 text-sm font-medium text-primary",V.innerHTML=`
                                        ${h.name}
                                        <input type="hidden" name="accessories[]" value="${h.id}">
                                        <button type="button" class="ml-2 hover:text-primary-strong" data-accessory-remove="${h.id}">
                                            <i class="fa-solid fa-xmark text-xs"></i>
                                        </button>
                                    `,D.appendChild(V),V.querySelector(`[data-accessory-remove="${h.id}"]`)?.addEventListener("click",()=>{S.delete(h.id),V.remove()})}y&&(y.value=""),l.hidden=!0,l.dataset.open="false"}),l.appendChild(C)}),l.hidden=!1,l.dataset.open="true")}catch(i){console.error("[WorkshopOrderCreate] Error searching accessories",i)}},300)},Y=async()=>{try{const a=await fetch(c,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const y=await a.text();console.error("[WorkshopOrderCreate] Error loading categories - Response not OK",{status:a.status,statusText:a.statusText,url:c,body:y.substring(0,200)});return}const i=await a.json().catch(y=>(console.error("[WorkshopOrderCreate] Error parsing JSON",y),null));if(!i)return;const s=t.querySelector("[data-order-category-options]"),l=t.querySelector('[data-select-name="category_id"]');i?.status==="success"&&i?.data?.items&&s&&(s.innerHTML="",i.data.items.forEach(y=>{const h=document.createElement("button");h.type="button",h.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",h.dataset.selectOption="",h.dataset.value=y.id,h.dataset.label=y.name,h.innerHTML=`<span class="truncate">${y.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,s.appendChild(h)}),l&&pe(l))}catch(a){console.error("[WorkshopOrderCreate] Error loading categories",a)}},J=async a=>{if(a)try{const i=new URL(f,window.location.origin);i.searchParams.set("category_id",a);const s=await fetch(i.toString(),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const C=await s.text();console.error("[WorkshopOrderCreate] Error loading states - Response not OK",{status:s.status,statusText:s.statusText,url:i.toString(),body:C.substring(0,200)});return}const l=await s.json().catch(C=>(console.error("[WorkshopOrderCreate] Error parsing JSON",C),null));if(!l)return;const y=t.querySelector("[data-order-state-options]"),h=t.querySelector('[data-select-name="state_id"]');if(l?.status==="success"&&l?.data?.items&&y){y.innerHTML="";const C=h?.querySelector("[data-select-trigger]");C&&(C.disabled=!1),l.data.items.forEach(D=>{const V=document.createElement("button");V.type="button",V.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",V.dataset.selectOption="",V.dataset.value=D.id,V.dataset.label=D.name,V.innerHTML=`<span class="truncate">${D.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,y.appendChild(V)}),h&&pe(h)}}catch(i){console.error("[WorkshopOrderCreate] Error loading states",i)}},G=()=>{const a=[{value:"Baja",label:P("Baja")},{value:"Normal",label:P("Normal")},{value:"Alta",label:P("Alta")},{value:"Urgente",label:P("Urgente")}],i=t.querySelector("[data-order-priority-options]"),s=t.querySelector('[data-select-name="priority"]');i&&(i.innerHTML="",a.forEach(l=>{const y=document.createElement("button");y.type="button",y.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",y.dataset.selectOption="",y.dataset.value=l.value,y.dataset.label=l.label,y.innerHTML=`<span class="truncate">${l.label}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,i.appendChild(y)})),s&&pe(s)},me=()=>{const a=[{value:"0",label:P("No")},{value:"1",label:P("Sí")}],i=t.querySelector("[data-order-diagnosis-options]"),s=t.querySelector('[data-select-name="diagnosis"]');i&&(i.innerHTML="",a.forEach(l=>{const y=document.createElement("button");y.type="button",y.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",y.dataset.selectOption="",y.dataset.value=l.value,y.dataset.label=l.label,y.innerHTML=`<span class="truncate">${l.label}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,i.appendChild(y)})),s&&pe(s)},le=()=>{const a=[{value:"0",label:P("No")},{value:"1",label:P("Sí")}],i=t.querySelector("[data-order-warranty-options]"),s=t.querySelector('[data-select-name="warranty"]');i&&(i.innerHTML="",a.forEach(l=>{const y=document.createElement("button");y.type="button",y.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",y.dataset.selectOption="",y.dataset.value=l.value,y.dataset.label=l.label,y.innerHTML=`<span class="truncate">${l.label}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,i.appendChild(y)})),s&&pe(s)},pe=a=>{if(!a)return;const i=a.querySelector("[data-select-trigger]"),s=a.querySelector("[data-select-dropdown]"),l=a.querySelector("[data-select-icon]"),y=a.querySelector("[data-select-input]"),h=a.querySelectorAll("[data-select-option]");if(!i||!s||!y)return;const C=()=>{s.hidden=!0,s.dataset.open="false",a.dataset.open="false",i.setAttribute("aria-expanded","false"),l?.classList.remove("rotate-180")},D=()=>{s.hidden=!1,s.dataset.open="true",a.dataset.open="true",i.setAttribute("aria-expanded","true"),l?.classList.add("rotate-180")};i.addEventListener("click",V=>{V.preventDefault(),V.stopPropagation(),a.dataset.open==="true"?C():D()}),h.forEach(V=>{V.addEventListener("click",N=>{N.preventDefault(),N.stopPropagation();const $=V.dataset.value||"",_=V.dataset.label||V.textContent.trim();y.value=$;const te=a.querySelector("[data-select-value]");if(te&&(te.textContent=_),h.forEach(j=>{j.dataset.selected=j.dataset.value===$?"true":"false"}),C(),y.dispatchEvent(new Event("change",{bubbles:!0})),y.name==="category_id"){const j=t.querySelector('[data-select-name="state_id"]'),X=j?.querySelector("[data-select-input]"),b=j?.querySelector("[data-select-value]"),v=j?.querySelector("[data-select-trigger]");X&&(X.value=""),b&&v&&(b.textContent=v.dataset.selectPlaceholder||P("Selecciona un estado")),J($)}})}),document.addEventListener("click",V=>{a.contains(V.target)||C()})},re=t.querySelector('[data-select-name="customer_id"]');if(re){const a=re.querySelector("[data-select-trigger]"),i=re.querySelector("[data-select-dropdown]"),s=re.querySelector("[data-order-customer-search]");if(a&&i){const l=()=>{i.hidden=!0,i.dataset.open="false",re.dataset.open="false",a.setAttribute("aria-expanded","false");const h=re.querySelector("[data-select-icon]");h&&h.classList.remove("rotate-180")},y=()=>{i.hidden=!1,i.dataset.open="true",re.dataset.open="true",a.setAttribute("aria-expanded","true");const h=re.querySelector("[data-select-icon]");h&&h.classList.add("rotate-180"),A("")};a.addEventListener("click",h=>{h.preventDefault(),h.stopImmediatePropagation(),i.dataset.open==="true"?l():y()},!0),s&&s.addEventListener("input",h=>{h.stopPropagation(),A(h.target.value.trim())}),document.addEventListener("click",h=>{re.contains(h.target)||l()})}}const ne=t.querySelector('[data-select-name="equipment_id"]');if(ne){const a=ne.querySelector("[data-select-trigger]"),i=ne.querySelector("[data-select-dropdown]"),s=ne.querySelector("[data-order-equipment-search]");if(a&&i){const l=()=>{i.hidden=!0,i.dataset.open="false",ne.dataset.open="false",a.setAttribute("aria-expanded","false");const h=ne.querySelector("[data-select-icon]");h&&h.classList.remove("rotate-180")},y=()=>{i.hidden=!1,i.dataset.open="true",ne.dataset.open="true",a.setAttribute("aria-expanded","true");const h=ne.querySelector("[data-select-icon]");h&&h.classList.add("rotate-180"),B("")};a.addEventListener("click",h=>{h.preventDefault(),h.stopImmediatePropagation(),i.dataset.open==="true"?l():y()},!0),s&&s.addEventListener("input",h=>{h.stopPropagation(),B(h.target.value.trim())}),document.addEventListener("click",h=>{ne.contains(h.target)||l()})}}const r=t.querySelector('[data-select-name="responsible_user_id"]');if(r){const a=r.querySelector("[data-select-trigger]"),i=r.querySelector("[data-select-dropdown]"),s=r.querySelector("[data-order-responsible-search]");if(a&&i){const l=()=>{i.hidden=!0,i.dataset.open="false",r.dataset.open="false",a.setAttribute("aria-expanded","false");const h=r.querySelector("[data-select-icon]");h&&h.classList.remove("rotate-180")},y=()=>{i.hidden=!1,i.dataset.open="true",r.dataset.open="true",a.setAttribute("aria-expanded","true");const h=r.querySelector("[data-select-icon]");h&&h.classList.add("rotate-180"),ie("")};a.addEventListener("click",h=>{h.preventDefault(),h.stopImmediatePropagation(),i.dataset.open==="true"?l():y()},!0),s&&s.addEventListener("input",h=>{h.stopPropagation(),ie(h.target.value.trim())}),document.addEventListener("click",h=>{r.contains(h.target)||l()})}}t.querySelector("[data-order-accessories-search]")?.addEventListener("input",a=>{se(a.target.value.trim())}),Y(),G(),me(),le()},Es=()=>{const t=document.querySelector("[data-workshop-order-edit-root]");if(!t)return;const n=t.dataset.orderId;if(!n)return;const d=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",m=window.location.origin,p=`${m}/workshop/categories/options`,u=`${m}/workshop/states/options`,o=t.querySelector("[data-order-notes-list]"),c=document.querySelector("[data-order-note-modal]"),f=c?.querySelector("[data-order-note-form]"),x=c?.querySelector("[data-order-note-modal-title]"),S=f?.querySelector("[data-order-note-text]"),P=f?.querySelector("[data-order-note-id]");console.log("[WorkshopOrderEdit] Notes elements",{notesList:o,noteModal:c,noteForm:f,noteModalTitle:x,noteTextArea:S,noteIdInput:P});const M=t.querySelector("[data-order-items-list]"),L=document.querySelector("[data-order-item-modal]"),E=L?.querySelector("[data-order-item-form]"),R=L?.querySelector("[data-order-item-modal-title]"),A=E?.querySelector("[data-order-item-product-select]"),B=E?.querySelector("[data-order-item-product-search]"),ie=E?.querySelector("[data-order-item-product-options]"),se=E?.querySelector("[data-order-item-product-id]"),Y=E?.querySelector("[data-order-item-price-list-select]"),J=E?.querySelector("[data-order-item-price-list-options]"),G=E?.querySelector("[data-order-item-price-list-id]"),me=E?.querySelector("[data-order-item-quantity]"),le=E?.querySelector("[data-order-item-unit-price]"),pe=E?.querySelector("[data-order-item-notes]"),re=E?.querySelector("[data-order-item-id]");console.log("[WorkshopOrderEdit] Items elements",{itemsList:M,itemModal:L,itemForm:E,itemModalTitle:R,itemProductSelect:A,itemPriceListSelect:Y});const ne=t.querySelector("[data-order-services-list]"),r=document.querySelector("[data-order-service-modal]"),a=r?.querySelector("[data-order-service-form]"),i=r?.querySelector("[data-order-service-modal-title]"),s=a?.querySelector("[data-order-service-category-select]"),l=a?.querySelector("[data-order-service-category-options]"),y=a?.querySelector("[data-order-service-category-id]"),h=a?.querySelector("[data-order-service-service-select]"),C=a?.querySelector("[data-order-service-service-search]"),D=a?.querySelector("[data-order-service-service-options]"),V=a?.querySelector("[data-order-service-service-id]"),N=a?.querySelector("[data-order-service-quantity]"),$=a?.querySelector("[data-order-service-unit-price]"),_=a?.querySelector("[data-order-service-notes]"),te=a?.querySelector("[data-order-service-id]");console.log("[WorkshopOrderEdit] Services elements",{servicesList:ne,serviceModal:r,serviceForm:a,serviceModalTitle:i,serviceCategorySelect:s,serviceServiceSelect:h});const j=t.querySelector("[data-order-items-total]"),X=t.querySelector("[data-order-services-total]"),b=t.querySelector("[data-order-total-cost]"),v=t.querySelector("[data-order-total-paid]"),H=t.querySelector("[data-order-balance]"),O=de=>{try{if(typeof window<"u"&&typeof window.gettext=="function")return window.gettext(de)}catch(oe){console.warn("[WorkshopOrderEdit] translate error",oe,de)}return de},q=de=>new Intl.NumberFormat("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).format(de),T=async()=>{try{const de=await fetch(p,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!de.ok){const Re=await de.text();console.error("[WorkshopOrderEdit] Error loading categories - Response not OK",{status:de.status,statusText:de.statusText,url:p,body:Re.substring(0,200)});return}const oe=await de.json().catch(Re=>(console.error("[WorkshopOrderEdit] Error parsing JSON",Re),null));if(!oe)return;const fe=t.querySelector("[data-order-category-options]"),ge=t.querySelector('[data-select-name="category_id"]'),$e=ge?.querySelector("[data-select-input]")?.value||"";oe?.status==="success"&&oe?.data?.items&&fe&&(fe.innerHTML="",oe.data.items.forEach(Re=>{const U=document.createElement("button");U.type="button",U.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",U.dataset.selectOption="",U.dataset.value=Re.id,U.dataset.label=Re.name,U.dataset.selected=Re.id===$e?"true":"false",U.innerHTML=`<span class="truncate">${Re.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,fe.appendChild(U)}),ge&&w(ge))}catch(de){console.error("[WorkshopOrderEdit] Error loading categories",de)}},z=async de=>{if(de)try{const oe=new URL(u,window.location.origin);oe.searchParams.set("category_id",de);const fe=await fetch(oe.toString(),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!fe.ok){const F=await fe.text();console.error("[WorkshopOrderEdit] Error loading states - Response not OK",{status:fe.status,statusText:fe.statusText,url:oe.toString(),body:F.substring(0,200)});return}const ge=await fe.json().catch(F=>(console.error("[WorkshopOrderEdit] Error parsing JSON",F),null));if(!ge)return;const Ae=t.querySelector("[data-order-state-options]"),$e=t.querySelector('[data-select-name="state_id"]'),U=$e?.querySelector("[data-select-input]")?.value||"";if(ge?.status==="success"&&ge?.data?.items&&Ae){Ae.innerHTML="";const F=$e?.querySelector("[data-select-trigger]");F&&(F.disabled=!1),ge.data.items.forEach(W=>{const ce=document.createElement("button");ce.type="button",ce.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",ce.dataset.selectOption="",ce.dataset.value=W.id,ce.dataset.label=W.name,ce.dataset.selected=W.id===U?"true":"false",ce.innerHTML=`<span class="truncate">${W.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,Ae.appendChild(ce)}),$e&&w($e)}}catch(oe){console.error("[WorkshopOrderEdit] Error loading states",oe)}},w=de=>{if(!de)return;const oe=de.querySelector("[data-select-trigger]"),fe=de.querySelector("[data-select-dropdown]"),ge=de.querySelector("[data-select-icon]"),Ae=de.querySelector("[data-select-input]");if(de.querySelectorAll("[data-select-option]"),!oe||!fe||!Ae)return;const $e=()=>{fe.hidden=!0,fe.dataset.open="false",de.dataset.open="false",oe.setAttribute("aria-expanded","false"),ge?.classList.remove("rotate-180")},Re=()=>{fe.hidden=!1,fe.dataset.open="true",de.dataset.open="true",oe.setAttribute("aria-expanded","true"),ge?.classList.add("rotate-180")},U=oe.cloneNode(!0);oe.parentNode?.replaceChild(U,oe);const F=fe.querySelectorAll("[data-select-option]");U.addEventListener("click",W=>{W.preventDefault(),W.stopPropagation(),de.dataset.open==="true"?$e():Re()}),F.forEach(W=>{W.addEventListener("click",ce=>{ce.preventDefault(),ce.stopPropagation();const be=W.dataset.value||"",Ee=W.dataset.label||W.textContent.trim();Ae.value=be;const Se=de.querySelector("[data-select-value]");if(Se&&(Se.textContent=Ee),F.forEach(Me=>{Me.dataset.selected=Me.dataset.value===be?"true":"false"}),$e(),Ae.dispatchEvent(new Event("change",{bubbles:!0})),Ae.name==="category_id"){const Me=t.querySelector('[data-select-name="state_id"]'),ke=Me?.querySelector("[data-select-input]"),Pe=Me?.querySelector("[data-select-value]"),Be=Me?.querySelector("[data-select-trigger]");ke&&(ke.value=""),Pe&&Be&&(Pe.textContent=Be.dataset.selectPlaceholder||O("Selecciona un estado")),z(be)}})}),document.addEventListener("click",W=>{de.contains(W.target)||$e()})},k=async()=>{try{const oe=await(await fetch(`${m}/workshop/work-orders/${n}/json`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();if(oe?.status==="success"&&oe?.data?.item){const fe=oe.data.item;if(j){const ge=fe.items?.reduce((Ae,$e)=>Ae+parseFloat($e.subtotal||0),0)||0;j.textContent=q(ge)}if(X){const ge=fe.services?.reduce((Ae,$e)=>Ae+parseFloat($e.subtotal||0),0)||0;X.textContent=q(ge)}if(b&&(b.textContent=q(parseFloat(fe.total_cost||0))),v&&(v.textContent=q(parseFloat(fe.total_paid||0))),H){const ge=parseFloat(fe.balance||0);H.textContent=q(Math.abs(ge)),ge<0?(H.classList.add("text-rose-600","dark:text-rose-400"),H.classList.remove("text-gray-900","dark:text-white")):(H.classList.add("text-gray-900","dark:text-white"),H.classList.remove("text-rose-600","dark:text-rose-400"))}}}catch(de){console.error("[WorkshopOrderEdit] Error updating costs summary",de)}},Q=async()=>{try{const oe=await(await fetch(`${m}/workshop/work-orders/${n}/notes`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();oe?.status==="success"&&oe?.data?.items&&o&&(o.innerHTML="",oe.data.items.forEach(fe=>{const ge=document.createElement("div");ge.className="rounded-xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-slate-800/50",ge.dataset.orderNoteItem="",ge.dataset.noteId=fe.id,ge.innerHTML=`
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <p class="text-sm text-gray-900 dark:text-white whitespace-pre-wrap">${fe.note||""}</p>
                                <div class="mt-2 flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400">
                                    <span class="flex items-center gap-1.5">
                                        <i class="fa-solid fa-user"></i>
                                        ${fe.user?.name||""}
                                    </span>
                                    <span class="flex items-center gap-1.5">
                                        <i class="fa-solid fa-clock"></i>
                                        ${fe.created_at_formatted||""}
                                    </span>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <button
                                    type="button"
                                    class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 text-gray-600 transition hover:border-primary hover:text-primary dark:border-gray-700 dark:text-gray-300"
                                    data-order-note-edit
                                    data-note-id="${fe.id}"
                                    data-note-text="${(fe.note||"").replace(/"/g,"&quot;")}"
                                >
                                    <i class="fa-regular fa-pen-to-square text-xs"></i>
                                </button>
                                <button
                                    type="button"
                                    class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-rose-300 text-rose-600 transition hover:border-rose-500 hover:bg-rose-50 dark:border-rose-700 dark:text-rose-400"
                                    data-order-note-delete
                                    data-note-id="${fe.id}"
                                >
                                    <i class="fa-regular fa-trash-can text-xs"></i>
                                </button>
                            </div>
                        </div>
                    `,o.appendChild(ge)}))}catch(de){console.error("[WorkshopOrderEdit] Error loading notes",de)}},ve=(de=null,oe="")=>{if(console.log("[WorkshopOrderEdit] openNoteModal called",{noteId:de,noteText:oe,noteModal:c,noteForm:f,noteModalTitle:x,noteTextArea:S,noteIdInput:P}),!c){console.error("[WorkshopOrderEdit] noteModal not found");return}if(!f){console.error("[WorkshopOrderEdit] noteForm not found");return}P&&(P.value=de||""),S&&(S.value=oe||""),x&&(x.textContent=O(de?"Editar nota":"Agregar nota")),console.log("[WorkshopOrderEdit] Removing hidden class from noteModal",{before:c.classList.contains("hidden")}),c.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),console.log("[WorkshopOrderEdit] Note modal opened",{after:c.classList.contains("hidden")}),S&&setTimeout(()=>S.focus(),100)},qe=()=>{c&&(c.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),f&&f.reset(),P&&(P.value=""),S&&(S.value=""))},_e=async(de=null)=>{if(!f||!S)return;const oe=S.value.trim();if(!oe){alert(O("La nota no puede estar vacía."));return}try{const fe=de?`${m}/workshop/work-orders/${n}/notes/${de}`:`${m}/workshop/work-orders/${n}/notes`,Ae=await fetch(fe,{method:de?"PATCH":"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({note:oe})}),$e=await Ae.json();Ae.ok&&$e?.status==="success"?(qe(),Q()):alert($e?.message||O("Error al guardar la nota."))}catch(fe){console.error("[WorkshopOrderEdit] Error saving note",fe),alert(O("Error al guardar la nota."))}},Ce=async de=>{if(!(!de||!confirm(O("¿Estás seguro de eliminar esta nota?"))))try{const oe=await fetch(`${m}/workshop/work-orders/${n}/notes/${de}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":d}}),fe=await oe.json();oe.ok&&fe?.status==="success"?Q():alert(fe?.message||O("Error al eliminar la nota."))}catch(oe){console.error("[WorkshopOrderEdit] Error deleting note",oe),alert(O("Error al eliminar la nota."))}};let Le=null,Ve=[];const Ge=async()=>{try{const oe=await(await fetch(`${m}/configuration/price-lists/options`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();oe?.status==="success"&&oe?.data?.items&&J&&(Ve=oe.data.items||[],J.innerHTML="",Ve.length===0?J.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+O("No hay listas de precios disponibles")+"</div>":Ve.forEach(fe=>{const ge=document.createElement("button");ge.type="button",ge.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",ge.dataset.selectOption="",ge.dataset.value=fe.id,ge.dataset.label=fe.name,ge.dataset.selected="false",ge.innerHTML=`<span class="truncate">${fe.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,ge.addEventListener("click",Ae=>{Ae.preventDefault(),Ae.stopPropagation();const $e=Y?.querySelector("[data-select-dropdown]");$e&&($e.hidden=!0,$e.dataset.open="false");const Re=Y?.querySelector("[data-select-trigger]");Re&&Re.setAttribute("aria-expanded","false");const U=Y?.querySelector("[data-select-icon]");U&&(U.style.transform=""),G&&(G.value=fe.id);const F=Y?.querySelector("[data-select-value]");F&&(F.textContent=fe.name);const W=se?.value?.trim(),ce=fe.id;W&&ce&&le?(console.log("[WorkshopOrderEdit] Loading price for product",W,"and price list",ce),Te(W,ce)):console.log("[WorkshopOrderEdit] Cannot load price - missing product or price list",{productId:W,priceListId:ce,hasUnitPriceInput:!!le})}),J.appendChild(ge)}))}catch(de){console.error("[WorkshopOrderEdit] Error loading price lists",de)}},Te=async(de=null,oe=null)=>{const fe=de||se?.value?.trim(),ge=oe||G?.value?.trim();if(!fe||!ge||!le){console.warn("[WorkshopOrderEdit] Cannot load product price - missing required data",{productId:fe,priceListId:ge,hasUnitPriceInput:!!le});return}try{console.log("[WorkshopOrderEdit] Fetching price for product",fe,"with price list",ge);const Ae=await fetch(`${m}/workshop/work-orders/items/products/${fe}/price?price_list_id=${encodeURIComponent(ge)}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!Ae.ok)throw new Error(`HTTP error! status: ${Ae.status}`);const $e=await Ae.json();if(console.log("[WorkshopOrderEdit] Price response",$e),$e?.status==="success"&&$e?.data?.price!==void 0){const Re=$e.data.price||"0";le.value=Re,console.log("[WorkshopOrderEdit] Price loaded successfully",Re),le.dispatchEvent(new Event("input",{bubbles:!0}))}else console.warn("[WorkshopOrderEdit] Unexpected response format",$e),le.value="0"}catch(Ae){console.error("[WorkshopOrderEdit] Error loading product price",Ae),le&&!le.value&&(le.value="0")}},Z=async(de="")=>{ie&&(clearTimeout(Le),Le=setTimeout(async()=>{try{const oe=de&&de.length>0?`&search=${encodeURIComponent(de)}`:"",ge=await(await fetch(`${m}/workshop/work-orders/items/search/products?limit=50${oe}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();ge?.status==="success"&&ge?.data?.items&&(ie.innerHTML="",ge.data.items.length===0?ie.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+O("No se encontraron productos")+"</div>":ge.data.items.forEach(Ae=>{const $e=document.createElement("button");$e.type="button",$e.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",$e.dataset.selectOption="",$e.dataset.value=Ae.id,$e.dataset.label=Ae.name,$e.dataset.selected="false";const Re=Ae.sku?`${Ae.name} (${Ae.sku})`:Ae.name;$e.innerHTML=`<span class="truncate">${Re}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,$e.addEventListener("click",U=>{U.preventDefault(),U.stopPropagation(),se&&(se.value=Ae.id);const F=A?.querySelector("[data-select-value]");F&&(F.textContent=Ae.name);const W=A?.querySelector("[data-select-dropdown]");W&&(W.hidden=!0,W.dataset.open="false");const ce=A?.querySelector("[data-select-trigger]");ce&&ce.setAttribute("aria-expanded","false");const be=A?.querySelector("[data-select-icon]");be&&(be.style.transform="");const Ee=se?.value?.trim(),Se=G?.value?.trim();Ee&&Se&&le?(console.log("[WorkshopOrderEdit] Loading price for product",Ee,"and price list",Se),Te(Ee,Se)):console.log("[WorkshopOrderEdit] Cannot load price - missing product or price list",{productId:Ee,priceListId:Se,hasUnitPriceInput:!!le})}),ie.appendChild($e)}))}catch(oe){console.error("[WorkshopOrderEdit] Error searching products",oe)}},de&&de.length>0?300:0))},I=async()=>{try{const oe=await(await fetch(`${m}/workshop/work-orders/${n}/items`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();oe?.status==="success"&&oe?.data?.items&&M&&(M.innerHTML="",oe.data.items.length===0?M.innerHTML=`
                        <tr>
                            <td colspan="5" class="px-4 py-8 text-center text-sm text-gray-500 dark:text-gray-400">
                                ${O("No hay productos agregados")}
                            </td>
                        </tr>
                    `:oe.data.items.forEach(fe=>{const ge=document.createElement("tr");ge.dataset.orderItemRow="",ge.dataset.itemId=fe.id,ge.innerHTML=`
                            <td class="px-4 py-3">
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">${fe.product_name||"N/A"}</p>
                                    ${fe.product_sku?`<p class="text-xs text-gray-500 dark:text-gray-400">${O("SKU")}: ${fe.product_sku}</p>`:""}
                                    ${fe.notes?`<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">${fe.notes}</p>`:""}
                                </div>
                            </td>
                            <td class="px-4 py-3 text-center">
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${fe.quantity||0}</span>
                            </td>
                            <td class="px-4 py-3 text-right">
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${q(fe.unit_price||0)}</span>
                            </td>
                            <td class="px-4 py-3 text-right">
                                <span class="text-sm font-semibold text-gray-900 dark:text-white">${q(fe.subtotal||0)}</span>
                            </td>
                            <td class="px-4 py-3 text-center">
                                <div class="flex items-center justify-center gap-2">
                                    <button
                                        type="button"
                                        class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 text-gray-600 transition hover:border-primary hover:text-primary dark:border-gray-700 dark:text-gray-300"
                                        data-order-item-edit
                                        data-item-id="${fe.id}"
                                        data-item-product-id="${fe.product_id}"
                                        data-item-product-name="${(fe.product_name||"").replace(/"/g,"&quot;")}"
                                        data-item-quantity="${fe.quantity}"
                                        data-item-unit-price="${fe.unit_price}"
                                        data-item-notes="${(fe.notes||"").replace(/"/g,"&quot;")}"
                                    >
                                        <i class="fa-regular fa-pen-to-square text-xs"></i>
                                    </button>
                                    <button
                                        type="button"
                                        class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-rose-300 text-rose-600 transition hover:border-rose-500 hover:bg-rose-50 dark:border-rose-700 dark:text-rose-400"
                                        data-order-item-delete
                                        data-item-id="${fe.id}"
                                    >
                                        <i class="fa-regular fa-trash-can text-xs"></i>
                                    </button>
                                </div>
                            </td>
                        `,M.appendChild(ge)}),k())}catch(de){console.error("[WorkshopOrderEdit] Error loading items",de)}},K=(de=null,oe=null)=>{if(console.log("[WorkshopOrderEdit] openItemModal called",{itemId:de,itemData:oe,itemModal:L,itemForm:E,itemModalTitle:R}),!L){console.error("[WorkshopOrderEdit] itemModal not found");return}if(!E){console.error("[WorkshopOrderEdit] itemForm not found");return}if(re&&(re.value=de||""),R&&(R.textContent=O(de?"Editar producto":"Agregar producto")),oe){se&&(se.value=oe.product_id||"");const fe=A?.querySelector("[data-select-value]");fe&&oe.product_name&&(fe.textContent=oe.product_name),me&&(me.value=oe.quantity||"1"),le&&(le.value=oe.unit_price||"0"),pe&&(pe.value=oe.notes||"")}else{E&&E.reset(),me&&(me.value="1"),le&&(le.value="0");const fe=A?.querySelector("[data-select-value]");fe&&(fe.textContent=A?.querySelector("[data-select-trigger]")?.dataset.selectPlaceholder||O("Selecciona un producto")),G&&(G.value="");const ge=Y?.querySelector("[data-select-value]");ge&&(ge.textContent=Y?.querySelector("[data-select-trigger]")?.dataset.selectPlaceholder||O("Selecciona una lista de precios"))}console.log("[WorkshopOrderEdit] Removing hidden class from itemModal",{before:L.classList.contains("hidden")}),L.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),console.log("[WorkshopOrderEdit] Item modal opened",{after:L.classList.contains("hidden")})},ye=()=>{if(!L)return;L.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),E&&E.reset(),re&&(re.value=""),se&&(se.value=""),G&&(G.value=""),ie&&(ie.innerHTML=""),B&&(B.value="");const de=A?.querySelector("[data-select-dropdown]");de&&(de.hidden=!0,de.dataset.open="false");const oe=A?.querySelector("[data-select-trigger]");oe&&oe.setAttribute("aria-expanded","false");const fe=A?.querySelector("[data-select-icon]");fe&&(fe.style.transform="");const ge=A?.querySelector("[data-select-value]");ge&&(ge.textContent=oe?.dataset.selectPlaceholder||O("Selecciona un producto"));const Ae=Y?.querySelector("[data-select-dropdown]");Ae&&(Ae.hidden=!0,Ae.dataset.open="false");const $e=Y?.querySelector("[data-select-trigger]");$e&&$e.setAttribute("aria-expanded","false");const Re=Y?.querySelector("[data-select-icon]");Re&&(Re.style.transform="");const U=Y?.querySelector("[data-select-value]");U&&(U.textContent=$e?.dataset.selectPlaceholder||O("Selecciona una lista de precios"))},xe=async(de=null)=>{if(!E)return;const oe=se?.value?.trim(),fe=parseInt(me?.value||"0",10),ge=parseFloat(le?.value||"0"),Ae=pe?.value?.trim()||null;if(!oe){alert(O("Selecciona un producto."));return}if(fe<1){alert(O("La cantidad debe ser mayor a 0."));return}if(ge<0){alert(O("El precio unitario no puede ser negativo."));return}try{const $e=de?`${m}/workshop/work-orders/${n}/items/${de}`:`${m}/workshop/work-orders/${n}/items`,Re=de?"PATCH":"POST",U={...de?{}:{product_id:oe},quantity:fe,unit_price:ge,...Ae?{notes:Ae}:{}},F=await fetch($e,{method:Re,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d},body:JSON.stringify(U)}),W=await F.json();F.ok&&W?.status==="success"?(ye(),I()):alert(W?.message||O("Error al guardar el producto."))}catch($e){console.error("[WorkshopOrderEdit] Error saving item",$e),alert(O("Error al guardar el producto."))}},Ie=async de=>{if(!(!de||!confirm(O("¿Estás seguro de eliminar este producto?"))))try{const oe=await fetch(`${m}/workshop/work-orders/${n}/items/${de}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":d}}),fe=await oe.json();oe.ok&&fe?.status==="success"?I():alert(fe?.message||O("Error al eliminar el producto."))}catch(oe){console.error("[WorkshopOrderEdit] Error deleting item",oe),alert(O("Error al eliminar el producto."))}};let we=null,Ne=[];const Je=async()=>{try{const oe=await(await fetch(`${m}/configuration/service-categories/options`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();oe?.status==="success"&&oe?.data?.items&&l&&(Ne=oe.data.items||[],l.innerHTML="",Ne.length===0?l.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+O("No hay categorías de servicios disponibles")+"</div>":Ne.forEach(fe=>{const ge=document.createElement("button");ge.type="button",ge.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",ge.dataset.selectOption="",ge.dataset.value=fe.id,ge.dataset.label=fe.name,ge.dataset.selected="false",ge.innerHTML=`<span class="truncate">${fe.name}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,ge.addEventListener("click",Ae=>{Ae.preventDefault(),Ae.stopPropagation();const $e=s?.querySelector("[data-select-dropdown]");$e&&($e.hidden=!0,$e.dataset.open="false");const Re=s?.querySelector("[data-select-trigger]");Re&&Re.setAttribute("aria-expanded","false");const U=s?.querySelector("[data-select-icon]");U&&(U.style.transform=""),y&&(y.value=fe.id);const F=s?.querySelector("[data-select-value]");F&&(F.textContent=fe.name),V&&(V.value="",V.disabled=!1);const W=h?.querySelector("[data-select-value]");W&&(W.textContent=h?.querySelector("[data-select-trigger]")?.dataset.selectPlaceholder||O("Selecciona un servicio")),D&&(D.innerHTML=""),C&&(C.value="",C.disabled=!1),$&&($.value="0");const ce=h?.querySelector("[data-select-trigger]");ce&&(ce.disabled=!1,ce.classList.remove("opacity-50","cursor-not-allowed")),Xe("",fe.id)}),l.appendChild(ge)}))}catch(de){console.error("[WorkshopOrderEdit] Error loading service categories",de)}},Xe=async(de="",oe=null)=>{if(!D)return;const fe=oe||y?.value?.trim();if(!fe){D.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+O("Primero selecciona una categoría")+"</div>";return}clearTimeout(we),we=setTimeout(async()=>{try{const ge=de&&de.length>0?`&search=${encodeURIComponent(de)}`:"",Ae=`&category_id=${encodeURIComponent(fe)}`,Re=await(await fetch(`${m}/workshop/work-orders/services/search/services?limit=50${ge}${Ae}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();console.log("[WorkshopOrderEdit] Services response",Re),Re?.status==="success"&&Re?.data?.items&&(D.innerHTML="",Re.data.items.length===0?D.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+O("No se encontraron servicios en esta categoría")+"</div>":Re.data.items.forEach(U=>{console.log("[WorkshopOrderEdit] Processing service",U,"price:",U.price);const F=document.createElement("button");F.type="button",F.className="group flex w-full items-center justify-between px-4 py-2 text-left text-sm text-heading transition hover:bg-primary-soft/20 data-[selected=true]:bg-primary-soft/30 data-[selected=true]:text-primary dark:text-white",F.dataset.selectOption="",F.dataset.value=U.id,F.dataset.label=U.name,F.dataset.selected="false";const W=U.description?`${U.name} - ${U.description.substring(0,50)}${U.description.length>50?"...":""}`:U.name;F.innerHTML=`<span class="truncate">${W}</span><i class="fa-solid fa-circle-check text-primary opacity-0 transition group-data-[selected=true]:opacity-100" data-select-check></i>`,F.addEventListener("click",ce=>{ce.preventDefault(),ce.stopPropagation();const be=h?.querySelector("[data-select-dropdown]");be&&(be.hidden=!0,be.dataset.open="false");const Ee=h?.querySelector("[data-select-trigger]");Ee&&Ee.setAttribute("aria-expanded","false");const Se=h?.querySelector("[data-select-icon]");Se&&(Se.style.transform=""),V&&(V.value=U.id,V.disabled=!1);const Me=h?.querySelector("[data-select-value]");Me&&(Me.textContent=U.name);const ke=U.price!==void 0&&U.price!==null?String(U.price):"0";console.log("[WorkshopOrderEdit] Service selected",{service:U,price:ke,hasUnitPriceInput:!!$}),$?($.value=ke,$.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[WorkshopOrderEdit] Service price mapped to input",{price:ke,inputValue:$.value})):console.warn("[WorkshopOrderEdit] serviceUnitPriceInput not found")}),D.appendChild(F)}))}catch(ge){console.error("[WorkshopOrderEdit] Error searching services",ge),D.innerHTML='<div class="px-4 py-3 text-sm text-rose-500 dark:text-rose-400">'+O("Error al cargar los servicios")+"</div>"}},de&&de.length>0?300:0)},Qe=async()=>{try{const oe=await(await fetch(`${m}/workshop/work-orders/${n}/services`,{headers:{Accept:"application/json","X-CSRF-TOKEN":d}})).json();oe?.status==="success"&&oe?.data?.items&&ne&&(ne.innerHTML="",oe.data.items.length===0?ne.innerHTML=`
                        <tr>
                            <td colspan="5" class="px-4 py-8 text-center text-sm text-gray-500 dark:text-gray-400">
                                ${O("No hay servicios agregados")}
                            </td>
                        </tr>
                    `:oe.data.items.forEach(fe=>{const ge=document.createElement("tr");ge.dataset.orderServiceRow="",ge.dataset.serviceId=fe.id,ge.innerHTML=`
                            <td class="px-4 py-3">
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">${fe.service_name||"N/A"}</p>
                                    ${fe.notes?`<p class="mt-1 text-xs text-gray-500 dark:text-gray-400">${fe.notes}</p>`:""}
                                </div>
                            </td>
                            <td class="px-4 py-3 text-center">
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${fe.quantity||0}</span>
                            </td>
                            <td class="px-4 py-3 text-right">
                                <span class="text-sm font-medium text-gray-900 dark:text-white">${q(fe.unit_price||0)}</span>
                            </td>
                            <td class="px-4 py-3 text-right">
                                <span class="text-sm font-semibold text-gray-900 dark:text-white">${q(fe.subtotal||0)}</span>
                            </td>
                            <td class="px-4 py-3 text-center">
                                <div class="flex items-center justify-center gap-2">
                                    <button
                                        type="button"
                                        class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 text-gray-600 transition hover:border-primary hover:text-primary dark:border-gray-700 dark:text-gray-300"
                                        data-order-service-edit
                                        data-service-id="${fe.id}"
                                        data-service-service-id="${fe.service_id}"
                                        data-service-service-name="${(fe.service_name||"").replace(/"/g,"&quot;")}"
                                        data-service-quantity="${fe.quantity}"
                                        data-service-unit-price="${fe.unit_price}"
                                        data-service-notes="${(fe.notes||"").replace(/"/g,"&quot;")}"
                                    >
                                        <i class="fa-regular fa-pen-to-square text-xs"></i>
                                    </button>
                                    <button
                                        type="button"
                                        class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-rose-300 text-rose-600 transition hover:border-rose-500 hover:bg-rose-50 dark:border-rose-700 dark:text-rose-400"
                                        data-order-service-delete
                                        data-service-id="${fe.id}"
                                    >
                                        <i class="fa-regular fa-trash-can text-xs"></i>
                                    </button>
                                </div>
                            </td>
                        `,ne.appendChild(ge)}),k())}catch(de){console.error("[WorkshopOrderEdit] Error loading services",de)}},Ue=(de=null,oe=null)=>{if(console.log("[WorkshopOrderEdit] openServiceModal called",{serviceId:de,serviceData:oe,serviceModal:r,serviceForm:a,serviceModalTitle:i}),!r){console.error("[WorkshopOrderEdit] serviceModal not found");return}if(!a){console.error("[WorkshopOrderEdit] serviceForm not found");return}te&&(te.value=de||""),i&&(i.textContent=O(de?"Editar servicio":"Agregar servicio")),y&&(y.value="");const fe=s?.querySelector("[data-select-value]");fe&&(fe.textContent=s?.querySelector("[data-select-trigger]")?.dataset.selectPlaceholder||O("Selecciona una categoría"));const ge=s?.querySelector("[data-select-dropdown]");ge&&(ge.hidden=!0,ge.dataset.open="false");const Ae=s?.querySelector("[data-select-trigger]");Ae&&Ae.setAttribute("aria-expanded","false");const $e=s?.querySelector("[data-select-icon]");$e&&($e.style.transform=""),V&&(V.disabled=!0),C&&(C.disabled=!0);const Re=h?.querySelector("[data-select-trigger]");if(Re&&(Re.disabled=!0,Re.classList.add("opacity-50","cursor-not-allowed")),oe){V&&(V.value=oe.service_id||"");const W=h?.querySelector("[data-select-value]");W&&oe.service_name&&(W.textContent=oe.service_name),N&&(N.value=oe.quantity||"1"),$&&($.value=oe.unit_price||"0"),_&&(_.value=oe.notes||"")}else{a&&a.reset(),N&&(N.value="1"),$&&($.value="0");const W=h?.querySelector("[data-select-value]");W&&(W.textContent=h?.querySelector("[data-select-trigger]")?.dataset.selectPlaceholder||O("Selecciona un servicio"))}V&&(V.value=""),D&&(D.innerHTML=""),C&&(C.value="");const U=h?.querySelector("[data-select-dropdown]");U&&(U.hidden=!0,U.dataset.open="false"),Re&&Re.setAttribute("aria-expanded","false");const F=h?.querySelector("[data-select-icon]");F&&(F.style.transform=""),console.log("[WorkshopOrderEdit] Removing hidden class from serviceModal",{before:r.classList.contains("hidden")}),r.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),console.log("[WorkshopOrderEdit] Service modal opened",{after:r.classList.contains("hidden")})},ze=()=>{if(!r)return;r.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),a&&a.reset(),te&&(te.value=""),y&&(y.value=""),V&&(V.value=""),D&&(D.innerHTML=""),C&&(C.value="");const de=s?.querySelector("[data-select-dropdown]");de&&(de.hidden=!0,de.dataset.open="false");const oe=s?.querySelector("[data-select-trigger]");oe&&(oe.setAttribute("aria-expanded","false"),oe.disabled=!1,oe.classList.remove("opacity-50","cursor-not-allowed"));const fe=s?.querySelector("[data-select-icon]");fe&&(fe.style.transform="");const ge=s?.querySelector("[data-select-value]");ge&&(ge.textContent=oe?.dataset.selectPlaceholder||O("Selecciona una categoría")),V&&(V.disabled=!0),C&&(C.disabled=!0);const Ae=h?.querySelector("[data-select-dropdown]");Ae&&(Ae.hidden=!0,Ae.dataset.open="false");const $e=h?.querySelector("[data-select-trigger]");$e&&($e.setAttribute("aria-expanded","false"),$e.disabled=!0,$e.classList.add("opacity-50","cursor-not-allowed"));const Re=h?.querySelector("[data-select-icon]");Re&&(Re.style.transform="");const U=h?.querySelector("[data-select-value]");U&&$e&&(U.textContent=$e.dataset.selectPlaceholder||O("Selecciona un servicio"))},Ze=async(de=null)=>{if(!a)return;const oe=V?.value?.trim(),fe=parseInt(N?.value||"0",10),ge=parseFloat($?.value||"0"),Ae=_?.value?.trim()||null;if(!oe){alert(O("Selecciona un servicio."));return}if(fe<1){alert(O("La cantidad debe ser mayor a 0."));return}if(ge<0){alert(O("El precio unitario no puede ser negativo."));return}try{const $e=de?`${m}/workshop/work-orders/${n}/services/${de}`:`${m}/workshop/work-orders/${n}/services`,Re=de?"PATCH":"POST",U={...de?{}:{service_id:oe},quantity:fe,unit_price:ge,...Ae?{notes:Ae}:{}},F=await fetch($e,{method:Re,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d},body:JSON.stringify(U)}),W=await F.json();F.ok&&W?.status==="success"?(ze(),Qe()):alert(W?.message||O("Error al guardar el servicio."))}catch($e){console.error("[WorkshopOrderEdit] Error saving service",$e),alert(O("Error al guardar el servicio."))}},mt=async de=>{if(!(!de||!confirm(O("¿Estás seguro de eliminar este servicio?"))))try{const oe=await fetch(`${m}/workshop/work-orders/${n}/services/${de}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":d}}),fe=await oe.json();oe.ok&&fe?.status==="success"?Qe():alert(fe?.message||O("Error al eliminar el servicio."))}catch(oe){console.error("[WorkshopOrderEdit] Error deleting service",oe),alert(O("Error al eliminar el servicio."))}},it=t.querySelector("[data-order-note-add]");it?it.addEventListener("click",de=>{de.preventDefault(),de.stopPropagation(),console.log("[WorkshopOrderEdit] Note add button clicked",{noteModal:c,noteForm:f}),ve()}):console.warn("[WorkshopOrderEdit] Note add button not found"),t.addEventListener("click",de=>{const oe=de.target.closest("[data-order-note-edit]");if(oe){const ge=oe.dataset.noteId,Ae=oe.dataset.noteText||"";ve(ge,Ae);return}const fe=de.target.closest("[data-order-note-delete]");if(fe){const ge=fe.dataset.noteId;Ce(ge);return}}),f?.addEventListener("submit",de=>{de.preventDefault();const oe=P?.value||null;_e(oe)}),c?.querySelectorAll("[data-order-note-modal-close]").forEach(de=>{de.addEventListener("click",qe)});const ct=t.querySelector("[data-order-item-add]");if(ct?ct.addEventListener("click",de=>{de.preventDefault(),de.stopPropagation(),console.log("[WorkshopOrderEdit] Item add button clicked",{itemModal:L,itemForm:E}),K()}):console.warn("[WorkshopOrderEdit] Item add button not found"),t.addEventListener("click",de=>{const oe=de.target.closest("[data-order-item-edit]");if(oe){const ge=oe.dataset.itemId,Ae={product_id:oe.dataset.itemProductId,product_name:oe.dataset.itemProductName,quantity:oe.dataset.itemQuantity,unit_price:oe.dataset.itemUnitPrice,notes:oe.dataset.itemNotes};K(ge,Ae);return}const fe=de.target.closest("[data-order-item-delete]");if(fe){const ge=fe.dataset.itemId;Ie(ge);return}}),A&&B){const de=A.querySelector("[data-select-trigger]"),oe=A.querySelector("[data-select-dropdown]"),fe=A.querySelector("[data-select-icon]");de?.addEventListener("click",ge=>{ge.preventDefault(),ge.stopPropagation();const Ae=oe?.dataset.open==="true";oe&&(oe.hidden=Ae,oe.dataset.open=Ae?"false":"true",de.setAttribute("aria-expanded",!Ae),fe&&(fe.style.transform=Ae?"":"rotate(180deg)"),!Ae&&ie&&Z(""))}),B.addEventListener("input",ge=>{ge.stopPropagation();const Ae=ge.target.value.trim();Z(Ae)}),document.addEventListener("click",ge=>{A&&!A.contains(ge.target)&&oe&&oe.dataset.open==="true"&&(oe.hidden=!0,oe.dataset.open="false",de?.setAttribute("aria-expanded","false"),fe&&(fe.style.transform=""))})}if(Y){const de=Y.querySelector("[data-select-trigger]"),oe=Y.querySelector("[data-select-dropdown]"),fe=Y.querySelector("[data-select-icon]");de&&!de.dataset.initialized&&(de.dataset.initialized="true",de.addEventListener("click",ge=>{ge.preventDefault(),ge.stopPropagation();const Ae=oe?.dataset.open==="true";oe&&(oe.hidden=Ae,oe.dataset.open=Ae?"false":"true",de.setAttribute("aria-expanded",!Ae),fe&&(fe.style.transform=Ae?"":"rotate(180deg)"))})),document.addEventListener("click",ge=>{Y&&!Y.contains(ge.target)&&oe&&oe.dataset.open==="true"&&(oe.hidden=!0,oe.dataset.open="false",de?.setAttribute("aria-expanded","false"),fe&&(fe.style.transform=""))})}Ge(),E?.addEventListener("submit",de=>{de.preventDefault();const oe=re?.value||null;xe(oe)}),L?.querySelectorAll("[data-order-item-modal-close]").forEach(de=>{de.addEventListener("click",ye)});const at=t.querySelector("[data-order-service-add]");if(at?at.addEventListener("click",de=>{de.preventDefault(),de.stopPropagation(),console.log("[WorkshopOrderEdit] Service add button clicked",{serviceModal:r,serviceForm:a}),Ue()}):console.warn("[WorkshopOrderEdit] Service add button not found"),t.addEventListener("click",de=>{const oe=de.target.closest("[data-order-service-edit]");if(oe){const ge=oe.dataset.serviceId,Ae={service_id:oe.dataset.serviceServiceId,service_name:oe.dataset.serviceServiceName,quantity:oe.dataset.serviceQuantity,unit_price:oe.dataset.serviceUnitPrice,notes:oe.dataset.serviceNotes};Ue(ge,Ae);return}const fe=de.target.closest("[data-order-service-delete]");if(fe){const ge=fe.dataset.serviceId;mt(ge);return}}),s){const de=s.querySelector("[data-select-trigger]"),oe=s.querySelector("[data-select-dropdown]"),fe=s.querySelector("[data-select-icon]");de&&!de.dataset.initialized&&(de.dataset.initialized="true",de.addEventListener("click",ge=>{ge.preventDefault(),ge.stopPropagation(),ge.stopImmediatePropagation();const Ae=oe?.dataset.open==="true";oe&&(Ae?(oe.hidden=!0,oe.dataset.open="false",de.setAttribute("aria-expanded","false"),fe&&(fe.style.transform="")):(oe.hidden=!1,oe.dataset.open="true",de.setAttribute("aria-expanded","true"),fe&&(fe.style.transform="rotate(180deg)"),l&&Je()))},!0)),document.addEventListener("click",ge=>{s&&!s.contains(ge.target)&&oe&&oe.dataset.open==="true"&&(oe.hidden=!0,oe.dataset.open="false",de?.setAttribute("aria-expanded","false"),fe&&(fe.style.transform=""))})}if(h&&C){const de=h.querySelector("[data-select-trigger]"),oe=h.querySelector("[data-select-dropdown]"),fe=h.querySelector("[data-select-icon]");de&&!de.dataset.initialized&&(de.dataset.initialized="true",de.addEventListener("click",ge=>{ge.preventDefault(),ge.stopPropagation(),ge.stopImmediatePropagation();const Ae=y?.value?.trim();if(!Ae){oe&&(oe.hidden=!0,oe.dataset.open="false"),de.setAttribute("aria-expanded","false"),fe&&(fe.style.transform=""),alert(O("Primero debes seleccionar una categoría"));return}const $e=oe?.dataset.open==="true";oe&&($e?(oe.hidden=!0,oe.dataset.open="false",de.setAttribute("aria-expanded","false"),fe&&(fe.style.transform="")):(oe.hidden=!1,oe.dataset.open="true",de.setAttribute("aria-expanded","true"),fe&&(fe.style.transform="rotate(180deg)"),D&&Xe("",Ae)))},!0)),C.addEventListener("input",ge=>{ge.stopPropagation();const Ae=ge.target.value.trim(),$e=y?.value?.trim();if(!$e){D&&(D.innerHTML='<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">'+O("Primero selecciona una categoría")+"</div>");return}Xe(Ae,$e)}),document.addEventListener("click",ge=>{h&&!h.contains(ge.target)&&oe&&oe.dataset.open==="true"&&(oe.hidden=!0,oe.dataset.open="false",de?.setAttribute("aria-expanded","false"),fe&&(fe.style.transform=""))})}a?.addEventListener("submit",de=>{de.preventDefault();const oe=te?.value||null;Ze(oe)}),r?.querySelectorAll("[data-order-service-modal-close]").forEach(de=>{de.addEventListener("click",ze)}),T().then(()=>{const oe=t.querySelector('[data-select-name="category_id"] [data-select-input]')?.value||"";oe&&z(oe)}),Q(),I(),Qe(),k()},ws=()=>{const t=document.querySelector("[data-pos-root]");if(!t)return;const n=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",d=window.location.origin,m=`${d}/pos/search/customers`,p=`${d}/pos/search/products`,u=`${d}/pos/search/services`,o=`${d}/pos/search/users`,c=`${d}/pos/search/work-orders`,f=`${d}/pos`;let x="products",S=[],P=null,M=null,L=null;const E=t.querySelector("[data-pos-salesperson-trigger]"),R=t.querySelector("[data-pos-salesperson-display]"),A=t.querySelector("[data-pos-salesperson-search]"),B=t.querySelector("[data-pos-salesperson-id]"),ie=t.querySelector("[data-pos-salesperson-dropdown]"),se=t.querySelector("[data-pos-salesperson-results]"),Y=t.querySelector("[data-pos-salesperson-selected]"),J=t.querySelector("[data-pos-salesperson-name]"),G=t.querySelector("[data-pos-salesperson-clear]"),me=t.querySelector("[data-pos-customer-trigger]"),le=t.querySelector("[data-pos-customer-display]"),pe=t.querySelector("[data-pos-customer-search]"),re=t.querySelector("[data-pos-customer-id]"),ne=t.querySelector("[data-pos-customer-dropdown]"),r=t.querySelector("[data-pos-customer-results]"),a=t.querySelector("[data-pos-customer-selected]"),i=t.querySelector("[data-pos-customer-name]"),s=t.querySelector("[data-pos-customer-clear]"),l=t.querySelector("[data-pos-work-order-trigger]"),y=t.querySelector("[data-pos-work-order-display]"),h=t.querySelector("[data-pos-work-order-search]"),C=t.querySelector("[data-pos-work-order-id]"),D=t.querySelector("[data-pos-work-order-dropdown]"),V=t.querySelector("[data-pos-work-order-results]"),N=t.querySelector("[data-pos-work-order-selected]"),$=t.querySelector("[data-pos-work-order-number]"),_=t.querySelector("[data-pos-work-order-customer]"),te=t.querySelector("[data-pos-work-order-clear]"),j=t.querySelector("[data-pos-item-search]"),X=t.querySelector("[data-pos-products-grid]"),b=t.querySelector("[data-pos-cart-items]"),v=t.querySelector("[data-pos-complete-sale]"),H=t.querySelector("[data-pos-clear-cart]"),O=t.querySelector("[data-pos-payment-modal]"),q=t.querySelectorAll("[data-pos-payment-close]"),T=t.querySelector("[data-pos-payment-subtotal]"),z=t.querySelector("[data-pos-payment-tax]"),w=t.querySelector("[data-pos-payment-total]");t.querySelector("[data-pos-payment-method]");const k=t.querySelector("[data-pos-payment-notes]"),Q=t.querySelector("[data-pos-payment-confirm]"),ve=t.querySelectorAll("[data-pos-tab]"),qe=t.querySelector("[data-pos-subtotal]"),_e=t.querySelector("[data-pos-tax]"),Ce=t.querySelector("[data-pos-total]"),Le=t.querySelector("[data-pos-items-count]"),Ve=t.querySelector("[data-pos-products-count]"),Ge=t.querySelector("[data-pos-services-count]"),Te=F=>{try{if(typeof window<"u"&&typeof window.gettext=="function")return window.gettext(F)}catch(W){console.warn("[POS] translate error",W,F)}return F},Z=F=>`USD ${Number(F).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}`;let I=0;const K=()=>{const F=S.reduce((je,Ye)=>je+Ye.quantity*Ye.unit_price,0),W=F*.15,ce=F+W,be=Math.max(0,ce-I);qe&&(qe.textContent=Z(F)),_e&&(_e.textContent=Z(W)),Ce&&(Ce.textContent=Z(ce)),T&&(T.textContent=Z(F)),z&&(z.textContent=Z(W)),w&&(w.textContent=Z(ce));const Ee=t.querySelector("[data-pos-advance]"),Se=t.querySelector("[data-pos-advance-amount]"),Me=t.querySelector("[data-pos-remaining]"),ke=t.querySelector("[data-pos-remaining-amount]");I>0?(Ee&&(Ee.style.display="flex"),Se&&(Se.textContent=Z(I)),Me&&(Me.style.display="flex"),ke&&(ke.textContent=Z(be))):(Ee&&(Ee.style.display="none"),Me&&(Me.style.display="none"));const Pe=S.filter(je=>je.item_type==="product").reduce((je,Ye)=>je+Ye.quantity,0),Be=S.filter(je=>je.item_type==="service").reduce((je,Ye)=>je+Ye.quantity,0);Le&&(Le.textContent=S.reduce((je,Ye)=>je+Ye.quantity,0)),Ve&&(Ve.textContent=Pe),Ge&&(Ge.textContent=Be),v&&(v.disabled=!P||S.length===0)},ye=()=>{if(b){if(S.length===0){b.innerHTML=`
                <div class="rounded-lg border-2 border-dashed border-gray-300 p-8 text-center dark:border-gray-700">
                    <i class="fa-solid fa-shopping-cart mb-3 text-4xl text-gray-400"></i>
                    <p class="text-sm text-gray-500 dark:text-gray-400">${Te("Carrito vacío")}</p>
                </div>
            `;return}b.innerHTML=S.map((F,W)=>`
            <div class="rounded-lg border border-gray-200 bg-gray-50 p-3 shadow-sm dark:border-gray-800 dark:bg-slate-900/50" data-cart-item="${W}">
                <div class="flex items-start justify-between gap-3">
                    <div class="flex-1">
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-white">${F.name}</h3>
                        ${F.sku?`<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">${F.sku}</p>`:""}
                        <div class="mt-2 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <button
                                    type="button"
                                    data-cart-item-decrease="${W}"
                                    class="flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition hover:bg-gray-50 active:scale-95 dark:border-gray-700 dark:bg-slate-900 dark:text-gray-300 touch-manipulation"
                                >
                                    <i class="fa-solid fa-minus text-xs"></i>
                                </button>
                                <input
                                    type="number"
                                    data-cart-item-quantity="${W}"
                                    value="${F.quantity}"
                                    min="1"
                                    class="w-16 rounded-lg border border-gray-300 bg-white px-2 py-1 text-center text-sm font-semibold text-gray-900 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                                >
                                <button
                                    type="button"
                                    data-cart-item-increase="${W}"
                                    class="flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition hover:bg-gray-50 active:scale-95 dark:border-gray-700 dark:bg-slate-900 dark:text-gray-300 touch-manipulation"
                                >
                                    <i class="fa-solid fa-plus text-xs"></i>
                                </button>
                            </div>
                            <div class="text-right">
                                <p class="text-xs font-medium text-gray-600 dark:text-gray-400">${Z(F.unit_price)}</p>
                                <p class="text-base font-bold text-primary">${Z(F.quantity*F.unit_price)}</p>
                            </div>
                        </div>
                    </div>
                    <button
                        type="button"
                        data-cart-item-remove="${W}"
                        class="flex h-8 w-8 items-center justify-center rounded-lg text-rose-500 transition hover:bg-rose-50 active:scale-95 dark:hover:bg-rose-900/20 touch-manipulation"
                    >
                        <i class="fa-solid fa-trash text-sm"></i>
                    </button>
                </div>
            </div>
        `).join("")}},xe=()=>{ie&&ie.classList.add("hidden"),ne&&ne.classList.add("hidden"),D&&D.classList.add("hidden")},Ie=(F,W,ce)=>{if(!F){console.warn("[POS] Dropdown not found",F);return}F.classList.contains("hidden")?(xe(),F.classList.remove("hidden"),W&&(W.value="",requestAnimationFrame(()=>{W.focus()})),ce&&ce("")):F.classList.add("hidden")};let we=[];const Ne=t.querySelector("[data-pos-payment-methods]"),Je=t.querySelector("[data-pos-add-payment-method]"),Xe=t.querySelector("[data-pos-payment-total-paid]"),Qe=t.querySelector("[data-pos-document-type]"),Ue=t.querySelector("[data-pos-payment-advance]"),ze=t.querySelector("[data-pos-payment-advance-amount]"),Ze=t.querySelector("[data-pos-payment-remaining]"),mt=t.querySelector("[data-pos-payment-remaining-amount]"),it=[{id:"EFECTIVO",name:"EFECTIVO"},{id:"TRANSFERENCIA",name:"TRANSFERENCIA"},{id:"TARJETA",name:"TARJETA"}],ct=()=>{Ne&&(we.length===0?Ne.innerHTML='<p class="text-sm text-gray-500 dark:text-gray-400 text-center py-2">'+Te("No hay métodos de pago agregados")+"</p>":(Ne.innerHTML=we.map((F,W)=>`
                <div class="space-y-3 rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-slate-800" data-payment-method-item="${W}">
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1" data-select data-select-name="payment_method_${W}" data-select-manual="true">
                            <input type="hidden" data-payment-method-type="${W}" data-select-input value="${F.type||""}">
                            <button
                                type="button"
                                class="flex w-full items-center justify-between rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/15 dark:border-surface dark:bg-slate-900 dark:text-white"
                                data-select-trigger
                                data-select-placeholder="${Te("Seleccionar método...")}"
                            >
                                <span data-select-value class="truncate">${F.type?it.find(ce=>ce.id===F.type)?.name||F.type:Te("Seleccionar método...")}</span>
                                <i class="fa-solid fa-chevron-down text-xs text-secondary transition" data-select-icon></i>
                            </button>
                            <div
                                class="invisible absolute left-0 right-0 z-50 mt-2 w-full origin-top scale-95 transform rounded-lg border border-gray-200 bg-white shadow-xl opacity-0 transition will-change-transform data-[open='true']:visible data-[open='true']:scale-100 data-[open='true']:opacity-100 dark:border-gray-700 dark:bg-slate-900"
                                data-select-dropdown
                                hidden
                            >
                                <div class="max-h-60 overflow-y-auto py-2">
                                    ${it.map(ce=>`
                                        <button
                                            type="button"
                                            class="w-full px-4 py-2 text-left text-sm text-gray-700 transition hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-slate-800"
                                            data-value="${ce.id}"
                                            data-select-option
                                        >
                                            ${ce.name}
                                        </button>
                                    `).join("")}
                                </div>
                            </div>
                        </div>
                        <input
                            type="number"
                            data-payment-method-amount="${W}"
                            step="0.01"
                            min="0"
                            placeholder="0.00"
                            value="${F.amount||""}"
                            class="w-32 rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                        >
                        <button
                            type="button"
                            data-payment-method-remove="${W}"
                            class="flex h-9 w-9 items-center justify-center rounded-lg text-rose-500 transition hover:bg-rose-50 active:scale-95 dark:hover:bg-rose-900/20"
                        >
                            <i class="fa-solid fa-times text-sm"></i>
                        </button>
                    </div>
                    <div class="payment-method-reference" data-payment-method-reference="${W}" style="display: ${F.type==="TRANSFERENCIA"||F.type==="TARJETA"?"block":"none"};">
                        <label class="mb-1 block text-xs font-semibold text-gray-600 dark:text-gray-400">
                            ${Te("Número de referencia")} <span class="text-rose-500">*</span>
                        </label>
                        <input
                            type="text"
                            data-payment-method-reference-input="${W}"
                            placeholder="${Te("Ingrese el número de referencia")}"
                            value="${F.reference||""}"
                            class="w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                        >
                    </div>
                </div>
            `).join(""),we.forEach((F,W)=>{const ce=Ne.querySelector(`[data-payment-method-item="${W}"]`),be=ce?.querySelector(`[data-select-name="payment_method_${W}"]`),Ee=ce?.querySelector(`[data-payment-method-type="${W}"]`),Se=ce?.querySelector(`[data-payment-method-amount="${W}"]`),Me=ce?.querySelector(`[data-payment-method-reference-input="${W}"]`),ke=ce?.querySelector(`[data-payment-method-reference="${W}"]`),Pe=ce?.querySelector(`[data-payment-method-remove="${W}"]`);if(be){const Be=be.querySelector("[data-select-trigger]"),je=be.querySelector("[data-select-dropdown]"),Ye=be.querySelector("[data-select-value]"),yt=be.querySelectorAll("[data-select-option]");if(Be&&je){const ut=()=>{je.hidden=!0,je.dataset.open="false",be.dataset.open="false",Be.setAttribute("aria-expanded","false");const et=be.querySelector("[data-select-icon]");et&&et.classList.remove("rotate-180")},lt=()=>{je.hidden=!1,je.dataset.open="true",be.dataset.open="true",Be.setAttribute("aria-expanded","true");const et=be.querySelector("[data-select-icon]");et&&et.classList.add("rotate-180")};Be.addEventListener("click",et=>{et.preventDefault(),et.stopPropagation(),je.dataset.open==="true"?ut():lt()}),yt.forEach(et=>{et.addEventListener("click",ee=>{ee.preventDefault(),ee.stopPropagation();const ae=et.dataset.value;Ee&&(Ee.value=ae),Ye&&(Ye.textContent=et.textContent.trim()),we[W].type=ae,ke&&(ae==="TRANSFERENCIA"||ae==="TARJETA"?ke.style.display="block":(ke.style.display="none",Me&&(Me.value=""),we[W].reference="")),ut(),at()})}),document.addEventListener("click",et=>{be.contains(et.target)||ut()})}}Se&&Se.addEventListener("input",Be=>{we[W].amount=parseFloat(Be.target.value)||0,at()}),Me&&Me.addEventListener("input",Be=>{we[W].reference=Be.target.value.trim()}),Pe&&Pe.addEventListener("click",()=>{we.splice(W,1),ct(),at()})})))},at=()=>{const F=S.reduce((Se,Me)=>Se+Me.quantity*Me.unit_price,0),W=F*.15,ce=F+W,be=Math.max(0,ce-I),Ee=we.reduce((Se,Me)=>Se+(parseFloat(Me.amount)||0),0);Xe&&(Xe.textContent=Z(Ee)),I>0?(Ue&&(Ue.style.display="flex"),ze&&(ze.textContent=Z(I)),Ze&&(Ze.style.display="flex"),mt&&(mt.textContent=Z(be-Ee))):(Ue&&(Ue.style.display="none"),Ze&&(Ze.style.display="none"))},de=()=>{we.push({type:"",amount:0,reference:""}),ct()},oe=()=>{O&&(we=[],ct(),K(),at(),I>0?(Ue&&(Ue.style.display="flex"),ze&&(ze.textContent=Z(I)),Ze&&(Ze.style.display="flex")):(Ue&&(Ue.style.display="none"),Ze&&(Ze.style.display="none")),O.classList.remove("hidden"),O.classList.add("flex"),Je&&Je.focus())},fe=()=>{O&&(O.classList.add("hidden"),O.classList.remove("flex"),k&&(k.value=""),we=[],ct(),Qe&&(Qe.checked=!1))};let ge={};const Ae=async(F="")=>{clearTimeout(ge.salesperson),ge.salesperson=setTimeout(async()=>{try{const W=F?`?search=${encodeURIComponent(F)}&limit=50`:"?limit=50",be=await(await fetch(`${o}${W}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();be?.status==="success"&&be?.data?.items&&se&&(se.innerHTML="",be.data.items.length===0?se.innerHTML=`<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${Te("No se encontraron vendedores")}</div>`:be.data.items.forEach(Ee=>{const Se=document.createElement("button");Se.type="button",Se.className="flex w-full items-center justify-between px-4 py-3 text-left text-sm text-gray-900 transition hover:bg-primary/10 active:bg-primary/20 dark:text-white dark:hover:bg-slate-800 touch-manipulation";const Me=Ee.name||Ee.full_name||Ee.email||"";Se.innerHTML=`
                                <div>
                                    <p class="font-medium">${Me}</p>
                                    ${Ee.email?`<p class="text-xs text-gray-500 dark:text-gray-400">${Ee.email}</p>`:""}
                                </div>
                            `,Se.addEventListener("click",()=>{M=Ee;const ke=Ee.name||Ee.full_name||Ee.email||"";B&&(B.value=Ee.id),R&&(R.textContent=ke),J&&(J.textContent=ke),Y&&(Y.style.display="flex"),E&&(E.style.display="none"),A&&(A.value=""),ie&&ie.classList.add("hidden")}),se.appendChild(Se)}))}catch(W){console.error("[POS] Error loading salespersons",W)}},300)},$e=async(F="")=>{clearTimeout(ge.customer),ge.customer=setTimeout(async()=>{try{const W=F?`?search=${encodeURIComponent(F)}&limit=50`:"?limit=50",be=await(await fetch(`${m}${W}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();be?.status==="success"&&be?.data?.items&&r&&(r.innerHTML="",be.data.items.length===0?r.innerHTML=`<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${Te("No se encontraron clientes")}</div>`:be.data.items.forEach(Ee=>{const Se=document.createElement("button");Se.type="button",Se.className="flex w-full items-center justify-between px-4 py-3 text-left text-sm text-gray-900 transition hover:bg-primary/10 active:bg-primary/20 dark:text-white dark:hover:bg-slate-800 touch-manipulation";const Me=Ee.name||Ee.display_name||"";Se.innerHTML=`
                                <div>
                                    <p class="font-medium">${Me}</p>
                                    ${Ee.document_number?`<p class="text-xs text-gray-500 dark:text-gray-400">${Ee.document_number}</p>`:""}
                                </div>
                            `,Se.addEventListener("click",()=>{P=Ee;const ke=Ee.name||Ee.display_name||"";re&&(re.value=Ee.id),le&&(le.textContent=ke),i&&(i.textContent=ke),a&&(a.style.display="flex"),me&&(me.style.display="none"),pe&&(pe.value=""),ne&&ne.classList.add("hidden"),Ee.id&&Re("",Ee.id),K()}),r.appendChild(Se)}))}catch(W){console.error("[POS] Error loading customers",W)}},300)},Re=async(F="",W=null)=>{clearTimeout(ge.workOrder),ge.workOrder=setTimeout(async()=>{try{let ce=F?`?search=${encodeURIComponent(F)}`:"?";W&&(ce+=ce.includes("?")&&ce!=="?"?"&":"",ce+=`customer_id=${encodeURIComponent(W)}`),ce+=ce.includes("?")&&ce!=="?"?"&":"",ce+="limit=50";const Ee=await(await fetch(`${c}${ce}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();Ee?.status==="success"&&Ee?.data?.items&&V&&(V.innerHTML="",Ee.data.items.length===0?V.innerHTML=`<div class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">${Te("No se encontraron órdenes")}</div>`:Ee.data.items.forEach(Se=>{const Me=document.createElement("button");Me.type="button",Me.className="flex w-full items-center justify-between px-4 py-3 text-left text-sm text-gray-900 transition hover:bg-primary/10 active:bg-primary/20 dark:text-white dark:hover:bg-slate-800 touch-manipulation",Me.innerHTML=`
                                <div>
                                    <p class="font-medium">${Se.order_number}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">${Se.customer_name} - ${Z(Se.total_cost)}</p>
                                </div>
                            `,Me.addEventListener("click",()=>{L=Se,C&&(C.value=Se.id),y&&(y.textContent=Se.order_number),$&&($.textContent=Se.order_number),_&&(_.textContent=Se.customer_name),N&&(N.style.display="block"),l&&(l.style.display="none"),h&&(h.value=""),D&&D.classList.add("hidden"),Se.customer_id&&(!P||P.id!==Se.customer_id)&&fetch(`${m}?search=&limit=100`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(ke=>ke.json()).then(ke=>{if(ke?.status==="success"&&ke?.data?.items){const Pe=ke.data.items.find(Be=>Be.id===Se.customer_id);if(Pe){P=Pe;const Be=Pe.name||Pe.display_name||"";re&&(re.value=Pe.id),le&&(le.textContent=Be),i&&(i.textContent=Be),a&&(a.style.display="flex"),me&&(me.style.display="none")}}}).catch(ke=>{console.error("[POS] Error loading customer from order",ke)}),I=parseFloat(Se.total_advances||0),S=[],Se.items&&Se.items.length>0&&Se.items.forEach(ke=>{S.push({item_id:ke.item_id,item_type:ke.item_type,name:ke.name||"Producto",sku:ke.sku||"",quantity:ke.quantity,unit_price:ke.unit_price})}),Se.services&&Se.services.length>0&&Se.services.forEach(ke=>{S.push({item_id:ke.item_id,item_type:ke.item_type,name:ke.name||"Servicio",sku:ke.sku||"",quantity:ke.quantity,unit_price:ke.unit_price})}),ye(),K()}),V.appendChild(Me)}))}catch(ce){console.error("[POS] Error loading work orders",ce)}},300)},U=async(F="")=>{clearTimeout(ge.item),ge.item=setTimeout(async()=>{try{const W=x==="products"?p:u,ce=F?`?search=${encodeURIComponent(F)}&limit=100`:"?limit=100",Ee=await(await fetch(`${W}${ce}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();Ee?.status==="success"&&Ee?.data?.items&&X&&(Ee.data.items.length===0?X.innerHTML=`
                            <div class="col-span-full rounded-xl border-2 border-dashed border-gray-300 p-12 text-center dark:border-gray-700">
                                <i class="fa-solid fa-box-open mb-4 text-5xl text-gray-400"></i>
                                <p class="text-gray-500 dark:text-gray-400">${Te("No se encontraron resultados")}</p>
                            </div>
                        `:(X.innerHTML=Ee.data.items.map(Se=>{const Me=S.find(Pe=>Pe.item_id===Se.id&&Pe.item_type===(x==="products"?"product":"service")),ke=Me!==void 0;return`
                                <div
                                    class="group relative cursor-pointer rounded-lg border-2 border-gray-200 bg-white p-4 text-center transition-all hover:border-primary hover:shadow-lg active:scale-95 dark:border-gray-700 dark:bg-slate-800 touch-manipulation ${ke?"border-primary bg-primary/5":""}"
                                    data-pos-product-item="${Se.id}"
                                    data-pos-product-type="${x==="products"?"product":"service"}"
                                >
                                    ${Se.image_url?`
                                        <img
                                            src="${Se.image_url}"
                                            alt="${Se.name}"
                                            class="mx-auto mb-3 h-20 w-20 rounded-lg object-cover"
                                            onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'80\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'80\\' height=\\'80\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\' font-family=\\'sans-serif\\' font-size=\\'12\\'%3E${Te("Sin imagen")}%3C/text%3E%3C/svg%3E'"
                                        >
                                    `:`
                                        <div class="mx-auto mb-3 flex h-20 w-20 items-center justify-center rounded-lg bg-gray-100 dark:bg-slate-700">
                                            <i class="fa-solid ${x==="products"?"fa-box":"fa-wrench"} text-3xl text-gray-400"></i>
                                        </div>
                                    `}
                                    <h3 class="mb-2 text-sm font-semibold text-gray-900 line-clamp-2 dark:text-white">
                                        ${Se.name}
                                    </h3>
                                    ${Se.sku?`<p class="mb-2 text-xs text-gray-500 dark:text-gray-400">${Se.sku}</p>`:""}
                                    <p class="text-lg font-bold text-primary">
                                        ${Z(Se.price)}
                                    </p>
                                    ${Se.stock!==void 0?`
                                        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                                            ${Te("Stock")}: ${Se.stock}
                                        </p>
                                    `:""}
                                    ${ke?`
                                        <div class="absolute top-2 right-2 rounded-full bg-primary px-2 py-1 text-xs font-bold text-white">
                                            ${Me.quantity}
                                        </div>
                                    `:""}
                                </div>
                            `}).join(""),X.querySelectorAll("[data-pos-product-item]").forEach(Se=>{Se.addEventListener("click",()=>{const Me=Se.dataset.posProductItem,ke=Se.dataset.posProductType,Pe=Ee.data.items.find(je=>je.id===Me);if(!Pe)return;const Be=S.findIndex(je=>je.item_id===Pe.id&&je.item_type===ke);Be>=0?S[Be].quantity+=1:S.push({item_id:Pe.id,item_type:ke,name:Pe.name,sku:Pe.sku||"",quantity:1,unit_price:Pe.price}),ye(),K(),U(j?.value||"")})})))}catch(W){console.error("[POS] Error loading items",W),X&&(X.innerHTML=`
                        <div class="col-span-full rounded-xl border-2 border-dashed border-red-300 p-12 text-center dark:border-red-700">
                            <i class="fa-solid fa-exclamation-triangle mb-4 text-5xl text-red-400"></i>
                            <p class="text-red-500 dark:text-red-400">${Te("Error al cargar productos")}</p>
                        </div>
                    `)}},300)};E&&ie?E.addEventListener("click",F=>{F.preventDefault(),F.stopPropagation(),Ie(ie,A,Ae)}):console.warn("[POS] Salesperson trigger or dropdown not found",{salespersonTrigger:E,salespersonDropdown:ie}),me&&ne?me.addEventListener("click",F=>{F.preventDefault(),F.stopPropagation(),Ie(ne,pe,$e)}):console.warn("[POS] Customer trigger or dropdown not found",{customerTrigger:me,customerDropdown:ne}),l&&D?l.addEventListener("click",F=>{F.preventDefault(),F.stopPropagation(),Ie(D,h,Re)}):console.warn("[POS] Work order trigger or dropdown not found",{workOrderTrigger:l,workOrderDropdown:D}),A&&A.addEventListener("input",F=>{Ae(F.target.value)}),pe&&pe.addEventListener("input",F=>{$e(F.target.value)}),h&&h.addEventListener("input",F=>{Re(F.target.value)}),j&&(j.addEventListener("input",F=>{U(F.target.value)}),U("")),ve.forEach(F=>{F.addEventListener("click",()=>{const W=F.dataset.posTab;x=W,ve.forEach(be=>{be.dataset.posTab===W?(be.classList.remove("bg-gray-200","text-gray-700","dark:bg-slate-700","dark:text-gray-300","dark:hover:bg-slate-600"),be.classList.add("bg-primary","text-white","hover:bg-primary-strong")):(be.classList.remove("bg-primary","text-white","hover:bg-primary-strong"),be.classList.add("bg-gray-200","text-gray-700","dark:bg-slate-700","dark:text-gray-300","dark:hover:bg-slate-600"))}),j&&(j.placeholder=Te(W==="products"?"Buscar productos por nombre o SKU...":"Buscar servicios por nombre..."),j.value="");const ce=t.querySelector("[data-pos-products-title]");ce&&(ce.textContent=Te(W==="products"?"Productos Disponibles":"Servicios Disponibles")),U("")})}),b?.addEventListener("click",F=>{const W=F.target.closest("[data-cart-item-decrease]");if(W){const Ee=parseInt(W.dataset.cartItemDecrease);S[Ee].quantity>1&&(S[Ee].quantity-=1,ye(),K());return}const ce=F.target.closest("[data-cart-item-increase]");if(ce){const Ee=parseInt(ce.dataset.cartItemIncrease);S[Ee].quantity+=1,ye(),K();return}const be=F.target.closest("[data-cart-item-remove]");if(be){const Ee=parseInt(be.dataset.cartItemRemove);S.splice(Ee,1),ye(),K();return}}),b?.addEventListener("change",F=>{const W=F.target.closest("[data-cart-item-quantity]");if(W){const ce=parseInt(W.dataset.cartItemQuantity),be=parseInt(W.value)||1;S[ce].quantity=Math.max(1,be),ye(),K()}}),G&&G.addEventListener("click",()=>{M=null,B&&(B.value=""),Y&&(Y.style.display="none"),E&&(E.style.display="flex"),R&&(R.textContent=Te("Seleccionar vendedor..."))}),s&&s.addEventListener("click",()=>{P=null,re&&(re.value=""),a&&(a.style.display="none"),me&&(me.style.display="flex"),le&&(le.textContent=Te("Seleccionar cliente...")),K()}),te&&te.addEventListener("click",()=>{L=null,I=0,C&&(C.value=""),N&&(N.style.display="none"),l&&(l.style.display="flex"),y&&(y.textContent=Te("Seleccionar orden de trabajo...")),K()}),v&&v.addEventListener("click",()=>{!P||S.length===0||oe()}),H&&H.addEventListener("click",()=>{S.length!==0&&Dr().then(F=>{F.fire({title:Te("¿Limpiar el carrito?"),text:Te("Esta acción eliminará todos los items del carrito."),icon:"warning",showCancelButton:!0,confirmButtonText:Te("Sí, limpiar"),cancelButtonText:Te("Cancelar")}).then(W=>{W.isConfirmed&&(S=[],I=0,ye(),K(),U(j?.value||""))})})}),q.forEach(F=>{F.addEventListener("click",()=>{fe()})}),O&&O.addEventListener("click",F=>{F.target===O&&fe()}),document.addEventListener("keydown",F=>{F.key==="Escape"&&O&&!O.classList.contains("hidden")&&fe()}),Je&&Je.addEventListener("click",()=>{de()}),Q&&Q.addEventListener("click",async()=>{if(!P||S.length===0){g({title:Te("Error"),text:Te("Debes seleccionar un cliente y agregar items al carrito."),icon:"error"});return}const F=we.filter(ke=>ke.type&&parseFloat(ke.amount)>0);if(F.length===0){g({title:Te("Error"),text:Te("Debes agregar al menos un método de pago con tipo y monto."),icon:"error"});return}for(const ke of F)if((ke.type==="TRANSFERENCIA"||ke.type==="TARJETA")&&!ke.reference?.trim()){g({title:Te("Error"),text:Te("El número de referencia es requerido para ")+ke.type+".",icon:"error"});return}const W=S.reduce((ke,Pe)=>ke+Pe.quantity*Pe.unit_price,0),ce=W*.15,be=W+ce,Ee=Math.max(0,be-I);if(F.reduce((ke,Pe)=>ke+(parseFloat(Pe.amount)||0),0)>Ee){g({title:Te("Error"),text:Te("El total pagado no puede exceder el restante a pagar."),icon:"error"});return}Q.disabled=!0;const Me=Q.innerHTML;Q.innerHTML=`<i class="fa-solid fa-spinner fa-spin mr-2"></i>${Te("Procesando...")}`;try{const ke=Qe&&Qe.checked?"NOTA DE VENTA":"FACTURA",Be=await(await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":n},body:JSON.stringify({customer_id:P.id,salesperson_id:M?.id||null,work_order_id:L?.id||null,document_type:ke,work_order_advance:I,payment_methods:F.map(je=>({type:je.type,amount:parseFloat(je.amount),reference:je.reference||null})),notes:k?.value||"",items:S.map(je=>({item_id:je.item_id,item_type:je.item_type,quantity:je.quantity,unit_price:je.unit_price}))})})).json();if(Be?.status==="success"){const je=Be.data.invoice?.invoice_number||Be.data.sales_note?.document_number||"",Ye=Te(ke==="NOTA DE VENTA"?"Nota de Venta":"Factura"),yt=Be.data.invoice?.workflow_status==="paid"||Be.data.sales_note?.workflow_status==="paid";g({title:Te("Éxito"),text:`${Te("Venta procesada correctamente.")}

${Ye}: ${je}
${Te(yt?"Estado: Pagado":"Estado: Pendiente de pago")}`,icon:"success"}),S=[],P=null,M=null,L=null,I=0,re&&(re.value=""),B&&(B.value=""),C&&(C.value=""),a&&(a.style.display="none"),Y&&(Y.style.display="none"),N&&(N.style.display="none"),me&&(me.style.display="flex"),E&&(E.style.display="flex"),l&&(l.style.display="flex"),le&&(le.textContent=Te("Seleccionar cliente...")),R&&(R.textContent=Te("Seleccionar vendedor...")),y&&(y.textContent=Te("Buscar orden de trabajo...")),ye(),K(),U(j?.value||""),fe()}else g({title:Te("Error"),text:Be?.message||Te("Error al procesar la venta."),icon:"error"})}catch(ke){console.error("[POS] Error completing sale",ke),g({title:Te("Error"),text:Te("Error al procesar la venta. Inténtalo nuevamente."),icon:"error"})}finally{Q.disabled=!1,Q.innerHTML=Me}}),t.addEventListener("click",F=>{ie&&!ie.classList.contains("hidden")&&ie.contains(F.target)||ne&&!ne.classList.contains("hidden")&&ne.contains(F.target)||D&&!D.classList.contains("hidden")&&D.contains(F.target)||xe()},!1),document.addEventListener("keydown",F=>{F.key==="Escape"&&xe()}),ye(),K()},Ss=()=>{const t=document.querySelector("[data-quotation-form-root]");if(!t)return;const n=window.location.origin,d=t.dataset.quotationId||null,m=`${n}/sales/quotations/search/customers`,p=`${n}/sales/quotations/search/products`,u=`${n}/sales/quotations/search/services`;let o="products",c=[],f=null;const x=t.querySelector("[data-quotation-customer]"),S=t.querySelector("[data-quotation-customer-search]"),P=t.querySelector("[data-quotation-customer-id]"),M=t.querySelector("[data-quotation-customer-results]"),L=t.querySelector("[data-quotation-customer-options]"),E=t.querySelector("[data-quotation-item-search]"),R=t.querySelector("[data-quotation-items-grid]"),A=t.querySelector("[data-quotation-cart-items]"),B=t.querySelector("[data-quotation-total]"),ie=t.querySelector("form"),se=t.querySelectorAll("[data-quotation-tab]"),Y=ne=>{try{if(typeof window<"u"&&typeof window.gettext=="function")return window.gettext(ne)}catch(r){console.warn("[Quotation] translate error",r,ne)}return ne},J=ne=>`USD ${Number(ne).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,G=()=>{const ne=c.reduce((i,s)=>i+s.quantity*s.unit_price,0),r=ne*.15,a=ne+r;B&&(B.textContent=J(a))},me=()=>{if(A){if(c.length===0){A.innerHTML=`
                <div class="rounded-lg border-2 border-dashed border-gray-300 p-8 text-center dark:border-gray-700">
                    <i class="fa-solid fa-shopping-cart mb-3 text-4xl text-gray-400"></i>
                    <p class="text-sm text-gray-500 dark:text-gray-400">${Y("No hay items agregados")}</p>
                </div>
            `;return}A.innerHTML=c.map((ne,r)=>`
            <div class="rounded-lg border border-gray-200 bg-gray-50 p-3 shadow-sm dark:border-gray-800 dark:bg-slate-900/50" data-cart-item="${r}">
                <div class="flex items-start justify-between gap-3">
                    <div class="flex-1">
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-white">${ne.name}</h3>
                        ${ne.sku?`<p class="mt-1 text-xs text-gray-600 dark:text-gray-400">${ne.sku}</p>`:""}
                        <div class="mt-2 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <button
                                    type="button"
                                    data-cart-item-decrease="${r}"
                                    class="flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition hover:bg-gray-50 active:scale-95 dark:border-gray-700 dark:bg-slate-900 dark:text-gray-300"
                                >
                                    <i class="fa-solid fa-minus text-xs"></i>
                                </button>
                                <input
                                    type="number"
                                    data-cart-item-quantity="${r}"
                                    value="${ne.quantity}"
                                    min="1"
                                    class="w-16 rounded-lg border border-gray-300 bg-white px-2 py-1 text-center text-sm font-semibold text-gray-900 outline-none transition focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-gray-700 dark:bg-slate-900 dark:text-white"
                                >
                                <button
                                    type="button"
                                    data-cart-item-increase="${r}"
                                    class="flex h-8 w-8 items-center justify-center rounded-lg border border-gray-300 bg-white text-gray-700 transition hover:bg-gray-50 active:scale-95 dark:border-gray-700 dark:bg-slate-900 dark:text-gray-300"
                                >
                                    <i class="fa-solid fa-plus text-xs"></i>
                                </button>
                            </div>
                            <div class="text-right">
                                <p class="text-xs font-medium text-gray-600 dark:text-gray-400">${J(ne.unit_price)}</p>
                                <p class="text-base font-bold text-primary">${J(ne.quantity*ne.unit_price)}</p>
                            </div>
                        </div>
                    </div>
                    <button
                        type="button"
                        data-cart-item-remove="${r}"
                        class="flex h-8 w-8 items-center justify-center rounded-lg text-rose-500 transition hover:bg-rose-50 active:scale-95 dark:hover:bg-rose-900/20"
                    >
                        <i class="fa-solid fa-trash text-sm"></i>
                    </button>
                </div>
            </div>
        `).join("")}};let le={};const pe=async(ne="")=>{clearTimeout(le.customer),le.customer=setTimeout(async()=>{try{const r=ne?`?search=${encodeURIComponent(ne)}&limit=100`:"?limit=100",i=await(await fetch(`${m}${r}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json(),s=L||M;if(i?.status==="success"&&i?.data?.items&&s){if(L?L.innerHTML="":s.innerHTML="",i.data.items.length===0){const l=document.createElement("div");l.className="px-4 py-3 text-sm text-center text-gray-500 dark:text-gray-400",l.textContent=Y("No se encontraron clientes"),L?L.appendChild(l):s.appendChild(l)}else i.data.items.forEach(l=>{const y=document.createElement("button");y.type="button",y.className="flex w-full items-center justify-between gap-3 px-4 py-3 text-left text-sm text-gray-900 transition hover:bg-primary/10 active:bg-primary/20 dark:text-white dark:hover:bg-slate-800 border-b border-gray-100 dark:border-gray-800 last:border-b-0",y.innerHTML=`
                                <div class="flex-1 min-w-0">
                                    <p class="font-medium text-gray-900 dark:text-white truncate">${l.name||l.display_name||""}</p>
                                    ${l.document_number?`<p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${l.document_number}</p>`:""}
                                    ${l.email?`<p class="text-xs text-gray-400 dark:text-gray-500 mt-0.5 truncate">${l.email}</p>`:""}
                                </div>
                                <i class="fa-solid fa-chevron-right text-xs text-gray-400 flex-shrink-0"></i>
                            `,y.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),f=l,P&&(P.value=l.id),S&&(S.value=l.name||l.display_name||""),M&&(M.hidden=!0,M.dataset.open="false")}),L?L.appendChild(y):s.appendChild(y)});M&&M.hidden&&(M.hidden=!1,M.dataset.open="true")}}catch(r){console.error("[Quotation] Error loading customers",r);const a=L||M;a&&(L?L.innerHTML=`<div class="px-4 py-3 text-sm text-center text-rose-500">${Y("Error al cargar clientes")}</div>`:a.innerHTML=`<div class="px-4 py-3 text-sm text-center text-rose-500">${Y("Error al cargar clientes")}</div>`)}},300)},re=async(ne="")=>{clearTimeout(le.item),le.item=setTimeout(async()=>{try{const r=o==="products"?p:u,a=ne?`?search=${encodeURIComponent(ne)}&limit=100`:"?limit=100",s=await(await fetch(`${r}${a}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).json();s?.status==="success"&&s?.data?.items&&R&&(s.data.items.length===0?R.innerHTML=`
                            <div class="col-span-full rounded-xl border-2 border-dashed border-gray-300 p-12 text-center dark:border-gray-700">
                                <i class="fa-solid fa-box-open mb-4 text-5xl text-gray-400"></i>
                                <p class="text-gray-500 dark:text-gray-400">${Y("No se encontraron resultados")}</p>
                            </div>
                        `:(R.innerHTML=s.data.items.map(l=>{const y=c.find(C=>C.item_id===l.id&&C.item_type===(o==="products"?"product":"service")),h=y!==void 0;return`
                                <div
                                    class="group relative cursor-pointer rounded-lg border-2 border-gray-200 bg-white p-4 text-center transition-all hover:border-primary hover:shadow-lg active:scale-95 dark:border-gray-700 dark:bg-slate-800 ${h?"border-primary bg-primary/5":""}"
                                    data-quotation-item="${l.id}"
                                    data-quotation-item-type="${o==="products"?"product":"service"}"
                                >
                                    <div class="mx-auto mb-3 flex h-20 w-20 items-center justify-center rounded-lg bg-gray-100 dark:bg-slate-700">
                                        <i class="fa-solid ${o==="products"?"fa-box":"fa-wrench"} text-3xl text-gray-400"></i>
                                    </div>
                                    <h3 class="mb-2 text-sm font-semibold text-gray-900 line-clamp-2 dark:text-white">
                                        ${l.name}
                                    </h3>
                                    ${l.sku?`<p class="mb-2 text-xs text-gray-500 dark:text-gray-400">${l.sku}</p>`:""}
                                    <p class="text-lg font-bold text-primary">
                                        ${J(l.price)}
                                    </p>
                                    ${h?`
                                        <div class="absolute top-2 right-2 rounded-full bg-primary px-2 py-1 text-xs font-bold text-white">
                                            ${y.quantity}
                                        </div>
                                    `:""}
                                </div>
                            `}).join(""),R.querySelectorAll("[data-quotation-item]").forEach(l=>{l.addEventListener("click",()=>{const y=l.dataset.quotationItem,h=l.dataset.quotationItemType,C=s.data.items.find(V=>V.id===y);if(!C)return;const D=c.findIndex(V=>V.item_id===C.id&&V.item_type===h);D>=0?c[D].quantity+=1:c.push({item_id:C.id,item_type:h,name:C.name,sku:C.sku||"",quantity:1,unit_price:C.price}),me(),G(),re(E?.value||"")})})))}catch(r){console.error("[Quotation] Error loading items",r),R&&(R.innerHTML=`
                        <div class="col-span-full rounded-xl border-2 border-dashed border-red-300 p-12 text-center dark:border-red-700">
                            <i class="fa-solid fa-exclamation-triangle mb-4 text-5xl text-red-400"></i>
                            <p class="text-red-500 dark:text-red-400">${Y("Error al cargar items")}</p>
                        </div>
                    `)}},300)};S&&(S.addEventListener("focus",()=>{M&&(M.hidden=!1,M.dataset.open="true",pe(""))}),S.addEventListener("input",ne=>{pe(ne.target.value)}),document.addEventListener("click",ne=>{x&&!x.contains(ne.target)&&M&&(M.hidden=!0,M.dataset.open="false")})),E&&(E.addEventListener("input",ne=>{re(ne.target.value)}),re("")),se.forEach(ne=>{ne.addEventListener("click",()=>{const r=ne.dataset.quotationTab;o=r,se.forEach(a=>{a.dataset.quotationTab===r?(a.classList.remove("bg-gray-200","text-gray-700","dark:bg-slate-700","dark:text-gray-300","dark:hover:bg-slate-600"),a.classList.add("bg-primary","text-white","hover:bg-primary-strong")):(a.classList.remove("bg-primary","text-white","hover:bg-primary-strong"),a.classList.add("bg-gray-200","text-gray-700","dark:bg-slate-700","dark:text-gray-300","dark:hover:bg-slate-600"))}),E&&(E.placeholder=Y(r==="products"?"Buscar productos por nombre o SKU...":"Buscar servicios por nombre..."),E.value=""),re("")})}),A?.addEventListener("click",ne=>{const r=ne.target.closest("[data-cart-item-decrease]");if(r){const s=parseInt(r.dataset.cartItemDecrease);c[s].quantity>1&&(c[s].quantity-=1,me(),G());return}const a=ne.target.closest("[data-cart-item-increase]");if(a){const s=parseInt(a.dataset.cartItemIncrease);c[s].quantity+=1,me(),G();return}const i=ne.target.closest("[data-cart-item-remove]");if(i){const s=parseInt(i.dataset.cartItemRemove);c.splice(s,1),me(),G(),re(E?.value||"");return}}),A?.addEventListener("change",ne=>{const r=ne.target.closest("[data-cart-item-quantity]");if(r){const a=parseInt(r.dataset.cartItemQuantity),i=parseInt(r.value)||1;c[a].quantity=Math.max(1,i),me(),G()}}),ie&&ie.addEventListener("submit",ne=>{if(!f&&!P?.value){ne.preventDefault(),g({title:Y("Error"),text:Y("Debes seleccionar un cliente para continuar."),icon:"error"}),S&&S.focus();return}if(c.length===0){ne.preventDefault(),g({title:Y("Error"),text:Y("Debes agregar al menos un item (producto o servicio) a la cotización para continuar."),icon:"error"}),E&&E.focus();return}c.forEach((r,a)=>{const i=document.createElement("input");i.type="hidden",i.name=`items[${a}][item_id]`,i.value=r.item_id,ie.appendChild(i);const s=document.createElement("input");s.type="hidden",s.name=`items[${a}][item_type]`,s.value=r.item_type,ie.appendChild(s);const l=document.createElement("input");l.type="hidden",l.name=`items[${a}][quantity]`,l.value=r.quantity,ie.appendChild(l);const y=document.createElement("input");y.type="hidden",y.name=`items[${a}][unit_price]`,y.value=r.unit_price,ie.appendChild(y)})}),d&&window.addEventListener("quotation:loadItems",ne=>{ne.detail&&Array.isArray(ne.detail)&&(c=ne.detail,me(),G(),re(E?.value||""))}),me(),G()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",gr,{once:!0}):gr();
